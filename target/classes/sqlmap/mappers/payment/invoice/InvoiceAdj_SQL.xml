<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.coway.trust.biz.payment.invoice.service.impl.InvoiceAdjMapper">
    <select id="selectInvoiceAdjList" parameterType="Map" resultType="egovMap">
        SELECT DISTINCT UnionAll2.MEMO_ADJ_ID MEMO_ADJ_ID  ,
			       UnionAll2.MEMOADJUSTID1 MEMOADJUSTID1  ,
			       UnionAll2.MEMO_ADJ_REF_NO MEMO_ADJ_REF_NO  ,
			       UnionAll2.MEMO_ADJ_INVC_NO MEMO_ADJ_INVC_NO  ,
			       UnionAll2.MEMO_ADJ_RPT_NO MEMO_ADJ_RPT_NO  ,
			       UnionAll2.RESN_DESC RESN_DESC  ,
			       UnionAll2.CODE CODE  ,
			       UnionAll2.MEMO_ADJ_STUS_ID MEMO_ADJ_STUS_ID  ,
			       UnionAll2.CODE1 CODE1  ,
			       UnionAll2.MEMO_ITM_CHRG MEMO_ITM_CHRG  ,
			       UnionAll2.MEMO_ITM_TXS MEMO_ITM_TXS  ,
			       UnionAll2.MEMO_ITM_AMT MEMO_ITM_AMT  ,
			       UnionAll2.INVC_ITM_ORD_NO INVC_ITM_ORD_NO  ,
			       UnionAll2.USER_NAME USER_NAME  ,
			       TO_CHAR(UnionAll2.MEMO_ADJ_CRT_DT, 'DD-MM-YYYY') MEMO_ADJ_CRT_DT  ,
			       UnionAll2.MEMO_ADJ_INVC_TYPE_ID MEMO_ADJ_INVC_TYPE_ID  ,
			       UnionAll2.TAX_INVC_TYPE TAX_INVC_TYPE,
			       UnionAll2.DEPT_NAME,
			       UnionAll2.MEMO_ADJ_REM,
			       UnionAll2.UPD_USER_NAME,
                   TO_CHAR(UnionAll2.MEMO_ADJ_UPD_DT, 'DD-MM-YYYY') MEMO_ADJ_UPD_DT,
                   UnionAll2.BATCH_ID
			  FROM ( SELECT UnionAll1.MEMO_ADJ_ID MEMO_ADJ_ID  ,
			                UnionAll1.MEMOADJUSTID1 MEMOADJUSTID1  ,
			                UnionAll1.MEMO_ADJ_REF_NO MEMO_ADJ_REF_NO  ,
			                UnionAll1.MEMO_ADJ_INVC_NO MEMO_ADJ_INVC_NO  ,
			                UnionAll1.MEMO_ADJ_RPT_NO MEMO_ADJ_RPT_NO  ,
			                UnionAll1.RESN_DESC RESN_DESC  ,
			                UnionAll1.CODE CODE  ,
			                UnionAll1.MEMO_ADJ_STUS_ID MEMO_ADJ_STUS_ID  ,
			                UnionAll1.CODE1 CODE1  ,
			                UnionAll1.MEMO_ITM_CHRG MEMO_ITM_CHRG  ,
			                UnionAll1.MEMO_ITM_TXS MEMO_ITM_TXS  ,
			                UnionAll1.MEMO_ITM_AMT MEMO_ITM_AMT  ,
			                UnionAll1.INVC_ITM_ORD_NO INVC_ITM_ORD_NO  ,
			                UnionAll1.USER_NAME USER_NAME  ,
			                UnionAll1.MEMO_ADJ_CRT_DT MEMO_ADJ_CRT_DT  ,
			                UnionAll1.MEMO_ADJ_INVC_TYPE_ID MEMO_ADJ_INVC_TYPE_ID  ,
			                UnionAll1.TAX_INVC_TYPE TAX_INVC_TYPE,
			                UnionAll1.DEPT_NAME,
			                UnionAll1.MEMO_ADJ_REM,
			                UnionAll1.UPD_USER_NAME,
                            UnionAll1.MEMO_ADJ_UPD_DT,
                            UnionAll1.BATCH_ID
			         FROM ( SELECT Extent1.MEMO_ADJ_ID MEMO_ADJ_ID  ,
			                       Extent1.MEMO_ADJ_ID MEMOADJUSTID1  ,
			                       Extent1.MEMO_ADJ_REF_NO MEMO_ADJ_REF_NO  ,
			                       Extent1.MEMO_ADJ_INVC_NO MEMO_ADJ_INVC_NO  ,
			                       Extent1.MEMO_ADJ_RPT_NO MEMO_ADJ_RPT_NO  ,
			                       Extent3.RESN_DESC RESN_DESC  ,
			                       Extent4.CODE CODE  ,
			                       Extent1.MEMO_ADJ_STUS_ID MEMO_ADJ_STUS_ID  ,
			                       Extent8.CODE CODE1  ,
			                       Extent2.MEMO_ITM_CHRG MEMO_ITM_CHRG  ,
			                       Extent2.MEMO_ITM_TXS MEMO_ITM_TXS  ,
			                       Extent2.MEMO_ITM_AMT MEMO_ITM_AMT  ,
			                       Extent6.INVC_ITM_ORD_NO INVC_ITM_ORD_NO  ,
			                       Extent7.USER_NAME USER_NAME  ,
			                       Extent1.MEMO_ADJ_CRT_DT MEMO_ADJ_CRT_DT  ,
			                       Extent1.MEMO_ADJ_INVC_TYPE_ID MEMO_ADJ_INVC_TYPE_ID  ,
			                       0 TAX_INVC_TYPE ,
			                       (CASE WHEN  Extent7.USER_DEPT_ID IS NULL OR NVL(Extent7.USER_DEPT_ID,0) = 0 THEN '-' ELSE Extent9.DEPT_NAME END) AS DEPT_NAME,
			                       Extent1.MEMO_ADJ_REM,
			                       Extent71.USER_NAME UPD_USER_NAME,
                                   Extent1.MEMO_ADJ_UPD_DT MEMO_ADJ_UPD_DT,
                                   Extent1.BATCH_ID
			                FROM PAY0011D Extent1
			                       JOIN PAY0012D Extent2   ON Extent2.MEMO_ADJ_ID = Extent1.MEMO_ADJ_ID
			                       LEFT JOIN SYS0032M Extent3   ON Extent3.RESN_ID = Extent1.MEMO_ADJ_RESN_ID
			                       LEFT JOIN SYS0013M Extent4   ON Extent4.CODE_ID = Extent1.MEMO_ADJ_TYPE_ID
			                       JOIN PAY0029D Extent5   ON Extent5.TAX_INVC_REF_NO = Extent1.MEMO_ADJ_INVC_NO
			                       JOIN PAY0030D Extent6   ON Extent6.INVC_ITM_ID = Extent2.MEMO_ITM_INVC_ITM_ID
			                       LEFT JOIN SYS0047M Extent7   ON Extent7.USER_ID = Extent1.MEMO_ADJ_CRT_USER_ID
			                       LEFT JOIN SYS0038M Extent8   ON Extent8.STUS_CODE_ID = Extent1.MEMO_ADJ_STUS_ID
			                       LEFT JOIN SYS0040M Extent9   ON Extent7.USER_DEPT_ID = Extent9.DEPT_ID
			                       LEFT JOIN SYS0047M Extent71  ON Extent71.USER_ID = Extent1.MEMO_ADJ_UPD_USER_ID
			                       <if test="mode == 'APPROVAL' ">
				                       INNER JOIN PAY0292D extent232
	                                   ON (extent1.BATCH_ID = LTRIM(extent232.MEMO_ADJ_ID, 'BCH') OR TO_CHAR(extent1.MEMO_ADJ_ID) = LTRIM(extent232.MEMO_ADJ_ID, 'BCH'))
	                                   <if test="apprGrp == null or apprGrp == '' ">
	                                       AND extent232.MEMO_APPV_STUS = 'R'
	                                       AND extent232.MEMO_APPR_USER_ID = #{memCode}
	                                   </if>
	                                   <if test="apprGrp != null and apprGrp != '' ">
	                                       AND extent232.MEMO_APPV_STUS = 'R'
                                         JOIN FCM0023M F ON F.APPR_MEM_CODE = extent232.MEMO_APPR_USER_ID AND APPR_GRP = #{apprGrp}
	                                       <!-- AND extent232.MEMO_APPR_USER_ID IN (
	                                           SELECT APPR_MEM_CODE
	                                           FROM FCM0023M
	                                           WHERE APPR_GRP = #{apprGrp}
	                                       ) -->
	                                   </if>
			                       </if>
			                WHERE 1=1
			                        <if test="orderNo != null and orderNo != '' " >
								    AND Extent6.INVC_ITM_ORD_NO = #{orderNo}
								    </if>
								    <if test="adjNo != null and adjNo != '' ">
								    AND Extent1.MEMO_ADJ_REF_NO = #{adjNo}
								    </if>
								    <if test="status != null and status != '' ">
								    AND Extent1.MEMO_ADJ_STUS_ID = #{status}
								    </if>
								    <if test="invoiceNo != null and invoiceNo != '' ">
								    AND Extent1.MEMO_ADJ_INVC_NO = #{invoiceNo}
								    </if>
								    <if test="reportNo != null and reportNo != '' ">
								    AND Extent1.MEMO_ADJ_RPT_NO = #{reportNo}
								    </if>
								    <if test="creator != null and creator != '' ">
								    AND Extent7.USER_NAME LIKE '%' || #{creator} || '%' ESCAPE '~'
								    </if>
								    <if test="date1 != null and date2 != null and date1 != '' and date2 != '' ">
								    AND
								        Extent1.MEMO_ADJ_CRT_DT <![CDATA[>=]]> TO_DATE(#{date1}, 'DD/MM/YYYY')
								        AND Extent1.MEMO_ADJ_CRT_DT<![CDATA[<]]> TO_DATE(#{date2}, 'DD/MM/YYYY')+1
								    </if>
								    <if test="batchId != null and batchId != '' ">
                                    AND Extent1.MEMO_ADJ_ID IN (SELECT MEMO_ADJ_ID FROM PAY0123M WHERE BATCH_ID = #{batchId})
                                    </if>
                                    <if test="deptNm != null and deptNm != '' ">
                                    AND Extent9.DEPT_NAME LIKE '%' || #{deptNm} || '%' ESCAPE '~'
                                    </if>
			                UNION ALL
			                SELECT Extent9.MEMO_ADJ_ID MEMO_ADJ_ID  ,
			                       Extent9.MEMO_ADJ_ID MEMOADJUSTID1  ,
			                       Extent9.MEMO_ADJ_REF_NO MEMO_ADJ_REF_NO  ,
			                       Extent9.MEMO_ADJ_INVC_NO MEMO_ADJ_INVC_NO  ,
			                       Extent9.MEMO_ADJ_RPT_NO MEMO_ADJ_RPT_NO  ,
			                       Extent11.RESN_DESC RESN_DESC  ,
			                       Extent12.CODE CODE  ,
			                       Extent9.MEMO_ADJ_STUS_ID MEMO_ADJ_STUS_ID  ,
			                       Extent16.CODE CODE1  ,
			                       Extent10.MEMO_ITM_CHRG MEMO_ITM_CHRG  ,
			                       Extent10.MEMO_ITM_TXS MEMO_ITM_TXS  ,
			                       Extent10.MEMO_ITM_AMT MEMO_ITM_AMT  ,
			                       Extent14.INVC_ITM_ORD_NO INVC_ITM_ORD_NO  ,
			                       Extent15.USER_NAME USER_NAME  ,
			                       Extent9.MEMO_ADJ_CRT_DT MEMO_ADJ_CRT_DT  ,
			                       Extent9.MEMO_ADJ_INVC_TYPE_ID MEMO_ADJ_INVC_TYPE_ID  ,
			                       0 TAX_INVC_TYPE  ,
			                       (CASE WHEN  Extent15.USER_DEPT_ID IS NULL OR NVL(Extent15.USER_DEPT_ID,0) = 0 THEN '-' ELSE Extent17.DEPT_NAME END) AS DEPT_NAME,
			                       Extent9.MEMO_ADJ_REM,
                                   Extent151.USER_NAME UPD_USER_NAME,
                                   Extent9.MEMO_ADJ_UPD_DT MEMO_ADJ_UPD_DT,
                                   Extent9.BATCH_ID
			                FROM PAY0011D Extent9
			                       JOIN PAY0012D Extent10   ON Extent10.MEMO_ADJ_ID = Extent9.MEMO_ADJ_ID
			                       LEFT JOIN SYS0032M Extent11   ON Extent11.RESN_ID = Extent9.MEMO_ADJ_RESN_ID
			                       LEFT JOIN SYS0013M Extent12   ON Extent12.CODE_ID = Extent9.MEMO_ADJ_TYPE_ID
			                       JOIN PAY0033D Extent13   ON Extent13.TAX_INVC_REF_NO = Extent9.MEMO_ADJ_INVC_NO
			                       JOIN PAY0034D Extent14   ON Extent14.INVC_ITM_ID = Extent10.MEMO_ITM_INVC_ITM_ID
			                       LEFT JOIN SYS0047M Extent15   ON Extent15.USER_ID = Extent9.MEMO_ADJ_CRT_USER_ID
			                       LEFT JOIN SYS0038M Extent16   ON Extent16.STUS_CODE_ID = Extent9.MEMO_ADJ_STUS_ID
			                       LEFT JOIN SYS0040M Extent17   ON Extent15.USER_DEPT_ID = Extent17.DEPT_ID
			                       LEFT JOIN SYS0047M Extent151  ON Extent151.USER_ID = Extent9.MEMO_ADJ_UPD_USER_ID
			                       <if test="mode == 'APPROVAL' ">
				                       INNER JOIN PAY0292D extent233
	                                   ON (extent9.BATCH_ID = LTRIM(extent233.MEMO_ADJ_ID, 'BCH') OR TO_CHAR(extent9.MEMO_ADJ_ID) = LTRIM(extent233.MEMO_ADJ_ID, 'BCH'))
	                                   <if test="apprGrp == null or apprGrp == '' ">
	                                       AND extent233.MEMO_APPV_STUS = 'R'
	                                       AND extent233.MEMO_APPR_USER_ID = #{memCode}
	                                   </if>
	                                   <if test="apprGrp != null and apprGrp != '' ">
	                                       AND extent233.MEMO_APPV_STUS = 'R'
                                         JOIN FCM0023M F ON F.APPR_MEM_CODE = extent233.MEMO_APPR_USER_ID AND APPR_GRP = #{apprGrp}
	                                       <!-- AND extent233.MEMO_APPR_USER_ID IN (
	                                           SELECT APPR_MEM_CODE
	                                           FROM FCM0023M
	                                           WHERE APPR_GRP = #{apprGrp}
	                                       ) -->
	                                   </if>
                                   </if>
			                 WHERE 1=1
                                    <if test="orderNo != null and orderNo != '' " >
                                    AND Extent14.INVC_ITM_ORD_NO = #{orderNo}
                                    </if>
                                    <if test="adjNo != null and adjNo != '' ">
                                    AND Extent9.MEMO_ADJ_REF_NO = #{adjNo}
                                    </if>
                                    <if test="status != null and status != '' ">
                                    AND Extent9.MEMO_ADJ_STUS_ID = #{status}
                                    </if>
                                    <if test="invoiceNo != null and invoiceNo != '' ">
                                    AND Extent9.MEMO_ADJ_INVC_NO = #{invoiceNo}
                                    </if>
                                    <if test="reportNo != null and reportNo != '' ">
                                    AND Extent9.MEMO_ADJ_RPT_NO = #{reportNo}
                                    </if>
                                    <if test="creator != null and creator != '' ">
                                    AND Extent15.USER_NAME LIKE '%' || #{creator} || '%' ESCAPE '~'
                                    </if>
                                    <if test="date1 != null and date2 != null and date1 != '' and date2 != '' ">
                                    AND
                                        Extent9.MEMO_ADJ_CRT_DT <![CDATA[>=]]> TO_DATE(#{date1}, 'DD/MM/YYYY')
                                        AND Extent9.MEMO_ADJ_CRT_DT<![CDATA[<]]> TO_DATE(#{date2}, 'DD/MM/YYYY')+1
                                    </if>
                                    <if test="batchId != null and batchId != '' ">
                                    AND Extent9.MEMO_ADJ_ID IN (SELECT MEMO_ADJ_ID FROM PAY0123M WHERE BATCH_ID = #{batchId})
                                    </if>
                                    <if test="deptNm != null and deptNm != '' ">
                                    AND Extent17.DEPT_NAME LIKE '%' || #{deptNm} || '%' ESCAPE '~'
                                    </if>
                                    UNION ALL
                                    SELECT Extent25.ADJ_ENTRY_ID MEMO_ADJ_ID  ,
                            Extent25.ADJ_ENTRY_ID MEMOADJUSTID1  ,
                            Extent25.ADJ_ENTRY_NOTE_NO MEMO_ADJ_REF_NO  ,
                            Extent25.ADJ_ENTRY_INVC_NO MEMO_ADJ_INVC_NO  ,
                            Extent25.ADJ_ENTRY_RPT_NO MEMO_ADJ_RPT_NO  ,
                            Extent27.RESN_DESC RESN_DESC  ,
                            Extent28.CODE CODE  ,
                            Extent25.ADJ_ENTRY_STUS_ID MEMO_ADJ_STUS_ID  ,
                            Extent30.CODE CODE1  ,
                            Extent26.ADJ_RESULT_AMT MEMO_ITM_CHRG  ,
                            Extent26.ADJ_RESULT_TXS MEMO_ITM_TXS  ,
                            Extent26.ADJ_RESULT_AMT MEMO_ITM_AMT  ,
                            Extent33.SALES_ORD_NO INVC_ITM_ORD_NO  ,
                            Extent29.USER_NAME USER_NAME  ,
                            Extent25.ADJ_ENTRY_CRT_DT MEMO_ADJ_CRT_DT  ,
                            Extent25.ADJ_ENTRY_INVC_TYPE_ID MEMO_ADJ_INVC_TYPE_ID  ,
                            0 TAX_INVC_TYPE ,
                            (CASE WHEN  Extent29.USER_DEPT_ID IS NULL OR NVL(Extent29.USER_DEPT_ID,0) = 0 THEN '-' ELSE Extent31.DEPT_NAME END) AS DEPT_NAME,
                            Extent25.ADJ_ENTRY_REM MEMO_ADJ_REM,
                            Extent32.USER_NAME UPD_USER_NAME,
                            Extent25.ADJ_ENTRY_UPD_DT MEMO_ADJ_UPD_DT,
                            0 BATCH_ID
                     FROM PAY0002D Extent25
                            JOIN PAY0003D Extent26   ON Extent26.ADJ_RESULT_ENTRY_ID = Extent25.ADJ_ENTRY_ID
                            LEFT JOIN SYS0032M Extent27   ON Extent27.RESN_ID = Extent25.ADJ_ENTRY_RESN_ID
                            LEFT JOIN SYS0013M Extent28   ON Extent28.CODE_ID = Extent25.ADJ_ENTRY_NOTE_TYPE_ID
                            LEFT JOIN SYS0047M Extent29   ON Extent29.USER_ID = Extent25.F_ADJ_ENTRY_CRT_USER_ID
                            LEFT JOIN SYS0038M Extent30   ON Extent30.STUS_CODE_ID = Extent25.ADJ_ENTRY_STUS_ID
                            LEFT JOIN SYS0040M Extent31   ON Extent29.USER_DEPT_ID = Extent31.DEPT_ID
                            LEFT JOIN SYS0047M Extent32  ON Extent32.USER_ID = Extent25.ADJ_ENTRY_UPD_USER_ID
                            LEFT JOIN SAL0001D Extent33  ON Extent33.SALES_ORD_ID = Extent25.ADJ_ENTRY_SO_ID
                            <if test="mode == 'APPROVAL' ">
	                            INNER JOIN PAY0292D extent234 ON extent25.ADJ_ENTRY_ID = LTRIM(extent234.MEMO_ADJ_ID, 'BCH')
	                            <if test="apprGrp == null or apprGrp == '' ">
	                                AND extent234.MEMO_APPV_STUS = 'R'
	                                AND extent234.MEMO_APPR_USER_ID = #{memCode}
	                            </if>
	                            <if test="apprGrp != null and apprGrp != '' ">
	                               AND extent234.MEMO_APPV_STUS = 'R'
                                 JOIN FCM0023M F ON F.APPR_MEM_CODE = extent234.MEMO_APPR_USER_ID AND APPR_GRP = #{apprGrp}
	                                <!-- AND extent234.MEMO_APPR_USER_ID IN (
	                                           SELECT APPR_MEM_CODE
	                                           FROM FCM0023M
	                                           WHERE APPR_GRP = #{apprGrp}
	                                       ) -->
	                            </if>
                            </if>
                    WHERE 1=1
                                     <if test="orderNo != null and orderNo != '' " >
                                    AND Extent33.SALES_ORD_NO = #{orderNo}
                                    </if>
                                    <if test="adjNo != null and adjNo != '' ">
                                    AND Extent25.ADJ_ENTRY_NOTE_NO = #{adjNo}
                                    </if>
                                    <if test="status != null and status != '' ">
                                    AND Extent25.ADJ_ENTRY_STUS_ID = #{status}
                                    </if>
                                    <if test="invoiceNo != null and invoiceNo != '' ">
                                    AND Extent25.ADJ_ENTRY_INVC_NO = #{invoiceNo}
                                    </if>
                                    <if test="reportNo != null and reportNo != '' ">
                                    AND Extent25.ADJ_ENTRY_RPT_NO = #{reportNo}
                                    </if>
                                    <if test="creator != null and creator != '' ">
                                    AND Extent29.USER_NAME LIKE '%' || #{creator} || '%' ESCAPE '~'
                                    </if>
                                    <if test="date1 != null and date2 != null and date1 != '' and date2 != '' ">
                                    AND
                                        Extent25.ADJ_ENTRY_CRT_DT <![CDATA[>=]]> TO_DATE(#{date1}, 'DD/MM/YYYY')
                                        AND Extent25.ADJ_ENTRY_CRT_DT<![CDATA[<]]> TO_DATE(#{date2}, 'DD/MM/YYYY')+1
                                    </if>
                                    <if test="batchId != null and batchId != '' ">
                                    AND Extent25.ADJ_ENTRY_ID IN (SELECT MEMO_ADJ_ID FROM PAY0123M WHERE BATCH_ID = #{batchId})
                                    </if>
                                    <if test="deptNm != null and deptNm != '' ">
                                    AND Extent31.DEPT_NAME LIKE '%' || #{deptNm} || '%' ESCAPE '~'
                                    </if>
			                       ) UnionAll1

			         UNION ALL
			         SELECT Extent17.MEMO_ADJ_ID MEMO_ADJ_ID  ,
			                Extent17.MEMO_ADJ_ID MEMOADJUSTID1  ,
			                Extent17.MEMO_ADJ_REF_NO MEMO_ADJ_REF_NO  ,
			                Extent17.MEMO_ADJ_INVC_NO MEMO_ADJ_INVC_NO  ,
			                Extent17.MEMO_ADJ_RPT_NO MEMO_ADJ_RPT_NO  ,
			                Extent19.RESN_DESC RESN_DESC  ,
			                Extent20.CODE CODE  ,
			                Extent17.MEMO_ADJ_STUS_ID MEMO_ADJ_STUS_ID  ,
			                Extent24.CODE CODE1  ,
			                Extent18.MEMO_ITM_CHRG MEMO_ITM_CHRG  ,
			                Extent18.MEMO_ITM_TXS MEMO_ITM_TXS  ,
			                Extent18.MEMO_ITM_AMT MEMO_ITM_AMT  ,
			                Extent22.INVC_ITM_ORD_NO INVC_ITM_ORD_NO  ,
			                Extent23.USER_NAME USER_NAME  ,
			                Extent17.MEMO_ADJ_CRT_DT MEMO_ADJ_CRT_DT  ,
			                Extent17.MEMO_ADJ_INVC_TYPE_ID MEMO_ADJ_INVC_TYPE_ID  ,
			                Extent21.TAX_INVC_TYPE TAX_INVC_TYPE ,
			                (CASE WHEN  Extent23.USER_DEPT_ID IS NULL OR NVL(Extent23.USER_DEPT_ID,0) = 0 THEN '-' ELSE Extent9.DEPT_NAME END) AS DEPT_NAME,
			                Extent17.MEMO_ADJ_REM,
			                Extent231.USER_NAME UPD_USER_NAME,
                            Extent17.MEMO_ADJ_UPD_DT MEMO_ADJ_UPD_DT,
                            Extent17.BATCH_ID
			         FROM PAY0011D Extent17
			                JOIN PAY0012D Extent18   ON Extent18.MEMO_ADJ_ID = Extent17.MEMO_ADJ_ID
			                LEFT JOIN SYS0032M Extent19   ON Extent19.RESN_ID = Extent17.MEMO_ADJ_RESN_ID
			                LEFT JOIN SYS0013M Extent20   ON Extent20.CODE_ID = Extent17.MEMO_ADJ_TYPE_ID
			                JOIN PAY0031D Extent21   ON Extent21.TAX_INVC_REF_NO = Extent17.MEMO_ADJ_INVC_NO
			                JOIN PAY0032D Extent22   ON Extent22.INVC_ITM_ID = Extent18.MEMO_ITM_INVC_ITM_ID
			                LEFT JOIN SYS0047M Extent23   ON Extent23.USER_ID = Extent17.MEMO_ADJ_CRT_USER_ID
			                LEFT JOIN SYS0038M Extent24   ON Extent24.STUS_CODE_ID = Extent17.MEMO_ADJ_STUS_ID
			                LEFT JOIN SYS0040M Extent9   ON Extent23.USER_DEPT_ID = Extent9.DEPT_ID
			                LEFT JOIN SYS0047M Extent231  ON Extent231.USER_ID = Extent17.MEMO_ADJ_UPD_USER_ID
			                <if test="mode == 'APPROVAL' ">
				                INNER JOIN PAY0292D extent235
	                            ON (extent17.BATCH_ID = LTRIM(extent235.MEMO_ADJ_ID, 'BCH') OR TO_CHAR(extent17.memo_adj_id) = LTRIM(extent235.MEMO_ADJ_ID, 'BCH'))
	                            <if test="apprGrp == null or apprGrp == '' ">
	                                AND extent235.MEMO_APPV_STUS = 'R'
	                                AND extent235.MEMO_APPR_USER_ID = #{memCode}
	                            </if>
	                            <if test="apprGrp != null and apprGrp != '' ">
	                                AND extent235.MEMO_APPV_STUS = 'R'
                                  JOIN FCM0023M F ON F.APPR_MEM_CODE = extent235.MEMO_APPR_USER_ID AND APPR_GRP = #{apprGrp}
	                                <!-- AND extent235.MEMO_APPR_USER_ID IN (
	                                           SELECT APPR_MEM_CODE
	                                           FROM FCM0023M
	                                           WHERE APPR_GRP = #{apprGrp}
	                                       ) -->
	                            </if>
                            </if>
			        WHERE 1=1
			                         <if test="orderNo != null and orderNo != '' " >
                                    AND Extent22.INVC_ITM_ORD_NO = #{orderNo}
                                    </if>
                                    <if test="adjNo != null and adjNo != '' ">
                                    AND Extent17.MEMO_ADJ_REF_NO = #{adjNo}
                                    </if>
                                    <if test="status != null and status != '' ">
                                    AND Extent17.MEMO_ADJ_STUS_ID = #{status}
                                    </if>
                                    <if test="invoiceNo != null and invoiceNo != '' ">
                                    AND Extent17.MEMO_ADJ_INVC_NO = #{invoiceNo}
                                    </if>
                                    <if test="reportNo != null and reportNo != '' ">
                                    AND Extent17.MEMO_ADJ_RPT_NO = #{reportNo}
                                    </if>
                                    <if test="creator != null and creator != '' ">
                                    AND Extent23.USER_NAME LIKE '%' || #{creator} || '%' ESCAPE '~'
                                    </if>
                                    <if test="date1 != null and date2 != null and date1 != '' and date2 != '' ">
                                    AND
                                        Extent17.MEMO_ADJ_CRT_DT <![CDATA[>=]]> TO_DATE(#{date1}, 'DD/MM/YYYY')
                                        AND Extent17.MEMO_ADJ_CRT_DT<![CDATA[<]]> TO_DATE(#{date2}, 'DD/MM/YYYY')+1
                                    </if>
                                    <if test="batchId != null and batchId != '' ">
                                    AND Extent17.MEMO_ADJ_ID IN (SELECT MEMO_ADJ_ID FROM PAY0123M WHERE BATCH_ID = #{batchId})
                                    </if>
                                    <if test="deptNm != null and deptNm != '' ">
                                    AND Extent9.DEPT_NAME LIKE '%' || #{deptNm} || '%' ESCAPE '~'
                                    </if>
			                ) UnionAll2
  ORDER BY UnionAll2.MEMOADJUSTID1 DESC
    </select>

    <select id="countAdjustmentExcelList" parameterType="Map" resultType="int">
        SELECT
            COUNT(1) AS CNT
              FROM ( SELECT UnionAll1.MEMO_ADJ_ID MEMO_ADJ_ID
                     FROM ( SELECT Extent1.MEMO_ADJ_ID MEMO_ADJ_ID
                            FROM PAY0011D Extent1
                                   JOIN PAY0012D Extent2   ON Extent2.MEMO_ADJ_ID = Extent1.MEMO_ADJ_ID
                                   LEFT JOIN SYS0032M Extent3   ON Extent3.RESN_ID = Extent1.MEMO_ADJ_RESN_ID
                                   LEFT JOIN SYS0013M Extent4   ON Extent4.CODE_ID = Extent1.MEMO_ADJ_TYPE_ID
                                   JOIN PAY0029D Extent5   ON Extent5.TAX_INVC_REF_NO = Extent1.MEMO_ADJ_INVC_NO
                                   JOIN PAY0030D Extent6   ON Extent6.INVC_ITM_ID = Extent2.MEMO_ITM_INVC_ITM_ID
                                   LEFT JOIN SYS0047M Extent7   ON Extent7.USER_ID = Extent1.MEMO_ADJ_CRT_USER_ID
                                   LEFT JOIN SYS0038M Extent8   ON Extent8.STUS_CODE_ID = Extent1.MEMO_ADJ_STUS_ID
                                   LEFT JOIN SYS0040M Extent9   ON Extent7.USER_DEPT_ID = Extent9.DEPT_ID
                                   LEFT JOIN SYS0047M Extent71  ON Extent71.USER_ID = Extent1.MEMO_ADJ_UPD_USER_ID
                            WHERE 1=1
                                    <if test="orderNo != null and orderNo != '' " >
                                    AND Extent6.INVC_ITM_ORD_NO = #{orderNo}
                                    </if>
                                    <if test="adjNo != null and adjNo != '' ">
                                    AND Extent1.MEMO_ADJ_REF_NO = #{adjNo}
                                    </if>
                                    <if test="status != null and status != '' ">
                                    AND Extent1.MEMO_ADJ_STUS_ID = #{status}
                                    </if>
                                    <if test="invoiceNo != null and invoiceNo != '' ">
                                    AND Extent1.MEMO_ADJ_INVC_NO = #{invoiceNo}
                                    </if>
                                    <if test="reportNo != null and reportNo != '' ">
                                    AND Extent1.MEMO_ADJ_RPT_NO = #{reportNo}
                                    </if>
                                    <if test="creator != null and creator != '' ">
                                    AND Extent7.USER_NAME LIKE '%' || #{creator} || '%' ESCAPE '~'
                                    </if>
                                    <if test="date1 != null and date2 != null and date1 != '' and date2 != '' ">
                                    AND
                                        Extent1.MEMO_ADJ_CRT_DT <![CDATA[>=]]> TO_DATE(#{date1}, 'DD/MM/YYYY')
                                        AND Extent1.MEMO_ADJ_CRT_DT<![CDATA[<]]> TO_DATE(#{date2}, 'DD/MM/YYYY')+1
                                    </if>
                                    <if test="batchId != null and batchId != '' ">
                                    AND Extent1.MEMO_ADJ_ID IN (SELECT MEMO_ADJ_ID FROM PAY0123M WHERE BATCH_ID = #{batchId})
                                    </if>
                                    <if test="deptNm != null and deptNm != '' ">
                                    AND Extent9.DEPT_NAME LIKE '%' || #{deptNm} || '%' ESCAPE '~'
                                    </if>
                            UNION ALL
                            SELECT Extent9.MEMO_ADJ_ID MEMO_ADJ_ID
                            FROM PAY0011D Extent9
                                   JOIN PAY0012D Extent10   ON Extent10.MEMO_ADJ_ID = Extent9.MEMO_ADJ_ID
                                   LEFT JOIN SYS0032M Extent11   ON Extent11.RESN_ID = Extent9.MEMO_ADJ_RESN_ID
                                   LEFT JOIN SYS0013M Extent12   ON Extent12.CODE_ID = Extent9.MEMO_ADJ_TYPE_ID
                                   JOIN PAY0033D Extent13   ON Extent13.TAX_INVC_REF_NO = Extent9.MEMO_ADJ_INVC_NO
                                   JOIN PAY0034D Extent14   ON Extent14.INVC_ITM_ID = Extent10.MEMO_ITM_INVC_ITM_ID
                                   LEFT JOIN SYS0047M Extent15   ON Extent15.USER_ID = Extent9.MEMO_ADJ_CRT_USER_ID
                                   LEFT JOIN SYS0038M Extent16   ON Extent16.STUS_CODE_ID = Extent9.MEMO_ADJ_STUS_ID
                                   LEFT JOIN SYS0040M Extent17   ON Extent15.USER_DEPT_ID = Extent17.DEPT_ID
                                   LEFT JOIN SYS0047M Extent151  ON Extent151.USER_ID = Extent9.MEMO_ADJ_UPD_USER_ID
                             WHERE 1=1
                                    <if test="orderNo != null and orderNo != '' " >
                                    AND Extent14.INVC_ITM_ORD_NO = #{orderNo}
                                    </if>
                                    <if test="adjNo != null and adjNo != '' ">
                                    AND Extent9.MEMO_ADJ_REF_NO = #{adjNo}
                                    </if>
                                    <if test="status != null and status != '' ">
                                    AND Extent9.MEMO_ADJ_STUS_ID = #{status}
                                    </if>
                                    <if test="invoiceNo != null and invoiceNo != '' ">
                                    AND Extent9.MEMO_ADJ_INVC_NO = #{invoiceNo}
                                    </if>
                                    <if test="reportNo != null and reportNo != '' ">
                                    AND Extent9.MEMO_ADJ_RPT_NO = #{reportNo}
                                    </if>
                                    <if test="creator != null and creator != '' ">
                                    AND Extent15.USER_NAME LIKE '%' || #{creator} || '%' ESCAPE '~'
                                    </if>
                                    <if test="date1 != null and date2 != null and date1 != '' and date2 != '' ">
                                    AND
                                        Extent9.MEMO_ADJ_CRT_DT <![CDATA[>=]]> TO_DATE(#{date1}, 'DD/MM/YYYY')
                                        AND Extent9.MEMO_ADJ_CRT_DT<![CDATA[<]]> TO_DATE(#{date2}, 'DD/MM/YYYY')+1
                                    </if>
                                    <if test="batchId != null and batchId != '' ">
                                    AND Extent9.MEMO_ADJ_ID IN (SELECT MEMO_ADJ_ID FROM PAY0123M WHERE BATCH_ID = #{batchId})
                                    </if>
                                    <if test="deptNm != null and deptNm != '' ">
                                    AND Extent17.DEPT_NAME LIKE '%' || #{deptNm} || '%' ESCAPE '~'
                                    </if>
                                   ) UnionAll1

                     UNION ALL
                     SELECT Extent17.MEMO_ADJ_ID MEMO_ADJ_ID
                     FROM PAY0011D Extent17
                            JOIN PAY0012D Extent18   ON Extent18.MEMO_ADJ_ID = Extent17.MEMO_ADJ_ID
                            LEFT JOIN SYS0032M Extent19   ON Extent19.RESN_ID = Extent17.MEMO_ADJ_RESN_ID
                            LEFT JOIN SYS0013M Extent20   ON Extent20.CODE_ID = Extent17.MEMO_ADJ_TYPE_ID
                            JOIN PAY0031D Extent21   ON Extent21.TAX_INVC_REF_NO = Extent17.MEMO_ADJ_INVC_NO
                            JOIN PAY0032D Extent22   ON Extent22.INVC_ITM_ID = Extent18.MEMO_ITM_INVC_ITM_ID
                            LEFT JOIN SYS0047M Extent23   ON Extent23.USER_ID = Extent17.MEMO_ADJ_CRT_USER_ID
                            LEFT JOIN SYS0038M Extent24   ON Extent24.STUS_CODE_ID = Extent17.MEMO_ADJ_STUS_ID
                            LEFT JOIN SYS0040M Extent9   ON Extent23.USER_DEPT_ID = Extent9.DEPT_ID
                            LEFT JOIN SYS0047M Extent231  ON Extent231.USER_ID = Extent17.MEMO_ADJ_UPD_USER_ID
                    WHERE 1=1
                                     <if test="orderNo != null and orderNo != '' " >
                                    AND Extent22.INVC_ITM_ORD_NO = #{orderNo}
                                    </if>
                                    <if test="adjNo != null and adjNo != '' ">
                                    AND Extent17.MEMO_ADJ_REF_NO = #{adjNo}
                                    </if>
                                    <if test="status != null and status != '' ">
                                    AND Extent17.MEMO_ADJ_STUS_ID = #{status}
                                    </if>
                                    <if test="invoiceNo != null and invoiceNo != '' ">
                                    AND Extent17.MEMO_ADJ_INVC_NO = #{invoiceNo}
                                    </if>
                                    <if test="reportNo != null and reportNo != '' ">
                                    AND Extent17.MEMO_ADJ_RPT_NO = #{reportNo}
                                    </if>
                                    <if test="creator != null and creator != '' ">
                                    AND Extent23.USER_NAME LIKE '%' || #{creator} || '%' ESCAPE '~'
                                    </if>
                                    <if test="date1 != null and date2 != null and date1 != '' and date2 != '' ">
                                    AND
                                        Extent17.MEMO_ADJ_CRT_DT <![CDATA[>=]]> TO_DATE(#{date1}, 'DD/MM/YYYY')
                                        AND Extent17.MEMO_ADJ_CRT_DT<![CDATA[<]]> TO_DATE(#{date2}, 'DD/MM/YYYY')+1
                                    </if>
                                    <if test="batchId != null and batchId != '' ">
                                    AND Extent17.MEMO_ADJ_ID IN (SELECT MEMO_ADJ_ID FROM PAY0123M WHERE BATCH_ID = #{batchId})
                                    </if>
                                    <if test="deptNm != null and deptNm != '' ">
                                    AND Extent9.DEPT_NAME LIKE '%' || #{deptNm} || '%' ESCAPE '~'
                                    </if>
                            ) UnionAll2

    </select>

    <select id="selectNewAdjMaster" parameterType="Map" resultType="egovMap">
        SELECT Distinct UnionAll2.TXINVOICEID TXINVOICEID  ,
       UnionAll2.TXINVOICEID1 TXINVOICEID1  ,
       UnionAll2.BR_NO BR_NO  ,
       TO_CHAR(UnionAll2.TAX_INVC_DT, 'DD-MM-YYYY') TAX_INVC_DT  ,
       UnionAll2.BILL_MONTH BILL_MONTH  ,
       UnionAll2.BILLYEAR BILLYEAR  ,
       UnionAll2.TXINVOICETYPEID TXINVOICETYPEID  ,
       UnionAll2.INVOICETYPE INVOICETYPE  ,
       UnionAll2.GROUPNO GROUPNO  ,
       UnionAll2.ORD_ID ORD_ID  ,
       UnionAll2.ORD_NO ORD_NO  ,
       UnionAll2.SERVICENO SERVICENO  ,
       UnionAll2.CUST_NAME CUST_NAME  ,
       UnionAll2.CNTC_PERSON CNTC_PERSON  ,
       UnionAll2.ADDRESS ADDRESS  ,
       UnionAll2.REM REM  ,
       UnionAll2.OVERDUE OVERDUE  ,
       UnionAll2.TAXES TAXES  ,
       UnionAll2.AMOUNTDUE AMOUNTDUE  ,
       UnionAll2.ACCOUNTCONVERSION ACCOUNTCONVERSION
  FROM ( SELECT UnionAll1.TXINVOICEID TXINVOICEID  ,
                UnionAll1.TXINVOICEID1 TXINVOICEID1  ,
                UnionAll1.BR_NO BR_NO  ,
                UnionAll1.TAX_INVC_DT TAX_INVC_DT  ,
                UnionAll1.BILL_MONTH BILL_MONTH  ,
                UnionAll1.BILLYEAR BILLYEAR  ,
                UnionAll1.TXINVOICETYPEID TXINVOICETYPEID  ,
                UnionAll1.INVOICETYPE INVOICETYPE  ,
                UnionAll1.GROUPNO GROUPNO  ,
                UnionAll1.ORD_ID ORD_ID  ,
                UnionAll1.ORD_NO ORD_NO  ,
                UnionAll1.SERVICENO SERVICENO  ,
                UnionAll1.CUST_NAME CUST_NAME  ,
                UnionAll1.CNTC_PERSON CNTC_PERSON  ,
                UnionAll1.ADDRESS ADDRESS  ,
                UnionAll1.REM REM  ,
                UnionAll1.TAX_INVC_CHRG OVERDUE  ,
                UnionAll1.TAXES TAXES  ,
                UnionAll1.AMOUNTDUE AMOUNTDUE  ,
                UnionAll1.ACCOUNTCONVERSION ACCOUNTCONVERSION
         FROM ( SELECT Extent1.TAX_INVC_ID TXINVOICEID  ,
                       Extent1.TAX_INVC_ID TXINVOICEID1  ,
                       Extent1.TAX_INVC_REF_NO BR_NO  ,
                       Extent1.TAX_INVC_REF_DT TAX_INVC_DT  ,
                       0 BILL_MONTH  ,
                       0 BILLYEAR  ,
                       128 TXINVOICETYPEID  ,
                       Extent2.CODE_MASTER_NAME INVOICETYPE  ,
                       '-' GROUPNO  ,
                       0 ORD_ID  ,
                       '-' ORD_NO  ,
                       Extent1.TAX_INVC_SVC_NO SERVICENO  ,
                       Extent1.TAX_INVC_CUST_NAME CUST_NAME  ,
                       Extent1.TAX_INVC_CNTC_PERSON CNTC_PERSON  ,
                       Extent1.TAX_INVC_ADDR1 || ' ' || Extent1.TAX_INVC_ADDR2 || ' ' || Extent1.TAX_INVC_ADDR3 || ' ' || Extent1.TAX_INVC_POST_CODE || ' ' || Extent1.TAX_INVC_STATE_NAME ADDRESS  ,
                       Extent1.TAX_INVC_REM REM  ,
                       Extent1.TAX_INVC_CHRG TAX_INVC_CHRG  ,
                       Extent1.TAX_INVC_TXS TAXES  ,
                       Extent1.TAX_INVC_AMT_DUE AMOUNTDUE  ,
                       1 ACCOUNTCONVERSION
                FROM PAY0031D Extent1
                       LEFT JOIN SYS0012M Extent2   ON Extent1.TAX_INVC_TYPE = Extent2.CODE_MASTER_ID
                 <if test="refNo != '' ">
                 WHERE  Extent1.TAX_INVC_REF_NO = #{refNo}
                 </if>
                UNION ALL
                SELECT Extent3.TAX_INVC_ID TXINVOICEID  ,
                       Extent3.TAX_INVC_ID TXINVOICEID1  ,
                       Extent3.TAX_INVC_REF_NO BR_NO  ,
                       Extent3.TAX_INVC_REF_DT TAX_INVC_DT  ,
                       utils.datepart('MONTH', Extent3.TAX_INVC_REF_DT) BILL_MONTH  ,
                       utils.datepart('YEAR', Extent3.TAX_INVC_REF_DT) BILLYEAR  ,
                       127 TXINVOICETYPEID  ,
                       'Outright' INVOICETYPE  ,
                       ' ' GROUPNO  ,
                       Extent5.SALES_ORD_ID ORD_ID  ,
                       Extent4.INVC_ITM_ORD_NO ORD_NO  ,
                       ' ' SERVICENO  ,
                       Extent3.TAX_INVC_CUST_NAME CUST_NAME  ,
                       Extent3.TAX_INVC_CNTC_PERSON CNTC_PERSON  ,
                       Extent3.TAX_INVC_ADDR1 || ' ' || Extent3.TAX_INVC_ADDR2 || ' ' || Extent3.TAX_INVC_ADDR3 || ' ' || Extent3.TAX_INVC_POST_CODE || ' ' || Extent3.TAX_INVC_STATE_NAME ADDRESS  ,
                       Extent3.TAX_INVC_REM REM  ,
                       Extent3.TAX_INVC_CHRG TAX_INVC_CHRG  ,
                       Extent4.INVC_ITM_GST_TXS TAXES  ,
                       Extent3.TAX_INVC_AMT_DUE AMOUNTDUE  ,
                       CASE
                            WHEN ( 1 = Extent6.ACC_BILL_ACCT_CNVR ) THEN 1
                       ELSE 0
                          END ACCOUNTCONVERSION
                FROM PAY0033D Extent3
                       LEFT JOIN PAY0034D Extent4   ON Extent3.TAX_INVC_ID = Extent4.TAX_INVC_ID
                       LEFT JOIN SAL0001D Extent5   ON ( Extent4.INVC_ITM_ORD_NO = Extent5.SALES_ORD_NO )
                       OR ( ( Extent4.INVC_ITM_ORD_NO IS NULL )
                       AND ( Extent5.SALES_ORD_NO IS NULL ) )
                       LEFT JOIN PAY0016D Extent6   ON Extent3.TAX_INVC_REF_NO = Extent6.ACC_BILL_REM
                 <if test="refNo != '' ">
                 WHERE  Extent3.TAX_INVC_REF_NO = #{refNo}
                 </if>
                 ) UnionAll1
         UNION ALL
         SELECT Extent7.TAX_INVC_ID TXINVOICEID  ,
                Extent7.TAX_INVC_ID TXINVOICEID1  ,
                Extent7.TAX_INVC_REF_NO BR_NO  ,
                Extent7.TAX_INVC_REF_DT TAX_INVC_DT  ,
                UTILS.CONVERT_TO_NUMBER(Extent7.TAX_INVC_MONTH,10,0) BILL_MONTH  ,
                UTILS.CONVERT_TO_NUMBER(Extent7.TAX_INVC_YEAR,10,0) BILLYEAR  ,
                126 TXINVOICETYPEID  ,
                'Rental' INVOICETYPE  ,
                Extent7.TAX_INVC_GRP_NO GROUPNO  ,
                0 ORD_ID  ,
                Extent8.INVC_ITM_ORD_NO ORD_NO  ,
                ' ' SERVICENO  ,
                Extent7.TAX_INVC_CUST_NAME CUST_NAME  ,
                Extent7.TAX_INVC_CNTC_PERSON CNTC_PERSON  ,
                Extent7.TAX_INVC_ADDR1 || ' ' || Extent7.TAX_INVC_ADDR2 || ' ' || Extent7.TAX_INVC_ADDR3 || ' ' || Extent7.TAX_INVC_POST_CODE || ' ' || Extent7.TAX_INVC_STATE_NAME ADDRESS  ,
                Extent7.TAX_INVC_REM REM  ,
                Extent7.TAX_INVC_OVERDU TAX_INVC_OVERDU  ,
                Extent8.INVC_ITM_GST_TXS TAXES  ,
                Extent7.TAX_INVC_AMT_DUE AMOUNTDUE  ,
                CASE
                     WHEN ( 1 = Extent9.ACC_BILL_ACCT_CNVR ) THEN 1
                ELSE 0
                   END ACCOUNTCONVERSION
         FROM PAY0029D Extent7
                LEFT JOIN PAY0030D Extent8   ON Extent7.TAX_INVC_ID = Extent8.TAX_INVC_ID
                LEFT JOIN PAY0016D Extent9   ON Extent7.TAX_INVC_REF_NO = Extent9.ACC_BILL_REM
          <if test="refNo != '' ">
          WHERE  Extent7.TAX_INVC_REF_NO = #{refNo}
          </if>
          ) UnionAll2
 <if test="refNo != '' ">
 WHERE  UnionAll2.BR_NO = #{refNo}
 </if>
  ORDER BY UnionAll2.BR_NO DESC
    </select>

    <select id="selectNewAdjDetailList" parameterType="Map" resultType="egovMap">
        SELECT DISTINCT
    UnionAll3.C1 C1,
    UnionAll3.TXINVOICEID  TXINVOICEID,
    UnionAll3.BR_NO  BR_NO,
    UnionAll3.TXINVOICEITEMID TXINVOICEITEMID,
    UnionAll3.TXINVOICEITEMTYPEID TXINVOICEITEMTYPEID,
    UnionAll3.BILLITEMTYPE BILLITEMTYPE,
    UnionAll3.BILLITEMREFNO BILLITEMREFNO,
    UnionAll3.BILLITEMUNITPRICE BILLITEMUNITPRICE,
    UnionAll3.BILLITEMTAXCODEID BILLITEMTAXCODEID,
    UnionAll3.BILLITEMTAXCODE BILLITEMTAXCODE,
    UnionAll3.BILLITEMTAXRATE BILLITEMTAXRATE,
    UnionAll3.BILLITEMQTY BILLITEMQTY,
    UnionAll3.BILLITEMTAXES BILLITEMTAXES,
    UnionAll3.BILLITEMCHARGES BILLITEMCHARGES,
    UnionAll3.BILLITEMAMOUNT BILLITEMAMOUNT,
    0 AS TOTAMOUNT,
    UnionAll3.BILLITEMINSTLMTNO BILLITEMINSTLMTNO ,
    UnionAll3.BILLITEMTAXINVCDT BILLITEMTAXINVCDT
    FROM  (SELECT
        UnionAll2.C1 C1,
        UnionAll2.TXINVOICEID TXINVOICEID,
        UnionAll2.BR_NO BR_NO,
        UnionAll2.TXINVOICEITEMID TXINVOICEITEMID,
        UnionAll2.TXINVOICEITEMTYPEID TXINVOICEITEMTYPEID,
        UnionAll2.BILLITEMTYPE BILLITEMTYPE,
        UnionAll2.BILLITEMREFNO BILLITEMREFNO,
        UnionAll2.BILLITEMUNITPRICE BILLITEMUNITPRICE,
        UnionAll2.BILLITEMTAXCODEID BILLITEMTAXCODEID,
        UnionAll2.BILLITEMTAXCODE BILLITEMTAXCODE,
        UnionAll2.BILLITEMTAXRATE BILLITEMTAXRATE,
        UnionAll2.BILLITEMQTY BILLITEMQTY,
        UnionAll2.BILLITEMTAXES BILLITEMTAXES,
        UnionAll2.BILLITEMCHARGES BILLITEMCHARGES,
        UnionAll2.BILLITEMAMOUNT BILLITEMAMOUNT,
        UnionAll2.BILLITEMINSTLMTNO BILLITEMINSTLMTNO ,
        UnionAll2.BILLITEMTAXINVCDT BILLITEMTAXINVCDT
        FROM  (SELECT UnionAll1.C1 C1  ,
       UnionAll1.TXINVOICEID TXINVOICEID  ,
       UnionAll1.BR_NO BR_NO  ,
       UnionAll1.TXINVOICEITEMID TXINVOICEITEMID  ,
       UnionAll1.TXINVOICEITEMTYPEID TXINVOICEITEMTYPEID  ,
       UnionAll1.BILLITEMTYPE BILLITEMTYPE  ,
       UnionAll1.BILLITEMREFNO BILLITEMREFNO  ,
       UnionAll1.BILLITEMUNITPRICE BILLITEMUNITPRICE  ,
       UnionAll1.BILLITEMTAXCODEID BILLITEMTAXCODEID  ,
       UnionAll1.BILLITEMTAXCODE BILLITEMTAXCODE  ,
       UnionAll1.BILLITEMTAXRATE BILLITEMTAXRATE  ,
       UnionAll1.BILLITEMQTY BILLITEMQTY  ,
       UnionAll1.BILLITEMTAXES BILLITEMTAXES  ,
       UnionAll1.BILLITEMCHARGES BILLITEMCHARGES  ,
       UnionAll1.BILLITEMAMOUNT BILLITEMAMOUNT  ,
       UnionAll1.BILLITEMINSTLMTNO BILLITEMINSTLMTNO ,
       UnionAll1.BILLITEMTAXINVCDT BILLITEMTAXINVCDT
  FROM ( SELECT 1 C1  ,
                Filter1.TAXINVOICEID1 TXINVOICEID  ,
                Filter1.BR_NO BR_NO  ,
                Filter1.TXINVOICEITEMID TXINVOICEITEMID  ,
                Filter1.CODEID1 TXINVOICEITEMTYPEID,
                CASE
                     WHEN ( 1265 = Filter1.TXINVOICEITEMTYPEID ) THEN Filter1.INVC_ITM_DESC1
                ELSE Filter1.CODENAME1
                   END BILLITEMTYPE  ,
                CASE
                     WHEN ( ' ' = Filter1.INVC_ITM_ORD_NO ) THEN Filter1.INVC_ITM_CODE
                ELSE Filter1.INVC_ITM_ORD_NO
                   END BILLITEMREFNO  ,
                Filter1.INVC_ITM_UNIT_PRC BILLITEMUNITPRICE  ,
                Extent5.ACC_BILL_TAX_CODE_ID BILLITEMTAXCODEID  ,
                '-' BILLITEMTAXCODE  ,
                Filter1.INVC_ITM_GST_RATE BILLITEMTAXRATE  ,
                Filter1.INVC_ITM_QTY BILLITEMQTY  ,
                Filter1.INVC_ITM_GST_TXS BILLITEMTAXES  ,
                Filter1.INVC_ITM_CHRG BILLITEMCHARGES  ,
                Filter1.INVC_ITM_AMT_DUE BILLITEMAMOUNT  ,
                Filter1.INVC_ITM_INSTLMT_NO BILLITEMINSTLMTNO ,
                 Filter1.TAX_INVC_REF_DT BILLITEMTAXINVCDT
         FROM ( SELECT Extent1.TAX_INVC_ID TAXINVOICEID1  ,
                       Extent1.TAX_INVC_REF_NO BR_NO  ,
                       Extent2.INVC_ITM_ID TXINVOICEITEMID  ,
                       Extent2.INVC_ITM_TYPE TXINVOICEITEMTYPEID  ,
                       Extent2.INVC_ITM_ORD_NO INVC_ITM_ORD_NO  ,
                       Extent2.INVC_ITM_CODE INVC_ITM_CODE  ,
                       Extent2.INVC_ITM_DESC1 INVC_ITM_DESC1  ,
                       Extent2.INVC_ITM_QTY INVC_ITM_QTY  ,
                       Extent2.INVC_ITM_UNIT_PRC INVC_ITM_UNIT_PRC  ,
                       Extent2.INVC_ITM_GST_RATE INVC_ITM_GST_RATE  ,
                       Extent2.INVC_ITM_GST_TXS INVC_ITM_GST_TXS  ,
                       Extent2.INVC_ITM_CHRG INVC_ITM_CHRG  ,
                       Extent2.INVC_ITM_AMT_DUE INVC_ITM_AMT_DUE  ,
                       Extent3.CODE_NAME CODENAME1  ,
                       Extent4.CODE_ID CODEID1  ,
                       Extent4.OLD_CODE_ID OLDCODEID1  ,
                       0 INVC_ITM_INSTLMT_NO,
                       Extent1.TAX_INVC_REF_DT TAX_INVC_REF_DT
                FROM PAY0031D Extent1
                       LEFT JOIN PAY0032D Extent2   ON Extent1.TAX_INVC_ID = Extent2.TAX_INVC_ID
                       LEFT JOIN SYS0013M Extent3   ON Extent2.INVC_ITM_TYPE = Extent3.CODE_ID
                       LEFT JOIN SYS0013M Extent4   ON ( Extent3.CODE = Extent4.CODE )
                       OR ( ( Extent3.CODE IS NULL )
                       AND ( Extent4.CODE IS NULL ) )
                 WHERE  Extent4.CODE_MASTER_ID IN ( 128,125,142,408)
               ) Filter1
                JOIN PAY0016D Extent5   ON ( Filter1.BR_NO = Extent5.ACC_BILL_REM )
                AND ( Extent5.ACC_BILL_MODE_ID = Filter1.OLDCODEID1 )
           <if test="refNo != '' ">
          WHERE  ( Filter1.BR_NO = #{refNo} ) AND ( Extent5.ACC_BILL_REM = #{refNo} )
            <if test="invcItmOrdNo != null and invcItmOrdNo != '' ">
                AND (CASE WHEN ( ' ' = Filter1.INVC_ITM_ORD_NO ) THEN Filter1.INVC_ITM_CODE ELSE Filter1.INVC_ITM_ORD_NO END) = #{invcItmOrdNo}
              </if>
              <if test="txInvoiceItemId != null and txInvoiceItemId != '' ">
                AND Filter1.TXINVOICEITEMID = #{txInvoiceItemId}
              </if>
             </if>
         UNION ALL
         SELECT 1 C1  ,
                Extent6.TAX_INVC_ID TXINVOICEID  ,
                Extent6.TAX_INVC_REF_NO BR_NO  ,
                Extent7.INVC_ITM_ID TXINVOICEITEMID  ,
                1282 TXINVOICEITEMTYPEID  ,
                'Outright' BILLITEMTYPE  ,
                Extent7.INVC_ITM_ORD_NO BILLITEMREFNO  ,
                Extent7.INVC_ITM_RENTAL_FEE BILLITEMUNITPRICE  ,
                Extent8.ACC_BILL_TAX_CODE_ID BILLITEMTAXCODEID  ,
                '-' BILLITEMTAXCODE  ,
                Extent7.INVC_ITM_GST_RATE BILLITEMTAXRATE  ,
                1 BILLITEMQTY  ,
                Extent7.INVC_ITM_GST_TXS BILLITEMTAXES  ,
                Extent7.INVC_ITM_RENTAL_FEE BILLITEMCHARGES  ,
                Extent7.INVC_ITM_AMT_DUE BILLITEMAMOUNT  ,
                0 INVC_ITM_INSTLMT_NO,
                Extent6.TAX_INVC_REF_DT BILLITEMTAXINVCDT
         FROM PAY0033D Extent6
                LEFT JOIN PAY0034D Extent7   ON Extent6.TAX_INVC_ID = Extent7.TAX_INVC_ID
                JOIN PAY0016D Extent8   ON Extent6.TAX_INVC_REF_NO = Extent8.ACC_BILL_REM
          <if test="refNo != '' ">
          WHERE  ( Extent6.TAX_INVC_REF_NO = #{refNo} ) AND ( Extent8.ACC_BILL_REM = #{refNo} )

          <if test="invcItmOrdNo != null and invcItmOrdNo != '' ">
                AND Extent7.INVC_ITM_ORD_NO = #{invcItmOrdNo}
              </if>
              <if test="txInvoiceItemId != null and txInvoiceItemId != '' ">
                AND Extent7.INVC_ITM_ID = #{txInvoiceItemId}
              </if>

          </if>
           ) UnionAll1
        UNION ALL
            SELECT 1 C1  ,
                    Extent9.TAX_INVC_ID TXINVOICEID  ,
                    Extent9.TAX_INVC_REF_NO BR_NO  ,
                    Extent10.INVC_ITM_ID TXINVOICEITEMID  ,
                    CASE
                    WHEN ( 0 <![CDATA[<>]]> Extent11.ACC_BILL_CNTRCT_ID ) THEN CASE
                                                                        WHEN ( 0 = Extent10.INVC_ITM_INSTLMT_NO ) THEN 1327
                    ELSE 1326
                        END
                    WHEN ( 0 = Extent10.INVC_ITM_INSTLMT_NO ) THEN 1280
                    ELSE 1279
                    END TXINVOICEITEMTYPEID  ,
                    CASE
                    WHEN ( 0 = Extent10.INVC_ITM_INSTLMT_NO ) THEN 'RPF'
                    ELSE 'Rental'
                    END BILLITEMTYPE  ,
                    Extent10.INVC_ITM_ORD_NO BILLITEMREFNO  ,
                    Extent10.INVC_ITM_RENTAL_FEE BILLITEMUNITPRICE  ,
                    CASE
                    WHEN ( Extent11.ACC_BILL_TAX_CODE_ID IS NULL ) THEN Extent12.ACC_BILL_TAX_CODE_ID
                    ELSE Extent11.ACC_BILL_TAX_CODE_ID
                    END BILLITEMTAXCODEID  ,
                    '-' BILLITEMTAXCODE  ,
                    Extent10.INVC_ITM_GST_RATE BILLITEMTAXRATE  ,
                    1 BILLITEMQTY  ,
                    Extent10.INVC_ITM_GST_TXS BILLITEMTAXES  ,
                    Extent10.INVC_ITM_RENTAL_FEE - Extent10.INVC_ITM_GST_TXS BILLITEMCHARGES  ,
                    Extent10.INVC_ITM_RENTAL_FEE BILLITEMAMOUNT  ,
                    Extent10.INVC_ITM_INSTLMT_NO BILLITEMINSTLMTNO ,
                    Extent9.TAX_INVC_REF_DT BILLITEMTAXINVCDT
            FROM PAY0029D Extent9
            LEFT JOIN PAY0030D Extent10   ON Extent9.TAX_INVC_ID = Extent10.TAX_INVC_ID
            LEFT JOIN PAY0016D Extent11   ON ( Extent10.INVC_ITM_ORD_NO = Extent11.ACC_BILL_ORD_NO )
            AND ( Extent9.TAX_INVC_TASK_ID = Extent11.ACC_BILL_TASK_ID )
            AND ( Extent9.TAX_INVC_REF_NO = Extent11.ACC_BILL_REM )
            AND ( Extent10.INVC_ITM_INSTLMT_NO = Extent11.ACC_BILL_SCHDUL_PRIOD )
            LEFT JOIN PAY0016D Extent12   ON ( Extent10.INVC_ITM_ORD_NO = Extent12.ACC_BILL_ORD_NO )
            AND ( 0 = Extent12.ACC_BILL_SCHDUL_PRIOD )
            <if test="refNo != '' ">
            WHERE  ( Extent9.TAX_INVC_REF_NO = #{refNo} ) AND ( Extent11.ACC_BILL_REM = #{refNo})
             <if test="invcItmOrdNo != null and invcItmOrdNo != '' ">
                AND Extent10.INVC_ITM_ORD_NO = #{invcItmOrdNo}
              </if>
              <if test="txInvoiceItemId != null and txInvoiceItemId != '' ">
                AND Extent10.INVC_ITM_ID = #{txInvoiceItemId}
              </if>
              <if test="invcItmInstlmtNo != null and invcItmInstlmtNo != '' ">
                AND Extent10.INVC_ITM_INSTLMT_NO = #{invcItmInstlmtNo}
              </if>
            </if>
            ) UnionAll2
    UNION ALL
        SELECT 1 C1  ,
                Filter5.TAXINVOICEID2 TXINVOICEID  ,
                Filter5.TAX_INVC_REF_NO BR_NO  ,
                Filter5.INVC_ITM_ID TXINVOICEITEMID  ,
                CASE
                    WHEN ( 1061 = Extent15.ACC_BILL_MODE_ID ) THEN 1281
                ELSE 1328
                    END TXINVOICEITEMTYPEID  ,
                'Handling Fees' BILLITEMTYPE  ,
                Filter5.INVC_ITM_ORD_NO BILLITEMREFNO  ,
                Filter5.INVC_ITM_HNDL_FEE BILLITEMUNITPRICE  ,
                Extent15.ACC_BILL_TAX_CODE_ID BILLITEMTAXCODEID  ,
                '-' BILLITEMTAXCODE  ,
                Filter5.INVC_ITM_GST_RATE BILLITEMTAXRATE  ,
                1 BILLITEMQTY  ,
                Filter5.INVC_ITM_HNDL_FEE_TXS BILLITEMTAXES  ,
                Filter5.INVC_ITM_HNDL_FEE - Filter5.INVC_ITM_HNDL_FEE_TXS BILLITEMCHARGES  ,
                Filter5.INVC_ITM_HNDL_FEE BILLITEMAMOUNT  ,
                Filter5.INVC_ITM_INSTLMT_NO BILLITEMINSTLMTNO ,
                Filter5.TAX_INVC_REF_DT BILLITEMTAXINVCDT
        FROM ( SELECT Extent13.TAX_INVC_ID TAXINVOICEID2  ,
                Extent13.TAX_INVC_REF_NO TAX_INVC_REF_NO  ,
                Extent13.TAX_INVC_TASK_ID TAX_INVC_TASK_ID  ,
                Extent14.INVC_ITM_ID INVC_ITM_ID  ,
                Extent14.INVC_ITM_ORD_NO INVC_ITM_ORD_NO  ,
                Extent14.INVC_ITM_GST_RATE INVC_ITM_GST_RATE  ,
                Extent14.INVC_ITM_HNDL_FEE INVC_ITM_HNDL_FEE  ,
                Extent14.INVC_ITM_HNDL_FEE_TXS INVC_ITM_HNDL_FEE_TXS  ,
                Extent14.INVC_ITM_INSTLMT_NO INVC_ITM_INSTLMT_NO ,
                Extent13.TAX_INVC_REF_DT TAX_INVC_REF_DT
            FROM PAY0029D Extent13
                JOIN PAY0030D Extent14   ON Extent13.TAX_INVC_ID = Extent14.TAX_INVC_ID
            WHERE  Extent14.INVC_ITM_HNDL_FEE > UTILS.CONVERT_TO_NUMBER(0,18) ) Filter5
            JOIN PAY0016D Extent15   ON ( Filter5.INVC_ITM_ORD_NO = Extent15.ACC_BILL_ORD_NO )
            AND ( Filter5.TAX_INVC_TASK_ID = Extent15.ACC_BILL_TASK_ID )
        WHERE  ( Extent15.ACC_BILL_MODE_ID IN ( 1061,1325 ))
            <if test="refNo != '' ">
            AND ( Filter5.TAX_INVC_REF_NO = #{refNo}) AND ( Extent15.ACC_BILL_REM = #{refNo} )

            <if test="invcItmOrdNo != null and invcItmOrdNo != '' ">
                AND Filter5.INVC_ITM_ORD_NO = #{invcItmOrdNo}
              </if>
              <if test="txInvoiceItemId != null and txInvoiceItemId != '' ">
                AND Filter5.INVC_ITM_ID = #{txInvoiceItemId}
              </if>
              <if test="invcItmInstlmtNo != null and invcItmInstlmtNo != '' ">
                AND Filter5.INVC_ITM_INSTLMT_NO = #{invcItmInstlmtNo}
              </if>

            </if>
        ) UnionAll3
        WHERE 1 = 1
              <if test="billItemType != null and billItemType != '' ">
                AND UPPER(UnionAll3.BILLITEMTYPE) = UPPER(#{billItemType})
              </if>


    </select>

    <select id="getAdjustmentCnDnAccId" parameterType="Map" resultType="egovMap">
        SELECT ADJ_SET_CR_ACC_ID, ADJ_SET_DR_ACC_ID
        FROM
            (
            SELECT
                ADJ_SET_CR_ACC_ID, ADJ_SET_DR_ACC_ID
            FROM
                PAY0001C
            WHERE
                ADJ_SET_GRP_ID = #{invoiceType}
                AND ADJ_SET_NOTE_GRP_ID = #{memoTypeId}
                AND ADJ_SET_APP_TYPE_ID = #{invoiceItemTypeId})
        WHERE
            ROWNUM = 1

    </select>

    <select id="getAdjustmentId" resultType="int">
      SELECT PAY0011D_SEQ.NEXTVAL FROM DUAL
    </select>

    <select id="getAdjBatchId" resultType="int">
      SELECT PAY0011D_BTCH_SEQ.NEXTVAL FROM DUAL
    </select>

     <insert id="saveNewAdjMaster" parameterType="Map">
        INSERT INTO PAY0011D
            (MEMO_ADJ_ID,
            MEMO_ADJ_REF_NO,
            MEMO_ADJ_RPT_NO,
            MEMO_ADJ_TYPE_ID,
            MEMO_ADJ_INVC_NO,
            MEMO_ADJ_INVC_TYPE_ID,
            MEMO_ADJ_STUS_ID,
            MEMO_ADJ_RESN_ID,
            MEMO_ADJ_REM,
            MEMO_ADJ_TXS_AMT,
            MEMO_ADJ_TOT_AMT,
            MEMO_ADJ_CRT_DT,
            MEMO_ADJ_CRT_USER_ID,
            BATCH_ID,
            ATCH_FILE_GRP_ID
            )
        VALUES
          (
              #{memoAdjustId},
              #{memoAdjustRefNo},
              #{memoAdjustReportNo},
              #{memoAdjustTypeID},
              #{memoAdjustInvoiceNo},
              #{memoAdjustInvoiceTypeID},
              #{memoAdjustStatusID},
              #{memoAdjustReasonID},
              #{memoAdjustRemark},
              #{memoAdjustTaxesAmount},
              #{memoAdjustTotalAmount},
              SYSDATE,
              #{memoAdjustCreator},
              #{batchId},
              #{atchFileGrpId}
        )
    </insert>

    <insert id="saveBatchInfo" parameterType="Map">
        INSERT INTO PAY0123M
            (BATCH_ID,MEMO_ADJ_ID)
        VALUES
          (
              #{batchId},
              #{memoAdjustId}
        )
    </insert>

    <insert id="saveNewAdjDetail" parameterType="Map">
        INSERT INTO PAY0012D
            (
            MEMO_ITM_ID,
			MEMO_ADJ_ID,
			MEMO_ITM_INVC_ITM_ID,
			MEMO_ITM_INVC_ITM_QTY,
			MEMO_ITM_CRDIT_ACC_ID,
			MEMO_ITM_DEBT_ACC_ID,
			MEMO_ITM_TAX_CODE_ID,
			MEMO_ITM_STUS_ID,
			MEMO_ITM_REM,
			MEMO_ITM_GST_RATE,
			MEMO_ITM_CHRG,
			MEMO_ITM_TXS,
			MEMO_ITM_AMT
            )
        VALUES(
              PAY0012D_SEQ.NEXTVAL,
              #{memoAdjustId},
              #{MemoItemInvoiceItemID},
              #{memoItemInvoiceItmQty},
              #{memoItemCreditAccID},
              #{memoItemDebitAccID},
              #{memoItemTaxCodeID},
              #{memoItemStatusID},
              #{memoItemRemark},
              #{memoItemGSTRate},
              #{memoItemCharges},
              #{memoItemTaxes},
              #{memoItemAmount}
        )
    </insert>

    <insert id="saveNewAdjHist" parameterType="Map">
        INSERT INTO PAY0122D
            (
            HIST_ID,
            ADJ_INVC_NO,
            MEMO_ADJ_ID,
            ADJ_STUS_ID,
            ADJ_CRT_DT,
            ADJ_CRT_USER_ID
            )
        VALUES(
              PAY0122D_SEQ.NEXTVAL,
              #{memoAdjustInvoiceNo},
              #{memoAdjustId},
              #{memoAdjustStatusID} ,
              SYSDATE,
              #{memoAdjustCreator}
        )
    </insert>

     <select id="selectAdjDetailPopMaster" parameterType="Map" resultType="egovMap">
       SELECT DISTINCT
        mst.MEMO_ADJ_ID ,
        mst.MEMO_ADJ_REF_NO ,
        mst.MEMO_ADJ_RPT_NO ,
        mst.MEMO_ADJ_TYPE_ID ,
        mst.MEMO_ADJ_INVC_TYPE_ID ,
        mst.MEMO_ADJ_STUS_ID ,
        mst.MEMO_ADJ_REM ,
        mst.MEMO_ADJ_TXS_AMT ,
        mst.MEMO_ADJ_TOT_AMT ,
        TO_CHAR(mst.MEMO_ADJ_CRT_DT,'DD/MM/YYYY') AS MEMO_ADJ_CRT_DT ,
        CASE
                WHEN 128 = mst.MEMO_ADJ_INVC_TYPE_ID THEN misc.TAX_INVC_TYPE ELSE 0 END TAX_INVC_TYPE ,
        CASE
            WHEN 126 = mst.MEMO_ADJ_INVC_TYPE_ID THEN company.TAX_INVC_REF_NO
            WHEN 127 = mst.MEMO_ADJ_INVC_TYPE_ID THEN out.TAX_INVC_REF_NO
            ELSE misc.TAX_INVC_REF_NO END TAX_INVC_REF_NO ,
        CASE
            WHEN 126 = mst.MEMO_ADJ_INVC_TYPE_ID THEN TO_CHAR(company.TAX_INVC_REF_DT,'DD/MM/YYYY')
            WHEN 127 = mst.MEMO_ADJ_INVC_TYPE_ID THEN TO_CHAR(out.TAX_INVC_REF_DT,'DD/MM/YYYY')
            ELSE TO_CHAR(misc.TAX_INVC_REF_DT,'DD/MM/YYYY') END TAX_INVC_REF_DT ,
        CASE WHEN 126 = mst.MEMO_ADJ_INVC_TYPE_ID THEN TO_NUMBER(company.TAX_INVC_MONTH) ELSE 0 END TAX_INVC_MONTH ,
        CASE WHEN 126 = mst.MEMO_ADJ_INVC_TYPE_ID THEN TO_NUMBER(company.TAX_INVC_YEAR) ELSE 0 END TAX_INVC_YEAR ,
        CASE
            WHEN 126 = mst.MEMO_ADJ_INVC_TYPE_ID THEN 'Rental'
            WHEN 127 = mst.MEMO_ADJ_INVC_TYPE_ID THEN 'Outright'
            ELSE type.CODE_MASTER_NAME END MEMO_ADJ_INVC_TYPE_NM ,
        CASE WHEN 126 = mst.MEMO_ADJ_INVC_TYPE_ID THEN company.TAX_INVC_GRP_NO ELSE '-' END TAX_INVC_GRP_NO
        , 0 ORD_ID
        , '-' ORD_NO ,
        CASE WHEN 128 = mst.MEMO_ADJ_INVC_TYPE_ID THEN misc.TAX_INVC_SVC_NO ELSE '-' END TAX_INVC_SVC_NO ,
        CASE
            WHEN 126 = mst.MEMO_ADJ_INVC_TYPE_ID THEN company.TAX_INVC_CUST_NAME
            WHEN 127 = mst.MEMO_ADJ_INVC_TYPE_ID THEN out.TAX_INVC_CUST_NAME
            ELSE misc.TAX_INVC_CUST_NAME END TAX_INVC_CUST_NAME ,
        CASE
            WHEN 126 = mst.MEMO_ADJ_INVC_TYPE_ID THEN company.TAX_INVC_CNTC_PERSON
            WHEN 127 = mst.MEMO_ADJ_INVC_TYPE_ID THEN out.TAX_INVC_CNTC_PERSON
            ELSE misc.TAX_INVC_CNTC_PERSON END TAX_INVC_CNTC_PERSON ,
        CASE
            WHEN 126 = mst.MEMO_ADJ_INVC_TYPE_ID THEN company.TAX_INVC_ADDR1 || ' ' || company.TAX_INVC_ADDR2 || ' ' || company.TAX_INVC_ADDR3 || ' ' || company.TAX_INVC_POST_CODE || ' ' || company.TAX_INVC_STATE_NAME
            WHEN 127 = mst.MEMO_ADJ_INVC_TYPE_ID THEN out.TAX_INVC_ADDR1 || ' ' || out.TAX_INVC_ADDR2 || ' ' || out.TAX_INVC_ADDR3 || ' ' || out.TAX_INVC_POST_CODE || ' ' || out.TAX_INVC_STATE_NAME
            ELSE misc.TAX_INVC_ADDR1 || ' ' || misc.TAX_INVC_ADDR2 || ' ' || misc.TAX_INVC_ADDR3 || ' ' || misc.TAX_INVC_POST_CODE || ' ' || misc.TAX_INVC_STATE_NAME ||' '|| misc.ADDR_DTL ||' '|| misc.street END ADDRESS ,
        CASE
            WHEN 126 = mst.MEMO_ADJ_INVC_TYPE_ID THEN company.TAX_INVC_REM
            WHEN 127 = mst.MEMO_ADJ_INVC_TYPE_ID THEN out.TAX_INVC_REM ELSE misc.TAX_INVC_REM END TAX_INVC_REM ,
        CASE
            WHEN 126 = mst.MEMO_ADJ_INVC_TYPE_ID THEN company.TAX_INVC_OVERDU
                WHEN 127 = mst.MEMO_ADJ_INVC_TYPE_ID THEN out.TAX_INVC_CHRG ELSE misc.TAX_INVC_CHRG END TAX_INVC_OVERDU  ,
            CASE
                WHEN 126 = mst.MEMO_ADJ_INVC_TYPE_ID THEN 0
                WHEN 127 = mst.MEMO_ADJ_INVC_TYPE_ID THEN 0 ELSE misc.TAX_INVC_TXS END TAX_INVC_TXS  ,
            CASE
                WHEN 126 = mst.MEMO_ADJ_INVC_TYPE_ID THEN company.TAX_INVC_AMT_DUE
                WHEN 127 = mst.MEMO_ADJ_INVC_TYPE_ID THEN OUT.TAX_INVC_AMT_DUE ELSE misc.TAX_INVC_AMT_DUE END TAX_INVC_AMT_DUE  ,
        status.NAME MEMO_ADJ_STUS_NM ,
        cd1.CODE_NAME MEMO_ADJ_TYPE_NM ,
        rsn.RESN_DESC RESN_DESC ,
        mst.MEMO_ADJ_CRT_USER_ID,
        userinfo.USER_NAME MEMO_ADJ_CRT_USER_NM ,
        dept.DEPT_NAME,
        CASE
            WHEN 126 = mst.MEMO_ADJ_INVC_TYPE_ID THEN TO_NUMBER(TO_CHAR(company.TAX_INVC_REF_DT,'MM'))
            WHEN 127 = mst.MEMO_ADJ_INVC_TYPE_ID THEN TO_NUMBER(TO_CHAR(out.TAX_INVC_REF_DT,'MM'))
            ELSE TO_NUMBER(TO_CHAR(misc.TAX_INVC_REF_DT,'MM')) END month,
        CASE
            WHEN 126 = mst.MEMO_ADJ_INVC_TYPE_ID THEN TO_NUMBER(TO_CHAR(company.TAX_INVC_REF_DT,'YYYY'))
            WHEN 127 = mst.MEMO_ADJ_INVC_TYPE_ID THEN TO_NUMBER(TO_CHAR(out.TAX_INVC_REF_DT,'YYYY'))
            ELSE TO_NUMBER(TO_CHAR(misc.TAX_INVC_REF_DT,'YYYY')) END year,
        mst.ATCH_FILE_GRP_ID,
        CASE WHEN eiv.QR_CODE IS NOT NULL THEN 'Y'
            ELSE 'N'
        END AS GEN_E_INV
    FROM
        PAY0011D mst
	    LEFT JOIN PAY0012D sub ON mst.MEMO_ADJ_ID = sub.MEMO_ADJ_ID
	    LEFT JOIN PAY0030D det on det.INVC_ITM_ID = sub.MEMO_ITM_INVC_ITM_ID
	    LEFT JOIN PAY0029D company ON det.TAX_INVC_ID = company.TAX_INVC_ID
	    LEFT JOIN PAY0031D misc ON mst.MEMO_ADJ_INVC_NO = misc.TAX_INVC_REF_NO
	    LEFT JOIN PAY0033D out ON mst.MEMO_ADJ_INVC_NO = out.TAX_INVC_REF_NO
	    LEFT JOIN SYS0038M status ON mst.MEMO_ADJ_STUS_ID = status.STUS_CODE_ID
	    LEFT JOIN SYS0013M cd1 ON mst.MEMO_ADJ_TYPE_ID = cd1.CODE_ID
	    LEFT JOIN SYS0032M rsn ON mst.MEMO_ADJ_RESN_ID = rsn.RESN_ID
	    LEFT JOIN SYS0013M cd2 ON misc.TAX_INVC_TYPE = cd2.CODE_ID
	    LEFT JOIN SYS0012M type ON misc.TAX_INVC_TYPE = type.CODE_MASTER_ID
	    LEFT JOIN SYS0047M userinfo ON mst.MEMO_ADJ_CRT_USER_ID = userinfo.USER_ID
	    LEFT JOIN SYS0040M dept   ON userinfo.USER_DEPT_ID = dept.DEPT_ID
	    LEFT JOIN EIV0004D eiv ON eiv.INV_REF_NO = mst.MEMO_ADJ_REF_NO AND eiv.STATUS = 4
    WHERE mst.MEMO_ADJ_ID = #{adjId}
    </select>

    <select id="selectAdjDetailPopList" parameterType="Map" resultType="egovMap">
       SELECT
		    DISTINCT
		    CASE
		        WHEN ( 126 = mst.MEMO_ADJ_INVC_TYPE_ID ) THEN CASE WHEN ( 0 = company.INVC_ITM_INSTLMT_NO ) THEN 'RPF' ELSE 'Rental' END
		        WHEN ( 127 = mst.MEMO_ADJ_INVC_TYPE_ID ) THEN out.INVC_ITM_ORD_NO
		        ELSE cd.CODE_NAME END BILL_ITM_TYPE ,
		    CASE
		        WHEN ( 126 = mst.MEMO_ADJ_INVC_TYPE_ID ) THEN company.INVC_ITM_ORD_NO
		        WHEN ( 127 = mst.MEMO_ADJ_INVC_TYPE_ID ) THEN out.INVC_ITM_ORD_NO
		        ELSE misc.INVC_ITM_ORD_NO END BILL_ITM_REF_NO ,
		    sub.MEMO_ITM_INVC_ITM_ID ,
		    sub.MEMO_ITM_INVC_ITM_QTY ,
		    sub.MEMO_ITM_CHRG ,
		    sub.MEMO_ITM_TXS ,
		    sub.MEMO_ITM_AMT
		FROM
		    PAY0011D mst
		    LEFT JOIN PAY0012D sub ON mst.MEMO_ADJ_ID = sub.MEMO_ADJ_ID
		    LEFT JOIN PAY0032D misc ON sub.MEMO_ITM_INVC_ITM_ID = misc.INVC_ITM_ID
		    LEFT JOIN SYS0013M cd ON misc.INVC_ITM_TYPE = cd.CODE_ID
		    LEFT JOIN PAY0034D out ON sub.MEMO_ITM_INVC_ITM_ID = out.INVC_ITM_ID
		    LEFT JOIN PAY0030D company ON sub.MEMO_ITM_INVC_ITM_ID = company.INVC_ITM_ID
		WHERE mst.MEMO_ADJ_ID = #{adjId}
    </select>

    <select id="selectAdjDetailPopHist" parameterType="Map" resultType="egovMap">
       SELECT
		    A.ADJ_INVC_NO,
            B.MEMO_ADJ_REF_NO,
            A.ADJ_STUS_ID,
            (CASE
                WHEN A.ADJ_STUS_ID = 1 THEN 'Requested'
                WHEN A.ADJ_STUS_ID = 4 THEN 'Approved'
                WHEN A.ADJ_STUS_ID = 21 THEN 'Rejected' ELSE ' ' END) AS ADJ_STUS_NAME,
            TO_CHAR(A.ADJ_CRT_DT,'DD/MM/YYYY') AS ADJ_CRT_DT,
            A.ADJ_CRT_USER_ID,
            C.USER_NAME AS ADJ_CRT_USER_NAME,
            D.DEPT_NAME
		FROM
		    PAY0122D A
		    JOIN PAY0011D B ON A.MEMO_ADJ_ID = B.MEMO_ADJ_ID
		    LEFT JOIN SYS0047M C ON A.ADJ_CRT_USER_ID = C.USER_ID
		    LEFT JOIN SYS0040M D   ON C.USER_DEPT_ID = D.DEPT_ID
		WHERE
		    A.ADJ_INVC_NO = (SELECT MEMO_ADJ_INVC_NO FROM PAY0011D WHERE MEMO_ADJ_ID = #{adjId} )
		ORDER BY
		    A.ADJ_CRT_DT DESC
    </select>

     <update id="approvalAdjustmentMaster" parameterType="Map">
        UPDATE PAY0011D SET
            MEMO_ADJ_STUS_ID = #{status},
            MEMO_ADJ_UPD_USER_ID = #{userId},
            MEMO_ADJ_UPD_DT = SYSDATE
        WHERE
            MEMO_ADJ_ID = #{adjId}
    </update>

    <update id="approvalAdjustmentDetails" parameterType="Map">
        UPDATE PAY0012D SET
            MEMO_ITM_STUS_ID = #{status}
        WHERE
            MEMO_ADJ_ID = #{adjId}
    </update>

    <select id="selectAdjMasterForApprovalRental" parameterType="Map" resultType="egovMap">
        SELECT
            Extent1.MEMO_ADJ_ID AS NOTE_ENTRY_ID  ,
            Extent2.TAX_INVC_GRP_NO AS NOTE_GRP_NO  ,
            Extent1.MEMO_ADJ_REF_NO AS NOTE_REF_NO  ,
            Extent2.TAX_INVC_REF_DT AS NOTE_REF_DT  ,
            Extent2.TAX_INVC_REF_NO AS NOTE_INVC_NO  ,
            126 AS NOTE_INVC_TYPE_ID  ,
            Extent2.TAX_INVC_CUST_NAME AS NOTE_CUST_NAME  ,
            Extent2.TAX_INVC_CNTC_PERSON AS NOTE_CNTC_PERSON  ,
            Extent2.TAX_INVC_ADDR1 AS NOTE_ADDR1  ,
            Extent2.TAX_INVC_ADDR2 AS NOTE_ADDR2  ,
            Extent2.TAX_INVC_ADDR3 AS NOTE_ADDR3  ,
            Extent2.TAX_INVC_ADDR4 AS NOTE_ADDR4  ,
            Extent2.TAX_INVC_POST_CODE AS NOTE_POST_CODE  ,
            '' AS NOTE_AREA_NAME  ,
            Extent2.TAX_INVC_STATE_NAME AS NOTE_STATE_NAME  ,
            Extent2.TAX_INVC_CNTY AS NOTE_CNTY_NAME  ,
            Extent1.MEMO_ADJ_TXS_AMT AS NOTE_TXS  ,
            Extent1.MEMO_ADJ_TOT_AMT - Extent1.MEMO_ADJ_TXS_AMT AS NOTE_CHRG  ,
            Extent1.MEMO_ADJ_TOT_AMT AS NOTE_AMT_DUE
        FROM
            PAY0011D Extent1
            LEFT JOIN PAY0029D Extent2   ON Extent1.MEMO_ADJ_INVC_NO = Extent2.TAX_INVC_REF_NO
        WHERE
            Extent1.MEMO_ADJ_ID = #{adjId}
    </select>

    <select id="getNoteId" resultType="int">
      SELECT PAY0027D_SEQ.NEXTVAL FROM DUAL
    </select>


    <insert id="insertAccTaxDebitCreditNote" parameterType="EgovMap">
       INSERT INTO PAY0027D(
			NOTE_ID,
			NOTE_ENTRY_ID,
			NOTE_TYPE_ID,
			NOTE_GRP_NO,
			NOTE_REF_NO,
			NOTE_REF_DT,
			NOTE_INVC_NO,
			NOTE_INVC_TYPE_ID,
			NOTE_CUST_NAME,
			NOTE_CNTC_PERSON,
			NOTE_ADDR1,
			NOTE_ADDR2,
			NOTE_ADDR3,
			NOTE_ADDR4,
			NOTE_POST_CODE,
			NOTE_AREA_NAME,
			NOTE_STATE_NAME,
			NOTE_CNTY_NAME,
			NOTE_TXS,
			NOTE_CHRG,
			NOTE_AMT_DUE,
			NOTE_REM,
			NOTE_STUS_ID,
			NOTE_CRT_DT,
			NOTE_CRT_USER_ID)
    VALUES
            (
                #{noteId},
                #{noteEntryId},
                #{noteTypeId},
                #{noteGrpNo},
				#{noteRefNo},
				#{noteRefDt},
				#{noteInvcNo},
				#{noteInvcTypeId},
				#{noteCustName},
				#{noteCntcPerson},
				#{noteAddr1},
				#{noteAddr2},
				#{noteAddr3},
				#{noteAddr4},
				#{notePostCode},
				#{noteAreaName},
				#{noteStateName},
				#{noteCntyName},
				#{noteTxs},
				#{noteChrg},
				#{noteAmtDue},
				'',
				4,
				SYSDATE,
				#{userId})
    </insert>

    <select id="selectAdjDetailsForApprovalRental" parameterType="Map" resultType="egovMap">
        SELECT
		       Extent1.MEMO_ITM_INVC_ITM_ID NOTE_ITM_INVC_ITM_ID  ,
		       Extent2.INVC_ITM_ORD_NO NOTE_ITM_ORD_NO  ,
		       Extent4.SALES_ORD_ID NOTE_ITM_ORD_ID  ,
		       Extent2.INVC_ITM_PRODUCT_MODEL NOTE_ITM_PRODUCT_MODEL  ,
		       Extent2.INVC_ITM_PRODUCT_SERIAL_NO NOTE_ITM_SERIAL_NO  ,
		       Extent2.INVC_ITM_INSTALL_DT NOTE_ITM_INSTALL_DT  ,
		       Extent2.INVC_ITM_ADD1 NOTE_ITM_ADD1  ,
		       Extent2.INVC_ITM_ADD2 NOTE_ITM_ADD2  ,
		       Extent2.INVC_ITM_ADD3 NOTE_ITM_ADD3  ,
		       '' NOTE_ITM_ADD4  ,
		       Extent2.INVC_ITM_POST_CODE NOTE_ITM_POST_CODE  ,
		       '' NOTE_ITM_AREA_NAME  ,
		       Extent2.INVC_ITM_STATE_NAME NOTE_ITM_STATE_NAME  ,
		       Extent2.INVC_ITM_CNTY NOTE_ITM_CNTY  ,
		       Extent1.MEMO_ITM_INVC_ITM_QTY NOTE_ITM_QTY  ,
		       Extent1.MEMO_ITM_AMT NOTE_ITM_UNIT_PRC  ,
		       Extent1.MEMO_ITM_GST_RATE NOTE_ITM_GST_RATE  ,
		       Extent1.MEMO_ITM_TXS NOTE_ITM_GST_TXS  ,
		       Extent1.MEMO_ITM_CHRG NOTE_ITM_CHRG  ,
		       Extent1.MEMO_ITM_AMT NOTE_ITM_DUE_AMT  ,
		       Extent3.TAX_INVC_BILL_TYPE NOTE_BILL_TYPE_ID  ,
		       Extent2.INVC_ITM_TYPE_ID NOTE_TYPE_ID  ,
		       CASE WHEN ( Extent5.SRV_CNTRCT_ID IS NOT NULL ) THEN Extent5.SRV_CNTRCT_ID ELSE 0 END NOTE_ITM_SRV_CNTRCT_ID
		  FROM
		    PAY0012D Extent1
		    LEFT JOIN PAY0030D Extent2   ON Extent1.MEMO_ITM_INVC_ITM_ID = Extent2.INVC_ITM_ID
		    LEFT JOIN PAY0029D Extent3   ON Extent2.TAX_INVC_ID = Extent3.TAX_INVC_ID
		    LEFT JOIN SAL0001D Extent4   ON Extent2.INVC_ITM_ORD_NO = Extent4.SALES_ORD_NO
		    LEFT JOIN SAL0077D Extent5   ON Extent2.INVC_ITM_DESC2 = Extent5.SRV_CNTRCT_REF_NO
		 WHERE  Extent1.MEMO_ADJ_ID = #{adjId}
    </select>

    <insert id="insertAccTaxDebitCreditNoteSub" parameterType="EgovMap">
        INSERT INTO PAY0028D(
				NOTE_ITM_ID,
				NOTE_ID,
				NOTE_ITM_INVC_ITM_ID,
				NOTE_ITM_ORD_NO,
				NOTE_ITM_PRODUCT_MODEL,
				NOTE_ITM_SERIAL_NO,
				NOTE_ITM_INSTALL_DT,
				NOTE_ITM_ADD1,
				NOTE_ITM_ADD2,
				NOTE_ITM_ADD3,
				NOTE_ITM_ADD4,
				NOTE_ITM_POST_CODE,
				NOTE_ITM_AREA_NAME,
				NOTE_ITM_STATE_NAME,
				NOTE_ITM_CNTY,
				NOTE_ITM_QTY,
				NOTE_ITM_UNIT_PRC,
				NOTE_ITM_GST_RATE,
				NOTE_ITM_GST_TXS,
				NOTE_ITM_CHRG,
				NOTE_ITM_DUE_AMT
			)
			VALUES (
                PAY0028D_SEQ.NEXTVAL,
				#{noteId},
				#{noteItmInvcItmId},
				#{noteItmOrdNo},
				#{noteItmProductModel},
				#{noteItmSerialNo},
				#{noteItmInstallDt},
				#{noteItmAdd1},
				#{noteItmAdd2},
				#{noteItmAdd3},
				#{noteItmAdd4},
				#{noteItmPostCode},
				#{noteItmAreaName},
				#{noteItmStateName},
				#{noteItmCnty},
				#{noteItmQty},
				#{noteItmUnitPrc},
				#{noteItmGstRate},
				#{noteItmGstTxs},
				#{noteItmChrg},
				#{noteItmDueAmt}
			)
    </insert>

    <insert id="insertAccServiceContractLedger" parameterType="Map">
        INSERT INTO PAY0023D (
            SRV_LDGR_ID,
            SRV_SALES_ORD_ID,
			SRV_LDGR_CNTRCT_ID,
			SRV_LDGR_REF_NO,
			SRV_LDGR_TYPE_ID,
			SRV_LDGR_REF_DT,
			SRV_LDGR_AMT,
			SRV_LDGR_CNTRCT_SCHDUL_ID,
			SRV_LDGR_CNTRCT_SCHDUL_NO,
			SRV_LDGR_REM,
			SRV_LDGR_CRT_DT,
			SRV_LDGR_CRT_USER_ID,
			SRV_LDGR_PAY_TYPE
        ) VALUES (
            PAY0023D_SRV_LDGR_ID_SEQ.NEXTVAL,
            #{srvSalesOrdId},
            #{srvLdgrCntrctId},
            #{srvLdgrRefNo},
            #{srvLdgrTypeId},
            SYSDATE,
            #{srvLdgrAmt},
            #{srvLdgrCntrctSchdulId},
            #{srvLdgrCntrctSchdulNo},
            #{srvLdgrRem},
            SYSDATE,
            #{userId},
            #{srvLdgrPayType}
        )
    </insert>

    <insert id="insertAccRentLedger" parameterType="Map">
        INSERT INTO PAY0022D (
            RENT_RUN_ID,
			RENT_ID,
			RENT_SO_ID,
			RENT_DOC_NO,
			RENT_DOC_TYPE_ID,
			RENT_DT_TM,
			RENT_AMT,
			RENT_BATCH_NO,
			RENT_INST_NO,
			RENT_UPD_USER_ID,
			RENT_UPD_DT,
			RENT_IS_SYNC,
			RENT_BILL_RUNNG_TOT,
			R01,
			R02
        ) VALUES (
            PAY0022D_SEQ.NEXTVAL,
            0,
            #{rentSoId},
            #{rentDocNo},
            #{rentDocTypeId},
            SYSDATE,
            #{rentAmt},
            #{rentBatchNo},
            #{rentInstNo},
            #{userId},
            SYSDATE,
            0,
            0,
            0,
            ''
        )
    </insert>

     <select id="selectAdjMasterForApprovalOutright" parameterType="Map" resultType="egovMap">
        SELECT
            adjM.MEMO_ADJ_ID AS NOTE_ENTRY_ID,
            invoiced.INVC_ITM_ORD_NO AS NOTE_GRP_NO,
            adjM.MEMO_ADJ_REF_NO AS NOTE_REF_NO,
            invoice.TAX_INVC_REF_DT AS NOTE_REF_DT,
            invoice.TAX_INVC_REF_NO AS NOTE_INVC_NO,
            127 AS NOTE_INVC_TYPE_ID,
            invoice.TAX_INVC_CUST_NAME AS NOTE_CUST_NAME,
            invoice.TAX_INVC_CNTC_PERSON AS NOTE_CONTACT_PERSON,
            invoice.TAX_INVC_ADDR1 AS NOTE_ADDR1,
            invoice.TAX_INVC_ADDR2 AS NOTE_ADDR2,
            invoice.TAX_INVC_ADDR3 AS NOTE_ADDR3,
            invoice.TAX_INVC_ADDR4 AS NOTE_ADDR4,
            invoice.TAX_INVC_POST_CODE AS NOTE_POST_CODE,
            '' AS NOTE_AREA_NAME,
            invoice.TAX_INVC_STATE_NAME AS NOTE_STATE_NAME,
            invoice.TAX_INVC_CNTY AS NOTE_CNTY_NAME,
            adjM.MEMO_ADJ_TXS_AMT AS NOTE_TXS,
            (AdjM.MEMO_ADJ_TOT_AMT - adjM.MEMO_ADJ_TXS_AMT) AS NOTE_CHRG,
            adjM.MEMO_ADJ_TOT_AMT AS NOTE_AMT_DUE
        FROM
            PAY0011D adjM
            LEFT OUTER JOIN PAY0033D invoice ON adjM.MEMO_ADJ_INVC_NO = invoice.TAX_INVC_REF_NO
            LEFT OUTER JOIN PAY0034D invoiced ON invoice.TAX_INVC_ID = invoiced.TAX_INVC_ID
        WHERE
            adjM.MEMO_ADJ_ID = #{adjId}
            AND ROWNUM = 1
    </select>

    <select id="selectAdjDetailsForApprovalOutright" parameterType="Map" resultType="egovMap">
        SELECT
            sub.MEMO_ITM_INVC_ITM_ID AS NOTE_ITM_INVC_ITM_ID,
			invoice.INVC_ITM_ORD_NO AS NOTE_ITM_ORD_NO,
			sales.SALES_ORD_ID AS NOTE_ITM_ORD_ID,
			invoice.INVC_ITM_PRODUCT_MODEL AS NOTE_ITM_PRODUCT_MODEL,
			invoice.INVC_ITM_PRODUCT_SERIAL_NO AS NOTE_ITM_SERIAL_NO,
			invoicem.TAX_INVC_REF_DT AS NOTE_ITM_INSTALL_DT,
			invoice.INVC_ITM_ADD1 AS NOTE_ITM_ADD1,
			invoice.INVC_ITM_ADD2 AS NOTE_ITM_ADD2,
			invoice.INVC_ITM_ADD3 AS NOTE_ITM_ADD3,
			'' AS NOTE_ITM_ADD4,
			invoice.INVC_ITM_POST_CODE AS NOTE_ITM_POST_CODE,
			'' AS NOTE_ITM_AREA_NAME,
			invoice.INVC_ITM_STATE_NAME AS NOTE_ITM_STATE_NAME,
			invoice.INVC_ITM_CNTY AS NOTE_ITM_CNTY,
			sub.MEMO_ITM_INVC_ITM_QTY AS NOTE_ITM_QTY,
			sub.MEMO_ITM_AMT AS NOTE_ITM_UNIT_PRC,
			sub.MEMO_ITM_GST_RATE AS NOTE_ITM_GST_RATE,
			sub.MEMO_ITM_TXS AS NOTE_ITM_GST_TXS,
			sub.MEMO_ITM_CHRG AS NOTE_ITM_CHRG,
			sub.MEMO_ITM_AMT AS NOTE_ITM_DUE_AMT
        FROM
            PAY0012D sub
            LEFT OUTER JOIN PAY0034D invoice ON sub.MEMO_ITM_INVC_ITM_ID = invoice.INVC_ITM_ID
            LEFT OUTER JOIN PAY0033D invoicem ON invoice.TAX_INVC_ID = invoicem.TAX_INVC_ID
            LEFT OUTER JOIN SAL0001D sales ON invoice.INVC_ITM_ORD_NO = sales.SALES_ORD_NO
        WHERE
            sub.MEMO_ADJ_ID = #{adjId}

    </select>

    <insert id="insertAccTradeLedger" parameterType="Map">
        INSERT INTO PAY0035D (
            TRADE_RUN_ID,
			TRADE_ID,
			TRADE_SO_ID,
			TRADE_DOC_NO,
			TRADE_DOC_TYPE_ID,
			TRADE_DT_TM,
			TRADE_AMT,
			TRADE_BATCH_NO,
			TRADE_INST_NO,
			TRADE_UPD_USER_ID,
			TRADE_UPD_DT,
			TRADE_IS_SYNC,
			R01
        ) VALUES (
            PAY0035D_SEQ.NEXTVAL,
            0,
            #{tradeSoId},
            #{tradeDocNo},
            #{tradeDocTypeId},
            SYSDATE,
            #{tradeAmt},
            #{tradeBatchNo},
            #{tradeInstNo},
            #{userId},
            SYSDATE,
            0,
            0
        )
    </insert>

     <select id="selectAdjMasterForApprovalMisc" parameterType="Map" resultType="egovMap">
        SELECT
            Extent1.MEMO_ADJ_ID AS NOTE_ENTRY_ID,
            Extent2.TAX_INVC_SVC_NO AS NOTE_GRP_NO,
            Extent1.MEMO_ADJ_REF_NO  AS NOTE_REF_NO,
            Extent2.TAX_INVC_REF_DT AS NOTE_REF_DT  ,
            Extent2.TAX_INVC_REF_NO AS NOTE_INVC_NO  ,
            128 AS NOTE_INVC_TYPE_ID,
            Extent2.TAX_INVC_CUST_NAME AS NOTE_CUST_NAME  ,
            Extent2.TAX_INVC_CNTC_PERSON AS NOTE_CONTACT_PERSON  ,
            Extent2.TAX_INVC_ADDR1 AS NOTE_ADDR1  ,
            Extent2.TAX_INVC_ADDR2 AS NOTE_ADDR2  ,
            Extent2.TAX_INVC_ADDR3 AS NOTE_ADDR3  ,
            Extent2.TAX_INVC_ADDR4 AS NOTE_ADDR4  ,
            Extent2.TAX_INVC_POST_CODE AS NOTE_POST_CODE  ,
            ' ' AS NOTE_AREA_NAME  ,
            Extent2.TAX_INVC_STATE_NAME AS NOTE_STATE_NAME  ,
            Extent2.TAX_INVC_CNTY AS NOTE_CNTY_NAME  ,
            Extent1.MEMO_ADJ_TXS_AMT AS NOTE_TXS  ,
            Extent1.MEMO_ADJ_TOT_AMT - Extent1.MEMO_ADJ_TXS_AMT AS NOTE_CHRG  ,
            Extent1.MEMO_ADJ_TOT_AMT AS NOTE_AMT_DUE
        FROM
            PAY0011D Extent1
            LEFT JOIN PAY0031D Extent2   ON Extent1.MEMO_ADJ_INVC_NO = Extent2.TAX_INVC_REF_NO
        WHERE
            Extent1.MEMO_ADJ_ID = #{adjId}
            AND ROWNUM = 1
    </select>

    <select id="selectAdjDetailsForApprovalMisc" parameterType="Map" resultType="egovMap">
        SELECT
		    Extent1.MEMO_ITM_INVC_ITM_ID AS NOTE_ITM_INVC_ITM_ID ,
		    CASE WHEN ( Extent2.INVC_ITM_ORD_NO IS NOT NULL ) THEN Extent2.INVC_ITM_ORD_NO ELSE ' ' END AS NOTE_ITM_ORD_NO ,
		    CASE WHEN ( Extent3.SALES_ORD_ID IS NOT NULL ) THEN Extent3.SALES_ORD_ID ELSE 0 END AS NOTE_ITM_ORD_ID ,
		    Extent2.INVC_ITM_TYPE AS NOTE_ITM_TYPE_ID ,
		    Extent2.INVC_ITM_DESC1 AS NOTE_ITM_PRODUCT_MODEL ,
		    ' ' AS NOTE_ITM_SERIAL_NO ,
		    NULL AS NOTE_ITM_INSTALL_DT ,
		    CASE WHEN ( Extent2.INVC_ITM_ADD1 IS NOT NULL ) THEN Extent2.INVC_ITM_ADD1 ELSE ' ' END AS NOTE_ITM_ADD1 ,
		    CASE WHEN ( Extent2.INVC_ITM_ADD2 IS NOT NULL ) THEN Extent2.INVC_ITM_ADD2 ELSE ' ' END AS NOTE_ITM_ADD2 ,
		    CASE WHEN ( Extent2.INVC_ITM_ADD3 IS NOT NULL ) THEN Extent2.INVC_ITM_ADD3 ELSE ' ' END AS NOTE_ITM_ADD3 ,
		    ' ' AS NOTE_ITM_ADD4 ,
		    CASE WHEN ( Extent2.INVC_ITM_POST_CODE IS NOT NULL ) THEN Extent2.INVC_ITM_POST_CODE ELSE ' ' END AS NOTE_ITM_POST_CODE ,
		    ' ' AS NOTE_ITM_AREA_NAME ,
		    CASE WHEN ( Extent2.INVC_ITM_STATE_NAME IS NOT NULL ) THEN Extent2.INVC_ITM_STATE_NAME ELSE ' ' END AS NOTE_ITM_STATE_NAME ,
		    CASE WHEN ( Extent2.INVC_ITM_CNTY IS NOT NULL ) THEN Extent2.INVC_ITM_CNTY ELSE ' ' END AS NOTE_ITM_CNTY ,
		    Extent1.MEMO_ITM_INVC_ITM_QTY AS NOTE_ITM_QTY ,
		    Extent1.MEMO_ITM_AMT AS NOTE_ITM_UNIT_PRC ,
		    Extent1.MEMO_ITM_GST_RATE AS NOTE_ITM_GST_RATE ,
		    Extent1.MEMO_ITM_TXS AS NOTE_ITM_GST_TXS ,
		    Extent1.MEMO_ITM_CHRG AS NOTE_ITM_CHRG ,
		    Extent1.MEMO_ITM_AMT AS NOTE_ITM_DUE_AMT ,
		    Extent2.INVC_ITM_DESC2 AS NOTE_DESC2
        FROM
            PAY0012D Extent1
            LEFT JOIN PAY0032D Extent2 ON Extent1.MEMO_ITM_INVC_ITM_ID = Extent2.INVC_ITM_ID
            LEFT JOIN SAL0001D Extent3 ON ( Extent2.INVC_ITM_ORD_NO = Extent3.SALES_ORD_NO )
                                                        OR ( ( Extent2.INVC_ITM_ORD_NO IS NULL ) AND ( Extent3.SALES_ORD_NO IS NULL ) )
        WHERE
            Extent1.MEMO_ADJ_ID = #{adjId}


    </select>

    <insert id="insertASLedger" parameterType="Map">
       INSERT INTO PAY0006D (
            AS_LDGR_ID,
			AS_ID,
			AS_DOC_NO,
			AS_LG_DOC_TYPE_ID,
			AS_LG_DT,
			AS_LG_AMT,
			AS_LG_UPD_USER_ID,
			AS_LG_UPD_DT,
			AS_SO_NO,
			AS_RESULT_NO,
			AS_SO_ID,
			AS_ADV_PAY,
			R01
        ) VALUES (
            PAY0006D_SEQ.NEXTVAL,
			0,
			#{asDocNo},
			#{asLgDocTypeId},
			SYSDATE,
			#{asLgAmt},
			#{userId},
			SYSDATE,
			#{asSoNo},
			#{asResultNo},
			#{asSoId},
			0,
			0
        )
    </insert>

    <select id="selectQuotId" parameterType="String" resultType="int">
       SELECT SRV_MEM_QUOT_ID FROM SAL0093D WHERE SRV_MEM_QUOT_NO = #{value} AND ROWNUM = 1
    </select>

    <select id="selectSrvMemId" parameterType="int" resultType="int">
       SELECT SRV_MEM_ID FROM SAL0095D WHERE SRV_MEM_QUOT_ID = #{value} AND ROWNUM = 1
    </select>

    <insert id="insertAccSrvMemLedger" parameterType="Map">
        INSERT INTO PAY0024D (
            SRV_MEM_LG_ID,
            SRV_MEM_ID,
            SRV_MEM_DOC_NO,
            SRV_MEM_DOC_TYPE_ID,
            SRV_MEM_DT_TM,
            SRV_MEM_AMT,
            SRV_MEM_INST_NO,
            SRV_MEM_BATCH_NO,
            SRV_MEM_UPD_USER_ID,
            SRV_MEM_UPD_DT,
            SRV_MEM_ORD_ID,
            SRV_MEM_QOTAT_ID
        ) VALUES (
            PAY0024D_SEQ.NEXTVAL,
            #{srvMemId},
            #{srvMemDocNo},
            #{srvMemDocTypeId},
            SYSDATE,
            #{srvMemAmt},
            #{srvMemInstNo},
            #{srvMemBatchNo},
            #{userId},
            SYSDATE,
            0,
            0
        )
</insert>

    <select id="selectAdjBatchApprovalPopMaster" parameterType="Map" resultType="egovMap">
        SELECT
            BATCH_ID,
            MEMO_ADJ_CRT_USER_ID,
            MEMO_ADJ_CRT_USER_NM,
            DEPT_NAME,
            MEMO_ADJ_STUS_NM,
            MEMO_ADJ_CRT_DT,
            RESN_DESC,
            MEMO_ADJ_REM,
            SUM(MEMO_ADJ_TOT_AMT) AS MEMO_ADJ_TOT_AMT,
            ATCH_FILE_GRP_ID
        FROM
            (
            SELECT
				mst.BATCH_ID,
				mst.MEMO_ADJ_ID ,
				mst.MEMO_ADJ_REF_NO ,
				mst.MEMO_ADJ_RPT_NO ,
				mst.MEMO_ADJ_TYPE_ID ,
				mst.MEMO_ADJ_INVC_TYPE_ID ,
				mst.MEMO_ADJ_STUS_ID ,
				mst.MEMO_ADJ_REM ,
				mst.MEMO_ADJ_TXS_AMT ,
				mst.MEMO_ADJ_TOT_AMT ,
				TO_CHAR(mst.MEMO_ADJ_CRT_DT,'DD/MM/YYYY') AS MEMO_ADJ_CRT_DT ,
				CASE
				    WHEN 128 = mst.MEMO_ADJ_INVC_TYPE_ID THEN misc.TAX_INVC_TYPE ELSE 0 END TAX_INVC_TYPE ,
				CASE
				    WHEN 126 = mst.MEMO_ADJ_INVC_TYPE_ID THEN company.TAX_INVC_REF_NO
				    WHEN 127 = mst.MEMO_ADJ_INVC_TYPE_ID THEN out.TAX_INVC_REF_NO
				    ELSE misc.TAX_INVC_REF_NO END TAX_INVC_REF_NO ,
				CASE
				    WHEN 126 = mst.MEMO_ADJ_INVC_TYPE_ID THEN TO_CHAR(company.TAX_INVC_REF_DT,'DD/MM/YYYY')
				    WHEN 127 = mst.MEMO_ADJ_INVC_TYPE_ID THEN TO_CHAR(out.TAX_INVC_REF_DT,'DD/MM/YYYY')
				    ELSE TO_CHAR(misc.TAX_INVC_REF_DT,'DD/MM/YYYY') END TAX_INVC_REF_DT ,
				CASE WHEN 126 = mst.MEMO_ADJ_INVC_TYPE_ID THEN TO_NUMBER(company.TAX_INVC_MONTH) ELSE 0 END TAX_INVC_MONTH ,
				CASE WHEN 126 = mst.MEMO_ADJ_INVC_TYPE_ID THEN TO_NUMBER(company.TAX_INVC_YEAR) ELSE 0 END TAX_INVC_YEAR ,
				CASE
				    WHEN 126 = mst.MEMO_ADJ_INVC_TYPE_ID THEN 'Rental'
				    WHEN 127 = mst.MEMO_ADJ_INVC_TYPE_ID THEN 'Outright'
				    ELSE type.CODE_MASTER_NAME END MEMO_ADJ_INVC_TYPE_NM ,
				CASE WHEN 126 = mst.MEMO_ADJ_INVC_TYPE_ID THEN company.TAX_INVC_GRP_NO ELSE '-' END TAX_INVC_GRP_NO
				, 0 ORD_ID
				, '-' ORD_NO ,
				CASE WHEN 128 = mst.MEMO_ADJ_INVC_TYPE_ID THEN misc.TAX_INVC_SVC_NO ELSE '-' END TAX_INVC_SVC_NO ,
				CASE
				    WHEN 126 = mst.MEMO_ADJ_INVC_TYPE_ID THEN company.TAX_INVC_CUST_NAME
				    WHEN 127 = mst.MEMO_ADJ_INVC_TYPE_ID THEN out.TAX_INVC_CUST_NAME
				    ELSE misc.TAX_INVC_CUST_NAME END TAX_INVC_CUST_NAME ,
				CASE
				    WHEN 126 = mst.MEMO_ADJ_INVC_TYPE_ID THEN company.TAX_INVC_CNTC_PERSON
				    WHEN 127 = mst.MEMO_ADJ_INVC_TYPE_ID THEN out.TAX_INVC_CNTC_PERSON
				    ELSE misc.TAX_INVC_CNTC_PERSON END TAX_INVC_CNTC_PERSON ,
				CASE
				    WHEN 126 = mst.MEMO_ADJ_INVC_TYPE_ID THEN company.TAX_INVC_ADDR1 || ' ' || company.TAX_INVC_ADDR2 || ' ' || company.TAX_INVC_ADDR3 || ' ' || company.TAX_INVC_POST_CODE || ' ' || company.TAX_INVC_STATE_NAME
				    WHEN 127 = mst.MEMO_ADJ_INVC_TYPE_ID THEN out.TAX_INVC_ADDR1 || ' ' || out.TAX_INVC_ADDR2 || ' ' || out.TAX_INVC_ADDR3 || ' ' || out.TAX_INVC_POST_CODE || ' ' || out.TAX_INVC_STATE_NAME
				    ELSE misc.TAX_INVC_ADDR1 || ' ' || misc.TAX_INVC_ADDR2 || ' ' || misc.TAX_INVC_ADDR3 || ' ' || misc.TAX_INVC_POST_CODE || ' ' || misc.TAX_INVC_STATE_NAME END ADDRESS ,
				CASE
				    WHEN 126 = mst.MEMO_ADJ_INVC_TYPE_ID THEN company.TAX_INVC_REM
				    WHEN 127 = mst.MEMO_ADJ_INVC_TYPE_ID THEN out.TAX_INVC_REM ELSE misc.TAX_INVC_REM END TAX_INVC_REM ,
				CASE
				    WHEN 126 = mst.MEMO_ADJ_INVC_TYPE_ID THEN company.TAX_INVC_OVERDU
				    WHEN 127 = mst.MEMO_ADJ_INVC_TYPE_ID THEN out.TAX_INVC_CHRG ELSE misc.TAX_INVC_CHRG END TAX_INVC_OVERDU  ,
				CASE
				    WHEN 126 = mst.MEMO_ADJ_INVC_TYPE_ID THEN 0
				    WHEN 127 = mst.MEMO_ADJ_INVC_TYPE_ID THEN 0 ELSE misc.TAX_INVC_TXS END TAX_INVC_TXS  ,
				CASE
				    WHEN 126 = mst.MEMO_ADJ_INVC_TYPE_ID THEN company.TAX_INVC_AMT_DUE
				    WHEN 127 = mst.MEMO_ADJ_INVC_TYPE_ID THEN OUT.TAX_INVC_AMT_DUE ELSE misc.TAX_INVC_AMT_DUE END TAX_INVC_AMT_DUE  ,
				status.NAME MEMO_ADJ_STUS_NM ,
				cd1.CODE_NAME MEMO_ADJ_TYPE_NM ,
				rsn.RESN_DESC RESN_DESC ,
				mst.MEMO_ADJ_CRT_USER_ID,
				userinfo.USER_NAME MEMO_ADJ_CRT_USER_NM ,
				dept.DEPT_NAME,
				mst.ATCH_FILE_GRP_ID
            FROM
                PAY0011D mst
                /* LEFT JOIN PAY0012D sub ON mst.MEMO_ADJ_ID = sub.MEMO_ADJ_ID */
				LEFT JOIN PAY0029D company ON mst.MEMO_ADJ_INVC_NO = company.TAX_INVC_REF_NO
				LEFT JOIN PAY0031D misc ON mst.MEMO_ADJ_INVC_NO = misc.TAX_INVC_REF_NO
				LEFT JOIN PAY0033D out ON mst.MEMO_ADJ_INVC_NO = out.TAX_INVC_REF_NO
				LEFT JOIN SYS0038M status ON mst.MEMO_ADJ_STUS_ID = status.STUS_CODE_ID
				LEFT JOIN SYS0013M cd1 ON mst.MEMO_ADJ_TYPE_ID = cd1.CODE_ID
				LEFT JOIN SYS0032M rsn ON mst.MEMO_ADJ_RESN_ID = rsn.RESN_ID
				LEFT JOIN SYS0013M cd2 ON misc.TAX_INVC_TYPE = cd2.CODE_ID
				LEFT JOIN SYS0012M type ON misc.TAX_INVC_TYPE = type.CODE_MASTER_ID
				LEFT JOIN SYS0047M userinfo ON mst.MEMO_ADJ_CRT_USER_ID = userinfo.USER_ID
				LEFT JOIN SYS0040M dept   ON userinfo.USER_DEPT_ID = dept.DEPT_ID
          WHERE
                mst.MEMO_ADJ_ID IN (SELECT MEMO_ADJ_ID FROM PAY0123M WHERE BATCH_ID = #{batchId})
                AND mst.MEMO_ADJ_STUS_ID = 1 )
          GROUP BY
                BATCH_ID,
                MEMO_ADJ_CRT_USER_ID,
		        MEMO_ADJ_CRT_USER_NM,
		        DEPT_NAME,
		        MEMO_ADJ_STUS_NM,
		        MEMO_ADJ_CRT_DT,
		        RESN_DESC,
		        MEMO_ADJ_REM,
		        ATCH_FILE_GRP_ID
    </select>

    <select id="selectAdjBatchApprovalPopDetail" parameterType="Map" resultType="egovMap">
        SELECT DISTINCT
		    tb1.BATCH_ID,
		    tb1.MEMO_ADJ_ID,
		    tb1.MEMO_ADJ_INVC_TYPE_ID,
		    tb1.MEMO_ADJ_TYPE_ID,
		    tb1.MEMO_ADJ_REF_NO,
		    tb1.MEMO_ADJ_INVC_NO,
		    tb1.BILL_ITM_REF_NO,
		    tb2.CUST_ID,
		    tb3.NAME AS CUST_NAME,
		    tb1.MEMO_ADJ_TOT_AMT

        FROM
		    (SELECT
		            DISTINCT
		            mst.BATCH_ID,
		            mst.MEMO_ADJ_ID,
		            mst.MEMO_ADJ_INVC_TYPE_ID,
		            mst.MEMO_ADJ_REF_NO,
		            mst.MEMO_ADJ_INVC_NO,
		            mst.MEMO_ADJ_TYPE_ID,
		            mst.MEMO_ADJ_STUS_ID,
		            CASE
		                WHEN 128 = mst.MEMO_ADJ_INVC_TYPE_ID THEN miscm.TAX_INVC_TYPE ELSE 0 END TAX_INVC_TYPE ,
		            CASE
		                WHEN ( 126 = mst.MEMO_ADJ_INVC_TYPE_ID ) THEN CASE WHEN ( 0 = company.INVC_ITM_INSTLMT_NO ) THEN 'RPF' ELSE 'Rental' END
		                WHEN ( 127 = mst.MEMO_ADJ_INVC_TYPE_ID ) THEN out.INVC_ITM_ORD_NO
		                ELSE cd.CODE_NAME END BILL_ITM_TYPE ,
		            CASE
		                WHEN ( 126 = mst.MEMO_ADJ_INVC_TYPE_ID ) THEN company.INVC_ITM_ORD_NO
		                WHEN ( 127 = mst.MEMO_ADJ_INVC_TYPE_ID ) THEN out.INVC_ITM_ORD_NO
		                ELSE miscs.INVC_ITM_ORD_NO END BILL_ITM_REF_NO ,
		            sub.MEMO_ITM_INVC_ITM_ID ,
		            sub.MEMO_ITM_INVC_ITM_QTY ,
		            sub.MEMO_ITM_CHRG ,
		            sub.MEMO_ITM_TXS ,
		            sub.MEMO_ITM_AMT  ,
		            mst.MEMO_ADJ_TOT_AMT
		        FROM
		            PAY0011D mst
		            LEFT JOIN PAY0012D sub ON mst.MEMO_ADJ_ID = sub.MEMO_ADJ_ID
		            LEFT JOIN PAY0031D miscm ON mst.MEMO_ADJ_INVC_NO = miscm.TAX_INVC_REF_NO
		            LEFT JOIN PAY0032D miscs ON sub.MEMO_ITM_INVC_ITM_ID = miscs.INVC_ITM_ID
		            LEFT JOIN SYS0013M cd ON miscs.INVC_ITM_TYPE = cd.CODE_ID
		            LEFT JOIN PAY0034D out ON sub.MEMO_ITM_INVC_ITM_ID = out.INVC_ITM_ID
		            LEFT JOIN PAY0030D company ON sub.MEMO_ITM_INVC_ITM_ID = company.INVC_ITM_ID
		        WHERE mst.MEMO_ADJ_ID IN (SELECT MEMO_ADJ_ID FROM PAY0123M WHERE BATCH_ID = #{batchId})
		              AND mst.MEMO_ADJ_STUS_ID = 1
		        ) tb1
		        left JOIN SAL0001D tb2
		ON         tb1.BILL_ITM_REF_NO = tb2.SALES_ORD_NO
		left JOIN SAL0029D tb3
		ON tb2.CUST_ID = tb3.CUST_ID
    </select>


    <select id="selectAdjBatchApprovalPopHist" parameterType="Map" resultType="egovMap">
       SELECT
            A.ADJ_INVC_NO,
            B.MEMO_ADJ_REF_NO,
            A.ADJ_STUS_ID,
            (CASE
                WHEN A.ADJ_STUS_ID = 1 THEN 'Requested'
                WHEN A.ADJ_STUS_ID = 4 THEN 'Approved'
                WHEN A.ADJ_STUS_ID = 21 THEN 'Rejected' ELSE ' ' END) AS ADJ_STUS_NAME,
            TO_CHAR(A.ADJ_CRT_DT,'DD/MM/YYYY') AS ADJ_CRT_DT,
            A.ADJ_CRT_USER_ID,
            C.USER_NAME AS ADJ_CRT_USER_NAME,
            D.DEPT_NAME
        FROM
            PAY0122D A
            JOIN PAY0011D B ON A.MEMO_ADJ_ID = B.MEMO_ADJ_ID
            LEFT JOIN SYS0047M C ON A.ADJ_CRT_USER_ID = C.USER_ID
            LEFT JOIN SYS0040M D   ON C.USER_DEPT_ID = D.DEPT_ID
        WHERE
            A.ADJ_INVC_NO IN (SELECT B.MEMO_ADJ_INVC_NO FROM PAY0123M A JOIN PAY0011D B ON A.MEMO_ADJ_ID = B.MEMO_ADJ_ID WHERE A.BATCH_ID = #{batchId} )
        ORDER BY
            A.ADJ_CRT_DT DESC
    </select>

         <select id="selectAdjDetailPopMasterOld" parameterType="Map" resultType="egovMap">
       SELECT
        mst.ADJ_ENTRY_ID MEMO_ADJ_ID ,
        mst.ADJ_ENTRY_NOTE_NO MEMO_ADJ_REF_NO ,
        mst.ADJ_ENTRY_RPT_NO MEMO_ADJ_RPT_NO ,
        mst.ADJ_ENTRY_NOTE_TYPE_ID MEMO_ADJ_TYPE_ID ,
        mst.ADJ_ENTRY_INVC_TYPE_ID MEMO_ADJ_INVC_TYPE_ID ,
        mst.ADJ_ENTRY_STUS_ID MEMO_ADJ_STUS_ID ,
        mst.ADJ_ENTRY_REM MEMO_ADJ_REM ,
        mst.ADJ_ENTRY_TXS MEMO_ADJ_TXS_AMT ,
        mst.ADJ_ENTRY_AMT MEMO_ADJ_TOT_AMT ,
        TO_CHAR(mst.ADJ_ENTRY_CRT_DT,'DD/MM/YYYY') AS MEMO_ADJ_CRT_DT ,
        0 TAX_INVC_TYPE ,
        '' TAX_INVC_REF_NO ,
        '' TAX_INVC_REF_DT ,
        0  TAX_INVC_MONTH ,
        0  TAX_INVC_YEAR ,
        '' MEMO_ADJ_INVC_TYPE_NM ,
        '-'  TAX_INVC_GRP_NO
        , 0 ORD_ID
        , '-' ORD_NO ,
        '-'  TAX_INVC_SVC_NO ,
        '' TAX_INVC_CUST_NAME ,
        '' TAX_INVC_CNTC_PERSON ,
        '' ADDRESS ,
        '' TAX_INVC_REM ,
        0 TAX_INVC_OVERDU  ,
        0 TAX_INVC_TXS  ,
        0 TAX_INVC_AMT_DUE  ,
        status.NAME MEMO_ADJ_STUS_NM ,
        cd1.CODE_NAME MEMO_ADJ_TYPE_NM ,
        rsn.RESN_DESC RESN_DESC ,
        mst.F_ADJ_ENTRY_CRT_USER_ID MEMO_ADJ_CRT_USER_ID,
        userinfo.USER_NAME MEMO_ADJ_CRT_USER_NM ,
        dept.DEPT_NAME,
        0 month,
        0 year

    FROM
        PAY0002D mst
        /* LEFT JOIN PAY0012D sub ON mst.MEMO_ADJ_ID = sub.MEMO_ADJ_ID */

        LEFT JOIN SYS0038M status ON mst.ADJ_ENTRY_STUS_ID = status.STUS_CODE_ID
        LEFT JOIN SYS0013M cd1 ON mst.ADJ_ENTRY_NOTE_TYPE_ID = cd1.CODE_ID
        LEFT JOIN SYS0032M rsn ON mst.ADJ_ENTRY_RESN_ID = rsn.RESN_ID
        LEFT JOIN SYS0047M userinfo ON mst.F_ADJ_ENTRY_CRT_USER_ID = userinfo.USER_ID
        LEFT JOIN SYS0040M dept   ON userinfo.USER_DEPT_ID = dept.DEPT_ID
    WHERE mst.ADJ_ENTRY_ID = #{adjId}
    </select>

    <select id="selectAdjDetailPopListOld" parameterType="Map" resultType="egovMap">
       SELECT
            DISTINCT
            cc.RESN_DESC BILL_ITM_TYPE ,
            dd.SALES_ORD_NO BILL_ITM_REF_NO ,
            0 MEMO_ITM_INVC_ITM_ID ,
            0 MEMO_ITM_INVC_ITM_QTY ,
            sub.ADJ_RESULT_AMT MEMO_ITM_CHRG ,
            sub.ADJ_RESULT_TXS MEMO_ITM_TXS ,
            sub.ADJ_RESULT_AMT MEMO_ITM_AMT
        FROM
            PAY0002D mst
            LEFT JOIN PAY0003D sub ON mst.ADJ_ENTRY_ID = sub.ADJ_RESULT_ENTRY_ID
            LEFT JOIN PAY0001C aa ON aa.ADJ_SET_ID = mst.ADJ_ENTRY_TYPE_SET_ID
            LEFT JOIN SYS0033M bb ON bb.RESN_GRP_ID = aa.ADJ_SET_GRP_ID
            LEFT JOIN SYS0032M cc ON cc.RESN_ID = bb.RESN_ID
            LEFT JOIN SAL0001D dd ON dd.SALES_ORD_ID = mst.ADJ_ENTRY_SO_ID
        WHERE mst.ADJ_ENTRY_ID = #{adjId}
    </select>

    <select id="getFinApprover" parameterType="Map" resultType="egovMap">
        SELECT
            APPR_MEM_CODE
        FROM FCM0023M
        WHERE APPR_MEM_STUS = '1'
        AND INVC_ADJ = '1'
    </select>

    <insert id="insertAdjReqAppv" parameterType="Map">
        INSERT INTO PAY0292D (
            MEMO_ADJ_ID,
            MEMO_ADJ_REF_NO,
            MEMO_REQST_DT,
            MEMO_APPV_PRCSS_STUS,
            MEMO_REQST_USER_ID,
            MEMO_APPR_USER_ID,
            MEMO_APPR_SEQ,
            MEMO_APPV_STUS,
            CRT_DT,
            CRT_USER_ID,
            UPD_DT,
            UPD_USER_ID
        ) VALUES (
            #{memoAdjustId},
            #{memoAdjustRefNo},
            SYSDATE,
            'R',
            #{userName},
            #{memCode},
            #{approveNo},
            #{appvStus},
            SYSDATE,
            #{userId},
            SYSDATE,
            #{userId}
        )
    </insert>

    <update id="updateAdjApprovalLine" parameterType="Map">
        UPDATE PAY0292D SET
            <choose>
                <when test='mode == "S" '>
                    MEMO_APPV_STUS = #{appvStus},
                    MEMO_APPV_DT = SYSDATE,
                    MEMO_REM = #{appvRem},
                </when>
                <otherwise>
                    MEMO_APPV_PRCSS_STUS = 'R',
                </otherwise>
            </choose>
            UPD_DT = SYSDATE,
            UPD_USER_ID = #{userId}
        WHERE 1=1
        <if test='mode == "S" '>
            <if test="apprGrp == null or apprGrp == '' ">
                AND MEMO_APPR_USER_ID = #{memCode}
            </if>
            <if test="apprGrp != null and apprGrp != '' ">
                AND MEMO_APPR_USER_ID IN (
                    SELECT APPR_MEM_CODE
                    FROM FCM0023M
                    WHERE INVC_ADJ = '1'
                    AND APPR_GRP = #{apprGrp}
                )
            </if>
        </if>
        <choose>
            <when test="batchId != null and batchId != '' ">
                AND MEMO_ADJ_ID = #{batchId}
            </when>
            <otherwise>
                AND MEMO_ADJ_ID = #{adjId}
            </otherwise>
        </choose>
    </update>

    <update id="updateAdjNextAppvLine" parameterType="Map">
        MERGE INTO PAY0292D A
		USING (
		    SELECT MEMO_ADJ_ID, MAX(MEMO_APPR_SEQ) MAX_SEQ
		    FROM PAY0292D
		    WHERE 1=1
		    AND MEMO_APPV_DT IS NOT NULL
		    <choose>
                <when test="batchId != null and batchId != '' ">
                    AND MEMO_ADJ_ID = #{batchId}
                </when>
                <otherwise>
                    AND MEMO_ADJ_ID = #{adjId}
                </otherwise>
            </choose>
		    GROUP BY MEMO_ADJ_ID
		) SRC
		ON(A.MEMO_ADJ_ID = SRC.MEMO_ADJ_ID AND A.MEMO_APPR_SEQ = SRC.MAX_SEQ + 1)
		WHEN MATCHED THEN UPDATE SET
		    MEMO_APPV_STUS = 'R',
		    UPD_DT = SYSDATE,
		    UPD_USER_ID = #{userId}
    </update>

    <select id="getAdjApprLine" parameterType="Map" resultType="egovMap">
        SELECT A.*,
                   C.NAME MEMO_APPR_USER_NAME
        FROM PAY0292D A
        INNER JOIN (
            SELECT MEMO_ADJ_ID, MAX(MEMO_APPR_SEQ) MAX_SEQ
            FROM PAY0292D
            WHERE 1=1
            <if test='mode == "NTF" '>
                AND MEMO_APPV_STUS = 'R'
            </if>
            <if test='mode == "C" '>
                AND MEMO_APPV_DT IS NOT NULL
            </if>
            GROUP BY MEMO_ADJ_ID
        ) B
            ON A.MEMO_ADJ_ID = B.MEMO_ADJ_ID
            AND A.MEMO_APPR_SEQ = B.MAX_SEQ
        INNER JOIN ORG0001D C
            ON A.MEMO_APPR_USER_ID = C.MEM_CODE
        WHERE 1=1
            <choose>
                <when test="batchId != null and batchId != '' ">
                    AND A.MEMO_ADJ_ID = #{batchId}
                </when>
                <otherwise>
                    AND A.MEMO_ADJ_ID = #{adjId}
                </otherwise>
            </choose>
    </select>

    <select id="nextApprover" parameterType="Map" resultType="String">
        SELECT
            USER_NAME APPV_NAME
        FROM SYS0047M
        WHERE HR_CODE = #{memCode}
    </select>

    <select id="selectAppvLineInfo" parameterType="Map" resultType="egovMap">
        SELECT * FROM (
			SELECT
			    DISTINCT
			    A.MEMO_REQST_USER_ID,
			    TO_CHAR(A.MEMO_REQST_DT, 'DD/MM/YYYY') REQST_DT,
			    A.MEMO_APPV_PRCSS_STUS,
			    A.MEMO_APPR_SEQ,
			    A.MEMO_APPR_USER_ID,
			    B.NAME APPV_LINE_USER_NAME,
			    A.MEMO_APPV_STUS,
			    NVL(TO_CHAR(A.MEMO_APPV_DT, 'DD/MM/YYYY'), '-') APPV_DT,
			    NVL(A.MEMO_REM, '-') MEMO_REM,
			    C.FULL_NAME FINAL_APPR_USER,
                C.FINAL_APPV_DT
			FROM PAY0011D M
			INNER JOIN PAY0292D A
            ON (M.MEMO_ADJ_ID = LTRIM(A.MEMO_ADJ_ID, 'BCH') OR M.BATCH_ID = LTRIM(A.MEMO_ADJ_ID, 'BCH'))
			INNER JOIN ORG0001D B
			ON A.MEMO_APPR_USER_ID = B.MEM_CODE
			LEFT JOIN (
                SELECT
                    A.MEMO_ADJ_ID,
                    D.FULL_NAME,
                    TO_CHAR(A.MEMO_APPV_DT, 'DD/MM/YYYY') FINAL_APPV_DT
                FROM PAY0292D A
                INNER JOIN (SELECT MEMO_ADJ_ID, MAX(MEMO_APPR_SEQ) MEMO_APPR_SEQ FROM PAY0292D WHERE MEMO_APPV_DT IS NOT NULL GROUP BY MEMO_ADJ_ID) B
                ON A.MEMO_ADJ_ID = B.MEMO_ADJ_ID AND A.MEMO_APPR_SEQ = B.MEMO_APPR_SEQ
                INNER JOIN SYS0047M C
                ON A.UPD_USER_ID = C.USER_ID
                INNER JOIN ORG0001D D
                ON C.HR_CODE = D.MEM_CODE
            ) C
            ON A.MEMO_ADJ_ID = C.MEMO_ADJ_ID
			/*INNER JOIN SYS0047M C
			ON A.UPD_USER_ID = C.USER_ID
			INNER JOIN ORG0001D D
			ON C.HR_CODE = D.MEM_CODE*/
			WHERE 1 = 1
			<choose>
                <when test="batchId != null and batchId != '' ">
                    AND M.BATCH_ID = #{batchId}
                </when>
                <otherwise>
                    AND M.MEMO_ADJ_ID = #{adjId}
                </otherwise>
            </choose>
		)
        ORDER BY MEMO_APPR_SEQ
    </select>

</mapper>