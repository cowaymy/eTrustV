<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.coway.trust.biz.sales.mambership.impl.MembershipPackageMMapper">
 
    
 <select id="selectList" parameterType="Map" resultType="egovMap">
          
                    SELECT S.SRV_CNTRCT_PAC_ID   ,
                               S.SRV_CNTRCT_PAC_CODE   ,
                               S.SRV_CNTRCT_PAC_DESC   ,
                               S.SRV_CNTRCT_PAC_DUR   ,
                               S.SRV_CNTRCT_PAC_STUS_ID   ,
                               S.CODE   ,
                               to_char(S.C1,'yyyy/mm/dd')  c1   ,
                               S.USER_NAME   ,
                               to_char(S.SRV_CNTRCT_PAC_START_DT,'yyyy/mm/dd') SRV_CNTRCT_PAC_START_DT  ,
                               to_char(S.SRV_CNTRCT_PAC_END_DT,'yyyy/mm/dd')    SRV_CNTRCT_PAC_END_DT 
                          FROM ( SELECT F.SRV_CNTRCT_PAC_ID   ,
                                        F.SRV_CNTRCT_PAC_CODE   ,
                                        F.SRV_CNTRCT_PAC_DESC   ,
                                        F.SRV_CNTRCT_PAC_DUR   ,
                                        F.SRV_CNTRCT_PAC_STUS_ID   ,
                                        F.SRV_CNTRCT_PAC_START_DT   ,
                                        F.SRV_CNTRCT_PAC_END_DT   ,
                                        F.CODE   ,
                                        U.USER_NAME   ,
                                        CASE 
                                             WHEN ( F.SRV_CNTRCT_PAC_CRT_DT IS NOT NULL ) THEN  F.SRV_CNTRCT_PAC_CRT_DT
                                              ELSE  TO_DATE('1900/01/01 00:00:00')
                                         END C1  
                     FROM ( SELECT D.SRV_CNTRCT_PAC_ID   ,
                                   D.SRV_CNTRCT_PAC_CODE   ,
                                   D.SRV_CNTRCT_PAC_DESC   ,
                                   D.SRV_CNTRCT_PAC_DUR   ,
                                   D.SRV_CNTRCT_PAC_STUS_ID   ,
                                   D.SRV_CNTRCT_PAC_CRT_DT   ,
                                   D.SRV_CNTRCT_PAC_CRT_USER_ID   ,
                                   D.SRV_CNTRCT_PAC_START_DT   ,
                                   D.SRV_CNTRCT_PAC_END_DT   ,
                                   Extent2.CODE   
                            FROM SAL0081D D
                                   JOIN SYS0038M Extent2   ON Extent2.STUS_CODE_ID = D.SRV_CNTRCT_PAC_STUS_ID
                             WHERE   1=1 
                               <if test="SRV_CNTRCT_PAC_STUS_ID != null and SRV_CNTRCT_PAC_STUS_ID != ''">
                                    AND D.SRV_CNTRCT_PAC_STUS_ID IN
                                     <foreach item="item" collection="SRV_CNTRCT_PAC_STUS_ID" index="index" open="(" separator="," close=")">
                                        #{item}
                                   </foreach>
                               </if>
                           ) F
                            JOIN SYS0047M  U   ON U.USER_ID = F.SRV_CNTRCT_PAC_CRT_USER_ID
                      WHERE    1=1 
                      
                          <if test="SRV_CNTRCT_PAC_CODE != null and SRV_CNTRCT_PAC_CODE != ''">
                                                AND (F.SRV_CNTRCT_PAC_CODE =  LIKE '%'|| #{SRV_CNTRCT_PAC_CODE} ||'%') 
                          </if>
                                                   
                          <if test="SRV_CNTRCT_PAC_DESC != null and SRV_CNTRCT_PAC_DESC != ''">
                                                AND (F.SRV_CNTRCT_PAC_DESC =  LIKE '%'|| #{SRV_CNTRCT_PAC_DESC} ||'%') 
                          </if>
                          
                          <if test="SRV_CNTRCT_PAC_DUR != null and SRV_CNTRCT_PAC_DUR != ''">
                                                AND (F.SRV_CNTRCT_PAC_DUR =  #{SRV_CNTRCT_PAC_DUR}) 
                          </if>
                        ) S
              ORDER BY S.SRV_CNTRCT_PAC_ID ASC
  </select>
  
  
  
  
    
 <select id="selectPopDetailList" parameterType="Map" resultType="egovMap">
             <![CDATA[
                    SELECT S.SRV_PAC_ITM_ID   ,
                           S.SRV_CNTRCT_PAC_ID   ,
                           S.SRV_PAC_ITM_PRODUCT_ID   ,
                           S.STK_CODE   ,
                           S.STK_DESC   ,
                           S.CODE_NAME   ,
                           S.SRV_PAC_ITM_RENTAL   ,
                           S.SRV_PAC_ITM_SVC_FREQ   ,
                           S.SRV_PAC_ITM_STUS_ID   ,
                           S.CODE   ,
                           S.SRV_PAC_ITM_UPD_DT   ,
                           S.USER_NAME   
                      FROM ( SELECT D.SRV_PAC_ITM_ID   ,
                                    D.SRV_CNTRCT_PAC_ID   ,
                                    D.SRV_PAC_ITM_PRODUCT_ID   ,
                                    D.SRV_PAC_ITM_SVC_FREQ   ,
                                    D.SRV_PAC_ITM_RENTAL   ,
                                    D.SRV_PAC_ITM_STUS_ID   ,
                                    D.SRV_PAC_ITM_UPD_DT   ,
                                    E.STK_CODE   ,
                                    E.STK_DESC   ,
                                    Extent3.CODE_NAME   ,
                                    Extent4.CODE   ,
                                    Extent5.USER_NAME   
                             FROM SAL0082D D
                                    JOIN SYS0026M E   ON ( E.STK_ID = D.SRV_PAC_ITM_PRODUCT_ID )
                                    AND ( 1 = E.STUS_CODE_ID )
                                    JOIN SYS0013M Extent3   ON Extent3.CODE_ID = E.STK_CTGRY_ID
                                    JOIN SYS0038M Extent4   ON Extent4.STUS_CODE_ID = D.SRV_PAC_ITM_STUS_ID
                                    JOIN SYS0047M Extent5   ON Extent5.USER_ID = D.SRV_PAC_ITM_UPD_USER_ID
                              WHERE  ( D.SRV_CNTRCT_PAC_ID = #{SRV_CNTRCT_PAC_ID} )
                                       AND ( D.SRV_PAC_ITM_STUS_ID = #{SRV_PAC_ITM_STUS_ID} )
                              ) S
                      ORDER BY S.STK_DESC ASC
        ]]>
  </select>
  
  
 <select id="selectPopDetail" parameterType="Map" resultType="egovMap">
 
             <![CDATA[
                    SELECT S.SRV_PAC_ITM_ID   ,
                           S.SRV_CNTRCT_PAC_ID   ,
                           S.SRV_PAC_ITM_PRODUCT_ID   ,
                           S.STK_CODE   ,
                           S.STK_DESC   ,
                           S.CODE_NAME   ,
                           S.SRV_PAC_ITM_RENTAL   ,
                           S.SRV_PAC_ITM_SVC_FREQ   ,
                           S.SRV_PAC_ITM_STUS_ID   ,
                           S.CODE   ,
                           S.SRV_PAC_ITM_UPD_DT   ,
                           S.USER_NAME   
                      FROM ( SELECT D.SRV_PAC_ITM_ID   ,
                                    D.SRV_CNTRCT_PAC_ID   ,
                                    D.SRV_PAC_ITM_PRODUCT_ID   ,
                                    D.SRV_PAC_ITM_SVC_FREQ   ,
                                    D.SRV_PAC_ITM_RENTAL   ,
                                    D.SRV_PAC_ITM_STUS_ID   ,
                                    D.SRV_PAC_ITM_UPD_DT   ,
                                    E.STK_CODE   ,
                                    E.STK_DESC   ,
                                    Extent3.CODE_NAME   ,
                                    Extent4.CODE   ,
                                    Extent5.USER_NAME   
                             FROM SAL0082D D
                                    JOIN SYS0026M E   ON ( E.STK_ID = D.SRV_PAC_ITM_PRODUCT_ID )
                                    AND ( 1 = E.STUS_CODE_ID )
                                    JOIN SYS0013M Extent3   ON Extent3.CODE_ID = E.STK_CTGRY_ID
                                    JOIN SYS0038M Extent4   ON Extent4.STUS_CODE_ID = D.SRV_PAC_ITM_STUS_ID
                                    JOIN SYS0047M Extent5   ON Extent5.USER_ID = D.SRV_PAC_ITM_UPD_USER_ID
                              WHERE  ( D.SRV_CNTRCT_PAC_ID = #{SRV_CNTRCT_PAC_ID} )
                                       AND ( D.SRV_PAC_ITM_STUS_ID = #{SRV_PAC_ITM_STUS_ID} )
                              ) S
                      ORDER BY S.STK_DESC ASC
        ]]>
  </select>
      
      
      
      
 <select id="selectPopUpList" parameterType="Map" resultType="egovMap">
 
          
                       SELECT E.SRV_PAC_ITM_ID   ,
                           E.SRV_CNTRCT_PAC_ID   ,
                           E.SRV_PAC_ITM_PRODUCT_ID   ,
                           S.STK_CODE   ,
                           S.STK_DESC   ,
                           M.CODE_NAME   ,
                          TO_CHAR( E.SRV_PAC_ITM_RENTAL,'FM9999999999990.00') SRV_PAC_ITM_RENTAL  ,
                           E.SRV_PAC_ITM_SVC_FREQ   ,
                           E.SRV_PAC_ITM_STUS_ID   ,
                           Extent4.CODE   ,
                           E.SRV_PAC_ITM_UPD_DT   ,
                           U.USER_NAME   
                      FROM SAL0082D E
                             JOIN SYS0026M S   ON ( S.STK_ID = E.SRV_PAC_ITM_PRODUCT_ID )
                             AND ( 1 = S.STUS_CODE_ID )
                             JOIN SYS0013M M   ON M.CODE_ID = S.STK_CTGRY_ID
                             JOIN SYS0038M Extent4   ON Extent4.STUS_CODE_ID = E.SRV_PAC_ITM_STUS_ID
                             JOIN SYS0047M U   ON U.USER_ID = E.SRV_PAC_ITM_UPD_USER_ID
                     WHERE  E.SRV_PAC_ITM_ID = #{SRV_PAC_ITM_ID}  AND ROWNUM    <![CDATA[<  ]]> = 1

      
  </select>
      
      
      
      
      
   <insert id="SAL0081D_update" parameterType="Map" >
        UPDATE SAL0081D 
        SET  
               SRV_CNTRCT_PAC_CODE        = #{srvCntrctPacCode},
               SRV_CNTRCT_PAC_DESC        = #{srvCntrctPacDesc},
               SRV_CNTRCT_PAC_DUR          = #{srvCntrctPacDur}, 
               SRV_CNTRCT_PAC_STUS_ID   = #{code},
               SRV_CNTRCT_PAC_START_DT = to_date(#{srvCntrctPacStartDt},'yyyy/mm/dd'),
               SRV_CNTRCT_PAC_END_DT     = to_date(#{srvCntrctPacEndDt},'yyyy/mm/dd')
        WHERE  SRV_CNTRCT_PAC_ID        = #{srvCntrctPacId}
   </insert>
   
   
   
   
   <insert id="SAL0082D_insert" parameterType="Map" >
            INSERT INTO SAL0082D (
                               SRV_PAC_ITM_ID, SRV_CNTRCT_PAC_ID, SRV_PAC_ITM_PRODUCT_ID, 
                               SRV_PAC_ITM_SVC_FREQ, SRV_PAC_ITM_RENTAL, SRV_PAC_ITM_PV, 
                               SRV_PAC_ITM_REM, SRV_PAC_ITM_STUS_ID, SRV_PAC_ITM_UPD_DT, 
                               SRV_PAC_ITM_UPD_USER_ID) 
            VALUES (   SAL0082D_SRV_PAC_ITM_ID_SEQ.NEXTVAL , #{srvContractPacID} ,  #{srvPacItemProductID},
                           #{srvPacItemServiceFreq} , #{srvPacItemRental} ,  #{srvPacItemPV},
                           #{srvPacItemRemark} , #{srvPacItemStatusID} ,sysdate, #{updator}
                       )
   </insert>
   
   <insert id="SAL0082D_update" parameterType="Map" >
            
            UPDATE  SAL0082D
            SET   
                       SRV_CNTRCT_PAC_ID       = #{srvContractPacID},
                       SRV_PAC_ITM_PRODUCT_ID  =  #{srvPacItemProductID},
                       SRV_PAC_ITM_SVC_FREQ    = #{srvPacItemServiceFreq},
                       SRV_PAC_ITM_RENTAL      =  #{srvPacItemRental},
                       SRV_PAC_ITM_PV          = #{srvPacItemPV},
                       SRV_PAC_ITM_REM         = #{srvPacItemRemark},
                       SRV_PAC_ITM_STUS_ID     = #{srvPacItemStatusID},
                       SRV_PAC_ITM_UPD_DT      = SYSDATE,
                       SRV_PAC_ITM_UPD_USER_ID =  #{updator}
            WHERE  SRV_PAC_ITM_ID          = #{srvPacItemID}
   </insert>
   
   
   
   
    
 <select id="selectGroupCode" parameterType="Map" resultType="egovMap">
            SELECT 
               distinct  A.STK_ID  CodeId,
                A.STK_CODE||'-'||A.STK_DESC  CodeName,  
                C.CODE_NAME      GroupCd ,
                COUNT(CODE_NAME) OVER (PARTITION BY CODE_NAME) overcnt
             FROM SYS0026M  A  ,
                          SAL0016M  B  ,
                          SYS0013M  C
               WHERE A.STK_ID  = B.STK_ID
                 AND A.STK_CTGRY_ID  = C.CODE_ID 
                 AND A.IS_NCV !=1 
                 AND A.STUS_CODE_ID =1 
                 AND A.STK_TYPE_ID =61
                 AND B.AMT >0
              order by GroupCd , CodeName

  </select>
      
   
      
      
 <select id="selectGroupCodeGroupby" parameterType="Map" resultType="egovMap">
              SELECT   CODE_NAME  
                      FROM( 
                         SELECT 
                            C.CODE_NAME       
                         FROM SYS0026M  A  ,
                                      SAL0016M  B  ,
                                      SYS0013M  C
                           WHERE A.STK_ID  = B.STK_ID
                             AND A.STK_CTGRY_ID  = C.CODE_ID 
                             AND A.IS_NCV !=1 
                             AND A.STUS_CODE_ID =1 
                             AND A.STK_TYPE_ID =61
                             AND B.AMT >0
                            ORDER BY  CODE_NAME
                       )
                         group by CODE_NAME
  </select>
      
      
        
      
      <insert id="SAL0082D_delete" parameterType="Map" >
                 UPDATE SAL0082D
                   SET SRV_PAC_ITM_STUS_ID =  #{SRV_PAC_ITM_STUS_ID} ,
                       SRV_PAC_ITM_UPD_DT = sysdate  
                 WHERE  ( SRV_PAC_ITM_ID = #{SRV_PAC_ITM_ID} )
     </insert>
 
      
     
   
   
      
</mapper>