<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.coway.trust.biz.payment.invoice.service.impl.InvoicePOMapper">

    <!-- Reconciliation 리스트 조회 -->
	<select id="selectOrderBasicInfoByOrderId" parameterType="Map" resultType="egovMap">
		SELECT Extent1.ORD_ID ORD_ID  ,
		       Extent1.ORD_NO ORD_NO  ,
		       Extent1.RENTAL_STUS RENTAL_STUS  ,
		       Extent1.ORD_STUS_ID ORD_STUS_ID  ,
		       Extent1.ORD_STUS_CODE ORD_STUS_CODE  ,
		       Extent1.ORD_STUS_NAME ORD_STUS_NAME  ,
		       Extent1.ORD_DT ORD_DT  ,
		       Extent1.INSTLMT_PRIOD INSTLMT_PRIOD  ,
		       Extent1.ORD_AMT ORD_AMT  ,
		       Extent1.ORD_MTH_RENTAL ORD_MTH_RENTAL  ,
		       Extent1.ORD_PV ORD_PV  ,
		       Extent1.ORD_PV_MONTH ORD_PV_MONTH  ,
		       Extent1.ORD_PV_YEAR ORD_PV_YEAR  ,
		       Extent1.ORD_REF_NO ORD_REF_NO  ,
		       Extent1.ORD_PO_NO ORD_PO_NO  ,
		       Extent1.ORD_DEPT_CODE ORD_DEPT_CODE  ,
		       Extent1.ORD_GRP_CODE ORD_GRP_CODE  ,
		       Extent1.ORD_ORG_CODE ORD_ORG_CODE  ,
		       Extent1.ORD_CRT_USER_ID ORD_CRT_USER_ID  ,
		       Extent1.ORD_CRT_DT ORD_CRT_DT  ,
		       Extent1.APP_TYPE_ID APP_TYPE_ID  ,
		       Extent1.APP_TYPE_CODE APP_TYPE_CODE  ,
		       Extent1.APP_TYPE_DESC APP_TYPE_DESC  ,
		       Extent1.STOCK_ID STOCK_ID  ,
		       Extent1.STOCK_CODE STOCK_CODE  ,
		       Extent1.STOCK_DESC STOCK_DESC  ,
		       Extent1.CUST_ID CUST_ID  ,
		       Extent1.CUST_TYPE CUST_TYPE  ,
		       Extent1.CUST_NAME CUST_NAME  ,
		       Extent1.CUST_NRIC CUST_NRIC  ,
		       Extent1.CUST_DOB CUST_DOB  ,
		       Extent1.CUST_NATION CUST_NATION  ,
		       Extent1.CUST_GENDER CUST_GENDER  ,
		       Extent1.CUST_RACE CUST_RACE  ,
		       Extent1.CUST_EMAIL CUST_EMAIL  ,
		       Extent1.CUST_VA_NO CUST_VA_NO  ,
		       Extent1.CUST_PASSPORT_EXPR CUST_PASSPORT_EXPR  ,
		       Extent1.CUST_VISA_EXPR CUST_VISA_EXPR  ,
		       Extent1.ORD_PROMO_ID ORD_PROMO_ID  ,
		       Extent1.ORD_PROMO_CODE ORD_PROMO_CODE  ,
		       Extent1.ORD_PROMO_DESC ORD_PROMO_DESC  ,
		       Extent1.ORD_MEM_ID ORD_MEM_ID  ,
		       Extent1.ORD_MEM_CODE ORD_MEM_CODE  ,
		       Extent1.ORD_MEM_NAME ORD_MEM_NAME  ,
		       Extent1.ORD_MEM_NRIC ORD_MEM_NRIC  ,
		       Extent1.ORD_MEM_TYPE_ID ORD_MEM_TYPE_ID  ,
		       Extent1.ORD_MEM_TYPE_CODE ORD_MEM_TYPE_CODE  ,
		       Extent1.ORD_MEM_TYPE_NAME ORD_MEM_TYPE_NAME  ,
		       Extent1.COOL_OFF_PRIOD COOL_OFF_PRIOD  ,
		       Extent1.KEYIN_BRNCH_ID KEYIN_BRNCH_ID  ,
		       Extent1.KEYIN_BRNCH_CODE KEYIN_BRNCH_CODE  ,
		       Extent1.KEYIN_BRNCH_NAME KEYIN_BRNCH_NAME  ,
		       Extent1.ORD_REM ORD_REM  ,
		       Extent1.RENT_CHK_ID RENT_CHK_ID  ,
		       Extent1.ORD_HM_ID ORD_HM_ID  ,
		       Extent1.ORD_SM_ID ORD_SM_ID  ,
		       Extent1.ORD_GM_ID ORD_GM_ID  ,
		       Extent1.ORD_ADDR_ID ORD_ADDR_ID  ,
		       Extent1.ORD_CNTC_ID ORD_CNTC_ID  ,
		       Extent1.ORD_PROMO_RELATED_NO ORD_PROMO_RELATED_NO  ,
		       Extent1.UPD_DT UPD_DT  ,
		       Extent1.UPD_USER_ID UPD_USER_ID  ,
		       Extent1.JOM_PAY_REF JOM_PAY_REF  ,
		       Extent1.STK_CTGRY_ID STK_CTGRY_ID  ,
		       Extent1.STK_CTGRY_NAME STK_CTGRY_NAME  ,
		       Extent1.CUST_TYPE_ID CUST_TYPE_ID  ,
		       Extent1.CUST_BILL_ID CUST_BILL_ID  ,
		       Extent1.OBLIGT_YEAR OBLIGT_YEAR  
	  FROM SAL1006V Extent1
	 WHERE Extent1.ORD_ID = #{orderId}
	</select>
	
	<select id="selectOrderDataByOrderId" parameterType="Map" resultType="egovMap">
	   SELECT Extent1.ID ID  ,
		       Extent1.PO_ORD_ID PO_ORD_ID  ,
		       Extent4.SALES_ORD_NO SALES_ORD_NO  ,
		       Extent5.CUST_ID CUST_ID  ,
		       Extent5.NAME NAME  ,
		       Extent1.PO_REF_NO PO_REF_NO  ,
		       Extent1.PO_START_INSTLMT || '~' ||Extent1.PO_END_INSTLMT period , 
		       TO_CHAR(Extent1.PO_CRT_DT, 'YYYY-MM-DD HH24:MI:SS') PO_CRT_DT,
		       Extent1.PO_CRT_USER_ID PO_CRT_USER_ID  ,
		       Extent3.USER_NAME USER_NAME  ,
		       Extent1.PO_UPD_DT PO_UPD_DT  ,
		       Extent1.PO_UPD_USER_ID PO_UPD_USER_ID  ,
		       Extent2.USER_NAME USERNAME1  ,
		       Extent1.PO_STUS_ID PO_STUS_ID  ,
		       Extent6.NAME NAME1  
	  FROM PAY0015D Extent1
	         LEFT JOIN SYS0047M Extent2   ON Extent2.USER_ID = Extent1.PO_UPD_USER_ID
	         LEFT JOIN SYS0047M Extent3   ON Extent3.USER_ID = Extent1.PO_CRT_USER_ID
	         LEFT JOIN SAL0001D Extent4   ON Extent4.SALES_ORD_ID = Extent1.PO_ORD_ID
	         LEFT JOIN SAL0029D Extent5   ON Extent5.CUST_ID = Extent4.CUST_ID
	         JOIN SYS0038M Extent6   ON Extent6.STUS_CODE_ID = Extent1.PO_STUS_ID
	 WHERE  Extent1.PO_ORD_ID = #{orderId}
	</select>
	
	<update id="updateInvoiceStatement" parameterType="Map">
	   UPDATE PAY0015D
	   SET PO_STUS_ID = 8,
             PO_UPD_USER_ID = #{userId},
             PO_UPD_DT = sysdate
	   WHERE ID = #{poEntryId}
	</update>
	
	<select id="selectInvoiceStatementByOrdId" parameterType="Map" resultType="egovMap">
	   SELECT Extent1.ID ID  ,
	       Extent1.PO_ORD_ID PO_ORD_ID  ,
	       Extent1.PO_REF_NO PO_REF_NO  ,
	       Extent1.PO_START_INSTLMT PO_START_INSTLMT  ,
	       Extent1.PO_END_INSTLMT PO_END_INSTLMT  ,
	       Extent1.PO_REM PO_REM  ,
	       Extent1.PO_STUS_ID PO_STUS_ID  ,
	       Extent1.PO_CRT_USER_ID PO_CRT_USER_ID  ,
	       Extent1.PO_CRT_DT PO_CRT_DT  ,
	       Extent1.PO_UPD_USER_ID PO_UPD_USER_ID  ,
	       Extent1.PO_UPD_DT PO_UPD_DT  ,
	       Extent1.PO_CNTRCT_ID PO_CNTRCT_ID  
	  FROM PAY0015D Extent1
	 WHERE  ( Extent1.PO_ORD_ID = #{orderId} )
	          AND ( 1 = Extent1.PO_STUS_ID )
	          AND ( TO_NUMBER(Extent1.PO_START_INSTLMT) <![CDATA[<=]]> #{startPeriod} )
	          AND ( TO_NUMBER(Extent1.PO_END_INSTLMT) <![CDATA[>=]]> #{startPeriod} )
	</select>
	
	<insert id="insertInvoicStatement" parameterType="Map">
	       INSERT INTO PAY0015D
			( 
			  ID,
			  PO_ORD_ID, 
			  PO_REF_NO, 
			  PO_START_INSTLMT, 
			  PO_END_INSTLMT, 
			  PO_REM, 
			  PO_STUS_ID, 
			  PO_CRT_USER_ID, 
			  PO_CRT_DT, 
			  PO_UPD_USER_ID, 
			  PO_UPD_DT, 
			  PO_CNTRCT_ID 
			)
			VALUES 
			( 
			  PAY0015D_ID_SEQ.NEXTVAL,
			  #{poOrderId}, 
			  #{poReferenceNo}, 
			  #{poStartInstallment}, 
			  #{poEndInstallment}, 
			  #{poRemark}, 
			  #{poStatusId}, 
			  #{userId}, 
			  sysdate, 
			  NULL, 
			  NULL, 
			  0 
			)
	</insert>
</mapper>