<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.coway.trust.biz.payment.reconciliation.service.impl.AccountReconciliationMapper">
    
    <select id="selectJournalMasterList" parameterType="Map" resultType="egovMap">
        SELECT 
		       Project1.F_BANK_JRNL_ID F_BANK_JRNL_ID  ,
		       Project1.F_BANK_JRNL_REF_NO F_BANK_JRNL_REF_NO  ,
		       Project1.F_BANK_JRNL_ACC_ID F_BANK_JRNL_ACC_ID  ,
		       Project1.ACC_CODE ACC_CODE  ,
		       Project1.ACC_DESC ACC_DESC  ,
		       Project1.F_BANK_JRNL_REM F_BANK_JRNL_REM  ,
		       Project1.STUS_CODE_ID STUS_CODE_ID  ,
		       Project1.NAME NAME  ,
		       TO_CHAR(Project1.C1 , 'DD-MM-YYYY hh:mi:ss A.M.') AS CRT_DT,
		       Project1.F_BANK_JRNL_CRT_USER_ID F_BANK_JRNL_CRT_USER_ID  ,
		       Project1.USER_NAME USER_NAME  ,
		       Project1.F_BANK_JRNL_ADJ F_BANK_JRNL_ADJ  
		  FROM ( SELECT Project1.F_BANK_JRNL_ID F_BANK_JRNL_ID  ,
		                Project1.F_BANK_JRNL_REF_NO F_BANK_JRNL_REF_NO  ,
		                Project1.F_BANK_JRNL_ACC_ID F_BANK_JRNL_ACC_ID  ,
		                Project1.F_BANK_JRNL_REM F_BANK_JRNL_REM  ,
		                Project1.F_BANK_JRNL_CRT_USER_ID F_BANK_JRNL_CRT_USER_ID  ,
		                Project1.F_BANK_JRNL_ADJ F_BANK_JRNL_ADJ  ,
		                Project1.C1 C1  ,
		                Project1.ACC_CODE ACC_CODE  ,
		                Project1.ACC_DESC ACC_DESC  ,
		                Project1.USER_NAME USER_NAME  ,
		                Project1.STUS_CODE_ID STUS_CODE_ID  ,
		                Project1.NAME NAME  ,
		                ROW_NUMBER() OVER ( ORDER BY Project1.F_BANK_JRNL_ID DESC  ) ROW_NUMBER  
		         FROM ( SELECT Extent1.F_BANK_JRNL_ID F_BANK_JRNL_ID  ,
		                       Extent1.F_BANK_JRNL_REF_NO F_BANK_JRNL_REF_NO  ,
		                       Extent1.F_BANK_JRNL_ACC_ID F_BANK_JRNL_ACC_ID  ,
		                       Extent1.F_BANK_JRNL_REM F_BANK_JRNL_REM  ,
		                       Extent1.F_BANK_JRNL_CRT_USER_ID F_BANK_JRNL_CRT_USER_ID  ,
		                       Extent1.F_BANK_JRNL_ADJ F_BANK_JRNL_ADJ  ,
		                       TO_DATE(Extent1.F_BANK_JRNL_CRT_DT) C1  ,
		                       Extent2.ACC_CODE ACC_CODE  ,
		                       Extent2.ACC_DESC ACC_DESC  ,
		                       Extent3.USER_NAME USER_NAME  ,
		                       Extent4.STUS_CODE_ID STUS_CODE_ID  ,
		                       Extent4.NAME NAME  
		                FROM PAY0079D Extent1
		                       LEFT JOIN SYS0001M Extent2   ON Extent1.F_BANK_JRNL_ACC_ID = Extent2.ACC_ID
		                       LEFT JOIN SYS0047M Extent3   ON Extent1.F_BANK_JRNL_CRT_USER_ID = Extent3.USER_ID
		                       LEFT JOIN SYS0038M Extent4   ON Extent1.F_BANK_JRNL_STUS_ID = Extent4.STUS_CODE_ID
		                 WHERE 1=1  
		                          <if test="refNo != ''"> 
		                          AND Extent1.F_BANK_JRNL_REF_NO LIKE '%' || #{refNo} || '%' ESCAPE '~' 
		                          </if>
		                          <if test="statusId != null">
		                              AND Extent4.STUS_CODE_ID IN
                                                    <foreach collection="statusId" item="item" open="(" close=")" separator="," >
                                                        #{item}
                                                    </foreach>   
                                 </if>
                                 <if test="uploadBy != ''"> 
		                          AND Extent3.USER_NAME LIKE '%' || #{uploadBy} || '%' ESCAPE '~' 
		                          </if>
		                          <if test="accountId != ''"> 
		                          AND Extent1.F_BANK_JRNL_ACC_ID = #{accountId}
		                          </if>
		                          <if test="fromUploadDate != null and toUploadDate != null and fromUploadDate != '' and toUploadDate != ''" > 
		                          AND TO_DATE(Extent1.F_BANK_JRNL_CRT_DT) <![CDATA[>= ]]> TO_DATE(#{fromUploadDate}, 'DD/MM/YYYY')
		                          AND TO_DATE(Extent1.F_BANK_JRNL_CRT_DT) <![CDATA[<= ]]> TO_DATE(#{toUploadDate}, 'DD/MM/YYYY') +1
		                          </if>
		                          ) Project1 ) Project1
		 WHERE  Project1.ROW_NUMBER > 0
		  ORDER BY Project1.F_BANK_JRNL_ID DESC
    </select>
    
    <select id="selectJournalMasterView" parameterType="Map" resultType="egovMap">
        SELECT 
		       Project1.F_BANK_JRNL_ID F_BANK_JRNL_ID  ,
		       Project1.F_BANK_JRNL_REF_NO F_BANK_JRNL_REF_NO  ,
		       Project1.F_BANK_JRNL_ACC_ID F_BANK_JRNL_ACC_ID  ,
		       Project1.ACC_CODE ACC_CODE  ,
		       Project1.ACC_DESC ACC_DESC  ,
		       Project1.F_BANK_JRNL_REM F_BANK_JRNL_REM  ,
		       Project1.STUS_CODE_ID STUS_CODE_ID  ,
		       Project1.NAME NAME  ,
		       TO_CHAR(Project1.F_BANK_JRNL_CRT_DT , 'DD-MM-YYYY') AS F_BANK_JRNL_CRT_DT,
		       Project1.F_BANK_JRNL_CRT_USER_ID F_BANK_JRNL_CRT_USER_ID  ,
		       Project1.USER_NAME USER_NAME  ,
		       Project1.F_BANK_JRNL_ADJ F_BANK_JRNL_ADJ  
		  FROM ( SELECT Project1.F_BANK_JRNL_ID F_BANK_JRNL_ID  ,
		                Project1.F_BANK_JRNL_REF_NO F_BANK_JRNL_REF_NO  ,
		                Project1.F_BANK_JRNL_ACC_ID F_BANK_JRNL_ACC_ID  ,
		                Project1.F_BANK_JRNL_REM F_BANK_JRNL_REM  ,
		                Project1.F_BANK_JRNL_CRT_USER_ID F_BANK_JRNL_CRT_USER_ID  ,
		                Project1.F_BANK_JRNL_ADJ F_BANK_JRNL_ADJ  ,
		                Project1.F_BANK_JRNL_CRT_DT F_BANK_JRNL_CRT_DT  ,
		                Project1.ACC_CODE ACC_CODE  ,
		                Project1.ACC_DESC ACC_DESC  ,
		                Project1.USER_NAME USER_NAME  ,
		                Project1.STUS_CODE_ID STUS_CODE_ID  ,
		                Project1.NAME NAME  ,
		                ROW_NUMBER() OVER ( ORDER BY Project1.F_BANK_JRNL_ID DESC  ) ROW_NUMBER  
		         FROM ( SELECT Extent1.F_BANK_JRNL_ID F_BANK_JRNL_ID  ,
		                       Extent1.F_BANK_JRNL_REF_NO F_BANK_JRNL_REF_NO  ,
		                       Extent1.F_BANK_JRNL_ACC_ID F_BANK_JRNL_ACC_ID  ,
		                       Extent1.F_BANK_JRNL_REM F_BANK_JRNL_REM  ,
		                       Extent1.F_BANK_JRNL_CRT_USER_ID F_BANK_JRNL_CRT_USER_ID  ,
		                       Extent1.F_BANK_JRNL_ADJ F_BANK_JRNL_ADJ  ,
		                       TO_DATE(Extent1.F_BANK_JRNL_CRT_DT) F_BANK_JRNL_CRT_DT  ,
		                       Extent2.ACC_CODE ACC_CODE  ,
		                       Extent2.ACC_DESC ACC_DESC  ,
		                       Extent3.USER_NAME USER_NAME  ,
		                       Extent4.STUS_CODE_ID STUS_CODE_ID  ,
		                       Extent4.NAME NAME  
		                FROM PAY0079D Extent1
		                       LEFT JOIN SYS0001M Extent2   ON Extent1.F_BANK_JRNL_ACC_ID = Extent2.ACC_ID
		                       LEFT JOIN SYS0047M Extent3   ON Extent1.F_BANK_JRNL_CRT_USER_ID = Extent3.USER_ID
		                       LEFT JOIN SYS0038M Extent4   ON Extent1.F_BANK_JRNL_STUS_ID = Extent4.STUS_CODE_ID
		                 WHERE  Extent1.F_BANK_JRNL_ID = #{journalId} 
		                  ) Project1 ) Project1
		 WHERE  Project1.ROW_NUMBER > 0
		  ORDER BY Project1.F_BANK_JRNL_ID DESC
    </select>
    
    <select id="selectJournalDetailList" parameterType="Map" resultType="egovMap">
        SELECT 
		       Project1.F_TRNSC_ID F_TRNSC_ID  ,
		       Project1.F_BANK_JRNL_ID F_BANK_JRNL_ID  ,
		       TO_CHAR(Project1.F_TRNSC_DT , 'DD-MM-YYYY') AS F_TRNSC_DT,
		       Project1.F_TRNSC_REF1 F_TRNSC_REF1  ,
		       Project1.F_TRNSC_REF2 F_TRNSC_REF2  ,
		       Project1.F_TRNSC_REF3 F_TRNSC_REF3  ,
		       Project1.F_TRNSC_REF4 F_TRNSC_REF4  ,
		       Project1.F_TRNSC_REF5 F_TRNSC_REF5  ,
		       Project1.F_TRNSC_REF6 F_TRNSC_REF6  ,
		       Project1.F_TRNSC_REM F_TRNSC_REM  ,
		       Project1.F_TRNSC_REF_RUNNG_NO F_TRNSC_REF_RUNNG_NO  ,
		       Project1.F_TRNSC_REF_CHQ_NO F_TRNSC_REF_CHQ_NO  ,
		       Project1.F_TRNSC_REF_EFT F_TRNSC_REF_EFT  ,
		       Project1.F_TRNSC_REF_VA_NO F_TRNSC_REF_VA_NO  ,
		       Project1.F_TRNSC_INSTCT F_TRNSC_INSTCT  ,
		       Project1.F_TRNSC_DEBT_AMT F_TRNSC_DEBT_AMT  ,
		       Project1.F_TRNSC_CRDIT_AMT F_TRNSC_CRDIT_AMT  ,
		       Project1.C2 C2  ,
		       Project1.USER_NAME USER_NAME  ,
		       Project1.F_TRNSC_UPD_DT F_TRNSC_UPD_DT  
		  FROM ( SELECT Project1.F_TRNSC_ID F_TRNSC_ID  ,
		                Project1.F_BANK_JRNL_ID F_BANK_JRNL_ID  ,
		                Project1.F_TRNSC_REF1 F_TRNSC_REF1  ,
		                Project1.F_TRNSC_REF2 F_TRNSC_REF2  ,
		                Project1.F_TRNSC_REF3 F_TRNSC_REF3  ,
		                Project1.F_TRNSC_REF4 F_TRNSC_REF4  ,
		                Project1.F_TRNSC_REF5 F_TRNSC_REF5  ,
		                Project1.F_TRNSC_REF6 F_TRNSC_REF6  ,
		                Project1.F_TRNSC_DEBT_AMT F_TRNSC_DEBT_AMT  ,
		                Project1.F_TRNSC_CRDIT_AMT F_TRNSC_CRDIT_AMT  ,
		                Project1.F_TRNSC_REM F_TRNSC_REM  ,
		                Project1.F_TRNSC_INSTCT F_TRNSC_INSTCT  ,
		                Project1.F_TRNSC_UPD_DT F_TRNSC_UPD_DT  ,
		                Project1.F_TRNSC_REF_RUNNG_NO F_TRNSC_REF_RUNNG_NO  ,
		                Project1.F_TRNSC_REF_EFT F_TRNSC_REF_EFT  ,
		                Project1.F_TRNSC_REF_CHQ_NO F_TRNSC_REF_CHQ_NO  ,
		                Project1.F_TRNSC_REF_VA_NO F_TRNSC_REF_VA_NO  ,
		                Project1.F_TRNSC_DT F_TRNSC_DT  ,
		                Project1.C2 C2  ,
		                Project1.USER_NAME USER_NAME  ,
		                ROW_NUMBER() OVER ( ORDER BY Project1.F_TRNSC_ID ASC  ) ROW_NUMBER  
		         FROM ( SELECT Extent1.F_TRNSC_ID F_TRNSC_ID  ,
		                       Extent1.F_BANK_JRNL_ID F_BANK_JRNL_ID  ,
		                       Extent1.F_TRNSC_REF1 F_TRNSC_REF1  ,
		                       Extent1.F_TRNSC_REF2 F_TRNSC_REF2  ,
		                       Extent1.F_TRNSC_REF3 F_TRNSC_REF3  ,
		                       Extent1.F_TRNSC_REF4 F_TRNSC_REF4  ,
		                       Extent1.F_TRNSC_REF5 F_TRNSC_REF5  ,
		                       Extent1.F_TRNSC_REF6 F_TRNSC_REF6  ,
		                       Extent1.F_TRNSC_DEBT_AMT F_TRNSC_DEBT_AMT  ,
		                       Extent1.F_TRNSC_CRDIT_AMT F_TRNSC_CRDIT_AMT  ,
		                       Extent1.F_TRNSC_REM F_TRNSC_REM  ,
		                       Extent1.F_TRNSC_INSTCT F_TRNSC_INSTCT  ,
		                       Extent1.F_TRNSC_UPD_DT F_TRNSC_UPD_DT  ,
		                       Extent1.F_TRNSC_REF_RUNNG_NO F_TRNSC_REF_RUNNG_NO  ,
		                       Extent1.F_TRNSC_REF_EFT F_TRNSC_REF_EFT  ,
		                       Extent1.F_TRNSC_REF_CHQ_NO F_TRNSC_REF_CHQ_NO  ,
		                       Extent1.F_TRNSC_REF_VA_NO F_TRNSC_REF_VA_NO  ,
		                       TO_DATE(Extent1.F_TRNSC_DT) F_TRNSC_DT  ,
		                       CASE 
		                            WHEN ( 1 = Extent1.F_TRNSC_IS_MTCH ) THEN 'O'
		                       ELSE 'X'
		                          END C2  ,
		                       Extent2.USER_NAME USER_NAME  
		                FROM PAY0081D Extent1
		                       LEFT JOIN SYS0047M Extent2   ON Extent1.F_TRNSC_UPD_USER_ID = Extent2.USER_ID
		                 WHERE  Extent1.F_BANK_JRNL_ID = #{journalId} 
		                 ) Project1 ) Project1
		 WHERE  Project1.ROW_NUMBER > 0
		  ORDER BY Project1.F_TRNSC_ID ASC
    </select>
    
    <select id="selectGrossTotal" parameterType="Map" resultType="String">
        SELECT 
		    TO_CHAR(GroupBy1.F_TRNSC_CRDIT_AMT , 'FM9999999999990.00') GROSS_TOTAL
		  FROM (
		  SELECT
		    SUM(NVL(Extent1.F_TRNSC_CRDIT_AMT,0)) AS F_TRNSC_CRDIT_AMT  
		    FROM PAY0081D Extent1
		    WHERE  Extent1.F_BANK_JRNL_ID = #{journalId} 
		 )GroupBy1
    </select>
    

</mapper>