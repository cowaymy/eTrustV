<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.coway.trust.biz.payment.eMandate.service.impl.EMandateMapper">

<!-- Added for DD enrollment by Hui Ding, 17/07/2023 -->
  <select id="checkOrderWithConditions" parameterType="Map" resultType="int">
        SELECT COUNT(1) AS VALID_ORDER FROM SAL0001D S
                JOIN SAL0029D C ON S.CUST_ID = C.CUST_ID
        WHERE TRIM(C.NRIC) = #{nric}
        AND TRIM(UPPER(C.NAME)) = #{name}
        AND S.SALES_ORD_NO = #{orderNo}
        AND S.STUS_CODE_ID = 4
  </select>

  <select id="getNextPaymentId" parameterType="Map" resultType="egovMap">
        SELECT 'CDD' || TO_CHAR (SYSDATE, 'YYMMDD') || LPAD (PAY0353M_PAY_ID_SEQ.NEXTVAL, 7, '0') PAY_ID
              FROM DUAL
    </select>

    <insert id="insertDDRequest" parameterType="Map">
        INSERT INTO PAY0353M(
            PAYMENT_ID,
            PAYMENT_MODE,
            CUST_ID,
            SALES_ORD_ID,
            REQ_STUS_ID,
            CRT_DT,
            CRT_USER_ID,
            AMT,
            EFFECTIVE_DT,
            RESPOND_REQ_ID,
            RESPOND_DT
        ) values (
            #{paymentId}
            ,#{paymentMode}
            ,#{custId}
            ,#{salesOrdId}
            ,#{stus}
            ,sysdate
            ,#{userId}
            ,#{amt}
            ,#{effectDate}
            ,#{apiId}
            ,#{resDate}
        )


    </insert>

  </mapper>