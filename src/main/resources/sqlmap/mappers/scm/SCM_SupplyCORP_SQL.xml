<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.coway.trust.biz.scm.impl.SalesPlanMngementMapper"> 

  <!-- Supply-CDC -->
  <select id="selectSupplyCDC" parameterType="Map" resultType="egovMap">
    SELECT DISTINCT 
          PLAN_ID CODE_VALUE 
        , CDC     CODE_VIEW
    FROM SCM0005M 
   WHERE PLAN_YEAR  = #{planYear}  
   <if test="planMonth != null and planMonth !=''">
     AND PLAN_MONTH = #{planMonth}  
   </if>
     AND PLAN_WEEK  = #{planWeek}  
     AND PLAN_STUS  = 4
   ORDER BY PLAN_ID
  </select> 
  
  <select id="selectComboSupplyCDC" parameterType="Map" resultType="egovMap">
    SELECT CODE
         , CODE_NAME
         , CODE_ID 
     FROM SYS0013M 
    WHERE CODE_MASTER_ID = #{codeMasterId}
  </select> 
  
  <select id="selectSupplyPlanMaster" parameterType="Map" resultType="egovMap">
     SELECT 
           PLAN_ID   
          ,PLAN_YEAR   
          ,PLAN_WEEK   
          ,CDC   
          ,PLAN_MONTH   
          ,PLAN_STUS   
          ,PLAN_CRT_DT   
          ,LAST_UP_DT   
          ,VER_NO   
          ,VER_DT   
      FROM SCM0005M 
     WHERE PLAN_YEAR = #{scmYearCbBox}
       AND PLAN_WEEK = #{scmPeriodCbBox}
       AND CDC = DECODE(#{cdcCbBox},'1001','KL','1002','PN','1003','JB','1004','KK','1005','KC','') 
  </select> 
  
  <select id="selectSalesPlanMaster" parameterType="Map" resultType="egovMap">
      SELECT 
           PLAN_ID   
          ,PLAN_YEAR   
          ,PLAN_MONTH   
          ,PLAN_WEEK   
          ,TEAM   
          ,PLAN_STUS_ID   
          ,CRT_DT   
          ,STUS_DT   
          ,CRT_USER_ID   
      FROM SCM0001M 
     WHERE PLAN_YEAR  = #{scmYearCbBox} 
       AND PLAN_MONTH = ( SELECT SCM_MONTH FROM SCM0018M WHERE SCM_YEAR = #{scmYearCbBox}  AND week_th = #{scmPeriodCbBox}  AND WEEK_TH_SN = 1) 
       AND PLAN_WEEK  = #{scmPeriodCbBox}
       AND PLAN_STUS_ID = 4
  </select>
  
  <!--  미저장이 있는 경우 RED -->
  <select id="selectSupplyCdcSaveFlag" parameterType="Map" resultType="egovMap">
    SELECT DECODE(COUNT(PLAN_MASTER_ID) ,0,'B','R' ) SAVE_FLAG
      FROM SCM0006D
     WHERE PLAN_MASTER_ID = ( SELECT PLAN_ID 
                                FROM SCM0005M  
                               WHERE PLAN_YEAR = #{scmYearCbBox} 
                                 AND PLAN_WEEK = #{scmPeriodCbBox} 
                                 AND CDC = DECODE(#{cdcCbBox},'1001','KL','1002','PN','1003','JB','1004','KK','1005','KC','') 
                             )
       AND CMPLT = 0
  </select> 
  
  <select id="selectSupplyCdcMainList" parameterType="Map" resultType="egovMap">
  SELECT  
           MOD( DENSE_RANK() OVER ( ORDER BY STOCK_CTGRY ,STOCK_CODE),2) DIV_ODD
           ,PLAN_DTL_ID   
           ,PLAN_MASTER_ID   
           ,PSI_ID     
           ,STOCK_CODE CODE   
           ,CMPLT      IS_SAVED
           ,LAST_UPD_COLUMN   
           ,PSI_NAME   PSI
           ,STOCK_CTGRY CATEGORY
           ,STOCK_NAME  NAME
           ,S26M.STK_TYPE_ID 
           ,M_3   
           ,M_2   
           ,M_1   
           ,M3_ISSU_AVG   
           ,SALES_PLAN_PRCNTAG   
           ,ROUND(M0_ORD)  M0_ORD  
           ,ROUND(M0_PLAN) M0_PLAN_ORDER  
           ,ROUND(M1) M1  
           ,ROUND(M2) M2  
           ,ROUND(M3) M3  
           ,ROUND(M4) M4  
           ,ROUND(OVERDUE) OVERDUE  
           ,ROUND(WS0) BEF_1_WEEK_TH  
           ,ROUND(WS1) BEF_2_WEEK_TH  
           ,ROUND(WS2) BEF_3_WEEK_TH  
           ,ROUND(WS3) BEF_4_WEEK_TH  
           ,ROUND(W00) W00  
           ,ROUND(W01) W01  
           ,ROUND(W02) W02  
           ,ROUND(W03) W03  
           ,ROUND(W04) W04  
           ,ROUND(W05) W05  
           ,ROUND(W06) W06  
           ,ROUND(W07) W07  
           ,ROUND(W08) W08  
           ,ROUND(W09) W09  
           ,ROUND(W10) W10  
           ,ROUND(W11) W11  
           ,ROUND(W12) W12  
           ,ROUND(W13) W13  
           ,ROUND(W14) W14  
           ,ROUND(W15) W15  
           ,ROUND(W16) W16  
           ,ROUND(W17) W17  
           ,ROUND(W18) W18  
           ,ROUND(W19) W19  
           ,ROUND(W20) W20  
           ,ROUND(W21) W21  
           ,ROUND(W22) W22  
           ,ROUND(W23) W23  
           ,ROUND(W24) W24  
           ,ROUND(W25) W25  
           ,ROUND(W26) W26  
           ,ROUND(W27) W27  
           ,ROUND(W28) W28  
           ,ROUND(W29) W29  
           ,ROUND(W30) W30  
      FROM SCM0006D  S06D
          ,SYS0026M  S26M
     WHERE PLAN_MASTER_ID = ( SELECT PLAN_ID 
                                FROM SCM0005M  
                               WHERE PLAN_YEAR = #{scmYearCbBox} 
                                 AND PLAN_WEEK = #{scmPeriodCbBox} 
                                 AND CDC = DECODE(#{cdcCbBox},'1001','KL','1002','PN','1003','JB','1004','KK','1005','KC','') 
                            )
        AND S06D.STOCK_CODE = S26M.STK_CODE
      <if test="stockCodeCbBox != null and stockCodeCbBox !=''">
       AND S06D.STOCK_CODE = #{stockCodeCbBox}         
      </if>
      <if test="scmStockType != null and scmStockType !=''">
       AND S26M.STK_TYPE_ID = #{scmStockType}         
      </if>
     ORDER BY S06D.STOCK_CTGRY 
             ,S06D.STOCK_CODE 
             ,S06D.PSI_ID
  </select>
  
  <!-- Supply-CORP -->
  <select id="selectSupplyCorpList" parameterType="Map" resultType="egovMap">
     SELECT MOD( DENSE_RANK() OVER ( ORDER BY STOCK_CTGRY,STOCK_CODE ),2 ) DIV_ODD
           ,PLAN_YEAR   
           ,PLAN_MONTH   
           ,PLAN_WEEK   
           ,STOCK_CTGRY CATEGORY
           ,STOCK_CODE  CODE 
           ,STOCK_NAME  NAME
           ,STK_TYPE_ID 
           ,PSI_ID      
           ,PSI_NAME    PSI
           ,ROUND(M0_ORD)  M0_ORD 
           ,ROUND(M0_PLAN) M0_PLAN_ORDER  
           ,ROUND(M1) M1  
           ,ROUND(M2) M2  
           ,ROUND(M3) M3  
           ,ROUND(M4) M4  
           ,ROUND(OVERDUE) OVERDUE   
           ,ROUND(WS0) BEF_1_WEEK_TH  
           ,ROUND(WS1) BEF_2_WEEK_TH  
           ,ROUND(WS2) BEF_3_WEEK_TH  
           ,ROUND(WS3) BEF_4_WEEK_TH  
           ,ROUND(W00) W00  
           ,ROUND(W01) W01  
           ,ROUND(W02) W02  
           ,ROUND(W03) W03  
           ,ROUND(W04) W04  
           ,ROUND(W05) W05  
           ,ROUND(W06) W06  
           ,ROUND(W07) W07  
           ,ROUND(W08) W08  
           ,ROUND(W09) W09  
           ,ROUND(W10) W10  
           ,ROUND(W11) W11  
           ,ROUND(W12) W12  
           ,ROUND(W13) W13  
           ,ROUND(W14) W14  
           ,ROUND(W15) W15  
           ,ROUND(W16) W16  
           ,ROUND(W17) W17  
           ,ROUND(W18) W18  
           ,ROUND(W19) W19  
           ,ROUND(W20) W20  
           ,ROUND(W21) W21  
           ,ROUND(W22) W22  
           ,ROUND(W23) W23  
           ,ROUND(W24) W24  
           ,ROUND(W25) W25  
           ,ROUND(W26) W26  
           ,ROUND(W27) W27  
           ,ROUND(W28) W28  
           ,ROUND(W29) W29  
           ,ROUND(W30) W30  
      FROM SCM0040V  
     WHERE PLAN_YEAR  = #{scmYearCbBox} 
       AND PLAN_WEEK  = #{scmPeriodCbBox}
       <if test="stockCodeCbBox != null and stockCodeCbBox !=''">
       AND STOCK_CODE = #{stockCodeCbBox}   
       </if>
       <if test="scmStockType != null and scmStockType !=''">
       AND STK_TYPE_ID = #{scmStockType}
       </if>
     ORDER BY STOCK_CTGRY
             ,STOCK_CODE
             ,PSI_ID
  </select> 
    
</mapper>