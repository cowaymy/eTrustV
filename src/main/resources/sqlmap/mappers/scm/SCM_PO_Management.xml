<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.coway.trust.biz.scm.impl.PoMngementMapper"> 

<!-- OTD Status Viewer -->
<select id="selectOtdStatusView" parameterType="Map" resultType="egovMap">
   SELECT 
	         PO_NO   
	        ,ISSUEDATE ISSUE_DATE  
	        ,STOCK_CODE STK_CODE  
	        ,STOCK_DESC STK_DESC   
	        /*,STK_TYPE_ID*/  
	        ,GR_WEEK   
	        ,GR_DT   
	        ,PO_QTY    
	        ,PO_STUS
	        
	        /*SO*/   
	        ,SO_QTY   
	        ,SO_DT   
	        
	        /*PP*/
	        ,PP_QTY_PLAN   
	        ,PP_QTY_RESULT   
	        ,PP_DT_PRODUCT_START   
	        ,PP_DT_PRODUCT_END   
	        ,PP_DT_PLAN   
	        
	        /*GI*/
	        ,GI_QTY 
	        ,GI_DT   
	        
	        /*SBO*/
	        ,SBO_PO_QTY   
	        ,AP_QTY   
	        ,GR_QTY  
     FROM scmotdview 
    WHERE 1 = 1
     <if test='startDate != null and startDate !=""  and endDate != null and endDate !="" '>
      AND ISSUEDATE <![CDATA[ >= ]]> TO_DATE(#{startDate},'DD/MM/YYYY')
      AND ISSUEDATE <![CDATA[ <= ]]> TO_DATE(#{endDate}  ,'DD/MM/YYYY')
     </if>
     <if test='poNoTxt != null and poNoTxt !="" '>
      AND PO_NO     =  #{poNoTxt}
     </if>
     <if test='statusSelBox != null and statusSelBox !="" '>
      AND PO_STUS   =  #{statusSelBox}
     </if>
     <if test="scmStockType != null and scmStockType !=''">
      <!-- AND STK_TYPE_ID = #{scmStockType} -->
     </if>
</select>

<select id="selectOtdSOGIDetailPop" parameterType="Map" resultType="egovMap">
		   SELECT  T0.PO_NO 
				      ,T1.STOCK_CODE  
				      ,STK.STK_DESC 
				      ,NVL(T1.QTY,0)  PO_QTY
				      ,NVL(T2.SO_QTY,0)  SO_QTY
				      ,NVL(T3.GI_QTY,0)  GI_QTY 
				      ,T2.SO_DT SO_DATE
				      ,T3.GI_DT GI_DATE
				      ,T0.PO_ISSU_DT  PO_ISSUE_DATE
				      ,T2.SO_NO   
				 FROM SCM0009M T0 LEFT JOIN SCM0010D T1 ON T1.PO_NO = T0.PO_NO 
				                  LEFT JOIN SCM0015D T2 ON T2.PO_NO=T1.PO_NO AND T2.STOCK_CODE=T1.STOCK_CODE 
				                  LEFT JOIN SCM0013D T3 ON T3.SO_NO=T2.SO_NO AND T3.STOCK_CODE=T2.STOCK_CODE 
				             JOIN SYS0026M STK ON STK.STK_CODE=T1.STOCK_CODE 
				 WHERE T0.PO_NO= #{poNo}
</select>

<select id="selectOtdSOPPDetailPop" parameterType="Map" resultType="egovMap">
				SELECT T0.PO_NO
				      ,T1.STOCK_CODE
				      ,STK.STK_DESC 
				      ,T1.QTY  PO_QTY
				      ,T2.SO_NO
				      ,NVL(T2.SO_QTY,0)  SO_QTY
				      ,NVL(T3.PP_QTY_PLAN,0)  PLAN_QTY
				      ,T3.PP_DT_PLAN PLAN_DATE
				      ,NVL(T3.PP_QTY_RESULT,0)  RESULT_QTY
				      ,T3.PP_DT_RESULT RESULT_DATE
				      ,T2.SO_DT
				 FROM SCM0009M T0 LEFT JOIN SCM0010D T1 ON T1.PO_NO = T0.PO_NO 
				                  LEFT JOIN SCM0015D T2 ON T2.PO_NO=T1.PO_NO AND T2.STOCK_CODE=T1.STOCK_CODE 
				                  LEFT JOIN SCM0014D T3 ON T3.SO_NO=T2.SO_NO AND T3.STOCK_CODE=T2.STOCK_CODE 
				             JOIN SYS0026M STK ON STK.STK_CODE=T1.STOCK_CODE 
				 WHERE T0.PO_NO = #{poNo}
</select>


<!-- Interface -->

<select id="selectInterfaceList" parameterType="Map" resultType="egovMap">
	 SELECT 
	        SPMON   
	      , MATNR   
	      , MATNR_NM   
	      , STOCK_TYPE 
	      , STK_TYPE_ID  
	      , CTGRY   
	      , MEASURE   
	      , AMT_K   
	      , WAERS_KRW   
	      , TO_CHAR(AMT_SUB, 'fm999,999,999,999.00')  AMT_SUB     
	      , WAERS_SUB   
	      , CNT   
	      , MEINS   
	      , AMT_USD   
	      , WAERS_USD   
	  FROM SCM0045V  
	 WHERE SPMON = #{targetDateCbBox}
 <if test="scmStockType != null and scmStockType !=''">
     AND STK_TYPE_ID = #{scmStockType}
 </if>	 
	 ORDER BY MATNR DESC
</select>

<select id="selectInterfaceLastState" parameterType="Map" resultType="egovMap">
	 SELECT TO_CHAR(IF_DT,'mm/dd/yyyy hh12:mm:ss AM') ||' '|| MSG_FROM_HQ LAST_STATE
		 FROM ( 
					 SELECT 
					        SN 
					      , TRGET_YEAR 
					      , IF_STUS 
					      , IF_DT                 
					      , MSG_FROM_HQ  
					    FROM SCM0025D 
					   WHERE  TRGET_YEAR = #{targetDateCbBox}
					   ORDER BY SN DESC
				  )
		  WHERE ROWNUM = 1
</select>
 
  <select id="selectScmPoView" parameterType="Map" resultType="egovMap">
		SELECT
	       'PDF'||'/ EXCEL' PDF
	       ,ROWNUM NO
	       ,PO_NO
	       ,PO_ITM_NO  
	       ,EST_WEEK 
	       ,GR_WEEK        
	       ,TO_CHAR(PO_ISSU_DT,'dd-mm-YYYY') PO_ISSU_DT  
	       ,STOCK_CODE         
	       ,STK_DESC  STOCK_NAME
	       ,QTY 
	       ,TO_CHAR(FOB_AMT, 'fm999,999,999,999.00')  FOB_AMT  
	       ,CDC  
	       ,RTPGR_WEEK         
	       ,PO_APPV_STUS  
	                     
	       ,PO_ID          
	       ,BAS_YEAR   
	       ,PO_STUS   
	       ,CRT_DT   
	       ,CRT_USER_ID   
	       ,UPD_DT   
	       ,UPD_USER_ID   
	       ,IF_DT   
	       ,GR_YEAR   
	       ,GR_MONTH   
	       ,SN   
	       ,STOCK_CTGRY   
	       ,STOCK_ID  
	       ,STK_TYPE_ID
	       ,PO_ITM_APPV_STUS   
	       ,GR_DT   
	   FROM SCM0041V 
	  WHERE BAS_YEAR = #{scmYearCbBox}  
	    AND EST_WEEK = #{scmPeriodCbBox} 
	    AND CDC = #{cdcCbBox}
	   <if test="stockCodeCbBox != null and stockCodeCbBox !=''">
	    AND STOCK_CODE = #{stockCodeCbBox}      
	   </if>
	   <if test="scmStockType != null and scmStockType !=''">
	    AND STK_TYPE_ID = #{scmStockType}    
	   </if>
      ORDER BY PO_NO DESC
  </select>
 
  <select id="selectScmPrePoItemView" parameterType="Map" resultType="egovMap">
    SELECT
           PRE_YEAR   
		     , PRE_MONTH   
		     , PRE_WEEK_TH   
		     , PRE_STOCK_CODE STOCK_CODE
		     , STK_DESC STOCK_NAME 
		     , STK_TYPE_ID     
		     , PRE_QTY  PLAN_QTY
		     , PO_QTY
		     , PRE_CDC 
		     , PRE_CRT_DT   
		     , PRE_PO_ITM_STUS   
		     , PRE_PO_ITM_STUS_DT   
		     , UNIT_PRC  FOB_PRICE 
		     , FOB_AMT   FOB_AMOUNT
		  FROM SCM0042V   
		 WHERE PRE_YEAR    = #{scmYearCbBox}  
		   AND PRE_WEEK_TH = #{scmPeriodCbBox}  
		   AND PRE_CDC     = #{cdcCbBox}
		   <if test='stockCodeCbBox != null and stockCodeCbBox !="" '> 
		   AND PRE_STOCK_CODE = #{stockCodeCbBox}      
		   </if>
       <if test="scmStockType != null and scmStockType !=''">
       AND STK_TYPE_ID = #{scmStockType}    
       </if>		   

     </select>
 
  <select id="selectScmPoStatusCnt" parameterType="Map" resultType="egovMap">
          SELECT  
				        (
				          SELECT COUNT(1) 
				            FROM SCM0011D
				           WHERE PRE_YEAR    = #{scmYearCbBox}  
				             AND PRE_WEEK_TH = #{scmPeriodCbBox}  
				             AND PRE_CDC     = #{cdcCbBox}
				             AND (PRE_QTY - PO_QTY) <![CDATA[ > ]]> 0
				         ) PRE_POITEM_CNT
				       ,(
				           SELECT COUNT(1) 
				             FROM SCM0009M 
				            WHERE BAS_YEAR = #{scmYearCbBox}  
				              AND EST_WEEK = #{scmPeriodCbBox}   
				              AND CDC      = #{cdcCbBox}
				              AND PO_STUS <![CDATA[ <> ]]> 5 
				        )  SCMPOMASTER_CNT
				   FROM DUAL   

  </select>
 
  
</mapper>