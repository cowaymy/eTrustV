<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.coway.trust.biz.scm.impl.OtdStatusManagementMapper">

<select id="selectOtdStatus" parameterType="Map" resultType="egovMap">
SELECT A.PO_NO
     , A.PO_ITEM_NO
     , A.STOCK_CODE
     , B.STK_DESC AS NAME
     , B.STK_TYPE_ID AS TYPE_ID
     , C.CODE_NAME AS TYPE
     , TO_CHAR(TO_DATE(A.PO_DT, 'YYYY-MM-DD'), 'YYYY-MM-DD') AS PO_DT
     , A.PO_QTY
     , A.PO_ITEM_STUS_ID
     , D.NAME AS PO_ITEM_STUS_NAME
     , A.SO_NO
     , A.SO_ITEM_NO
     , A.SO_QTY
     , TO_CHAR(TO_DATE(A.SO_DT, 'YYYY-MM-DD'), 'YYYY-MM-DD') AS SO_DT
     , TO_CHAR(TO_DATE(A.GR_DT, 'YYYY-MM-DD'), 'YYYY-MM-DD') AS GR_DT
     , A.PP_PLAN_QTY
     , A.PP_PROD_QTY
     , TO_CHAR(TO_DATE(A.PP_PROD_START_DT, 'YYYY-MM-DD'), 'YYYY-MM-DD') AS PP_PROD_START_DT
     , TO_CHAR(TO_DATE(A.PP_PROD_END_DT, 'YYYY-MM-DD'), 'YYYY-MM-DD') AS PP_PROD_END_DT
     , A.GI_QTY
     , TO_CHAR(TO_DATE(A.GI_DT, 'YYYY-MM-DD'), 'YYYY-MM-DD') AS GI_DT
     , A.SAP_PO_NO
     , A.SAP_PO_ITEM_NO
     , A.SAP_PO_QTY
     , A.SAP_AP_QTY
     , A.SAP_GR_QTY
     , A.REM
  FROM SCM0039M A
  LEFT OUTER JOIN SYS0026M B ON (A.STOCK_CODE = B.STK_CODE)
  LEFT OUTER JOIN SYS0013M C ON (B.STK_TYPE_ID = C.CODE_ID AND C.CODE_MASTER_ID = 15) /* 15 : Spare Part Type */
  LEFT OUTER JOIN SYS0038M D ON (A.PO_ITEM_STUS_ID = D.STUS_CODE_ID)
 WHERE 1 = 1
   AND A.PO_NO LIKE '%' || #{poNo} || '%'
	<if test="startDate != null and startDate != ''">
   AND A.PO_DT BETWEEN #{startDate} AND #{endDate}
	</if>
	<if test="poItemStusId != null and poItemStusId != ''">
   AND A.PO_ITEM_STUS_ID = #{poItemStusId}
	</if>
	<if test="scmStockTypeCbBox != null and ! scmStockTypeCbBox.isEmpty">
   AND B.STK_TYPE_ID IN
		<foreach item="item" collection="scmStockTypeCbBox" index="index" open="(" separator="," close=")">
		#{item}
		</foreach>
	</if>
 ORDER BY A.PO_NO, A.PO_ITEM_NO
</select>

</mapper>