<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.coway.trust.biz.scm.impl.ScmCommonMapper">

<select id="selectScmYear" parameterType="Map" resultType="egovMap">
SELECT TO_CHAR(SYSDATE - 365, 'YYYY') AS ID, TO_CHAR(SYSDATE - 365, 'YYYY') AS NAME FROM DUAL
UNION ALL
SELECT TO_CHAR(SYSDATE, 'YYYY') AS ID, TO_CHAR(SYSDATE, 'YYYY') AS NAME FROM DUAL
</select>

<select id="selectScmWeek" parameterType="Map" resultType="egovMap">
SELECT A.SCM_YEAR
     , A.WEEK_TH || DECODE(LENGTH(A.WEEK_TH), 1, '  [', '[') || TO_CHAR(A.WEEK_TH_SN_START, 'YYYY-MM-DD') || ' ~ ]' AS NAME
     , A.SCM_MONTH
     , A.WEEK_TH AS ID
  FROM SCM0018M A
 WHERE A.USE_YN = 'Y'
   AND A.WEEK_TH_SN = 1
   AND A.SCM_YEAR = #{scmYear}
</select>

<select id="selectScmTeam" parameterType="Map" resultType="egovMap">
SELECT A.CODE AS ID
     , A.CODE_NAME AS NAME
  FROM SYS0013M A
 WHERE A.CODE_MASTER_ID = 337
   AND A.DISAB = 0
 ORDER BY A.CODE_ID
</select>

<select id="selectScmCdc" parameterType="Map" resultType="egovMap">
SELECT A.CODE AS ID
     , A.CODE_DESC AS ID2
     , A.CODE_NAME AS NAME
  FROM SYS0013M A
 WHERE A.CODE_MASTER_ID = 349
   AND A.DISAB = 0
 ORDER BY A.CODE_ID
</select>

<select id="selectScmIfType" parameterType="Map" resultType="egovMap">
SELECT A.CODE AS ID
     , A.CODE_DESC AS ID2
     , A.CODE_NAME AS NAME
  FROM SYS0013M A
 WHERE A.CODE_MASTER_ID = 352
   AND A.DISAB = 0
 ORDER BY A.CODE_ID
</select>

<select id="selectScmIfTranStatus" parameterType="Map" resultType="egovMap">
SELECT A.CODE AS ID
     , A.CODE_DESC AS ID2
     , A.CODE_NAME AS NAME
  FROM SYS0013M A
 WHERE A.CODE_MASTER_ID = 400
   AND A.DISAB = 0
 ORDER BY A.CODE_ID
</select>

<select id="selectScmIfErrCode" parameterType="Map" resultType="egovMap">
SELECT A.CODE AS ID
     , A.CODE_DESC AS ID2
     , A.CODE_NAME AS NAME
  FROM SYS0013M A
 WHERE A.CODE_MASTER_ID = 401
   AND A.DISAB = 0
 ORDER BY A.CODE_ID
</select>

<select id="selectScmStockCategory" parameterType="Map" resultType="egovMap">
SELECT DISTINCT C.CODE_ID AS ID
     , C.CODE_NAME AS NAME
  FROM SCM0008M A
  LEFT OUTER JOIN SYS0026M B ON (A.STOCK_ID = B.STK_ID)
  LEFT OUTER JOIN SYS0013M C ON (B.STK_CTGRY_ID = C.CODE_ID AND C.CODE_MASTER_ID = 11)
 WHERE A.STUS_CODE_ID = 1
   AND B.STUS_CODE_ID = 1
   AND B.IS_NCV = 0
   AND C.DISAB = 0
 ORDER BY C.CODE_ID
</select>

<select id="selectScmStockType" parameterType="Map" resultType="egovMap">
SELECT DISTINCT C.CODE_ID AS ID
     , C.CODE_NAME AS NAME
  FROM SCM0008M A
  LEFT OUTER JOIN SYS0026M B ON (A.STOCK_ID = B.STK_ID)
  LEFT OUTER JOIN SYS0013M C ON (B.STK_TYPE_ID = C.CODE_ID AND C.CODE_MASTER_ID = 15)
 WHERE A.STUS_CODE_ID = 1
   AND B.STUS_CODE_ID = 1
   AND B.IS_NCV = 0
   AND C.DISAB = 0
 ORDER BY C.CODE_ID
</select>

<select id="selectScmStockCode" parameterType="Map" resultType="egovMap">
SELECT B.STK_CODE AS ID
     , B.STK_CODE || ' - ' || B.STK_DESC AS NAME
  FROM SCM0008M A
  LEFT OUTER JOIN SYS0026M B ON (A.STOCK_ID = B.STK_ID)
 WHERE A.IS_TRGET = 1
   AND A.STUS_CODE_ID = 1
   AND B.IS_NCV = 0
   AND B.STUS_CODE_ID = 1
	<if test="scmStockCategory != null and scmStockCategory != ''">
   AND B.STK_CTGRY_ID IN (SELECT REGEXP_SUBSTR (#{scmStockCategory}, '[^,]+', 1, LEVEL) FROM DUAL CONNECT BY REGEXP_SUBSTR (#{scmStockCategory}, '[^,]+', 1, LEVEL) IS NOT NULL)
	</if>
	<if test="scmStockType != null and scmStockType != ''">
   AND B.STK_TYPE_ID IN (SELECT REGEXP_SUBSTR (#{scmStockType}, '[^,]+', 1, LEVEL) FROM DUAL CONNECT BY REGEXP_SUBSTR (#{scmStockType}, '[^,]+', 1, LEVEL) IS NOT NULL)
	</if>
 ORDER BY B.STK_CODE
</select>

</mapper>