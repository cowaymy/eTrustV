<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.coway.trust.biz.scm.impl.SupplyPlanManagementMapper">

<select id="selectSupplyPlanHeader" parameterType="Map" resultType="egovMap">
SELECT PLAN_ID
     , PLAN_DTL_ID
     , STOCK
     , CDC
     , PLAN_STUS_ID
     , VER_NO
     , TYPE_ID
     , TYPE_NAME
     , CATEGORY_ID
     , CATEGORY_NAME
     , CODE
     , NAME
     , PSI_ID
     , PSI_NAME
     , M0
     , M1
     , M2
     , M3
     , M4
     , OVERDUE
     , (CASE WHEN (FN_GET_SPLIT_DATA2(W1_WEEK_SEQ ,'-',3) = 2 AND FN_GET_SPLIT_DATA2(W1_WEEK_SEQ ,'-',2) = 1) OR (FN_GET_SPLIT_DATA2(W1_WEEK_SEQ ,'-',3) = 1 AND FN_GET_SPLIT_DATA2(W1_WEEK_SEQ ,'-',2) = 2) OR (FN_GET_SPLIT_DATA2(W1_WEEK_SEQ ,'-',3) = 9 AND FN_GET_SPLIT_DATA2(W1_WEEK_SEQ ,'-',2) = 2) THEN SUBSTR(W1_WEEK_SEQ ,1,5) ELSE SUBSTR(W1_WEEK_SEQ ,1,3) END) AS W1_WEEK_SEQ
     , (CASE WHEN (FN_GET_SPLIT_DATA2(W2_WEEK_SEQ ,'-',3) = 2 AND FN_GET_SPLIT_DATA2(W2_WEEK_SEQ ,'-',2) = 1) OR (FN_GET_SPLIT_DATA2(W2_WEEK_SEQ ,'-',3) = 1 AND FN_GET_SPLIT_DATA2(W2_WEEK_SEQ ,'-',2) = 2) OR (FN_GET_SPLIT_DATA2(W2_WEEK_SEQ ,'-',3) = 9 AND FN_GET_SPLIT_DATA2(W2_WEEK_SEQ ,'-',2) = 2) THEN SUBSTR(W2_WEEK_SEQ ,1,5) ELSE SUBSTR(W2_WEEK_SEQ ,1,3) END) AS W2_WEEK_SEQ
     , (CASE WHEN (FN_GET_SPLIT_DATA2(W3_WEEK_SEQ ,'-',3) = 2 AND FN_GET_SPLIT_DATA2(W3_WEEK_SEQ ,'-',2) = 1) OR (FN_GET_SPLIT_DATA2(W3_WEEK_SEQ ,'-',3) = 1 AND FN_GET_SPLIT_DATA2(W3_WEEK_SEQ ,'-',2) = 2) OR (FN_GET_SPLIT_DATA2(W3_WEEK_SEQ ,'-',3) = 9 AND FN_GET_SPLIT_DATA2(W3_WEEK_SEQ ,'-',2) = 2) THEN SUBSTR(W3_WEEK_SEQ ,1,5) ELSE SUBSTR(W3_WEEK_SEQ ,1,3) END) AS W3_WEEK_SEQ
     , (CASE WHEN (FN_GET_SPLIT_DATA2(W4_WEEK_SEQ ,'-',3) = 2 AND FN_GET_SPLIT_DATA2(W4_WEEK_SEQ ,'-',2) = 1) OR (FN_GET_SPLIT_DATA2(W4_WEEK_SEQ ,'-',3) = 1 AND FN_GET_SPLIT_DATA2(W4_WEEK_SEQ ,'-',2) = 2) OR (FN_GET_SPLIT_DATA2(W4_WEEK_SEQ ,'-',3) = 9 AND FN_GET_SPLIT_DATA2(W4_WEEK_SEQ ,'-',2) = 2) THEN SUBSTR(W4_WEEK_SEQ ,1,5) ELSE SUBSTR(W4_WEEK_SEQ ,1,3) END) AS W4_WEEK_SEQ
     , (CASE WHEN (FN_GET_SPLIT_DATA2(W5_WEEK_SEQ ,'-',3) = 2 AND FN_GET_SPLIT_DATA2(W5_WEEK_SEQ ,'-',2) = 1) OR (FN_GET_SPLIT_DATA2(W5_WEEK_SEQ ,'-',3) = 1 AND FN_GET_SPLIT_DATA2(W5_WEEK_SEQ ,'-',2) = 2) OR (FN_GET_SPLIT_DATA2(W5_WEEK_SEQ ,'-',3) = 9 AND FN_GET_SPLIT_DATA2(W5_WEEK_SEQ ,'-',2) = 2) THEN SUBSTR(W5_WEEK_SEQ ,1,5) ELSE SUBSTR(W5_WEEK_SEQ ,1,3) END) AS W5_WEEK_SEQ
     , (CASE WHEN (FN_GET_SPLIT_DATA2(W6_WEEK_SEQ ,'-',3) = 2 AND FN_GET_SPLIT_DATA2(W6_WEEK_SEQ ,'-',2) = 1) OR (FN_GET_SPLIT_DATA2(W6_WEEK_SEQ ,'-',3) = 1 AND FN_GET_SPLIT_DATA2(W6_WEEK_SEQ ,'-',2) = 2) OR (FN_GET_SPLIT_DATA2(W6_WEEK_SEQ ,'-',3) = 9 AND FN_GET_SPLIT_DATA2(W6_WEEK_SEQ ,'-',2) = 2) THEN SUBSTR(W6_WEEK_SEQ ,1,5) ELSE SUBSTR(W6_WEEK_SEQ ,1,3) END) AS W6_WEEK_SEQ
     , (CASE WHEN (FN_GET_SPLIT_DATA2(W7_WEEK_SEQ ,'-',3) = 2 AND FN_GET_SPLIT_DATA2(W7_WEEK_SEQ ,'-',2) = 1) OR (FN_GET_SPLIT_DATA2(W7_WEEK_SEQ ,'-',3) = 1 AND FN_GET_SPLIT_DATA2(W7_WEEK_SEQ ,'-',2) = 2) OR (FN_GET_SPLIT_DATA2(W7_WEEK_SEQ ,'-',3) = 9 AND FN_GET_SPLIT_DATA2(W7_WEEK_SEQ ,'-',2) = 2) THEN SUBSTR(W7_WEEK_SEQ ,1,5) ELSE SUBSTR(W7_WEEK_SEQ ,1,3) END) AS W7_WEEK_SEQ
     , (CASE WHEN (FN_GET_SPLIT_DATA2(W8_WEEK_SEQ ,'-',3) = 2 AND FN_GET_SPLIT_DATA2(W8_WEEK_SEQ ,'-',2) = 1) OR (FN_GET_SPLIT_DATA2(W8_WEEK_SEQ ,'-',3) = 1 AND FN_GET_SPLIT_DATA2(W8_WEEK_SEQ ,'-',2) = 2) OR (FN_GET_SPLIT_DATA2(W8_WEEK_SEQ ,'-',3) = 9 AND FN_GET_SPLIT_DATA2(W8_WEEK_SEQ ,'-',2) = 2) THEN SUBSTR(W8_WEEK_SEQ ,1,5) ELSE SUBSTR(W8_WEEK_SEQ ,1,3) END) AS W8_WEEK_SEQ
     , (CASE WHEN (FN_GET_SPLIT_DATA2(W9_WEEK_SEQ ,'-',3) = 2 AND FN_GET_SPLIT_DATA2(W9_WEEK_SEQ ,'-',2) = 1) OR (FN_GET_SPLIT_DATA2(W9_WEEK_SEQ ,'-',3) = 1 AND FN_GET_SPLIT_DATA2(W9_WEEK_SEQ ,'-',2) = 2) OR (FN_GET_SPLIT_DATA2(W9_WEEK_SEQ ,'-',3) = 9 AND FN_GET_SPLIT_DATA2(W9_WEEK_SEQ ,'-',2) = 2) THEN SUBSTR(W9_WEEK_SEQ ,1,5) ELSE SUBSTR(W9_WEEK_SEQ ,1,3) END) AS W9_WEEK_SEQ
     , (CASE WHEN (FN_GET_SPLIT_DATA2(W10_WEEK_SEQ,'-',3) = 2 AND FN_GET_SPLIT_DATA2(W10_WEEK_SEQ,'-',2) = 1) OR (FN_GET_SPLIT_DATA2(W10_WEEK_SEQ,'-',3) = 1 AND FN_GET_SPLIT_DATA2(W10_WEEK_SEQ,'-',2) = 2) OR (FN_GET_SPLIT_DATA2(W10_WEEK_SEQ,'-',3) = 9 AND FN_GET_SPLIT_DATA2(W10_WEEK_SEQ,'-',2) = 2) THEN SUBSTR(W10_WEEK_SEQ,1,5) ELSE SUBSTR(W10_WEEK_SEQ,1,3) END) AS W10_WEEK_SEQ
     , (CASE WHEN (FN_GET_SPLIT_DATA2(W11_WEEK_SEQ,'-',3) = 2 AND FN_GET_SPLIT_DATA2(W11_WEEK_SEQ,'-',2) = 1) OR (FN_GET_SPLIT_DATA2(W11_WEEK_SEQ,'-',3) = 1 AND FN_GET_SPLIT_DATA2(W11_WEEK_SEQ,'-',2) = 2) OR (FN_GET_SPLIT_DATA2(W11_WEEK_SEQ,'-',3) = 9 AND FN_GET_SPLIT_DATA2(W11_WEEK_SEQ,'-',2) = 2) THEN SUBSTR(W11_WEEK_SEQ,1,5) ELSE SUBSTR(W11_WEEK_SEQ,1,3) END) AS W11_WEEK_SEQ
     , (CASE WHEN (FN_GET_SPLIT_DATA2(W12_WEEK_SEQ,'-',3) = 2 AND FN_GET_SPLIT_DATA2(W12_WEEK_SEQ,'-',2) = 1) OR (FN_GET_SPLIT_DATA2(W12_WEEK_SEQ,'-',3) = 1 AND FN_GET_SPLIT_DATA2(W12_WEEK_SEQ,'-',2) = 2) OR (FN_GET_SPLIT_DATA2(W12_WEEK_SEQ,'-',3) = 9 AND FN_GET_SPLIT_DATA2(W12_WEEK_SEQ,'-',2) = 2) THEN SUBSTR(W12_WEEK_SEQ,1,5) ELSE SUBSTR(W12_WEEK_SEQ,1,3) END) AS W12_WEEK_SEQ
     , (CASE WHEN (FN_GET_SPLIT_DATA2(W13_WEEK_SEQ,'-',3) = 2 AND FN_GET_SPLIT_DATA2(W13_WEEK_SEQ,'-',2) = 1) OR (FN_GET_SPLIT_DATA2(W13_WEEK_SEQ,'-',3) = 1 AND FN_GET_SPLIT_DATA2(W13_WEEK_SEQ,'-',2) = 2) OR (FN_GET_SPLIT_DATA2(W13_WEEK_SEQ,'-',3) = 9 AND FN_GET_SPLIT_DATA2(W13_WEEK_SEQ,'-',2) = 2) THEN SUBSTR(W13_WEEK_SEQ,1,5) ELSE SUBSTR(W13_WEEK_SEQ,1,3) END) AS W13_WEEK_SEQ
     , (CASE WHEN (FN_GET_SPLIT_DATA2(W14_WEEK_SEQ,'-',3) = 2 AND FN_GET_SPLIT_DATA2(W14_WEEK_SEQ,'-',2) = 1) OR (FN_GET_SPLIT_DATA2(W14_WEEK_SEQ,'-',3) = 1 AND FN_GET_SPLIT_DATA2(W14_WEEK_SEQ,'-',2) = 2) OR (FN_GET_SPLIT_DATA2(W14_WEEK_SEQ,'-',3) = 9 AND FN_GET_SPLIT_DATA2(W14_WEEK_SEQ,'-',2) = 2) THEN SUBSTR(W14_WEEK_SEQ,1,5) ELSE SUBSTR(W14_WEEK_SEQ,1,3) END) AS W14_WEEK_SEQ
     , (CASE WHEN (FN_GET_SPLIT_DATA2(W15_WEEK_SEQ,'-',3) = 2 AND FN_GET_SPLIT_DATA2(W15_WEEK_SEQ,'-',2) = 1) OR (FN_GET_SPLIT_DATA2(W15_WEEK_SEQ,'-',3) = 1 AND FN_GET_SPLIT_DATA2(W15_WEEK_SEQ,'-',2) = 2) OR (FN_GET_SPLIT_DATA2(W15_WEEK_SEQ,'-',3) = 9 AND FN_GET_SPLIT_DATA2(W15_WEEK_SEQ,'-',2) = 2) THEN SUBSTR(W15_WEEK_SEQ,1,5) ELSE SUBSTR(W15_WEEK_SEQ,1,3) END) AS W15_WEEK_SEQ
     , (CASE WHEN (FN_GET_SPLIT_DATA2(W16_WEEK_SEQ,'-',3) = 2 AND FN_GET_SPLIT_DATA2(W16_WEEK_SEQ,'-',2) = 1) OR (FN_GET_SPLIT_DATA2(W16_WEEK_SEQ,'-',3) = 1 AND FN_GET_SPLIT_DATA2(W16_WEEK_SEQ,'-',2) = 2) OR (FN_GET_SPLIT_DATA2(W16_WEEK_SEQ,'-',3) = 9 AND FN_GET_SPLIT_DATA2(W16_WEEK_SEQ,'-',2) = 2) THEN SUBSTR(W16_WEEK_SEQ,1,5) ELSE SUBSTR(W16_WEEK_SEQ,1,3) END) AS W16_WEEK_SEQ
     , (CASE WHEN (FN_GET_SPLIT_DATA2(W17_WEEK_SEQ,'-',3) = 2 AND FN_GET_SPLIT_DATA2(W17_WEEK_SEQ,'-',2) = 1) OR (FN_GET_SPLIT_DATA2(W17_WEEK_SEQ,'-',3) = 1 AND FN_GET_SPLIT_DATA2(W17_WEEK_SEQ,'-',2) = 2) OR (FN_GET_SPLIT_DATA2(W17_WEEK_SEQ,'-',3) = 9 AND FN_GET_SPLIT_DATA2(W17_WEEK_SEQ,'-',2) = 2) THEN SUBSTR(W17_WEEK_SEQ,1,5) ELSE SUBSTR(W17_WEEK_SEQ,1,3) END) AS W17_WEEK_SEQ
     , (CASE WHEN (FN_GET_SPLIT_DATA2(W18_WEEK_SEQ,'-',3) = 2 AND FN_GET_SPLIT_DATA2(W18_WEEK_SEQ,'-',2) = 1) OR (FN_GET_SPLIT_DATA2(W18_WEEK_SEQ,'-',3) = 1 AND FN_GET_SPLIT_DATA2(W18_WEEK_SEQ,'-',2) = 2) OR (FN_GET_SPLIT_DATA2(W18_WEEK_SEQ,'-',3) = 9 AND FN_GET_SPLIT_DATA2(W18_WEEK_SEQ,'-',2) = 2) THEN SUBSTR(W18_WEEK_SEQ,1,5) ELSE SUBSTR(W18_WEEK_SEQ,1,3) END) AS W18_WEEK_SEQ
     , (CASE WHEN (FN_GET_SPLIT_DATA2(W19_WEEK_SEQ,'-',3) = 2 AND FN_GET_SPLIT_DATA2(W19_WEEK_SEQ,'-',2) = 1) OR (FN_GET_SPLIT_DATA2(W19_WEEK_SEQ,'-',3) = 1 AND FN_GET_SPLIT_DATA2(W19_WEEK_SEQ,'-',2) = 2) OR (FN_GET_SPLIT_DATA2(W19_WEEK_SEQ,'-',3) = 9 AND FN_GET_SPLIT_DATA2(W19_WEEK_SEQ,'-',2) = 2) THEN SUBSTR(W19_WEEK_SEQ,1,5) ELSE SUBSTR(W19_WEEK_SEQ,1,3) END) AS W19_WEEK_SEQ
     , (CASE WHEN (FN_GET_SPLIT_DATA2(W20_WEEK_SEQ,'-',3) = 2 AND FN_GET_SPLIT_DATA2(W20_WEEK_SEQ,'-',2) = 1) OR (FN_GET_SPLIT_DATA2(W20_WEEK_SEQ,'-',3) = 1 AND FN_GET_SPLIT_DATA2(W20_WEEK_SEQ,'-',2) = 2) OR (FN_GET_SPLIT_DATA2(W20_WEEK_SEQ,'-',3) = 9 AND FN_GET_SPLIT_DATA2(W20_WEEK_SEQ,'-',2) = 2) THEN SUBSTR(W20_WEEK_SEQ,1,5) ELSE SUBSTR(W20_WEEK_SEQ,1,3) END) AS W20_WEEK_SEQ
     , (CASE WHEN (FN_GET_SPLIT_DATA2(W21_WEEK_SEQ,'-',3) = 2 AND FN_GET_SPLIT_DATA2(W21_WEEK_SEQ,'-',2) = 1) OR (FN_GET_SPLIT_DATA2(W21_WEEK_SEQ,'-',3) = 1 AND FN_GET_SPLIT_DATA2(W21_WEEK_SEQ,'-',2) = 2) OR (FN_GET_SPLIT_DATA2(W21_WEEK_SEQ,'-',3) = 9 AND FN_GET_SPLIT_DATA2(W21_WEEK_SEQ,'-',2) = 2) THEN SUBSTR(W21_WEEK_SEQ,1,5) ELSE SUBSTR(W21_WEEK_SEQ,1,3) END) AS W21_WEEK_SEQ
     , (CASE WHEN (FN_GET_SPLIT_DATA2(W22_WEEK_SEQ,'-',3) = 2 AND FN_GET_SPLIT_DATA2(W22_WEEK_SEQ,'-',2) = 1) OR (FN_GET_SPLIT_DATA2(W22_WEEK_SEQ,'-',3) = 1 AND FN_GET_SPLIT_DATA2(W22_WEEK_SEQ,'-',2) = 2) OR (FN_GET_SPLIT_DATA2(W22_WEEK_SEQ,'-',3) = 9 AND FN_GET_SPLIT_DATA2(W22_WEEK_SEQ,'-',2) = 2) THEN SUBSTR(W22_WEEK_SEQ,1,5) ELSE SUBSTR(W22_WEEK_SEQ,1,3) END) AS W22_WEEK_SEQ
     , (CASE WHEN (FN_GET_SPLIT_DATA2(W23_WEEK_SEQ,'-',3) = 2 AND FN_GET_SPLIT_DATA2(W23_WEEK_SEQ,'-',2) = 1) OR (FN_GET_SPLIT_DATA2(W23_WEEK_SEQ,'-',3) = 1 AND FN_GET_SPLIT_DATA2(W23_WEEK_SEQ,'-',2) = 2) OR (FN_GET_SPLIT_DATA2(W23_WEEK_SEQ,'-',3) = 9 AND FN_GET_SPLIT_DATA2(W23_WEEK_SEQ,'-',2) = 2) THEN SUBSTR(W23_WEEK_SEQ,1,5) ELSE SUBSTR(W23_WEEK_SEQ,1,3) END) AS W23_WEEK_SEQ
     , (CASE WHEN (FN_GET_SPLIT_DATA2(W24_WEEK_SEQ,'-',3) = 2 AND FN_GET_SPLIT_DATA2(W24_WEEK_SEQ,'-',2) = 1) OR (FN_GET_SPLIT_DATA2(W24_WEEK_SEQ,'-',3) = 1 AND FN_GET_SPLIT_DATA2(W24_WEEK_SEQ,'-',2) = 2) OR (FN_GET_SPLIT_DATA2(W24_WEEK_SEQ,'-',3) = 9 AND FN_GET_SPLIT_DATA2(W24_WEEK_SEQ,'-',2) = 2) THEN SUBSTR(W24_WEEK_SEQ,1,5) ELSE SUBSTR(W24_WEEK_SEQ,1,3) END) AS W24_WEEK_SEQ
     , (CASE WHEN (FN_GET_SPLIT_DATA2(W25_WEEK_SEQ,'-',3) = 2 AND FN_GET_SPLIT_DATA2(W25_WEEK_SEQ,'-',2) = 1) OR (FN_GET_SPLIT_DATA2(W25_WEEK_SEQ,'-',3) = 1 AND FN_GET_SPLIT_DATA2(W25_WEEK_SEQ,'-',2) = 2) OR (FN_GET_SPLIT_DATA2(W25_WEEK_SEQ,'-',3) = 9 AND FN_GET_SPLIT_DATA2(W25_WEEK_SEQ,'-',2) = 2) THEN SUBSTR(W25_WEEK_SEQ,1,5) ELSE SUBSTR(W25_WEEK_SEQ,1,3) END) AS W25_WEEK_SEQ
     , (CASE WHEN (FN_GET_SPLIT_DATA2(W26_WEEK_SEQ,'-',3) = 2 AND FN_GET_SPLIT_DATA2(W26_WEEK_SEQ,'-',2) = 1) OR (FN_GET_SPLIT_DATA2(W26_WEEK_SEQ,'-',3) = 1 AND FN_GET_SPLIT_DATA2(W26_WEEK_SEQ,'-',2) = 2) OR (FN_GET_SPLIT_DATA2(W26_WEEK_SEQ,'-',3) = 9 AND FN_GET_SPLIT_DATA2(W26_WEEK_SEQ,'-',2) = 2) THEN SUBSTR(W26_WEEK_SEQ,1,5) ELSE SUBSTR(W26_WEEK_SEQ,1,3) END) AS W26_WEEK_SEQ
     , (CASE WHEN (FN_GET_SPLIT_DATA2(W27_WEEK_SEQ,'-',3) = 2 AND FN_GET_SPLIT_DATA2(W27_WEEK_SEQ,'-',2) = 1) OR (FN_GET_SPLIT_DATA2(W27_WEEK_SEQ,'-',3) = 1 AND FN_GET_SPLIT_DATA2(W27_WEEK_SEQ,'-',2) = 2) OR (FN_GET_SPLIT_DATA2(W27_WEEK_SEQ,'-',3) = 9 AND FN_GET_SPLIT_DATA2(W27_WEEK_SEQ,'-',2) = 2) THEN SUBSTR(W27_WEEK_SEQ,1,5) ELSE SUBSTR(W27_WEEK_SEQ,1,3) END) AS W27_WEEK_SEQ
     , (CASE WHEN (FN_GET_SPLIT_DATA2(W28_WEEK_SEQ,'-',3) = 2 AND FN_GET_SPLIT_DATA2(W28_WEEK_SEQ,'-',2) = 1) OR (FN_GET_SPLIT_DATA2(W28_WEEK_SEQ,'-',3) = 1 AND FN_GET_SPLIT_DATA2(W28_WEEK_SEQ,'-',2) = 2) OR (FN_GET_SPLIT_DATA2(W28_WEEK_SEQ,'-',3) = 9 AND FN_GET_SPLIT_DATA2(W28_WEEK_SEQ,'-',2) = 2) THEN SUBSTR(W28_WEEK_SEQ,1,5) ELSE SUBSTR(W28_WEEK_SEQ,1,3) END) AS W28_WEEK_SEQ
     , (CASE WHEN (FN_GET_SPLIT_DATA2(W29_WEEK_SEQ,'-',3) = 2 AND FN_GET_SPLIT_DATA2(W29_WEEK_SEQ,'-',2) = 1) OR (FN_GET_SPLIT_DATA2(W29_WEEK_SEQ,'-',3) = 1 AND FN_GET_SPLIT_DATA2(W29_WEEK_SEQ,'-',2) = 2) OR (FN_GET_SPLIT_DATA2(W29_WEEK_SEQ,'-',3) = 9 AND FN_GET_SPLIT_DATA2(W29_WEEK_SEQ,'-',2) = 2) THEN SUBSTR(W29_WEEK_SEQ,1,5) ELSE SUBSTR(W29_WEEK_SEQ,1,3) END) AS W29_WEEK_SEQ
     , (CASE WHEN (FN_GET_SPLIT_DATA2(W30_WEEK_SEQ,'-',3) = 2 AND FN_GET_SPLIT_DATA2(W30_WEEK_SEQ,'-',2) = 1) OR (FN_GET_SPLIT_DATA2(W30_WEEK_SEQ,'-',3) = 1 AND FN_GET_SPLIT_DATA2(W30_WEEK_SEQ,'-',2) = 2) OR (FN_GET_SPLIT_DATA2(W30_WEEK_SEQ,'-',3) = 9 AND FN_GET_SPLIT_DATA2(W30_WEEK_SEQ,'-',2) = 2) THEN SUBSTR(W30_WEEK_SEQ,1,5) ELSE SUBSTR(W30_WEEK_SEQ,1,3) END) AS W30_WEEK_SEQ
  FROM (
        SELECT *
          FROM (
                SELECT DECODE(RNO, 1,  '1',  2,  '2',  3,  '3',  4,  '4',  5,  '5',  6,  '6',  7,  '7',  8,  '8',  9,  '9',  10, '10'
                                 , 11, '11', 12, '12', 13, '13', 14, '14', 15, '15', 16, '16', 17, '17', 18, '18', 19, '19', 20, '20'
                                 , 21, '21', 22, '22', 23, '23', 24, '24', 25, '25', 26, '26', 27, '27', 28, '28', 29, '29', 30, '30') AS RNO
                     , WEEK_SEQ
                     , PLAN_ID
                     , PLAN_DTL_ID
                     , STOCK
                     , CDC
                     , PLAN_STUS_ID
                     , VER_NO
                     , TYPE_ID
                     , TYPE_NAME
                     , CATEGORY_ID
                     , CATEGORY_NAME
                     , CODE
                     , NAME
                     , PSI_ID
                     , PSI_NAME
                     , M0
                     , M1
                     , M2
                     , M3
                     , M4
                     , OVERDUE
                  FROM (
                        SELECT ROWNUM AS RNO
                             , DECODE(LEAD(Z.WEEK_TH_SN) OVER (ORDER BY 'W' || LPAD(Z.WEEK_TH, 2, 0) || '-' || Z.WEEK_TH_SN)
                                    , NULL
                                    , 'W' || LPAD(Z.WEEK_TH, 2, 0) || '-' || Z.WEEK_TH_SN || '-' || '9'
                                    , 'W' || LPAD(Z.WEEK_TH, 2, 0) || '-' || Z.WEEK_TH_SN || '-' || LEAD(Z.WEEK_TH_SN) OVER (ORDER BY 'W'|| LPAD(Z.WEEK_TH, 2, 0) || '-' || Z.WEEK_TH_SN)) AS WEEK_SEQ
                             , 'planId' AS PLAN_ID
                             , 'planDtlId' AS PLAN_DTL_ID
                             , 'stock' AS STOCK
                             , 'cdc' AS CDC
                             , 'planStusId' AS PLAN_STUS_ID
                             , 'verNo' AS VER_NO
                             , 'typeId' AS TYPE_ID
                             , 'typeName' AS TYPE_NAME
                             , 'categoryId' AS CATEGORY_ID
                             , 'categoryName' AS CATEGORY_NAME
                             , 'code' AS CODE
                             , 'name' AS NAME
                             , 'psiId' AS PSI_ID
                             , 'psiName' AS PSI_NAME
                             , 'm0' AS M0
                             , 'm1' AS M1
                             , 'm2' AS M2
                             , 'm3' AS M3
                             , 'm4' AS M4
                             , 'overdue' AS OVERDUE
                          FROM SCM0018M Z
                         WHERE TO_CHAR(Z.WEEK_TH_SN_START, 'YYYYMM') BETWEEN #{salesPlanFrom} AND #{salesPlanTo}
                        )
                )
         PIVOT (
                MAX(WEEK_SEQ) WEEK_SEQ
                FOR RNO IN (1  AS W1,  2  AS W2,  3  AS W3,  4  AS W4,  5  AS W5,  6  AS W6,  7  AS W7,  8  AS W8,  9  AS W9,  10 AS W10
                          , 11 AS W11, 12 AS W12, 13 AS W13, 14 AS W14, 15 AS W15, 16 AS W16, 17 AS W17, 18 AS W18, 19 AS W19, 20 AS W20
                          , 21 AS W21, 22 AS W22, 23 AS W23, 24 AS W24, 25 AS W25, 26 AS W26, 27 AS W27, 28 AS W28, 29 AS W29, 30 AS W30)
                )
        )
</select>

<select id="selectSupplyPlanInfo" parameterType="Map" resultType="egovMap">
SELECT A.PLAN_ID
     , A.PLAN_YEAR
     , A.PLAN_MONTH
     , A.PLAN_WEEK
     , A.CDC
     , A.PLAN_STUS AS PLAN_STUS_ID
     , DECODE(A.PLAN_STUS, 1, 'Active', 'Confirmed') AS PLAN_STUS_NM
     , TO_CHAR(A.PLAN_CRT_DT, 'YYYY/MM/DD HH24:MI:SS') AS PLAN_CRT_DT
     , TO_CHAR(A.LAST_UP_DT, 'YYYY/MM/DD HH24:MI:SS') AS LAST_UP_DT
     , TO_CHAR(A.VER_DT, 'YYYY/MM/DD HH24:MI:SS') AS VER_DT
     , A.VER_NO
     , (SELECT NVL(MAX(Z.PLAN_STUS_ID), 0) FROM SCM0001M Z WHERE Z.PLAN_YEAR = #{scmYearCbBox} AND Z.PLAN_WEEK = #{scmWeekCbBox} AND Z.TEAM = 'DST')
     + (SELECT NVL(MAX(Z.PLAN_STUS_ID), 0) FROM SCM0001M Z WHERE Z.PLAN_YEAR = #{scmYearCbBox} AND Z.PLAN_WEEK = #{scmWeekCbBox} AND Z.TEAM = 'CODY')
     + (SELECT NVL(MAX(Z.PLAN_STUS_ID), 0) FROM SCM0001M Z WHERE Z.PLAN_YEAR = #{scmYearCbBox} AND Z.PLAN_WEEK = #{scmWeekCbBox} AND Z.TEAM = 'CS') AS CONF
  FROM SCM0005M A
 WHERE A.PLAN_YEAR = #{scmYearCbBox}
   AND A.PLAN_WEEK = #{scmWeekCbBox}
	<if test="scmCdcCbBox != null and scmCdcCbBox !=''">
   AND A.CDC = #{scmCdcCbBox}
	</if>
</select>

<select id="selectSupplyPlanList" parameterType="Map" resultType="egovMap">
SELECT A.PLAN_ID
     , A.PLAN_YEAR
     , A.PLAN_MONTH
     , A.PLAN_WEEK
     , A.CDC
     , A.PLAN_STUS
     , A.VER_NO
     , B.PLAN_DTL_ID
     , B.PSI_ID
     , B.PSI_NAME
     , D.STK_TYPE_ID AS TYPE_ID
     , E.CODE_NAME AS TYPE_NAME
     , D.STK_CTGRY_ID AS CATEGORY_ID
     , F.CODE_NAME AS CATEGORY_NAME
     , B.STOCK_CODE AS CODE
     , D.STK_DESC AS NAME
     , 0 AS M0
     , 0 AS M1
     , 0 AS M2
     , 0 AS M3
     , 0 AS M4
     , 0 AS OVERDUE
     , NVL(B.W01, 0) AS W01
     , NVL(B.W02, 0) AS W02
     , NVL(B.W03, 0) AS W03
     , NVL(B.W04, 0) AS W04
     , NVL(B.W05, 0) AS W05
     , NVL(B.W06, 0) AS W06
     , NVL(B.W07, 0) AS W07
     , NVL(B.W08, 0) AS W08
     , NVL(B.W09, 0) AS W09
     , NVL(B.W10, 0) AS W10
     , NVL(B.W11, 0) AS W11
     , NVL(B.W12, 0) AS W12
     , NVL(B.W13, 0) AS W13
     , NVL(B.W14, 0) AS W14
     , NVL(B.W15, 0) AS W15
     , NVL(B.W16, 0) AS W16
     , NVL(B.W17, 0) AS W17
     , NVL(B.W18, 0) AS W18
     , NVL(B.W19, 0) AS W19
     , NVL(B.W20, 0) AS W20
     , NVL(B.W21, 0) AS W21
     , NVL(B.W22, 0) AS W22
     , NVL(B.W23, 0) AS W23
     , NVL(B.W24, 0) AS W24
     , NVL(B.W25, 0) AS W25
     , NVL(B.W26, 0) AS W26
     , NVL(B.W27, 0) AS W27
     , NVL(B.W28, 0) AS W28
     , NVL(B.W29, 0) AS W29
     , NVL(B.W30, 0) AS W30
  FROM SCM0005M A
  LEFT OUTER JOIN SCM0006D B ON (A.PLAN_ID = B.PLAN_MASTER_ID)
  LEFT OUTER JOIN SCM0008M C ON (B.STOCK_CODE = C.STOCK_CODE)
  LEFT OUTER JOIN SYS0026M D ON (C.STOCK_ID = D.STK_ID)
  LEFT OUTER JOIN SYS0013M E ON (D.STK_CTGRY_ID = E.CODE_ID AND E.CODE_MASTER_ID = 11) /* 11 : Stock Category */
  LEFT OUTER JOIN SYS0013M F ON (D.STK_TYPE_ID = F.CODE_ID AND F.CODE_MASTER_ID = 15) /* 15 : Spare Part Type */
 WHERE A.PLAN_YEAR = #{scmYearCbBox}
   AND A.PLAN_WEEK = #{scmWeekCbBox}
	<if test="scmStockTypeCbBox != null and ! scmStockTypeCbBox.isEmpty">
   AND D.STK_TYPE_ID IN
		<foreach item="item" collection="scmStockTypeCbBox" index="index" open="(" separator="," close=")">
		#{item}
		</foreach>
	</if>
   AND ((B.STOCK_CODE LIKE '%' || #{scmStockCode} || '%') OR (D.STK_DESC LIKE '%' || #{scmStockCode} || '%'))
 ORDER BY A.PLAN_ID DESC, B.STOCK_CODE, B.PSI_ID
</select>

<insert id="insertSupplyPlanMaster" parameterType="Map">
INSERT INTO SCM0005M
(
       PLAN_ID
     , PLAN_YEAR
     , PLAN_MONTH
     , PLAN_WEEK
     , CDC
     , PLAN_STUS
     , PLAN_CRT_DT
     , VER_NO
     , VER_DT
 )
VALUES
(
       SCM0005M_PLAN_ID_SEQ.NEXTVAL
     , #{scmYearCbBox}
     , #{planMonth}
     , #{scmWeekCbBox}
     , #{scmCdcCbBox}
     , 1
     , SYSDATE
     , 0
     , SYSDATE
 )
</insert>

<resultMap id="insertSupplyPlanDetailResultMap" type="egovMap"></resultMap>
<select id="callSpScmInsSupplyPlanDetail" statementType="CALLABLE" parameterType="Map">
{ call GBSLCVD.SP_SCM_INS_SUPPLY_PLAN_DETAIL(#{scmYearCbBox}, #{scmWeekCbBox}, #{scmCdcCbBox}, #{result, mode=OUT, jdbcType=VARCHAR, javaType=STRING, resultMap=insertSupplyPlanDetailResultMap}) }
</select>

<insert id="insertSupplyPlanDetail" parameterType="Map">
INSERT INTO SCM0006D
(
       PLAN_DTL_ID
     , PLAN_MASTER_ID
     , PSI_ID
     , STOCK_CODE
     , CMPLT
     , M0_ORD
     , M0_PLAN
     , M1
     , M2
     , M3
     , M4
     , OVERDUE
     , W01, W02, W03, W04, W05, W06, W07, W08, W09, W10
     , W11, W12, W13, W14, W15, W16, W17, W18, W19, W20
     , W21, W22, W23, W24, W25, W26, W27, W28, W29, W30
 )
VALUES
(
       SCM0006D_PLAN_DETAIL_SEQ.NEXTVAL
     , (SELECT PLAN_ID FROM SCM0005M WHERE PLAN_YEAR = #{scmYearCbBox} AND PLAN_WEEK = #{scmWeekCbBox} AND CDC = #{scmCdcCbBox})
     , #{psiId}
     , #{stockCode}
     , 1
     , #{m0Ord}
     , #{m0Plan}
     , NVL(#{m1}, 0)
     , NVL(#{m2}, 0)
     , NVL(#{m3}, 0)
     , NVL(#{m4}, 0)
     , #{overdue}
     , NVL(#{w01}, 0), NVL(#{w02}, 0), NVL(#{w03}, 0), NVL(#{w04}, 0), NVL(#{w05}, 0), NVL(#{w06}, 0), NVL(#{w07}, 0), NVL(#{w08}, 0), NVL(#{w09}, 0), NVL(#{w10}, 0)
     , NVL(#{w11}, 0), NVL(#{w12}, 0), NVL(#{w13}, 0), NVL(#{w14}, 0), NVL(#{w15}, 0), NVL(#{w16}, 0), NVL(#{w17}, 0), NVL(#{w18}, 0), NVL(#{w19}, 0), NVL(#{w20}, 0)
     , NVL(#{w21}, 0), NVL(#{w22}, 0), NVL(#{w23}, 0), NVL(#{w24}, 0), NVL(#{w25}, 0), NVL(#{w26}, 0), NVL(#{w27}, 0), NVL(#{w28}, 0), NVL(#{w29}, 0), NVL(#{w30}, 0)
 )
</insert>
<!-- 
<resultMap id="insertSalesPlanDetailResultMap" type="egovMap"></resultMap>
<select id="callSpScmInsSalesPlanDetail" statementType="CALLABLE" parameterType="Map">
{ call GBSLCVD.SP_SCM_INS_SALES_PLAN_DETAIL(#{scmYearCbBox}, #{scmWeekCbBox}, #{scmTeamCbBox}, #{result, mode=OUT, jdbcType=VARCHAR, javaType=STRING, resultMap=insertSalesPlanDetailResultMap}) }
</select>
 -->
<update id="updateSupplyPlanDetail" parameterType="Map">
UPDATE SCM0002D
   SET PRE_M3_AVG_ISSU = TO_NUMBER(REPLACE(#{m3IssueAvg}, ','))
     , M1_ORD = TO_NUMBER(REPLACE(#{m1Issue}, ','))
     , M0_ORD = TO_NUMBER(REPLACE(#{m0Order}, ','))
     , M0_PLAN = TO_NUMBER(REPLACE(#{m0Plan}, ','))
     , M1 = TO_NUMBER(REPLACE(#{m1}, ','))
     , M2 = TO_NUMBER(REPLACE(#{m2}, ','))
     , M3 = TO_NUMBER(REPLACE(#{m2}, ','))
     , M4 = TO_NUMBER(REPLACE(#{m2}, ','))
     , W01 = TO_NUMBER(REPLACE(#{w01}, ','))
     , W02 = TO_NUMBER(REPLACE(#{w02}, ','))
     , W03 = TO_NUMBER(REPLACE(#{w03}, ','))
     , W04 = TO_NUMBER(REPLACE(#{w04}, ','))
     , W05 = TO_NUMBER(REPLACE(#{w05}, ','))
     , W06 = TO_NUMBER(REPLACE(#{w06}, ','))
     , W07 = TO_NUMBER(REPLACE(#{w07}, ','))
     , W08 = TO_NUMBER(REPLACE(#{w08}, ','))
     , W09 = TO_NUMBER(REPLACE(#{w09}, ','))
     , W10 = TO_NUMBER(REPLACE(#{w10}, ','))
     , W11 = TO_NUMBER(REPLACE(#{w11}, ','))
     , W12 = TO_NUMBER(REPLACE(#{w12}, ','))
     , W13 = TO_NUMBER(REPLACE(#{w13}, ','))
     , W14 = TO_NUMBER(REPLACE(#{w14}, ','))
     , W15 = TO_NUMBER(REPLACE(#{w15}, ','))
     , W16 = TO_NUMBER(REPLACE(#{w16}, ','))
     , W17 = TO_NUMBER(REPLACE(#{w17}, ','))
     , W18 = TO_NUMBER(REPLACE(#{w18}, ','))
     , W19 = TO_NUMBER(REPLACE(#{w19}, ','))
     , W20 = TO_NUMBER(REPLACE(#{w20}, ','))
     , W21 = TO_NUMBER(REPLACE(#{w21}, ','))
     , W22 = TO_NUMBER(REPLACE(#{w22}, ','))
     , W23 = TO_NUMBER(REPLACE(#{w23}, ','))
     , W24 = TO_NUMBER(REPLACE(#{w24}, ','))
     , W25 = TO_NUMBER(REPLACE(#{w25}, ','))
     , W26 = TO_NUMBER(REPLACE(#{w26}, ','))
     , W27 = TO_NUMBER(REPLACE(#{w27}, ','))
     , W28 = TO_NUMBER(REPLACE(#{w28}, ','))
     , W29 = TO_NUMBER(REPLACE(#{w29}, ','))
     , W30 = TO_NUMBER(REPLACE(#{w30}, ','))
 WHERE PLAN_DTL_ID = #{planDtlId}
</update>

<update id="updateSupplyPlanMaster" parameterType="Map">
UPDATE SCM0001M
   SET PLAN_STUS_ID = #{planStusId}
 WHERE PLAN_ID = #{planId}
</update>

<select id="selectCdcRate" parameterType="Map" resultType="egovMap">
SELECT A.STOCK_CODE
     , B.CDC
     , ROUND((B.CDC_SUM / A.STOCK_SUM) * 100) AS CDC_RATE
  FROM (
        SELECT Z.STOCK_CODE
             , SUM(Z.ISS_QTY) AS STOCK_SUM
          FROM SCM0051S Z
         WHERE Z.ISS_DT BETWEEN #{issDtFrom} AND #{issDtTo}
         GROUP BY Z.STOCK_CODE
        ) A
  LEFT OUTER JOIN (
                   SELECT Z.STOCK_CODE
                        , Z.CDC
                        , SUM(Z.ISS_QTY) AS CDC_SUM
                     FROM SCM0051S Z
                    WHERE Z.ISS_DT BETWEEN #{issDtFrom} AND #{issDtTo}
                    GROUP BY Z.STOCK_CODE, Z.CDC
                   ) B ON (A.STOCK_CODE = B.STOCK_CODE)
</select>

</mapper>