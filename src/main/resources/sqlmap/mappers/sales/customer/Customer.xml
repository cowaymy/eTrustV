<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.coway.trust.biz.sales.customer.impl.CustomerMapper">

    <select id="selectCustomerList" parameterType="Map" resultType="egovMap">
        <![CDATA[
        SELECT  
				P2.C1 AS C1, 
				P2.CUST_ID AS CUST_ID, 
				P2.CRT_USER_ID AS CRT_USER_ID, 
				P2.USER_NAME1 AS USER_NAME1, 
				P2.CRT_DT AS CRT_DT, 
				P2.CORP_TYPE_ID AS CORP_TYPE_ID, 
				P2.CODE AS CODE, 
				P2.CODE_NAME AS CODE_NAME, 
				P2.Name1 AS Name, 
				P2.NRIC AS NRIC, 
				P2.CODE_NAME1 AS CODE_NAME1, 
				P2.TYPE_ID AS TYPE_ID, 
				P2.DOB AS DOB, 
				P2.EMAIL AS EMAIL, 
				P2.GENDER AS GENDER, 
				P2.NATION AS NATION, 
				P2.Name2 AS Name2, 
				P2.RACE_ID AS RACE_ID, 
				P2.CODE_NAME2 AS CODE_NAME2, 
				P2.REM AS REM, 
				P2.STUS_CODE_ID AS STUS_CODE_ID, 
				P2.UPD_USER_ID AS UPD_USER_ID, 
				P2.UPD_DT AS UPD_DT, 
				P2.USER_NAME2 AS USER_NAME2, 
				P2.CUST_ADD_ID AS CUST_ADD_ID, 
				P2.CUST_CNTC_ID AS CUST_CNTC_ID, 
				P2.CUST_CARE_CNT_ID AS CUST_CARE_CNT_ID, 
				P2.PAS_SPORT_EXPR AS PAS_SPORT_EXPR, 
				P2.VISA_EXPR AS VISA_EXPR, 
				P2.CUST_VA_NO AS CUST_VA_NO, 
				P2.GST_RGIST_NO AS GST_RGIST_NO
				FROM ( SELECT P1.CUST_ID, P1.Name1, P1.NRIC, P1.REM, P1.TYPE_ID, P1.PAS_SPORT_EXPR, 
				                P1.VISA_EXPR, P1.C1, P1.CRT_USER_ID, P1.USER_NAME1, 
				                P1.CRT_DT, P1.CORP_TYPE_ID, P1.CODE, P1.CODE_NAME, 
				                P1.CODE_NAME1, P1.DOB, P1.EMAIL, P1.GENDER, 
				                P1.NATION, P1.Name2, P1.RACE_ID, P1.CODE_NAME2, 
				                P1.STUS_CODE_ID, P1.UPD_USER_ID, P1.UPD_DT, P1.USER_NAME2, 
				                P1.CUST_ADD_ID, P1.CUST_CNTC_ID, P1.CUST_CARE_CNT_ID, P1.CUST_VA_NO, 
				                P1.GST_RGIST_NO, row_number() OVER (ORDER BY P1.CUST_ID ASC) AS row_number
				        FROM ( SELECT 
				                D1.CUST_ID AS CUST_ID, 
				                D1.Name1 AS Name1, 
				                D1.NRIC AS NRIC, 
				                D1.REM AS REM, 
				                D1.TYPE_ID AS TYPE_ID, 
				                D1.PAS_SPORT_EXPR AS PAS_SPORT_EXPR, 
				                D1.VISA_EXPR AS VISA_EXPR, 
				                D1.C1 AS C1, 
				                D1.CRT_USER_ID AS CRT_USER_ID, 
				                D1.USER_NAME1 AS USER_NAME1, 
				                D1.CRT_DT AS CRT_DT, 
				                D1.CORP_TYPE_ID AS CORP_TYPE_ID, 
				                D1.CODE AS CODE, 
				                D1.CODE_NAME AS CODE_NAME, 
				                D1.CODE_NAME1 AS CODE_NAME1, 
				                D1.DOB AS DOB, 
				                D1.EMAIL AS EMAIL, 
				                D1.GENDER AS GENDER, 
				                D1.NATION AS NATION, 
				                D1.Name2 AS Name2, 
				                D1.RACE_ID AS RACE_ID, 
				                D1.CODE_NAME2 AS CODE_NAME2, 
				                D1.STUS_CODE_ID AS STUS_CODE_ID, 
				                D1.UPD_USER_ID AS UPD_USER_ID, 
				                D1.UPD_DT AS UPD_DT, 
				                D1.USER_NAME2 AS USER_NAME2, 
				                D1.CUST_ADD_ID AS CUST_ADD_ID, 
				                D1.CUST_CNTC_ID AS CUST_CNTC_ID, 
				                D1.CUST_CARE_CNT_ID AS CUST_CARE_CNT_ID, 
				                D1.CUST_VA_NO AS CUST_VA_NO, 
				                D1.GST_RGIST_NO AS GST_RGIST_NO
				                FROM ( SELECT DISTINCT 
				                            S1.CUST_ID1 AS CUST_ID, 
				                            S1.Name1 AS Name1, 
				                            S1.NRIC1 AS NRIC, 
				                            S1.REM, 
				                            S1.TYPE_ID AS TYPE_ID, 
				                            S1.PAS_SPORT_EXPR AS PAS_SPORT_EXPR, 
				                            S1.VISA_EXPR AS VISA_EXPR, 
				                            1 AS C1, 
				                            CASE WHEN (S1.CRT_USER_ID1 IS NOT NULL) THEN S1.CRT_USER_ID1 ELSE 0 END AS CRT_USER_ID, 
				                            CASE WHEN (S1.USER_ID1 IS NOT NULL) THEN S1.USER_NAME1 ELSE '' END AS USER_NAME1, 
				                            CASE WHEN ((S1.CRT_DT1 IS NOT NULL) AND (S1.CRT_DT1 > '1900-01-01 00:00:00')) THEN   S1.CRT_DT1 ELSE '1900-01-01 00:00:00' END AS CRT_DT, 
				                            CASE WHEN (S1.CORP_TYPE_ID IS NOT NULL) THEN S1.CORP_TYPE_ID ELSE 0 END AS CORP_TYPE_ID, 
				                            CASE WHEN (T10.CODE_ID IS NOT NULL) THEN T10.Code ELSE '' END AS CODE, 
				                            CASE WHEN (T10.CODE_ID IS NOT NULL) THEN T10.CODE_NAME ELSE '' END AS CODE_NAME, 
				                            CASE WHEN (S1.CODE_ID1 IS NOT NULL) THEN S1.CODE_NAME1 ELSE '' END AS CODE_NAME1, 
				                            CASE WHEN (964 <> S1.TYPE_ID) THEN '1900-01-01 00:00:00' WHEN ((S1.DOB1 IS NOT NULL) AND (S1.DOB1 > '1900-01-01 00:00:00')) THEN   S1.DOB1 ELSE '1900-01-01 00:00:00' END AS DOB, 
				                            CASE WHEN (S1.Email1 IS NOT NULL) THEN S1.Email1 ELSE '' END AS EMAIL, 
				                            CASE WHEN (964 <> S1.TYPE_ID) THEN '' WHEN (S1.Gender1 IS NOT NULL) THEN S1.Gender1 ELSE '' END AS GENDER, 
				                            CASE WHEN (964 <> S1.TYPE_ID) THEN 0 WHEN (S1.NATION IS NOT NULL) THEN   S1.NATION ELSE 0 END AS NATION, 
				                            CASE WHEN (964 <> S1.TYPE_ID) THEN '' WHEN (S1.CNTY_ID1 IS NOT NULL) THEN S1.Name2 ELSE '' END AS Name2, 
				                            CASE WHEN (964 <> S1.TYPE_ID) THEN 0 WHEN (S1.RACE_ID1 IS NOT NULL) THEN   S1.RACE_ID1 ELSE 0 END AS RACE_ID, 
				                            CASE WHEN (964 <> S1.TYPE_ID) THEN '' WHEN (S1.CODE_ID2 IS NOT NULL) THEN S1.CODE_NAME2 ELSE '' END AS CODE_NAME2, 
				                            CASE WHEN (S1.STUS_CODE_ID1 IS NOT NULL) THEN   S1.STUS_CODE_ID1 ELSE 0 END AS STUS_CODE_ID, 
				                            CASE WHEN (S1.UPD_USER_ID1 IS NOT NULL) THEN S1.UPD_USER_ID1 ELSE 0 END AS UPD_USER_ID, 
				                            CASE WHEN ((S1.UPD_DT1 IS NOT NULL) AND (S1.UPD_DT1 > '1900-01-01 00:00:00')) THEN   S1.UPD_DT1 ELSE '1900-01-01 00:00:00' END AS UPD_DT, 
				                            CASE WHEN (S1.USER_ID2 IS NOT NULL) THEN S1.USER_NAME2 ELSE '' END AS USER_NAME2, 
				                            CASE WHEN (S1.CUST_ADD_ID IS NOT NULL) THEN S1.CUST_ADD_ID ELSE 0 END AS CUST_ADD_ID, 
				                            CASE WHEN (S1.CUST_CNTC_ID IS NOT NULL) THEN S1.CUST_CNTC_ID ELSE 0 END AS CUST_CNTC_ID, 
				                            CASE WHEN (S1.CUST_CARE_CNT_ID IS NOT NULL) THEN S1.CUST_CARE_CNT_ID ELSE 0 END AS CUST_CARE_CNT_ID, 
				                            CASE WHEN (S1.CUST_VA_NO IS NOT NULL) THEN S1.CUST_VA_NO ELSE '' END AS CUST_VA_NO, 
				                            CASE WHEN (S1.GST_RGIST_NO IS NOT NULL) THEN S1.GST_RGIST_NO ELSE '' END AS GST_RGIST_NO
				                            FROM   (SELECT T1.CUST_ID AS CUST_ID1, T1.Name AS Name1, T1.NRIC AS NRIC1, DBMS_LOB.SUBSTR (T1.REM, 4000) AS REM, T1.TYPE_ID AS TYPE_ID, T1.PAS_SPORT_EXPR AS PAS_SPORT_EXPR, 
				                                        T1.VISA_EXPR AS VISA_EXPR, --C1, 
				                                        T1.CRT_USER_ID AS CRT_USER_ID1, T2.USER_ID AS USER_ID1, T2.USER_NAME AS USER_NAME1, TO_CHAR(T1.CRT_DT, 'YYYYMMDD') AS CRT_DT1, T1.CORP_TYPE_ID AS CORP_TYPE_ID, T9.CODE_ID AS CODE_ID1, 
				                                        T9.CODE_NAME AS CODE_NAME1, T1.DOB AS DOB1, T1.Email AS Email1, T1.Gender AS Gender1, T1.NATION AS NATION, T4.Name AS Name2, T4.CNTY_ID AS CNTY_ID1, T1.RACE_ID AS RACE_ID1, 
				                                        T5.CODE_ID AS CODE_ID2, T5.CODE_NAME AS CODE_NAME2, T1.STUS_CODE_ID AS STUS_CODE_ID1, T1.UPD_DT AS UPD_DT1, T1.UPD_USER_ID AS UPD_USER_ID1, T3.USER_ID AS USER_ID2, T3.USER_NAME AS USER_NAME2, 
				                                        T6.CUST_ADD_ID AS CUST_ADD_ID, T7.CUST_CNTC_ID AS CUST_CNTC_ID, T8.CUST_CARE_CNT_ID AS CUST_CARE_CNT_ID, T1.CUST_VA_NO AS CUST_VA_NO, T1.GST_RGIST_NO AS GST_RGIST_NO
				                                    FROM SAL0029D T1
				                                    LEFT OUTER 
				                                    JOIN SYS0047M T2 
				                                      ON T2.USER_ID = T1.CRT_USER_ID
				                                    LEFT OUTER 
				                                    JOIN SYS0047M T3 
				                                      ON T3.USER_ID = T1.UPD_USER_ID
				                                    LEFT OUTER 
				                                    JOIN SYS0015M T4 
				                                      ON T4.CNTY_ID =  T1.NATION
				                                    LEFT OUTER 
				                                    JOIN SYS0013M T5 
				                                      ON T5.CODE_ID =  T1.RACE_ID
				                                    LEFT OUTER 
				                                    JOIN SAL0023D T6 
				                                      ON T6.CUST_ID = T1.CUST_ID 
				                                     AND (9 =   T6.STUS_CODE_ID)
				                                    LEFT OUTER 
				                                    JOIN SAL0027D T7 
				                                      ON T7.CUST_ID = T1.CUST_ID 
				                                     AND (9 =   T7.STUS_CODE_ID)
				                                    LEFT OUTER 
				                                    JOIN SAL0026D T8 
				                                      ON T8.CUST_ID = T1.CUST_ID AND (9 =   T8.STUS_CODE_ID)
				                                    LEFT OUTER 
				                                    JOIN SYS0013M T9 
				                                      ON T9.CODE_ID = T1.TYPE_ID
				                                   WHERE (8 <>   T1.STUS_CODE_ID) 
				                                     --AND (T1.TYPE_ID IN (965,964)) 
				                                     --AND ( (1154 = (CASE WHEN (T1.CORP_TYPE_ID IS NOT NULL) THEN T1.CORP_TYPE_ID ELSE 0 END)) OR (1174 = (CASE WHEN (T1.CORP_TYPE_ID IS NOT NULL) THEN T1.CORP_TYPE_ID ELSE 0 END))) 
				                                   ) S1
				                            LEFT OUTER 
				                            JOIN SYS0013M T10 
				                              ON T10.CODE_ID = S1.CORP_TYPE_ID 
				                             AND S1.CORP_TYPE_ID IS NOT NULL
				                         WHERE 1=1
				                          
				                            --AND (CASE WHEN (964 <> S1.TYPE_ID) THEN 0 WHEN (S1.NATION IS NOT NULL) THEN   S1.NATION ELSE 0 END) = 1    --MALAYSIA
				                            ]]>

				                                
				                            <if test="typeIdList != null and typeIdList != ''">
								                AND S1.TYPE_ID in 
									            <foreach item="item" collection="typeIdList" index="index" open="(" separator="," close=")">
									                #{item}
									            </foreach>
								            </if>
								            <if test="cmbCorpTypeIdList != null and cmbCorpTypeIdList != ''">
                                                AND S1.CORP_TYPE_ID in 
                                                <foreach item="item" collection="cmbCorpTypeIdList" index="index" open="(" separator="," close=")">
                                                    #{item}
                                                </foreach>
                                            </if>
								            <if test="nation != null and nation != ''">
                                                AND S1.NATION = #{nation}
                                            </if>
				                            <if test="custId != null and custId !=''">
                                                AND S1.CUST_ID1 = #{custId}
                                            </if>
                                            <if test="nric != null and nric !=''">
                                                AND S1.NRIC1 = #{nric}
                                            </if>
                                            <if test="name != null and name !=''">
                                                AND S1.Name1 like '%'|| #{name} || '%'
                                            </if>
                                            <if test="custVaNo != null and custVaNo !=''">
                                                AND S1.CUST_VA_NO = #{custVaNo}
                                            </if>
                                            <if test="dob != null and dob !=''">
                                                AND S1.DOB1 = #{dob}
                                            </if>
                                            
				                            
				                     ) D1
				            ) P1
				        ) P2
				WHERE P2.row_number > 0
				ORDER BY P2.CUST_ID ASC
		
    </select>


</mapper>