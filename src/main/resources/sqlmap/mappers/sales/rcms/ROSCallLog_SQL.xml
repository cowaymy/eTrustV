<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.coway.trust.biz.sales.rcms.impl.ROSCallLogMapper">

<select id="getAppTypeList" parameterType="Map" resultType="egovMap">
    SELECT 
       Extent1.CODE_ID   ,
       Extent1.CODE_MASTER_ID   ,
       Extent1.CODE   ,
       Extent1.CODE_NAME   ,
       Extent1.CODE_DESC   ,
       Extent1.DISAB   ,
       Extent1.CRT_DT   ,
       Extent1.CRT_USER_ID   ,
       Extent1.UPD_DT   ,
       Extent1.UPD_USER_ID   ,
       Extent1.OLD_CODE_ID   
  FROM SYS0013M Extent1
 WHERE  ( 0 = Extent1.DISAB )
          AND ( Extent1.CODE_MASTER_ID = #{codeMasterId})
</select>

<select id="selectRosCallLogList" parameterType="Map" resultType="egovMap">
    SELECT Project1.ORD_ID   ,
       Project1.ORD_NO   ,
       Project1.ORD_DT,
       Project1.APP_TYPE_ID   ,
       Project1.APP_TYPE_CODE   ,
       Project1.APP_TYPE_DESC   ,
       Project1.CUST_ID   ,
       Project1.CUST_NAME   ,
       Project1.CUST_NRIC   ,
       Project1.ORD_PO_NO   ,
       Project1.ORD_REF_NO   ,
       Project1.BRNCH_ID   ,
       Project1.STOCK_CODE   ,
       Project1.STOCK_DESC   ,
       Project1.RENTAL_STUS   ,
       Project1.CUST_BILL_ID   ,
       Project1.ORD_STUS_ID   
  FROM ( SELECT Project1.ORD_ID   ,
                Project1.ORD_NO   ,
                Project1.RENTAL_STUS   ,
                Project1.ORD_REF_NO   ,
                Project1.ORD_PO_NO   ,
                Project1.APP_TYPE_CODE   ,
                Project1.APP_TYPE_DESC   ,
                Project1.STOCK_CODE   ,
                Project1.STOCK_DESC   ,
                Project1.CUST_ID   ,
                Project1.CUST_NAME   ,
                Project1.CUST_NRIC   ,
                Project1.APP_TYPE_ID   ,
                Project1.ORD_DT   ,
                Project1.BRNCH_ID   ,
                Project1.CUST_BILL_ID   ,
                Project1.ORD_STUS_ID   
         FROM ( SELECT Extent1.ORD_ID   ,
                       Extent1.ORD_NO   ,
                       Extent1.RENTAL_STUS   ,
                       Extent1.ORD_REF_NO   ,
                       Extent1.ORD_PO_NO   ,
                       Extent1.APP_TYPE_CODE   ,
                       Extent1.APP_TYPE_DESC   ,
                       Extent1.STOCK_CODE   ,
                       Extent1.STOCK_DESC   ,
                       Extent1.CUST_ID   ,
                       Extent1.CUST_NAME   ,
                       Extent1.CUST_NRIC   ,
                       Extent2.APP_TYPE_ID   ,
                       CASE  WHEN ( Extent1.ORD_DT IS NOT NULL ) THEN TO_CHAR(Extent1.ORD_DT, 'DD/MM/YYYY') ELSE '01/01/1900' END ORD_DT  ,
                       CASE  WHEN ( Extent2.BRNCH_ID IS NOT NULL ) THEN Extent2.BRNCH_ID  ELSE 0 END BRNCH_ID  ,
                       CASE  WHEN ( Extent2.CUST_BILL_ID IS NULL ) THEN 0 ELSE Extent2.CUST_BILL_ID END CUST_BILL_ID  ,
                       CASE  WHEN ( Extent1.ORD_STUS_ID IS NOT NULL ) THEN Extent1.ORD_STUS_ID ELSE 0 END ORD_STUS_ID  
                FROM ( SELECT vOrderBasicInfo.ORD_ID   ,
                              vOrderBasicInfo.ORD_NO   ,
                              vOrderBasicInfo.RENTAL_STUS   ,
                              vOrderBasicInfo.ORD_STUS_ID   ,
                              vOrderBasicInfo.ORD_STUS_CODE   ,
                              vOrderBasicInfo.ORD_STUS_NAME   ,
                              vOrderBasicInfo.ORD_DT   ,
                              vOrderBasicInfo.INSTLMT_PRIOD   ,
                              vOrderBasicInfo.ORD_AMT   ,
                              vOrderBasicInfo.ORD_MTH_RENTAL   ,
                              vOrderBasicInfo.ORD_PV   ,
                              vOrderBasicInfo.ORD_PV_MONTH   ,
                              vOrderBasicInfo.ORD_PV_YEAR   ,
                              vOrderBasicInfo.ORD_REF_NO   ,
                              vOrderBasicInfo.ORD_PO_NO   ,
                              vOrderBasicInfo.ORD_DEPT_CODE   ,
                              vOrderBasicInfo.ORD_GRP_CODE   ,
                              vOrderBasicInfo.ORD_ORG_CODE   ,
                              vOrderBasicInfo.ORD_CRT_USER_ID   ,
                              vOrderBasicInfo.ORD_CRT_DT   ,
                              vOrderBasicInfo.APP_TYPE_ID   ,
                              vOrderBasicInfo.APP_TYPE_CODE   ,
                              vOrderBasicInfo.APP_TYPE_DESC   ,
                              vOrderBasicInfo.STOCK_ID   ,
                              vOrderBasicInfo.STOCK_CODE   ,
                              vOrderBasicInfo.STOCK_DESC   ,
                              vOrderBasicInfo.CUST_ID   ,
                              vOrderBasicInfo.CUST_TYPE   ,
                              vOrderBasicInfo.CUST_NAME   ,
                              vOrderBasicInfo.CUST_NRIC   ,
                              vOrderBasicInfo.CUST_DOB   ,
                              vOrderBasicInfo.CUST_NATION   ,
                              vOrderBasicInfo.CUST_GENDER   ,
                              vOrderBasicInfo.CUST_RACE   ,
                              vOrderBasicInfo.CUST_EMAIL   ,
                              vOrderBasicInfo.CUST_VA_NO   ,
                              vOrderBasicInfo.CUST_PASSPORT_EXPR   ,
                              vOrderBasicInfo.CUST_VISA_EXPR   ,
                              vOrderBasicInfo.ORD_PROMO_ID   ,
                              vOrderBasicInfo.ORD_PROMO_CODE   ,
                              vOrderBasicInfo.ORD_PROMO_DESC   ,
                              vOrderBasicInfo.ORD_MEM_ID   ,
                              vOrderBasicInfo.ORD_MEM_CODE   ,
                              vOrderBasicInfo.ORD_MEM_NAME   ,
                              vOrderBasicInfo.ORD_MEM_NRIC   ,
                              vOrderBasicInfo.ORD_MEM_TYPE_ID   ,
                              vOrderBasicInfo.ORD_MEM_TYPE_CODE   ,
                              vOrderBasicInfo.ORD_MEM_TYPE_NAME   ,
                              vOrderBasicInfo.COOL_OFF_PRIOD   ,
                              vOrderBasicInfo.KEYIN_BRNCH_ID   ,
                              vOrderBasicInfo.KEYIN_BRNCH_CODE   ,
                              vOrderBasicInfo.KEYIN_BRNCH_NAME   ,
                              vOrderBasicInfo.ORD_REM   ,
                              vOrderBasicInfo.RENT_CHK_ID   ,
                              vOrderBasicInfo.ORD_HM_ID   ,
                              vOrderBasicInfo.ORD_SM_ID   ,
                              vOrderBasicInfo.ORD_GM_ID   ,
                              vOrderBasicInfo.ORD_ADDR_ID   ,
                              vOrderBasicInfo.ORD_CNTC_ID   ,
                              vOrderBasicInfo.ORD_PROMO_RELATED_NO   ,
                              vOrderBasicInfo.UPD_DT   ,
                              vOrderBasicInfo.UPD_USER_ID   ,
                              vOrderBasicInfo.JOM_PAY_REF   ,
                              vOrderBasicInfo.STK_CTGRY_ID   ,
                              vOrderBasicInfo.STK_CTGRY_NAME   ,
                              vOrderBasicInfo.CUST_TYPE_ID   ,
                              vOrderBasicInfo.CUST_BILL_ID   ,
                              vOrderBasicInfo.OBLIGT_YEAR   
                       FROM SAL1006V vOrderBasicInfo ) Extent1
                       JOIN SAL0001D Extent2   ON Extent2.SALES_ORD_ID = Extent1.ORD_ID
                 WHERE 1 = 1  
                 <if test=" ordNo != null and ordNo != '' ">
                    AND  Extent1.ORD_NO = #{ordNo}
                 </if>
                 <if test=" appTypeArr != null and appTypeArr.length > 0 ">
                    AND  Extent2.APP_TYPE_ID IN
                    <foreach collection="appTypeArr" item="item" open="(" separator="," close=")">
                    #{item}
                    </foreach>
                 </if>
                 <if test=" custId != null and custId != '' ">
                    AND  Extent1.CUST_ID = #{custId}
                 </if>
                 <if test=" custName != null and custName != '' ">
                    AND  UPPER(Extent1.CUST_NAME) LIKE '%'||UPPER(#{custName}) ||'%'
                 </if>
                 <if test=" custNric != null and custNric != '' ">
                    AND  Extent1.CUST_NRIC LIKE '%'||#{custNric}||'%'
                 </if>
                 <if test=" rentalArr != null and rentalArr.length > 0  ">
                    AND Extent1.RENTAL_STUS IN
                    <foreach collection="rentalArr" item="item" open="(" separator="," close=")">
                        #{item}
                    </foreach>
                 </if>
                          ) Project1 ) Project1
  ORDER BY Project1.ORD_ID ASC
</select>


<select id="getRentInstallLatestNo" parameterType="Map" resultType="egovMap">
				SELECT 
				    T1.RENT_INST_NO
				FROM(
				        SELECT 
				            RENT_INST_NO
				        FROM 
				            SAL0070D 
				        WHERE 
				            SALES_ORD_ID = #{ordId} 
				        ORDER BY RENT_INST_DT DESC ) T1
				<![CDATA[     
				WHERE ROWNUM <= 1
				]]>
</select>

<select id="getRentalStatus" parameterType="Map" resultType="egovMap">
    SELECT 
        RENTAL_STUS 
    FROM 
        SAL1006V 
    WHERE ORD_ID = #{ordId}
    <![CDATA[
    AND ROWNUM <= 1
    ]]>
</select>

<select id="selectROSSMSCodyTicketLogList" parameterType="Map" resultType="egovMap"> 
				   SELECT Project4.C1   ,
				       Project4.TYPE_ID   ,
				       Project4.CODE   ,
				       Project4.CODE_NAME   ,
				       Project4.REM   ,
				       Project4.USER_ID   ,
				       Project4.USER_NAME   ,
				       TO_CHAR(Project4.CALL_CRT_DT , 'DD/MM/YYYY') CALL_CRT_DT   
				  FROM ( SELECT Project4.C1   ,
				                Project4.TYPE_ID   ,
				                Project4.CODE   ,
				                Project4.CODE_NAME   ,
				                Project4.REM   ,
				                Project4.USER_ID   ,
				                Project4.USER_NAME   ,
				                Project4.CALL_CRT_DT   
				         FROM ( SELECT Distinct1.C1   ,
				                       Distinct1.TYPE_ID   ,
				                       Distinct1.CODE   ,
				                       Distinct1.CODE_NAME   ,
				                       Distinct1.REM   ,
				                       Distinct1.USER_ID   ,
				                       Distinct1.USER_NAME   ,
				                       Distinct1.CALL_CRT_DT   
				                FROM ( SELECT DISTINCT UnionAll1.C1   ,
				                                       UnionAll1.TYPE_ID   ,
				                                       UnionAll1.CODE CODE  ,
				                                       UnionAll1.CODE_NAME   ,
				                                       UnionAll1.REM   ,
				                                       UnionAll1.USER_ID   ,
				                                       UnionAll1.USER_NAME   ,
				                                       UnionAll1.CALL_CRT_DT   
				                       FROM ( SELECT 1 C1  ,
				                                     Extent1.TYPE_ID TYPE_ID  ,
				                                     Extent3.CODE CODE  ,
				                                     Extent3.CODE_NAME CODE_NAME  ,
				                                     CASE WHEN ( Extent2.CALL_SMS_REM IS NOT NULL ) THEN Extent2.CALL_SMS_REM ELSE ' ' END REM  ,
				                                     CASE WHEN ( Extent4.USER_ID IS NOT NULL ) THEN Extent4.USER_ID ELSE 0 END USER_ID  ,
				                                     CASE WHEN ( Extent4.USER_ID IS NOT NULL ) THEN Extent4.USER_NAME ELSE ' ' END USER_NAME  ,
				                                     Extent2.CALL_CRT_DT CALL_CRT_DT  
				                              FROM CCR0006D Extent1
				                                     JOIN CCR0007D Extent2   ON ( Extent2.CALL_ENTRY_ID = Extent1.CALL_ENTRY_ID ) AND ( 1 = Extent2.CALL_SMS )
				                                     JOIN SYS0013M Extent3   ON Extent3.CODE_ID = Extent1.TYPE_ID
				                                     LEFT JOIN SYS0047M Extent4   ON Extent4.USER_ID = Extent2.CALL_CRT_USER_ID
				                               WHERE  Extent1.SALES_ORD_ID = #{ordId}
				                              UNION ALL 
				                              SELECT 1 C1  ,
				                                     Extent7.TYPE_ID   ,
				                                     Extent8.CODE   ,
				                                     Extent8.CODE_NAME   ,
				                                     CASE WHEN ( Extent5.CRCT_REM IS NOT NULL ) THEN Extent5.CRCT_REM ELSE ' ' END REM  ,
				                                     CASE WHEN ( Extent9.USER_ID IS NOT NULL ) THEN Extent9.USER_ID ELSE 0 END USER_ID  ,
				                                     CASE WHEN ( Extent9.USER_ID IS NOT NULL ) THEN Extent9.USER_NAME ELSE ' ' END USER_NAME  ,
				                                     Extent5.CRT_DT CRT_DT  
				                              FROM CCR0014M Extent5
				                                     JOIN CCR0007D Extent6   ON Extent6.CALL_RESULT_ID = Extent5.CALL_RESULT_ID
				                                     JOIN CCR0006D Extent7   ON ( Extent7.CALL_ENTRY_ID = Extent6.CALL_ENTRY_ID )
				                                     AND ( Extent7.SALES_ORD_ID = #{ordId} )
				                                     JOIN SYS0013M Extent8   ON Extent8.CODE_ID = Extent5.CALL_TYPE_ID
				                                     LEFT JOIN SYS0047M Extent9   ON Extent9.USER_ID = Extent5.CRT_USER_ID ) UnionAll1 ) Distinct1 ) Project4 ) Project4
				      ORDER BY Project4.CALL_CRT_DT DESC
</select>

<select id="getReasonCodeList" parameterType="Map" resultType="egovMap">
			  SELECT
			     Extent1.RESN_ID CODE_ID  ,
			     Extent1.CODE CODE  ,
			     Extent1.CODE || ' - ' || Extent1.RESN_DESC CODE_NAME  
			  FROM 
			     SYS0032M Extent1
			  WHERE  
			      Extent1.RESN_TYPE_ID = #{typeId} 
			  AND  
			      Extent1.STUS_CODE_ID = #{stusCodeId} 
</select>

<select id="getFeedbackCodeList" parameterType="Map" resultType="egovMap">
			    SELECT Extent2.RESN_ID CODE_ID  ,
			       Extent2.CODE CODE  ,
			       Extent2.CODE || ' - ' || Extent2.RESN_DESC CODE_NAME  
			  FROM SYS0034M Extent1
			         JOIN SYS0032M Extent2   ON Extent2.RESN_ID = Extent1.RESN_ID
			 WHERE  ( Extent1.PARENT_RESN_ID = #{resnId} )
			          AND ( 0 = Extent1.DISAB )
</select>
</mapper>