<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.coway.trust.biz.sales.promotion.impl.PromotionListMapper">

    <select id="selectPromotionList" parameterType="Map" resultType="egovMap">
		SELECT T1.PROMO_ID
		     , T1.PROMO_MTCH_ID
		     , T1.PROMO_CODE
		     , T1.PROMO_DESC
		     , T1.PROMO_TYPE_ID
		     , T3.CODE_NAME AS PROMO_TYPE_NAME
		     , T1.PROMO_APP_TYPE_ID
		     , T2.CODE_NAME AS PROMO_APP_TYPE_NAME
		     , T1.PROMO_SRV_MEM_PAC_ID
		     , TO_CHAR(T1.PROMO_DT_FROM, 'DD/MM/YYYY') AS PROMO_DT_FROM
		     , TO_CHAR(T1.PROMO_DT_END,  'DD/MM/YYYY') AS PROMO_DT_END
		     , T1.PROMO_STUS_ID
		     , T1.PROMO_UPD_DT
		     , T1.PROMO_UPD_USER_ID
		     , T1.PROMO_IS_TRIAL_CNVR
		     , T1.PROMO_PRC_PRCNT
		     , T1.PROMO_CUST_TYPE
		     , T1.PROMO_DISC_TYPE
		     , T1.PROMO_RPF_DISC_AMT
		     , T1.PROMO_DISC_PERIOD_TP
		     , T1.PROMO_DISC_PERIOD
		     , T1.PROMO_FREESVC_PERIOD_TP
		     , T1.PROMO_ADD_DISC_PRC
		     , T1.PROMO_ADD_DISC_PV
		     , T1.EMP_CHK
		     , T1.EX_TRADE
		  FROM SAL0017D T1
		  LEFT OUTER
		  JOIN SYS0013M T2
		    ON T1.PROMO_APP_TYPE_ID = T2.CODE_ID
		   AND T2.CODE_MASTER_ID = '320'
		  LEFT OUTER
		  JOIN SYS0013M T3
		    ON T1.PROMO_TYPE_ID = T3.CODE_ID
		   AND T3.CODE_MASTER_ID = '76'
		 WHERE 1 = 1
         <if test='arrPromoAppTypeId != null and arrPromoAppTypeId != ""'>
           AND T1.PROMO_APP_TYPE_ID IN
           <foreach item="item" collection="arrPromoAppTypeId" index="index" open="(" separator="," close=")">
             #{item}
           </foreach>
         </if>
         <if test='arrPromoTypeId != null and arrPromoTypeId !=""'>
           AND T1.PROMO_TYPE_ID IN
           <foreach item="item" collection="arrPromoTypeId" index="index" open="(" separator="," close=")">
             #{item}
           </foreach>
         </if>
         <if test='promoDt != null and promoDt !=""'>
           AND #{promoDt} BETWEEN TO_CHAR(T1.PROMO_DT_FROM, 'YYYY-MM-DD') AND TO_CHAR(T1.PROMO_DT_END, 'YYYY-MM-DD')
         </if>
         <if test='promoStusId != null and promoStusId !=""'>
           AND T1.PROMO_STUS_ID = #{promoStusId}
         </if>
         <if test='promoCode != null and promoCode !=""'>
           AND UPPER(T1.PROMO_CODE) LIKE '%'||UPPER(#{promoCode})||'%'
         </if>
         <if test='promoDesc != null and promoDesc !=""'>
           AND UPPER(T1.PROMO_DESC) LIKE '%'||UPPER(#{promoDesc})||'%'
         </if>
    </select>

    <update id="updatePromoStatus" parameterType="salesPromoMVO">
        UPDATE SAL0017D
           SET PROMO_STUS_ID = #{promoStusId}
             , PROMO_UPD_DT = SYSDATE
             , PROMO_UPD_USER_ID = #{promoUpdUserId}
         WHERE PROMO_ID = #{promoId}
    </update>
</mapper>