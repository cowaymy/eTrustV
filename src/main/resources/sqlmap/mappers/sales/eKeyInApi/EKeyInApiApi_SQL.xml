<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.coway.trust.biz.sales.eKeyInApi.impl.EKeyInApiMapper">

  <select id="selecteKeyInList" parameterType="Map" resultType="egovMap">
    <![CDATA[
      /* [com.coway.trust.biz.sales.eKeyInApi.impl.EKeyInApiMapper.selecteKeyInList] 20191209 - KR JAEMAJEM */
      SELECT A.CUST_ID                                                               AS CUST_ID
               , B.NAME                                                                  AS CUST_NAME
               , CASE WHEN C.STK_CTGRY_ID IN ('5706', '5707')  THEN 'HC' --SYS0013M : 5706(Mattress), 5707(Frame)
                         ELSE NULL END AS HC_GU
               , A.SOF_NO AS SOF_NO
               , TO_CHAR(A.REQST_DT, 'DD/MM/YYYY') AS REQST_DT
               , A.STUS_ID AS STUS_ID
               , D.NAME AS STUS_NAME
               , C.STK_DESC AS STK_DESC
               , A.REM1 AS REM1
               , A.REM2 AS REM2
               , A.PRE_ORD_ID AS PRE_ORD_ID
      FROM SAL0213M A
      INNER JOIN SAL0029D B ON A.CUST_ID = B.CUST_ID
                                AND B.TYPE_ID IN ('964', '965') --SYS0013M : 964(Individual), 965(Company)
      INNER JOIN SYS0026M C ON A.ITM_STK_ID = C.STK_ID
      INNER JOIN SYS0038M D ON A.STUS_ID = D.STUS_CODE_ID
                                        AND D.STUS_CODE_ID IN (1, 4, 10, 21, 104) --1(Active), 4(Completed), 10(Cancelled), 21(Failed), 104(Processing)
      INNER JOIN SYS0005M E ON A.KEYIN_BRNCH_ID = E.BRNCH_ID
                                AND E.STUS_ID = 1
      WHERE A.APP_TYPE_ID IN ('66', '67', '68', '5764')                             --SYS0013M : 66(Rental), 67(Outright), 68(Instalment), 5764(Auxiliary)
          AND A.MEM_CODE = ( SELECT A.HR_CODE
                                         FROM SYS0047M A
                                         WHERE A.USER_NAME = #{regId}
                                        )
    ]]>

    <if test="reqstDtFrom != null and reqstDtFrom != '' and reqstDtTo != null and reqstDtTo != ''">
      AND TO_CHAR(A.REQST_DT, 'YYYYMMDD') BETWEEN #{reqstDtFrom} AND #{reqstDtTo}
    </if>

    <if test="selectType != null and selectType != '' ">
      <choose>
         <when test='selectType.equals("1") and selectKeyword != null and selectKeyword != ""'>
           AND UPPER(A.SOF_NO) = UPPER(#{selectKeyword})
        </when>

        <when test='selectType.equals("2") and selectKeyword != null and selectKeyword != ""'>
          AND UPPER(B.NAME) LIKE '%'||#{selectKeyword}||'%'
        </when>
      </choose>
    </if>
    ORDER BY    A.PRE_ORD_ID DESC
  </select>

  <select id="selectCodeList" resultType="egovMap">
    <![CDATA[
      /* [com.coway.trust.biz.sales.eKeyInApi.impl.EKeyInApiMapper.selectCodeList] 20191210 - KR JAEMAJEM */
      SELECT CODE_MASTER_ID AS CODE_MASTER_ID
               , CODE_ID AS CODE_ID
               , CODE AS CODE
               , CODE_NAME AS CODE_NAME
               , CODE_DESC AS CODE_DESC
      FROM SYS0013M
      WHERE CODE_MASTER_ID IN (8, 10, 19, 21, 115, 17, 2)
          AND DISAB = 0
      ORDER BY CODE_MASTER_ID ASC
                   , CASE WHEN CODE_MASTER_ID = 8 THEN CODE_DESC
                             ELSE NULL END DESC
                   , CASE WHEN CODE_MASTER_ID != 8 THEN CODE_DESC
                             ELSE NULL END ASC
    ]]>
  </select>

  <select id="selectBankList" resultType="egovMap">
    <![CDATA[
      /* [com.coway.trust.biz.sales.eKeyInApi.impl.EKeyInApiMapper.selectBankList] 20191211 - KR JAEMAJEM */
      SELECT A.BANK_ID AS BANK_ID
               , A.CODE AS CODE
               , A.CODE ||'-'|| A.NAME AS NAME
      FROM SYS0004M A
      WHERE STUS_CODE_ID = 1
      ORDER BY A.NAME ASC
    ]]>
  </select>

  <select id="selecteKeyInDetail" parameterType="Map" resultType="egovMap">
    <![CDATA[
      /* [com.coway.trust.biz.sales.eKeyInApi.impl.EKeyInApiMapper.selecteKeyInDetail] 20191212 - KR JAEMAJEM */
      SELECT CASE WHEN O.STK_CTGRY_ID IN ('5706', '5707') THEN 'HC'--SYS0013M : 5706(Mattress), 5707(Frame)
                                                                                     ELSE NULL END AS HC_GU
               , A.CUST_ID AS CUST_ID
               , A.CUST_CNTC_ID AS CUST_CNTC_ID
               , I.CUST_ADD_ID AS CUST_ADD_ID
               , A.CUST_CRC_ID AS CUST_CRC_ID
               , A.STUS_ID AS STUS_ID
               , TO_CHAR(A.REQST_DT, 'YYYYMMDD') AS REQST_DT

    --CUSTOMER----------------------------------------------------------------------
               , B.TYPE_ID AS TYPE_ID
               , B.NRIC AS NRIC
               , A.SOF_NO AS SOF_NO
               , D.CODE AS INITIALS
               , G.CODE_NAME AS COMPANY_TYPE
               , CASE WHEN TO_CHAR(B.DOB, 'DD/MM/YYYY') = '01/01/1900' THEN NULL
                         ELSE TO_CHAR(B.DOB, 'DD/MM/YYYY') END AS DOB
               , B.NAME AS CUST_NAME
               , B.GENDER AS GENDER
               , E.CODE_DESC AS NATION
               , NVL2(F.CODE_ID, F.CODE_NAME, NULL) AS RACE
               , CASE WHEN TO_CHAR(B.PAS_SPORT_EXPR, 'DD/MM/YYYY') = '01/01/1900' THEN NULL
                         ELSE TO_CHAR(B.PAS_SPORT_EXPR, 'DD/MM/YYYY') END AS PAS_SPORT_EXPR
               , CASE WHEN TO_CHAR(B.VISA_EXPR, 'DD/MM/YYYY') = '01/01/1900' THEN NULL
                         ELSE TO_CHAR(B.VISA_EXPR, 'DD/MM/YYYY') END AS VISA_EXPR

    --CONTACT-----------------------------------------------------------------------
               , A.PRE_ORD_ID AS PRE_ORD_ID
               , C.NAME AS NAME
               , C.TEL_M1 AS TEL_M1
               , C.TEL_R AS TEL_R
               , C.TEL_O AS TEL_O
               , C.TELF AS TELF
               , C.EMAIL AS EMAIL
               , C.EXT AS EXT

     --ORDER-------------------------------------------------------------------------
               , CASE WHEN A.APP_TYPE_ID = 5764  THEN 66 --SYS0013M : 5764(Auxiliary), 66(Rental)
                          ELSE A.APP_TYPE_ID END AS APP_TYPE_ID
               , A.SRV_PAC_ID AS SRV_PAC_ID
               , A.ITM_STK_ID AS ITM_STK_ID
               , A.PROMO_ID AS PROMO_ID
               , A.TOT_AMT AS TOT_AMT
               , A.MTH_RENT_AMT AS MTH_RENT_AMT
               , A.TOT_PV AS TOT_PV
               , REPLACE(REPLACE(A.INSTCT, CHR(10), '\n'), CHR(39), CHR(38)||CHR(35)||'39;') AS INSTCT
               , TO_CHAR(A.PRE_DT, 'YYYY') AS YYYY
               , TO_CHAR(A.CRT_DT, 'MM') AS MM
               , A.EMP_CHK AS EMP_CHK
               , A.EX_TRADE AS EX_TRADE
               , A.NOR_AMT AS NOR_AMT
               , A.PRC_ID AS PRC_ID
               , A.PRC_ID AS PRC_ID
               , A.TOT_PV_GST AS TOT_PV_GST

     --INSTALLATION------------------------------------------------------------------
               , I.ADDR_DTL AS ADDR_DTL
               , I.STREET AS STREET
               , J.AREA AS AREA
               , J.CITY AS CITY
               , J.POSTCODE AS POSTCODE
               , J.STATE AS STATE
               , J.COUNTRY AS COUNTRY
               , K.CODE ||' - '|| K.NAME AS DSC_BRNCH
               , K.BRNCH_ID AS DSC_BRNCH_ID

               --, L.CODE ||' - '|| L.NAME AS POSTING_BRNCH
               --, L.BRNCH_ID AS POSTING_BRNCH_ID
               , (CASE WHEN Q.USER_NAME LIKE 'CD%' THEN (CASE WHEN P.CODE IS NOT NULL AND P.NAME IS NOT NULL THEN P.CODE ||' - '|| P.NAME ELSE NULL END)
                          WHEN Q.USER_NAME LIKE 'HT%' THEN (SELECT CODE ||' - '|| NAME FROM SYS0005M WHERE BRNCH_ID = '284')
                          ELSE (CASE WHEN L.CODE IS NOT NULL AND L.NAME IS NOT NULL THEN L.CODE ||' - '|| L.NAME ELSE NULL END) END) AS POSTING_BRNCH
               , (CASE WHEN Q.USER_NAME LIKE 'CD%' THEN P.BRNCH_ID
                          WHEN Q.USER_NAME LIKE 'HT%' THEN 284
                          ELSE L.BRNCH_ID END) AS POSTING_BRNCH_ID

               , M.CODE ||' - '|| M.NAME AS HDC_BRNCH
               , M.BRNCH_ID AS HDC_BRNCH_ID

     --PAYMENT-----------------------------------------------------------------------
               , A.RENT_PAY_MODE_ID AS RENT_PAY_MODE_ID
               , N.CUST_ORI_CRC_NO AS CUST_ORI_CRC_NO
               , N.CUST_CRC_TYPE_ID AS CUST_CRC_TYPE_ID
               , N.CUST_CRC_OWNER AS CUST_CRC_OWNER
               , SUBSTR(N.CUST_CRC_EXPR, 1, 2)||'/'||SUBSTR(N.CUST_CRC_EXPR, 3) AS CUST_CRC_EXPR
               , N.CUST_CRC_BANK_ID AS CUST_CRC_BANK_ID
               , N.CARD_TYPE_ID AS CARD_TYPE_ID

     --Attachment--------------------------------------------------------------------
               ,  A.ATCH_FILE_GRP_ID AS ATCH_FILE_GRP_ID
      FROM SAL0213M A
      INNER JOIN SAL0029D B ON  A.CUST_ID = B.CUST_ID
      LEFT OUTER JOIN SAL0027D C ON  A.CUST_CNTC_ID = C.CUST_CNTC_ID
      LEFT OUTER JOIN SYS0013M D ON  C.CUST_INITIAL = D.CODE_ID
      LEFT OUTER JOIN SYS0013M E ON  B.NATION = E.CODE
                                                AND E.CODE_MASTER_ID = 338
                                                AND E.DISAB = 0
      LEFT OUTER JOIN SYS0013M F ON  B.RACE_ID = F.CODE_ID
                                                AND F.CODE_MASTER_ID = 2
                                                AND F.DISAB = 0
      LEFT OUTER JOIN SYS0013M G ON  B.CORP_TYPE_ID = G.CODE_ID
      INNER JOIN SAL0023D I ON  A.INST_ADD_ID = I.CUST_ADD_ID
      INNER JOIN SYS0064M J  ON I.AREA_ID = J.AREA_ID
      LEFT OUTER JOIN SYS0005M K ON J.CT_BRNCH_CODE = K.CODE
      LEFT OUTER JOIN SYS0005M L ON J.SO_BRNCH_CODE= L.CODE
      LEFT OUTER JOIN SYS0005M M ON J.DT_BRNCH_CODE= M.CODE
      LEFT OUTER JOIN SYS0005M P ON J.CODY_BRNCH_CODE= P.CODE
      INNER JOIN SAL0028D N ON A.CUST_CRC_ID = N.CUST_CRC_ID
      INNER JOIN SYS0026M O ON  A.ITM_STK_ID = O.STK_ID
      LEFT JOIN SYS0047M Q ON A.CRT_USER_ID = Q.USER_ID
      WHERE   A.PRE_ORD_ID = #{preOrdId}
    ]]>
  </select>

  <select id="selecteKeyInDetailAttachment" parameterType="Map" resultType="egovMap">
    <![CDATA[
      /* [com.coway.trust.biz.sales.eKeyInApi.impl.EKeyInApiMapper.selecteKeyInDetailAttachment] 20191210 - KR JAEMAJEM */
        SELECT A.ATCH_FILE_GRP_ID AS ATCH_FILE_GRP_ID
                 , B.ATCH_FILE_ID AS ATCH_FILE_ID
                 , B.ATCH_FILE_NAME AS ATCH_FILE_NAME
                 , B.FILE_SUB_PATH AS FILE_SUB_PATH
                 , B.PHYSICL_FILE_NAME AS PHYSICL_FILE_NAME
                 , B.FILE_EXTSN AS FILE_EXTSN
                 , B.FILE_KEY_SEQ AS FILE_KEY_SEQ
        FROM SYS0070M A
        INNER JOIN SYS0071D B ON  A.ATCH_FILE_ID = B.ATCH_FILE_ID
        WHERE A.ATCH_FILE_GRP_ID = #{atchFileGrpId}
    ]]>
  </select>

  <select id="selecteKeyInDetailOrderHomecare" parameterType="Map" resultType="egovMap">
    <![CDATA[
      /* [com.coway.trust.biz.sales.eKeyInApi.impl.EKeyInApiMapper.selecteKeyInDetailOrderHomecare] 20191210 - KR JAEMAJEM */
      SELECT A.MAT_PRE_ORD_ID AS MAT_PRE_ORD_ID
               , A.FRA_PRE_ORD_ID AS FRA_PRE_ORD_ID
               , A.ORD_SEQ_NO AS ORD_SEQ_NO
      FROM  HMC0011D A
      WHERE ( A.MAT_PRE_ORD_ID = #{preOrdId}
              OR A.FRA_PRE_ORD_ID = #{preOrdId}
      )
    ]]>
  </select>

  <select id="selecteKeyInDetailOrder" parameterType="Map" resultType="egovMap">
    <![CDATA[
       /* [com.coway.trust.biz.sales.eKeyInApi.impl.EKeyInApiMapper.selecteKeyInDetailOrder] 20191210 - KR JAEMAJEM */
        SELECT CASE WHEN A.APP_TYPE_ID = 5764  THEN 66 --SYS0013M : 5764(Auxiliary), 66(Rental)
                           ELSE A.APP_TYPE_ID END AS APP_TYPE_ID
                    , A.SRV_PAC_ID AS SRV_PAC_ID
                    , A.ITM_STK_ID AS ITM_STK_ID
                    , A.PROMO_ID AS PROMO_ID
                    , A.TOT_AMT AS TOT_AMT
                    , A.DISC_RNT_FEE AS MTH_RENT_AMT-- MTH_RENT_AMT -> DISC_RNT_FEE 변경
                    , A.TOT_PV AS TOT_PV
                    , REPLACE(REPLACE(A.INSTCT, CHR(10), '\n'), CHR(39), CHR(38)||CHR(35)||'39;') AS INSTCT
                    , TO_CHAR(A.REQST_DT, 'YYYYMMDD') AS REQST_DT
                    , TO_CHAR(A.PRE_DT, 'YYYY') AS YYYY
                    , TO_CHAR(A.CRT_DT, 'MM') AS MM
                    , A.EMP_CHK AS EMP_CHK
                    , A.EX_TRADE AS EX_TRADE
                    , B.TYPE_ID AS TYPE_ID
                    , A.NOR_AMT AS NOR_AMT
                    , A.PRC_ID AS PRC_ID
                    , A.TOT_PV_GST AS TOT_PV_GST
                    , A.PRE_ORD_ID AS PRE_ORD_ID
        FROM SAL0213M A
        INNER JOIN SAL0029D B ON  A.CUST_ID = B.CUST_ID
        WHERE A.PRE_ORD_ID = #{preOrdId}
    ]]>
  </select>

  <select id="selecteOrderPackType1" parameterType="Map" resultType="egovMap">
    <![CDATA[
      /* [com.coway.trust.biz.sales.eKeyInApi.impl.EKeyInApiMapper.selecteOrderPackType1] 20191210 - KR JAEMAJEM */
      SELECT A.CODE_MASTER_ID AS CODE_MASTER_ID
               , A.CODE_ID AS CODE_ID
               , A.CODE AS CODE
               , A.CODE_NAME AS CODE_NAME
               , A.CODE_DESC AS CODE_DESC
      FROM SYS0013M A
      INNER JOIN SAL0081D B ON  A.CODE = B.SRV_CNTRCT_PAC_ID
                                        AND B.PAC_TYPE = 0
      WHERE A.CODE_MASTER_ID = '367'
          AND A.DISAB = 0
      ORDER BY CODE_NAME ASC
    ]]>
  </select>

  <select id="selecteOrderPackType2" parameterType="Map" resultType="egovMap">
    <![CDATA[
      /* [com.coway.trust.biz.sales.eKeyInApi.impl.EKeyInApiMapper.selecteOrderPackType2] 20191210 - KR JAEMAJEM */
      SELECT A.CODE_MASTER_ID AS CODE_MASTER_ID
               , A.CODE_ID AS CODE_ID
               , A.CODE AS CODE
               , A.CODE_NAME AS CODE_NAME
               , A.CODE_DESC AS CODE_DESC
      FROM SYS0013M A
      INNER JOIN SAL0091M B ON A.CODE = B.SRV_MEM_PAC_ID
                                       AND B.PAC_TYPE = 0
      WHERE A.CODE_MASTER_ID = #{codeMasterId}
          AND A.DISAB = 0
      ORDER BY CODE_NAME ASC
    ]]>
  </select>

  <select id="selecteOrderProduct1" parameterType="Map" resultType="egovMap">
    <![CDATA[
      /* [com.coway.trust.biz.sales.eKeyInApi.impl.EKeyInApiMapper.selecteOrderProduct1] 20191210 - KR JAEMAJEM */
      SELECT DISTINCT A.STK_ID AS STK_ID
                             , A.STK_CODE ||' - '||A.STK_DESC AS C1
                             , CASE WHEN B.DISCONTINUE = '1' THEN C.CODE_NAME ||' ('||D.CODE_NAME||')'
                                       ELSE C.CODE_NAME END AS CODE_NAME
                             , B.DISCONTINUE AS DISCONTINUE
      FROM SYS0026M A
      INNER JOIN SAL0082D B ON  A.STK_ID = B.SRV_PAC_ITM_PRODUCT_ID
                                        AND B.SRV_PAC_ITM_STUS_ID = 1
                                        AND B.SRV_CNTRCT_PAC_ID = #{srvCntrctPacId}
      INNER JOIN SYS0013M C ON  C.CODE_MASTER_ID = 11
                                        AND A.STK_CTGRY_ID = C.CODE_ID
      INNER JOIN SYS0013M D ON  TO_CHAR(B.DISCONTINUE) = D.CODE
                                         AND D.CODE_MASTER_ID = '381'
    ]]>
    WHERE A.STK_TYPE_ID = 61
        AND A.STUS_CODE_ID = 1

    <choose>
      <when test='stkCtgryId != null and stkCtgryId != "" and stkCtgryId > 0'>
        AND EXISTS ( SELECT 1
                            FROM SYS0094M EX1
                            WHERE EX1.IND = 'HOMECARE'
                                AND C.CODE = EX1.CODE

                            <if test='stkCtgryId == 5706'>
                              AND EX1.CODE = 'MAT'
                            </if>
                            <if test='stkCtgryId == 5707'>
                              AND EX1.CODE = 'FRM'
                            </if>
        )
      </when>
      <otherwise>
        AND NOT EXISTS ( SELECT 1
                                   FROM SYS0094M EX1
                                   WHERE EX1.IND = 'HOMECARE'
                                       AND C.CODE = EX1.CODE
        )
      </otherwise>
    </choose>
    <choose>
      <when test='gu != null and gu != "" and gu.equals("MATTRESS")'>
        AND EXISTS ( SELECT 1
                            FROM SYS0026M EX1
                            WHERE EX1.STK_ID = #{itmStkId}
                                AND EX1.STK_SIZE = A.STK_SIZE
        )
      </when>
    </choose>

    ORDER BY DISCONTINUE ASC
                 , CODE_NAME ASC
                 , STK_ID ASC
  </select>

  <select id="selecteOrderProduct2" parameterType="Map" resultType="egovMap">
    <![CDATA[
       /* [com.coway.trust.biz.sales.eKeyInApi.impl.EKeyInApiMapper.selecteOrderProduct2] 20191210 - KR JAEMAJEM */
       SELECT DISTINCT A.STK_ID                                                                AS STK_ID
                              , A.STK_CODE ||' - '||A.STK_DESC                                          AS C1
                              , CASE WHEN B.DISCONTINUE = '1'   THEN C.CODE_NAME ||' ('||D.CODE_NAME||')'
                                        ELSE C.CODE_NAME END                                     AS CODE_NAME
                              , B.DISCONTINUE                                                           AS DISCONTINUE
       FROM SYS0026M A
       INNER JOIN SAL0092M B ON A.STK_ID = B.SRV_MEM_ITM_STK_ID
                                        AND B.SRV_MEM_ITM_STUS_ID = 1
                                        AND B.SRV_MEM_PAC_ID = #{srvCntrctPacId}
       INNER JOIN SYS0013M C ON A.STK_CTGRY_ID = C.CODE_ID
       INNER JOIN SYS0013M D ON TO_CHAR(B.DISCONTINUE) = D.CODE
                                        AND D.CODE_MASTER_ID = '381'
       WHERE A.STK_TYPE_ID = 61
           AND A.STUS_CODE_ID = 1
    ]]>

    <if test='stkCtgryId != null and stkCtgryId != "" and stkCtgryId > 0'>
      AND A.STK_CTGRY_ID = #{stkCtgryId}
    </if>

    ORDER BY DISCONTINUE ASC
                 , CODE_NAME ASC
                 , STK_ID ASC
  </select>

  <select id="selectPromotionByAppTypeStockESales" parameterType="Map" resultType="egovMap">
    <![CDATA[
      /* [com.coway.trust.biz.sales.eKeyInApi.impl.EKeyInApiMapper.selectPromotionByAppTypeStockESales] 20191210 - KR JAEMAJEM */
      SELECT DISTINCT B.PROMO_ID AS PROMO_ID
                             , B.PROMO_CODE || '-' || B.PROMO_DESC AS PROMO_DESC
                             , TO_CHAR(B.PROMO_DT_FROM, 'YYYYMMDD') AS PROMO_DT_FROM
      FROM SAL0018D A
      INNER JOIN SAL0017D B ON  B.PROMO_ID = A.PROMO_ID
                               AND B.PROMO_STUS_ID = 1
                               AND B.PROMO_APP_TYPE_ID IN (#{appTypeId}, DECODE(2284, 2284, 66, 2285, 67, 2286, 68, 2287, 1412, 99999), DECODE(#{appTypeId}, 2286, 2285, 99999))
                               AND B.PROMO_SRV_MEM_PAC_ID = #{srvPacId}
                               AND B.PROMO_TYPE_ID = 2282
                               AND B.PROMO_IS_TRIAL_CNVR = 0
                               AND B.EMP_CHK = #{empChk}
                               AND B.EX_TRADE = #{exTrade}
                               AND ( B.PROMO_CUST_TYPE = #{typeId}
                                   OR B.PROMO_CUST_TYPE = 0
                                   OR B.PROMO_CUST_TYPE IS NULL
                               )
    ]]>

    <if test='promoId == 0'>
      <![CDATA[
        AND TO_CHAR(B.PROMO_DT_FROM, 'YYYYMMDD') <= TO_CHAR(SYSDATE, 'YYYYMMDD')
        AND TO_CHAR(B.PROMO_DT_END,  'YYYYMMDD') >= TO_CHAR(SYSDATE, 'YYYYMMDD')
      ]]>
    </if>

    <if test='promoId != null and promoId !=0'>
      <![CDATA[
        AND TO_CHAR(B.PROMO_DT_FROM, 'YYYYMMDD') <= #{promoDt}
        AND TO_CHAR(B.PROMO_DT_END,  'YYYYMMDD') >= #{promoDt}
      ]]>
     </if>

    <![CDATA[
      WHERE A.PROMO_ITM_STK_ID = #{itmStkId}
          AND A.PROMO_ITM_STUS_ID = 1
          AND B.E_SALES IN (1,2)
    ]]>

    OR B.PROMO_ID IN (31723 <if test='promoId != null and promoId !=0'>, #{promoId}</if> )
    ORDER BY PROMO_DT_FROM DESC
  </select>

  <select id="selectPromotionByAppTypeStock" parameterType="Map" resultType="egovMap">
    <![CDATA[
      /* [com.coway.trust.biz.sales.eKeyInApi.impl.EKeyInApiMapper.selectPromotionByAppTypeStock] 20191210 - KR JAEMAJEM */
      SELECT  DISTINCT B.PROMO_ID AS PROMO_ID
                              , B.PROMO_CODE || '-' || B.PROMO_DESC AS PROMO_DESC
                              , TO_CHAR(B.PROMO_DT_FROM, 'YYYYMMDD') AS PROMO_DT_FROM
      FROM SAL0018D A
      INNER JOIN SAL0017D B ON  B.PROMO_ID = A.PROMO_ID
                                        AND B.PROMO_STUS_ID = 1
                                        AND B.PROMO_APP_TYPE_ID IN (#{appTypeId}, DECODE(#{appTypeId}, 2284, 66, 2285, 67, 2286, 68, 2287, 1412, 99999), DECODE(#{appTypeId}, 2286, 2285, 99999))
                                        AND B.PROMO_SRV_MEM_PAC_ID = #{srvPacId}
                                        AND B.PROMO_TYPE_ID = 2282
                                        AND B.PROMO_IS_TRIAL_CNVR = 0
                                        AND B.EMP_CHK = #{empChk}
                                        AND B.EX_TRADE = #{exTrade}
                                        AND ( B.PROMO_CUST_TYPE = #{typeId}
                                            OR B.PROMO_CUST_TYPE = 0
                                            OR B.PROMO_CUST_TYPE IS NULL
                                        )
    ]]>

    <if test='promoId == 0'>
      <![CDATA[
        AND TO_CHAR(B.PROMO_DT_FROM, 'YYYYMMDD') <= TO_CHAR(SYSDATE, 'YYYYMMDD')
        AND TO_CHAR(B.PROMO_DT_END,  'YYYYMMDD') >= TO_CHAR(SYSDATE, 'YYYYMMDD')
      ]]>
      </if>

      <if test='promoId != null and promoId !=0'>
        <![CDATA[
          AND TO_CHAR(B.PROMO_DT_FROM, 'YYYYMMDD') <= #{promoDt}
          AND TO_CHAR(B.PROMO_DT_END,  'YYYYMMDD') >= #{promoDt}
        ]]>
      </if>

      <![CDATA[
        WHERE A.PROMO_ITM_STK_ID = #{itmStkId}
            AND A.PROMO_ITM_STUS_ID = 1
            AND B.E_SALES IN (0,2)
            ORDER BY PROMO_DT_FROM DESC
      ]]>
  </select>

  <select id="selectAnotherContact" parameterType="Map" resultType="egovMap">
    <![CDATA[
      /* [com.coway.trust.biz.sales.eKeyInApi.impl.EKeyInApiMapper.selectAnotherContact] 20191212 - KR JAEMAJEM */
      SELECT A.CUST_CNTC_ID AS CUST_CNTC_ID
               , A.CUST_ID AS CUST_ID
               , A.NAME AS NAME
               , A.CUST_INITIAL AS CUST_INITIAL
               , A.NRIC AS NRIC
               , A.POS AS POS
               , A.TEL_M1 AS TEL_M1
               , A.TEL_M2 AS TEL_M2
               , A.TEL_O AS TEL_O
               , A.TEL_R AS TEL_R
               , A.TELF AS TELF
               , CASE WHEN TO_CHAR(A.DOB, 'DD/MM/YYYY') = '01/01/1900' THEN NULL
                         ELSE TO_CHAR(A.DOB, 'DD/MM/YYYY') END AS DOB
               , A.GENDER AS GENDER
               , A.RACE_ID AS RACE_ID
               , A.EMAIL AS EMAIL
               , A.STUS_CODE_ID AS STUS_CODE_ID
               , A.ID_OLD AS ID_OLD
               , A.DEPT AS DEPT
               , A.DCM AS DCM
               , A.EXT AS EXT
               , B.NAME AS STUS_CODE_ID_NAME
      FROM SAL0027D A
      INNER JOIN SYS0038M B ON  A.STUS_CODE_ID = B.STUS_CODE_ID
      WHERE A.CUST_ID = #{custId}
    ]]>

    <choose>
      <when test='stusCodeId != null and stusCodeId != "" and stusCodeId > 0'>
        AND A.STUS_CODE_ID = #{stusCodeId}
      </when>
      <otherwise>
        AND A.STUS_CODE_ID IN (1, 9)                                                --SYS0038M : 1(Active), 9(Main)
      </otherwise>
    </choose>

    <if test='custCntcId != null and custCntcId != "" and custCntcId > 0'>
      AND A.CUST_CNTC_ID = #{custCntcId}
    </if>

    ORDER BY A.STUS_CODE_ID DESC
                 , A.CUST_CNTC_ID ASC
  </select>

  <insert id="insertAddNewContact" parameterType="Map">
  <selectKey keyProperty="custCntcId" resultType="int" order="BEFORE">
    SELECT SAL0027D_CUST_CNTC_ID_SEQ.NEXTVAL AS custCntcId
    FROM DUAL
  </selectKey>
  <![CDATA[
    /* [com.coway.trust.biz.sales.eKeyInApi.impl.EKeyInApiMapper.insertAddNewContact] 20191212 - KR JAEMAJEM */
    INSERT INTO SAL0027D (
      CUST_CNTC_ID                                                            -- ASIS_COLUMN : CustContactID
    , CUST_ID                                                                     -- ASIS_COLUMN : CustID
    , NAME                                                                         -- ASIS_COLUMN : Name
    , CUST_INITIAL                                                             -- ASIS_COLUMN : Initial
    , NRIC                                                                          -- ASIS_COLUMN : NRIC
    , POS                                                                            -- ASIS_COLUMN : Pos
    , TEL_M1                                                                       -- ASIS_COLUMN : TelM1
    , TEL_M2                                                                       -- ASIS_COLUMN : TelM2
    , TEL_O                                                                         -- ASIS_COLUMN : TelO
    , TEL_R                                                                         -- ASIS_COLUMN : TelR
    , TELF                                                                           -- ASIS_COLUMN : TelF
    , DOB                                                                            -- ASIS_COLUMN : DOB
    , GENDER                                                                       -- ASIS_COLUMN : Gender
    , RACE_ID                                                                      -- ASIS_COLUMN : RaceID
    , EMAIL                                                                          -- ASIS_COLUMN : Email
    , STUS_CODE_ID                                                             -- ASIS_COLUMN : StatusCodeID
    , UPD_DT                                                                       -- ASIS_COLUMN : Updated
    , UPD_USER_ID                                                              -- ASIS_COLUMN : Updator
    , ID_OLD                                                                       -- ASIS_COLUMN : IDOld
    , DEPT                                                                          -- ASIS_COLUMN : Dept
    , DCM                                                                           -- ASIS_COLUMN : Dcm
    , CRT_DT                                                                      -- ASIS_COLUMN : Created
    , CRT_USER_ID                                                              -- ASIS_COLUMN : Creator
    , EXT                                                                           -- ASIS_COLUMN : Ext
    )VALUES(
      #{custCntcId}                                                            -- ASIS_COLUMN : CustContactID
    , #{custId}                                                                  -- ASIS_COLUMN : CustID
    , #{name}                                                                   -- ASIS_COLUMN : Name
    , #{custInitial}                                                             -- ASIS_COLUMN : Initial
    , NULL                                                                         -- ASIS_COLUMN : NRIC
    , NULL                                                                         -- ASIS_COLUMN : Pos
    , #{telM1}                                                                   -- ASIS_COLUMN : TelM1
    , NULL                                                                         -- ASIS_COLUMN : TelM2
    , #{telO}                                                                     -- ASIS_COLUMN : TelO
    , #{telR}                                                                      -- ASIS_COLUMN : TelR
    , #{telf}                                                                       -- ASIS_COLUMN : TelF
    , NULL                                                                          -- ASIS_COLUMN : DOB
    , #{gender}                                                                  -- ASIS_COLUMN : Gender
    , #{raceId}                                                                   -- ASIS_COLUMN : RaceID
    , #{email}                                                                    -- ASIS_COLUMN : Email
    , 1                                                                               -- ASIS_COLUMN : StatusCodeID
    , SYSDATE                                                                    -- ASIS_COLUMN : Updated
    , #{updUserId}                                                             -- ASIS_COLUMN : Updator
    , NULL                                                                         -- ASIS_COLUMN : IDOld
    , NULL                                                                         -- ASIS_COLUMN : Dept
    , NULL                                                                         -- ASIS_COLUMN : Dcm
    , SYSDATE                                                                    -- ASIS_COLUMN : Created
    , #{crtUserId}                                                              -- ASIS_COLUMN : Creator
    , #{ext}                                                                      -- ASIS_COLUMN : Ext
    )
    ]]>
  </insert>

  <select id="selectItmStkPrice" parameterType="Map" resultType="egovMap">
    <![CDATA[
      /* [com.coway.trust.biz.sales.eKeyInApi.impl.EKeyInApiMapper.selectItmStkPrice] 20191213 - KR JAEMAJEM */
      SELECT NVL(B.PRC_ID, 0) AS PRC_ID
               , NVL(B.PRC_RPF, 0) AS PRC_RPF
               , NVL(B.AMT, 0) AS AMT
               , NVL(B.PRC_PV, 0) AS PRC_PV
               , DECODE(B.APP_TYPE_ID, 66, B.AMT, 0) AS MONTHLY_RENTAL
               , NVL(B.TRADE_IN_PV, 0) AS TRADE_IN_PV
               , NVL(B.PRC_COSTING, 0) AS PRC_COSTING
      FROM SYS0026M A
      LEFT JOIN SAL0016M B ON  B.STK_ID = A.STK_ID
                                      AND B.APP_TYPE_ID = #{appTypeId}
                                      AND B.MEM_PAC_ID = #{srvPacId}
      WHERE A.STK_ID = #{itmStkId}
          AND A.STK_TYPE_ID = 61
    ]]>
  </select>

  <select id="selectPromoDesc" parameterType="int" resultType="egovMap">
    <![CDATA[
    /* [com.coway.trust.biz.sales.eKeyInApi.impl.EKeyInApiMapper.selectPromoDesc] 20191213 - KR JAEMAJEM */
      SELECT A.PROMO_DESC AS PROMO_DESC
               , A.PROMO_DISC_PERIOD_TP AS PROMO_DISC_PERIOD_TP
               , A.PROMO_DISC_PERIOD AS PROMO_DISC_PERIOD
               , A.IS_NEW AS IS_NEW
      FROM SAL0017D A
      WHERE A.PROMO_ID = #{value}
    ]]>
  </select>

  <select id="selectProductPromotionPriceByPromoStockIDNewCorp" parameterType="Map" resultType="egovMap">
    <![CDATA[
      /* [com.coway.trust.biz.sales.eKeyInApi.impl.EKeyInApiMapper.selectProductPromotionPriceByPromoStockIDNewCorp] 20191213 - KR JAEMAJEM */
      SELECT T1.PROMO_ITM_ID AS PROMO_ITM_ID
               , T1.PROMO_ID AS PROMO_ID
               , T1.PROMO_ITM_STK_ID AS PROMO_ITM_STK_ID
               , T2.STK_CODE AS STK_CODE
               , T2.STK_DESC AS STK_DESC
               , T1.PROMO_ITM_CUR_ID AS PROMO_ITM_CUR_ID
               , NVL(T1.PROMO_ITM_PRC, 0) AS PROMO_ITM_PRC
               , NVL(T4.AMT, 0) AS AMT
               , NVL(T4.PRC_RPF, 0) AS PRC_RPF
               , NVL(T4.PRC_PV, 0) AS PRC_PV
               , CASE WHEN T4.APP_TYPE_ID IN (67,68) THEN TRUNC( ( NVL(T4.AMT, 0) - DECODE(NVL(T3.PROMO_DISC_TYPE, 0), 0, NVL(T4.AMT, 0) * (NVL(T3.PROMO_PRC_PRCNT, 0) / 100), NVL(T3.PROMO_PRC_PRCNT, 0)) - NVL(T3.PROMO_ADD_DISC_PRC, 0)), -1 )
                         ELSE ( NVL(T4.AMT, 0) - DECODE(NVL(T3.PROMO_DISC_TYPE, 0), 0, NVL(T4.AMT, 0) * (NVL(T3.PROMO_PRC_PRCNT, 0) / 100), NVL(T3.PROMO_PRC_PRCNT, 0)) - NVL(T3.PROMO_ADD_DISC_PRC, 0) ) END  AS PROMO_AMT
               , NVL(T4.PRC_RPF, 0) - NVL(T3.PROMO_RPF_DISC_AMT, 0) AS PROMO_PRC_RPF
               , NVL(T1.PROMO_ITM_PV, 0) AS PROMO_ITM_PV
               , NVL(T1.PROMO_ITM_PV_GST, 0) AS PROMO_ITM_PV_GST
               , NVL(T3.PROMO_APP_TYPE_ID, 0) AS PROMO_APP_TYPE_ID
    FROM SAL0018D T1
    LEFT OUTER JOIN SYS0026M T2 ON T1.PROMO_ITM_STK_ID = T2.STK_ID
    LEFT OUTER JOIN SAL0017D T3 ON T1.PROMO_ID = T3.PROMO_ID
    LEFT OUTER JOIN SAL0016M T4 ON T4.STK_ID = T1.PROMO_ITM_STK_ID
                                               AND T4.APP_TYPE_ID = DECODE(T3.PROMO_APP_TYPE_ID, 2284, 66, 2285, 67, 2286, 68, 2287, 1412)
    WHERE T1.PROMO_ID = #{promoId}
        AND T1.PROMO_ITM_STK_ID = #{itmStkId}
        AND T4.MEM_PAC_ID = #{srvPacId}
        AND T1.PROMO_ITM_STUS_ID = 1
    ]]>
  </select>






<select id="selectProductPromotionPriceByPromoStockIDNew" parameterType="Map" resultType="egovMap">
<![CDATA[
/* [com.coway.trust.biz.sales.eKeyInApi.impl.EKeyInApiMapper.selectProductPromotionPriceByPromoStockIDNew] 20191213 - KR JAEMAJEM */
SELECT  T1.PROMO_ITM_ID                                                         AS PROMO_ITM_ID
    ,   T1.PROMO_ID                                                             AS PROMO_ID
    ,   T1.PROMO_ITM_STK_ID                                                     AS PROMO_ITM_STK_ID
    ,   T2.STK_CODE                                                             AS STK_CODE
    ,   T2.STK_DESC                                                             AS STK_DESC
    ,   T1.PROMO_ITM_CUR_ID                                                     AS PROMO_ITM_CUR_ID
    ,   NVL(T1.PROMO_ITM_PRC, 0)                                                AS PROMO_ITM_PRC
    ,   NVL(T4.AMT, 0)                                                          AS AMT
    ,   NVL(T4.PRC_RPF, 0)                                                      AS PRC_RPF
    ,   NVL(T4.PRC_PV, 0)                                                       AS PRC_PV
    ,   CASE WHEN T4.APP_TYPE_ID IN (67,68) THEN TRUNC( FLOOR( NVL(T4.AMT, 0) - DECODE(NVL(T3.PROMO_DISC_TYPE, 0), 0, NVL(T4.AMT, 0) * (NVL(T3.PROMO_PRC_PRCNT, 0) / 100), NVL(T3.PROMO_PRC_PRCNT, 0)) - NVL(T3.PROMO_ADD_DISC_PRC, 0)), -1)
                                            ELSE        FLOOR( NVL(T4.AMT, 0) - DECODE(NVL(T3.PROMO_DISC_TYPE, 0), 0, NVL(T4.AMT, 0) * (NVL(T3.PROMO_PRC_PRCNT, 0) / 100), NVL(T3.PROMO_PRC_PRCNT, 0)) - NVL(T3.PROMO_ADD_DISC_PRC, 0))
                                            END                                 AS PROMO_AMT
    ,   NVL(T4.PRC_RPF, 0) - NVL(T3.PROMO_RPF_DISC_AMT, 0)                      AS PROMO_PRC_RPF
    ,   NVL(T1.PROMO_ITM_PV, 0)                                                 AS PROMO_ITM_PV
    ,   NVL(T1.PROMO_ITM_PV_GST, 0)                                             AS PROMO_ITM_PV_GST
    ,   NVL(T3.PROMO_APP_TYPE_ID, 0)                                            AS PROMO_APP_TYPE_ID
FROM    SAL0018D T1
        LEFT OUTER JOIN SYS0026M T2
            ON  T1.PROMO_ITM_STK_ID = T2.STK_ID
        LEFT OUTER JOIN SAL0017D T3
            ON  T1.PROMO_ID = T3.PROMO_ID
        LEFT OUTER JOIN SAL0016M T4
            ON  T4.STK_ID = T1.PROMO_ITM_STK_ID
            AND T4.APP_TYPE_ID = DECODE(T3.PROMO_APP_TYPE_ID, 2284, 66, 2285, 67, 2286, 68, 2287, 1412)
WHERE   T1.PROMO_ID = #{promoId}
AND     T1.PROMO_ITM_STK_ID = #{itmStkId}
AND     T4.MEM_PAC_ID = #{srvPacId}
AND     T1.PROMO_ITM_STUS_ID = 1
]]>
</select>






<select id="selectProductPromotionPriceByPromoStockID" parameterType="Map" resultType="egovMap">
<![CDATA[
/* [com.coway.trust.biz.sales.eKeyInApi.impl.EKeyInApiMapper.selectProductPromotionPriceByPromoStockID] 20191213 - KR JAEMAJEM */
--SELECT  T1.PROMO_ITM_ID
--    ,   T1.PROMO_ID
--    ,   T1.PROMO_ITM_STK_ID
--    ,   T1.PROMO_ITM_CUR_ID
--    ,   T1.PROMO_ITM_PRC
--    ,   T1.PROMO_ITM_PV
--    ,   T1.PROMO_ITM_STUS_ID
--    ,   T1.PROMO_ITM_UPD_USER_ID
--    ,   T1.PROMO_ITM_UPD_DT
--    ,   T1.PROMO_ITM_RENTAL
--    ,   T1.PROMO_ITM_RENT_PRIOD
--    ,   T1.PROMO_ITM_OBLIG_PRIOD

SELECT  T1.PROMO_ITM_PRC
    ,   T1.PROMO_ITM_PV
    ,   T1.PROMO_ITM_RENTAL
FROM    SAL0018D T1
WHERE   T1.PROMO_ID = #{promoId}
AND     T1.PROMO_ITM_STK_ID = #{itmStkId}
AND     T1.PROMO_ITM_STUS_ID = 1
]]>
</select>

<select id="selectAnotherAddress" parameterType="Map" resultType="egovMap">
  <![CDATA[
  SELECT A.ADDR_DTL AS ADDR_DTL
           , A.STREET  AS STREET
           , B.AREA  AS AREA
           , B.CITY  AS CITY
           , B.POSTCODE  AS POSTCODE
           , B.STATE AS STATE
           , B.COUNTRY  AS COUNTRY
           , CASE WHEN C.CODE IS NOT NULL AND C.NAME IS NOT NULL THEN C.CODE ||' - '|| C.NAME ELSE NULL END  AS DSC_BRNCH
           , C.BRNCH_ID AS DSC_BRNCH_ID
           , (CASE WHEN #{userNm} LIKE 'CD%' THEN (CASE WHEN F.CODE IS NOT NULL AND F.NAME IS NOT NULL THEN F.CODE ||' - '|| F.NAME ELSE NULL END)
                      WHEN #{userNm} LIKE 'HT%' THEN (SELECT CODE ||' - '|| NAME FROM SYS0005M WHERE BRNCH_ID = '284')
                      ELSE (CASE WHEN D.CODE IS NOT NULL AND D.NAME IS NOT NULL THEN D.CODE ||' - '|| D.NAME ELSE NULL END)
              END) AS POSTING_BRNCH
           , (CASE WHEN #{userNm} LIKE 'CD%' THEN F.BRNCH_ID
                      WHEN #{userNm} LIKE 'HT%' THEN 284
                      ELSE D.BRNCH_ID END) AS POSTING_BRNCH_ID
           , CASE WHEN E.CODE IS NOT NULL AND E.NAME IS NOT NULL THEN E.CODE ||' - '|| E.NAME ELSE NULL END  AS HDC_BRNCH
           , E.BRNCH_ID  AS HDC_BRNCH_ID
           , F.NAME  AS STUS_CODE_ID_NAME
           , CASE WHEN ( A.ADDR_DTL IS NOT NULL ) THEN LTRIM(RTRIM(A.ADDR_DTL)) ELSE ''
             END ||' '||NVL(A.STREET, '') ||' '|| B.AREA ||' '|| B.POSTCODE ||' '|| B.CITY ||' '|| B.STATE ||' '|| B.COUNTRY AS FULL_ADDR
           ,   A.CUST_ADD_ID AS CUST_ADD_ID
  FROM SAL0023D A
  INNER JOIN SYS0064M B ON A.AREA_ID = B.AREA_ID
  LEFT OUTER JOIN SYS0005M C ON B.CT_BRNCH_CODE = C.CODE
  LEFT OUTER JOIN SYS0005M D ON B.SO_BRNCH_CODE= D.CODE
  LEFT OUTER JOIN SYS0005M E ON B.DT_BRNCH_CODE= E.CODE
  LEFT OUTER JOIN SYS0005M F ON B.CODY_BRNCH_CODE= F.CODE
  INNER JOIN SYS0038M F ON A.STUS_CODE_ID = F.STUS_CODE_ID
  WHERE  A.CUST_ID = #{custId}
  ]]>

  <choose>
    <when test='stusCodeId != null and stusCodeId != "" and stusCodeId > 0'>
      AND A.STUS_CODE_ID = #{stusCodeId}
    </when>
    <otherwise>
      AND A.STUS_CODE_ID IN (1, 9)
    </otherwise>
  </choose>
  <if test='custAddId != null and custAddId != "" and custAddId > 0'>
    AND     A.CUST_ADD_ID = #{custAddId}
  </if>
  ORDER BY A.STUS_CODE_ID DESC
               , A.CUST_ADD_ID DESC
</select>






<insert id="insertAddNewAddress" parameterType="Map">
<selectKey keyProperty="custAddId" resultType="int" order="BEFORE">
SELECT  SAL0023D_CUST_ADD_ID_SEQ.NEXTVAL AS custAddId
FROM    DUAL
</selectKey>
<![CDATA[
/* [com.coway.trust.biz.sales.eKeyInApi.impl.EKeyInApiMapper.insertAddNewAddress] 20191214 - KR JAEMAJEM */
INSERT
INTO    SAL0023D                                                                -- ASIS_DB : WebDB ASIS_SCHEMA : dbo ASIS_TABLE : CustAddress
(
        CUST_ADD_ID                                                             -- ASIS_COLUMN : CustAddID
    ,   CUST_ID                                                                 -- ASIS_COLUMN : CustomerID
    ,   NRIC                                                                    -- ASIS_COLUMN : NRIC
    ,   TEL                                                                     -- ASIS_COLUMN : Tel
    ,   FAX                                                                     -- ASIS_COLUMN : Fax
    ,   STUS_CODE_ID                                                            -- ASIS_COLUMN : StatusCodeID
    ,   REM                                                                     -- ASIS_COLUMN : Remark
    ,   UPD_USER_ID                                                             -- ASIS_COLUMN : Updator
    ,   UPD_DT                                                                  -- ASIS_COLUMN : Updated
    ,   ID_OLD                                                                  -- ASIS_COLUMN : IDOld
    ,   SO_ID                                                                   -- ASIS_COLUMN : SOID
    ,   IDCM                                                                    -- ASIS_COLUMN : IDcm
    ,   CRT_USER_ID                                                             -- ASIS_COLUMN : Creator
    ,   CRT_DT                                                                  -- ASIS_COLUMN : Created
    ,   AREA_ID                                                                 -- Area ID
    ,   ADDR_DTL                                                                -- Address Detail
    ,   STREET                                                                  -- Street
    ,   ADD1                                                                    -- ASIS_COLUMN : Add1
    ,   ADD2                                                                    -- ASIS_COLUMN : Add2
    ,   ADD3                                                                    -- ASIS_COLUMN : Add3
    ,   ADD4                                                                    -- ASIS_COLUMN : Add4
    ,   POSTCODEID                                                              -- Post Code ID
    ,   POSTCODE                                                                -- POSTCODE
    ,   AREAID                                                                  -- Area ID
    ,   AREA                                                                    -- ASIS_COLUMN : Area
    ,   STATEID                                                                 -- State ID
    ,   COUNTRYID                                                               -- Country Id
)VALUES(
        #{custAddId}                                                            -- ASIS_COLUMN : CustAddID
    ,   #{custId}                                                               -- ASIS_COLUMN : CustomerID
    ,   NULL                                                                    -- ASIS_COLUMN : NRIC
    ,   NULL                                                                    -- ASIS_COLUMN : Tel
    ,   NULL                                                                    -- ASIS_COLUMN : Fax
    ,   1                                                                       -- ASIS_COLUMN : StatusCodeID
    ,   #{rem}                                                                  -- ASIS_COLUMN : Remark
    ,   #{updUserId}                                                            -- ASIS_COLUMN : Updator
    ,   SYSDATE                                                                 -- ASIS_COLUMN : Updated
    ,   NULL                                                                    -- ASIS_COLUMN : IDOld
    ,   NULL                                                                    -- ASIS_COLUMN : SOID
    ,   NULL                                                                    -- ASIS_COLUMN : IDcm
    ,   #{crtUserId}                                                            -- ASIS_COLUMN : Creator
    ,   SYSDATE                                                                 -- ASIS_COLUMN : Created
    ,   #{areaId}                                                               -- Area ID
    ,   #{addrDtl}                                                              -- Address Detail
    ,   #{street}                                                               -- Street
    ,   NULL                                                                    -- ASIS_COLUMN : Add1
    ,   NULL                                                                    -- ASIS_COLUMN : Add2
    ,   NULL                                                                    -- ASIS_COLUMN : Add3
    ,   NULL                                                                    -- ASIS_COLUMN : Add4
    ,   NULL                                                                    -- Post Code ID
    ,   NULL                                                                    -- POSTCODE
    ,   NULL                                                                    -- Area ID
    ,   NULL                                                                    -- ASIS_COLUMN : Area
    ,   NULL                                                                    -- State ID
    ,   NULL                                                                    -- Country Id
)
]]>
</insert>






<select id="selectAnotherCard" parameterType="Map" resultType="egovMap">
<![CDATA[
/* [com.coway.trust.biz.sales.eKeyInApi.impl.EKeyInApiMapper.selectAnotherCard] 20191214 - KR JAEMAJEM */
SELECT  A.CUST_ORI_CRC_NO                                                       AS CUST_ORI_CRC_NO
    ,   A.CUST_CRC_TYPE_ID                                                      AS CUST_CRC_TYPE_ID
    ,   A.CUST_CRC_OWNER                                                        AS CUST_CRC_OWNER
    ,   SUBSTR(A.CUST_CRC_EXPR, 1, 2)||'/'||SUBSTR(A.CUST_CRC_EXPR, 3)          AS CUST_CRC_EXPR
    ,   A.CUST_CRC_BANK_ID                                                      AS CUST_CRC_BANK_ID
    ,   A.CARD_TYPE_ID                                                          AS CARD_TYPE_ID
    ,   B.CODE_NAME                                                             AS CARD_TYPE_ID_NAME
    ,   A.CUST_CRC_ID                                                           AS CUST_CRC_ID
FROM    SAL0028D A
        INNER JOIN SYS0013M B
            ON  B.CODE_MASTER_ID = 115
            AND A.CARD_TYPE_ID = B.CODE_ID
WHERE   A.CUST_ID = #{custId}
AND     A.CUST_CRC_STUS_ID != 8                                                 --SYS0038M : 8(Inactive)
]]>
<if test='custCrcId != null and custCrcId != "" and custCrcId > 0'>
AND     A.CUST_CRC_ID = #{custCrcId}
</if>
ORDER BY    A.CUST_CRC_STUS_ID DESC
        ,   A.CUST_CRC_ID ASC
</select>






<select id="selectParamVal" resultType="egovMap">
/* [com.coway.trust.biz.sales.eKeyInApi.impl.EKeyInApiMapper.selectAnotherCard] 20191214 - KR JAEMAJEM */
SELECT  PARAM_VAL                                                               AS PARAM_VAL
FROM    SYS0098M
WHERE   MODULE = 'GEN'
AND     SUB_MODULE = 'TKNZ'
AND     PARAM_CODE = 'TKNZ_PUB'
</select>






<select id="selectTokenID" resultType="Integer">
/* [com.coway.trust.biz.sales.eKeyInApi.impl.EKeyInApiMapper.selectTokenID] 20191215 - KR JAEMAJEM */
SELECT  SAL0257D_ID_SEQ.NEXTVAL
FROM    DUAL
</select>






<select id="selectTokenSettings" resultType="egovMap">
/* [com.coway.trust.biz.sales.eKeyInApi.impl.EKeyInApiMapper.selectTokenSettings] 20191215 - KR JAEMAJEM */
SELECT  (SELECT PARAM_VAL FROM SYS0098M WHERE MODULE = 'GEN' AND SUB_MODULE = 'TKNZ' AND PARAM_CODE = 'TKNZ_URL')           AS TKNZ_URL
    ,   (SELECT PARAM_VAL FROM SYS0098M WHERE MODULE = 'GEN' AND SUB_MODULE = 'TKNZ' AND PARAM_CODE = 'TKNZ_MERCHANT_ID')   AS TKNZ_MERCHANT_ID
    ,   (SELECT PARAM_VAL FROM SYS0098M WHERE MODULE = 'GEN' AND SUB_MODULE = 'TKNZ' AND PARAM_CODE = 'TKNZ_VERF_KEY')      AS TKNZ_VERF_KEY
FROM    DUAL
</select>






<insert id="insertSAL0257D" parameterType="Map">
/* [com.coway.trust.biz.sales.eKeyInApi.impl.EKeyInApiMapper.insertSAL0257D] 20191214 - KR JAEMAJEM */
INSERT
INTO    SAL0257D
(
        TKN_ID
    ,   REF_NO
    <if test="etyPoint == 'EE'">
    ,   CUST_CRC_ID
    </if>
    ,   BILL_NM
    ,   BIN
    ,   CCLAST4
    ,   EXP_MONTH
    ,   EXP_YEAR
    ,   TKN_TYPE
    ,   TOKEN
    ,   SIGNATURE_REQ
    ,   SIGNATURE_RES
    ,   RES_TEXT
    ,   STATUS
    ,   REMARK
    ,   CRT_DT
    ,   CRT_USER_ID
    ,   UPD_DT
    ,   UPD_USER_ID
)VALUES(
        #{tknId}
    ,   #{refNo}
    <if test="etyPoint == 'EE'">
    ,   #{custCrcId}
    </if>
    ,   #{billNm}
    ,   NULL
    ,   NULL
    ,   #{expMonth}
    ,   #{expYear}
    ,   1
    ,   NULL
    ,   #{signatureReq}
    ,   NULL
    ,   NULL
    ,   44
    ,   NULL
    ,   SYSDATE
    ,   #{crtUserId}
    ,   SYSDATE
    ,   #{updUserId}
)
</insert>






<update id="updateSAL0257D" parameterType="Map">
/* [com.coway.trust.biz.sales.eKeyInApi.impl.EKeyInApiMapper.updateSAL0257D] 20191214 - KR JAEMAJEM */
UPDATE  SAL0257D
SET     BIN = #{BIN}
    ,   CCLAST4 = #{cclast4}
    ,   TOKEN = #{token}
    ,   SIGNATURE_RES = #{signature}
    ,   RES_TEXT = #{resText}
    ,   STATUS = #{stus}
    ,   UPD_USER_ID = #{updUserId}
    ,   UPD_DT = SYSDATE
WHERE   TKN_ID = #{tknId}
</update>






<select id="selectCheckCRC1" parameterType="Map" resultType="Integer">
/* [com.coway.trust.biz.sales.eKeyInApi.impl.EKeyInApiMapper.selectCheckCRC1] 20191214 - KR JAEMAJEM */
SELECT  COUNT(1)                                                                AS CNT
FROM    SAL0028D A
        INNER JOIN
        (
            SELECT  CUST_ORI_CRC_NO
                ,   COUNT(1)
            FROM    SAL0028D
            GROUP BY CUST_ORI_CRC_NO
        ) B
        ON  A.CUST_ORI_CRC_NO = B.CUST_ORI_CRC_NO
WHERE   A.CUST_ORI_CRC_NO LIKE #{cardNo}
AND     A.CUST_CRC_TOKEN = #{token}
AND     A.CUST_ID = #{custId}
AND     A.CUST_CRC_STUS_ID = '1'
</select>






<select id="selectCheckCRC2" parameterType="Map" resultType="Integer">
/* [com.coway.trust.biz.sales.eKeyInApi.impl.EKeyInApiMapper.selectCheckCRC2] 20191214 - KR JAEMAJEM */
SELECT  COUNT(DISTINCT(NRIC))                                                   AS CNT
FROM     SAL0029D A
        INNER JOIN
        (
        SELECT  A1.CUST_ID
            ,   A1.CUST_ORI_CRC_NO
            ,   B1.CNT
        FROM    SAL0028D A1
                INNER JOIN
                (
                    SELECT  CUST_ORI_CRC_NO
                        ,   COUNT(*) CNT
                    FROM    SAL0028D
                    GROUP BY CUST_ORI_CRC_NO
                ) B1
                ON A1.CUST_ORI_CRC_NO = B1.CUST_ORI_CRC_NO
        WHERE   A1.CUST_ORI_CRC_NO LIKE #{cardNo}
        AND     A1.CUST_CRC_TOKEN = #{token}
        <if test="custId != '' and custId != null">
        AND     A1.CUST_ID = #{custId}
        </if>
        AND     A1.CUST_CRC_STUS_ID = '1'
        ) B
        ON A.CUST_ID = B.CUST_ID
<if test='step == "3" '>
WHERE   A.NRIC = #{nric}
</if>
</select>






<insert id="insertSAL0258D" parameterType="Map">
/* [com.coway.trust.biz.sales.eKeyInApi.impl.EKeyInApiMapper.insertSAL0258D] 20191214 - KR JAEMAJEM */
INSERT
INTO    SAL0258D
(
        TKN_ID
    ,   ERROR_CDE
    ,   ERROR_DESC
    ,   REMARK
    ,   CRT_DT
    ,   CRT_USER_ID
    ,   UPD_DT
    ,   UPD_USER_ID
)VALUES(
        #{tknId}
    ,   #{error_code}
    ,   #{error_desc}
    ,   #{src}
    ,   SYSDATE
    ,   #{crtUserId}
    ,   SYSDATE
    ,   #{updUserId}
)
</insert>






<insert id="insertSAL0028D" parameterType="Map">
<selectKey keyProperty="custCrcId" resultType="int" order="BEFORE">
SELECT  SAL0028D_CUST_CRC_ID_SEQ.NEXTVAL AS custCrcId
FROM    DUAL
</selectKey>
/* [com.coway.trust.biz.sales.eKeyInApi.impl.EKeyInApiMapper.insertSAL0028D] 20191216 - KR JAEMAJEM */
INSERT
INTO    SAL0028D                                                                -- ASIS_DB : WebDB ASIS_SCHEMA : dbo ASIS_TABLE : CustCRC
(
        CUST_CRC_ID                                                             -- ASIS_COLUMN : CustCRCID
    ,   CUST_ID                                                                 -- ASIS_COLUMN : CustID
    ,   CUST_CRC_NO                                                             -- ASIS_COLUMN : CustCRCNo
    ,   CUST_ORI_CRC_NO                                                         -- ASIS_COLUMN : CustOriCRCNo
    ,   CUST_ENCRYPT_CRC_NO                                                     -- ASIS_COLUMN : CustEncryptedCRCNo
    ,   CUST_CRC_OWNER                                                          -- ASIS_COLUMN : CustCRCOwner
    ,   CUST_CRC_TYPE_ID                                                        -- ASIS_COLUMN : CustCRCTypeID
    ,   CUST_CRC_BANK_ID                                                        -- ASIS_COLUMN : CustCRCBankID
    ,   CUST_CRC_STUS_ID                                                        -- ASIS_COLUMN : CustCRCStatusID
    ,   CUST_CRC_REM                                                            -- ASIS_COLUMN : CustCRCRemark
    ,   CUST_CRC_UPD_USER_ID                                                    -- ASIS_COLUMN : CustCRCUpdateBy
    ,   CUST_CRC_UPD_DT                                                         -- ASIS_COLUMN : CustCRCUpdateAt
    ,   CUST_CRC_EXPR                                                           -- ASIS_COLUMN : CustCRCExpiry
    ,   CUST_CRC_ID_OLD                                                         -- ASIS_COLUMN : CustCRCIDOld
    ,   SO_ID                                                                   -- ASIS_COLUMN : SOID
    ,   CUST_CRC_IDCM                                                           -- ASIS_COLUMN : CustCRCIDcm
    ,   CUST_CRC_CRT_USER_ID                                                    -- ASIS_COLUMN : CustCRCCreateBy
    ,   CUST_CRC_CRT_DT                                                         -- ASIS_COLUMN : CustCRCCreateAt
    ,   CARD_TYPE_ID                                                            -- ASIS_COLUMN : CardTypeID
    ,   CUST_CRC_TOKEN                                                          --
)VALUES(
        #{custCrcId}                                                            -- ASIS_COLUMN : CustCRCID
    ,   #{custId}                                                               -- ASIS_COLUMN : CustID
    ,   #{custCrcNo}                                                            -- ASIS_COLUMN : CustCRCNo
    ,   #{custOriCrcNo}                                                         -- ASIS_COLUMN : CustOriCRCNo
    ,   #{custEncryptCrcNo}                                                     -- ASIS_COLUMN : CustEncryptedCRCNo
    ,   #{custCrcOwner}                                                         -- ASIS_COLUMN : CustCRCOwner
    ,   #{custCrcTypeId}                                                        -- ASIS_COLUMN : CustCRCTypeID
    ,   #{custCrcBankId}                                                        -- ASIS_COLUMN : CustCRCBankID
    ,   #{custCrcStusId}                                                        -- ASIS_COLUMN : CustCRCStatusID
    ,   #{custCrcRem}                                                           -- ASIS_COLUMN : CustCRCRemark
    ,   #{custCrcUpdUserId}                                                     -- ASIS_COLUMN : CustCRCUpdateBy
    ,   SYSDATE                                                                 -- ASIS_COLUMN : CustCRCUpdateAt
    ,   #{custCrcExpr}                                                          -- ASIS_COLUMN : CustCRCExpiry
    ,   #{custCrcIdOld}                                                         -- ASIS_COLUMN : CustCRCIDOld
    ,   #{soId}                                                                 -- ASIS_COLUMN : SOID
    ,   #{custCrcIdcm}                                                          -- ASIS_COLUMN : CustCRCIDcm
    ,   #{custCrcCrtUserId}                                                     -- ASIS_COLUMN : CustCRCCreateBy
    ,   SYSDATE                                                                 -- ASIS_COLUMN : CustCRCCreateAt
    ,   #{cardTypeId}                                                           -- ASIS_COLUMN : CardTypeID
    ,   #{custCrcToken}                                                         --
)
</insert>






<update id="updateCustCrcIdSAL0257D" parameterType="Map">
/* [com.coway.trust.biz.sales.eKeyInApi.impl.EKeyInApiMapper.updateCustCrcIdSAL0257D] 20191216 - KR JAEMAJEM */
UPDATE  SAL0257D
SET     CUST_CRC_ID = #{custCrcId}
    ,   UPD_USER_ID = #{updUserId}
    ,   UPD_DT = SYSDATE
WHERE   TKN_ID = #{tknId}
</update>






<select id="selectCreditCardIsExisting" parameterType="Map" resultType="Integer">
/* [com.coway.trust.biz.sales.eKeyInApi.impl.EKeyInApiMapper.selectCreditCardIsExisting] 20191216 - KR JAEMAJEM */
SELECT  COUNT(1)
FROM    SAL0028D A
WHERE   CUST_ID = #{custId}
AND     CUST_ORI_CRC_NO = #{custOriCrcNo}
AND     CUST_CRC_STUS_ID != 8
</select>






<select id="selectCheckRc" parameterType="Map" resultType="egovMap">
/* [com.coway.trust.biz.sales.eKeyInApi.impl.EKeyInApiMapper.selectCheckRc] 20191216 - KR JAEMAJEM */
SELECT  B.MEM_ID                                                                AS MEM_ID
    ,   B.MEM_CODE                                                              AS MEM_CODE
    ,   A.NAME                                                                  AS NAME
    ,   B.TARGET_TOT                                                            AS TARGET_TOT
    ,   B.COLLECT_TOT                                                           AS COLLECT_TOT
    ,   B.RC_PRCT                                                               AS RC_PRCT
    ,   NVL(C.CNT, 0)                                                           AS CNT
FROM    ORG0001D A
        LEFT JOIN SAL0248M B
            ON A.MEM_CODE = B.MEM_CODE
        LEFT JOIN
        (
            SELECT  MEM_ID
                ,   COUNT(1) CNT
            FROM    SAL0001D
            WHERE   TO_CHAR(SALES_DT, 'YYYYMM') = TO_CHAR(SYSDATE, 'YYYYMM')
            GROUP BY MEM_ID
        ) C
        ON A.MEM_ID = C.MEM_ID
WHERE   B.MONTH = EXTRACT(MONTH FROM ADD_MONTHS(SYSDATE, -1))
AND     B.YEAR = EXTRACT(YEAR FROM ADD_MONTHS(SYSDATE, -1))
AND     A.MEM_CODE =    (
                            SELECT  HR_CODE
                            FROM    SYS0047M
                            WHERE   USER_ID = #{userId}
                        )
</select>






<select id="selectExistSofNo" parameterType="Map" resultType="Integer">
/* [com.coway.trust.biz.sales.eKeyInApi.impl.EKeyInApiMapper.selectExistSofNo] 20191216 - KR JAEMAJEM */
SELECT  SUM(CNT)                                                                AS CNT
FROM
(
    SELECT  COUNT(1) CNT
    FROM    SAL0213M
    WHERE   SOF_NO = #{sofNo}
    AND     STUS_ID NOT IN (10, 98)
    UNION ALL
    SELECT  COUNT(1) CNT
    FROM    SAL0001D
    WHERE   REF_NO = #{sofNo}
    AND     STUS_CODE_ID != 8
)
</select>






<select id="selectCustomerInfo" parameterType="Map" resultType="egovMap">
<![CDATA[
/* [com.coway.trust.biz.sales.eKeyInApi.impl.EKeyInApiMapper.selectCustomerInfo] 20191212 - KR JAEMAJEM */
SELECT  A.TYPE_ID                                                               AS TYPE_ID
    ,   A.NRIC                                                                  AS NRIC
    ,   C.CODE                                                                  AS INITIALS
    ,   F.CODE_NAME                                                             AS COMPANY_TYPE
    ,   CASE WHEN TO_CHAR(A.DOB, 'DD/MM/YYYY') = '01/01/1900'           THEN NULL
                                                                        ELSE TO_CHAR(A.DOB, 'DD/MM/YYYY')
                                                                        END     AS DOB
    ,   A.NAME                                                                  AS CUST_NAME
    ,   A.GENDER                                                                AS GENDER
    ,   D.CODE_DESC                                                             AS NATION
    ,   NVL2(E.CODE_ID, E.CODE_NAME, NULL)                                      AS RACE
    ,   CASE WHEN TO_CHAR(A.PAS_SPORT_EXPR, 'DD/MM/YYYY') = '01/01/1900' THEN NULL
                                                                         ELSE TO_CHAR(A.PAS_SPORT_EXPR, 'DD/MM/YYYY')
                                                                         END    AS PAS_SPORT_EXPR
    ,   CASE WHEN TO_CHAR(A.VISA_EXPR, 'DD/MM/YYYY') = '01/01/1900'      THEN NULL
                                                                         ELSE TO_CHAR(A.VISA_EXPR, 'DD/MM/YYYY')
                                                                         END    AS VISA_EXPR
    ,   A.CUST_ID                                                               AS CUST_ID
FROM    SAL0029D A                                                              -- ASIS_DB : WebDB ASIS_SCHEMA : dbo ASIS_TABLE : Customer
        LEFT OUTER JOIN SAL0027D B
            ON  A.CUST_ID = B.CUST_ID
            AND B.STUS_CODE_ID = 9
        LEFT OUTER JOIN SYS0013M C
            ON  B.CUST_INITIAL = C.CODE_ID
        LEFT OUTER JOIN SYS0013M D
            ON  A.NATION = D.CODE
            AND D.CODE_MASTER_ID = 338
            AND D.DISAB = 0
        LEFT OUTER JOIN SYS0013M E
            ON  A.RACE_ID = E.CODE_ID
            AND E.CODE_MASTER_ID = 2
            AND E.DISAB = 0
        LEFT OUTER JOIN SYS0013M F
            ON  A.CORP_TYPE_ID = F.CODE_ID
WHERE   UPPER(A.NRIC) =  UPPER(#{nric})
AND     A.TYPE_ID = #{typeId}
AND     A.STUS_CODE_ID != 8
AND ROWNUM =1
]]>
</select>





<select id="selectFileGroupKey" resultType="int">
/* [com.coway.trust.biz.sales.eKeyInApi.impl.EKeyInApiMapper.selectFileGroupKey] 20191220 - KR JAEMAJEM */
SELECT  SYS0070M_ATCH_FILE_GRP_ID_SEQ.NEXTVAL
FROM    DUAL
</select>






<insert id="insertSYS0071D" parameterType="Map">
<selectKey keyProperty="atchFileId" resultType="int" order="BEFORE">
SELECT  SYS0071D_ATCH_FILE_ID_SEQ.NEXTVAL
FROM    DUAL
</selectKey>
/* [com.coway.trust.biz.sales.eKeyInApi.impl.EKeyInApiMapper.insertSYS0071D] 20191220 - KR JAEMAJEM */
INSERT
INTO    SYS0071D                                                                --Attached File Table
(
        ATCH_FILE_ID                                                            --Attached File ID
    ,   ATCH_FILE_NAME                                                          --Attached File Name
    ,   FILE_SUB_PATH                                                           --Server Sub Path
    ,   PHYSICL_FILE_NAME                                                       --Physical File Name
    ,   FILE_EXTSN                                                              --파일확장자
    ,   FILE_SIZE                                                               --File Size
    ,   FILE_PASSWORD                                                           --파일비밀번호
    ,   FILE_UNQ_KEY                                                            --
    ,   FILE_KEY_SEQ                                                            --
)VALUES(
        #{atchFileId}                                                           --Attached File ID
    ,   #{atchFileName}                                                         --Attached File Name
    ,   #{fileSubPath}                                                          --Server Sub Path
    ,   #{physiclFileName}                                                      --Physical File Name
    ,   #{fileExtsn}                                                            --파일확장자
    ,   #{fileSize}                                                             --File Size
    ,   #{filePassword}                                                         --파일비밀번호
    ,   #{fileUnqKey}                                                           --
    ,   #{fileKeySeq}
)
</insert>






<update id="updateSYS0071D" parameterType="Map">
/* [com.coway.trust.biz.sales.eKeyInApi.impl.EKeyInApiMapper.updateSYS0071D] 20191220 - KR JAEMAJEM */
UPDATE  SYS0071D A                                                              --Attached File Table
SET     A.ATCH_FILE_NAME = #{atchFileName}                                      --Attached File Name
    ,   A.FILE_SUB_PATH = #{fileSubPath}                                        --Server Sub Path
    ,   A.PHYSICL_FILE_NAME = #{physiclFileName}                                --Physical File Name
    ,   A.FILE_EXTSN = #{fileExtsn}                                             --파일확장자
    ,   A.FILE_SIZE = #{fileSize}                                               --File Size
WHERE   A.ATCH_FILE_ID = #{atchFileId}                                          --Attached File ID
</update>






<update id="updateSYS0070M" parameterType="Map">
/* [com.coway.trust.biz.sales.eKeyInApi.impl.EKeyInApiMapper.updateSYS0070M] 20191220 - KR JAEMAJEM */
UPDATE  SYS0070M A                                                              --Attached File Group Master Table
SET     A.UPD_USER_ID = #{updUserId}                                            --Updator
    ,   A.UPD_DT = SYSDATE                                                      --Updated
WHERE   A.ATCH_FILE_GRP_ID = #{atchFileGrpId}                                   --Attached File Group ID
AND     A.ATCH_FILE_ID = #{atchFileId}                                          --Attached File ID
</update>






<delete id="deleteSYS0071D" parameterType="Map">
/* [com.coway.trust.biz.sales.eKeyInApi.impl.EKeyInApiMapper.deleteSYS0071D] 20191220 - KR JAEMAJEM */
DELETE
FROM    SYS0071D A                                                              --Attached File Table
WHERE   A.ATCH_FILE_ID = #{atchFileId}
</delete>






<delete id="deleteSYS0070M" parameterType="Map">
/* [com.coway.trust.biz.sales.eKeyInApi.impl.EKeyInApiMapper.deleteSYS0070M] 20191220 - KR JAEMAJEM */
DELETE
FROM    SYS0070M A                                                              --Attached File Group Master Table
WHERE   A.ATCH_FILE_GRP_ID = #{atchFileGrpId}                                   --Attached File Group ID
AND     A.ATCH_FILE_ID = #{atchFileId}                                          --Attached File ID
</delete>






<insert id="insertSYS0070M" parameterType="Map">
/* [com.coway.trust.biz.sales.eKeyInApi.impl.EKeyInApiMapper.insertSYS0070M] 20191220 - KR JAEMAJEM */
INSERT
INTO    SYS0070M                                                                --Attached File Group Master Table
(
        ATCH_FILE_GRP_ID                                                        --Attached File Group ID
    ,   ATCH_FILE_ID                                                            --Attached File ID
    ,   CHENAL_TYPE                                                             --Chenal(W:Web/M:Mobile/C:CallCenter)
    ,   CRT_USER_ID                                                             --Creator
    ,   CRT_DT                                                                  --Created
    ,   UPD_USER_ID                                                             --Updator
    ,   UPD_DT                                                                  --Updated
)VALUES(
        #{atchFileGrpId}                                                        --Attached File Group ID
    ,   #{atchFileId}                                                           --Attached File ID
    ,   #{chenalType}                                                           --Chenal(W:Web/M:Mobile/C:CallCenter)
    ,   #{crtUserId}                                                            --Creator
    ,   SYSDATE                                                                 --Created
    ,   #{updUserId}                                                            --Updator
    ,   SYSDATE                                                                 --Updated
)
</insert>






<insert id="insertSAL0213M" parameterType="Map">
<selectKey keyProperty="preOrdId" resultType="int" order="BEFORE">
SELECT  SAL0213M_PRE_ORD_ID_SEQ.NEXTVAL                                         AS preOrdId
FROM    DUAL
</selectKey>
/* [com.coway.trust.biz.sales.eKeyInApi.impl.EKeyInApiMapper.insertSAL0213M] 20191217 - KR JAEMAJEM */
INSERT
INTO    SAL0213M                                                                --Pre-Order_table
(
        PRE_ORD_ID                                                              --Pre Order ID
    ,   REQST_DT                                                                --Request Date
    ,   CHNNL                                                                   --Channel
    ,   STUS_ID                                                                 --Status ID
    ,   SOF_NO                                                                  --SOF Number
    ,   CUST_PO_NO                                                              --Cust Po NUmber
    ,   APP_TYPE_ID                                                             --App Type ID
    ,   SRV_PAC_ID                                                              --Srv Pac ID
    ,   INST_PRIOD                                                              --Transaction ID
    ,   CUST_ID                                                                 --Customer ID
    ,   EMP_CHK                                                                 --userId
    ,   GST_CHK                                                                 --salesOrderNo
    ,   EURC_CUST_RGS_NO                                                        --customerId
    ,   ATCH_FILE_GRP_ID                                                        --Atache File Group ID
    ,   CUST_CNTC_ID                                                            --defectCodeId
    ,   KEYIN_BRNCH_ID                                                          --defectCodeId
    ,   INST_ADD_ID                                                             --resultRemark
    ,   DSC_BRNCH_ID                                                            --Dsc Branch ID
    ,   PRE_DT                                                                  --Pre Date
    ,   PRE_TM                                                                  --Pre Time
    ,   INSTCT                                                                  --Instruction
    ,   EX_TRADE                                                                --EX Trade
    ,   ITM_STK_ID                                                              --Item Stock ID
    ,   PROMO_ID                                                                --Prome ID
    ,   MTH_RENT_AMT                                                            --Update Date
    ,   PROMO_DISC_PERIOD_TP                                                    --Promo DISC Period TP
    ,   PROMO_DISC_PERIOD                                                       --Promo DISC Period
    ,   TOT_AMT                                                                 --Total Amount
    ,   NOR_AMT                                                                 --Nor Amount Date
    ,   NOR_RNT_FEE                                                             --Nor Rent Fee
    ,   DISC_RNT_FEE                                                            --Disc Rent Fee
    ,   TOT_PV                                                                  --Total Pv
    ,   TOT_PV_GST                                                              --Total Pv Gst
    ,   PRC_ID                                                                  --Prc ID
    ,   MEM_CODE                                                                --Member Code
    ,   ADV_BILL                                                                --Advance Bill
    ,   CUST_CRC_ID                                                             --resultRemark
    ,   BANK_ID                                                                 --Bank ID
    ,   CUST_ACC_ID                                                             --Customer Acc ID
    ,   IS_3RD_PARTY                                                            --IS 3RD Party
    ,   RENT_PAY_CUST_ID                                                        --Rental Pay Customer Id
    ,   RENT_PAY_MODE_ID                                                        --Rental Pay Mode Id
    ,   CUST_BILL_ID                                                            --CustBillID
    ,   CUST_BILL_CUST_ID                                                       --Customer Bill Cust ID
    ,   CUST_BILL_CNT_ID                                                        --Customer Bill Count ID
    ,   CUST_BILL_ADD_ID                                                        --Customer Bill Add ID
    ,   CUST_BILL_REM                                                           --Customer Bill Remark
    ,   CUST_BILL_EMAIL                                                         --Customer Bill Email
    ,   CUST_BILL_IS_SMS                                                        --Customer Bill Is SMS
    ,   CUST_BILL_IS_POST                                                       --Customer Bill Is Post
    ,   CUST_BILL_EMAIL_ADD                                                     --Customer Bill Email Add
    ,   CUST_BILL_IS_WEB_PORTAL                                                 --Customer Bill IS Web Portal
    ,   CUST_BILL_WEB_PORTAL_URL                                                --Customer Bill Web Portal URL
    ,   CUST_BILL_IS_SMS2                                                       --Customer Bill Is SMS2
    ,   CUST_BILL_CUST_CARE_CNT_ID                                              --Customer Bill Cust Care Count ID
    ,   REM1                                                                    --Remark1
    ,   REM2                                                                    --Remark2
    ,   CRT_USER_ID                                                             --Create User ID
    ,   CRT_DT                                                                  --Create Date
    ,   UPD_USER_ID                                                             --Update User ID
    ,   UPD_DT                                                                  --Update Date
    ,   SALES_ORD_ID                                                            --
    ,   ON_HOLD                                                                 --
    ,   CPNT_ID                                                                 --
    ,   CORP_CUST_TYPE                                                          --
    ,   AGREEMENT_TYPE                                                          --
    ,   BNDL_ID                                                                 --Homecare Order seq
)VALUES(
        #{preOrdId}                                                             --Pre Order ID
    ,   SYSDATE                                                                 --Request Date
    ,   #{chnnl}                                                                --Channel
    ,   #{stusId}                                                               --Status ID
    ,   #{sofNo}                                                                --SOF Number
    ,   #{custPoNo}                                                             --Cust Po NUmber
    ,   #{appTypeId}                                                            --App Type ID
    ,   #{srvPacId}                                                             --Srv Pac ID
    ,   #{instPriod}                                                            --Transaction ID
    ,   #{custId}                                                               --Customer ID
    ,   #{empChk}                                                               --userId
    ,   #{gstChk}                                                               --salesOrderNo
    ,   #{eurcCustRgsNo}                                                        --customerId
    ,   #{atchFileGrpId}                                                        --Atache File Group ID
    ,   #{custCntcId}                                                           --defectCodeId
    ,   #{keyinBrnchId}                                                         --defectCodeId
    ,   #{instAddId}                                                            --resultRemark
    ,   #{dscBrnchId}                                                           --Dsc Branch ID
    ,   SYSDATE + 1                                                             --Pre Date
    ,   #{preTm}                                                                --Pre Time
    ,   #{instct}                                                               --Instruction
    ,   #{exTrade}                                                              --EX Trade
    ,   #{itmStkId}                                                             --Item Stock ID
    ,   #{promoId}                                                              --Prome ID
    ,   #{mthRentAmt}                                                           --Update Date
    ,   #{promoDiscPeriodTp}                                                    --Promo DISC Period TP
    ,   #{promoDiscPeriod}                                                      --Promo DISC Period
    ,   #{totAmt}                                                               --Total Amount
    ,   #{norAmt}                                                               --Nor Amount Date
    ,   #{norRntFee}                                                            --Nor Rent Fee
    ,   #{discRntFee}                                                           --Disc Rent Fee
    ,   #{totPv}                                                                --Total Pv
    ,   #{totPvGst}                                                             --Total Pv Gst
    ,   #{prcId}                                                                --Prc ID
    ,   #{memCode}                                                              --Member Code
    ,   #{advBill}                                                              --Advance Bill
    ,   #{custCrcId}                                                            --resultRemark
    ,   #{bankId}                                                               --Bank ID
    ,   #{custAccId}                                                            --Customer Acc ID
    ,   #{is3rdParty}                                                           --IS 3RD Party
    ,   #{rentPayCustId}                                                        --Rental Pay Customer Id
    ,   #{rentPayModeId}                                                        --Rental Pay Mode Id
    ,   #{custBillId}                                                           --CustBillID
    ,   #{custBillCustId}                                                       --Customer Bill Cust ID
    ,   #{custBillCntId}                                                        --Customer Bill Count ID
    ,   #{custBillAddId}                                                        --Customer Bill Add ID
    ,   #{custBillRem}                                                          --Customer Bill Remark
    ,   #{custBillEmail}                                                        --Customer Bill Email
    ,   #{custBillIsSms}                                                        --Customer Bill Is SMS
    ,   #{custBillIsPost}                                                       --Customer Bill Is Post
    ,   #{custBillEmailAdd}                                                     --Customer Bill Email Add
    ,   #{custBillIsWebPortal}                                                  --Customer Bill IS Web Portal
    ,   #{custBillWebPortalUrl}                                                 --Customer Bill Web Portal URL
    ,   #{custBillIsSms2}                                                       --Customer Bill Is SMS2
    ,   #{custBillCustCareCntId}                                                --Customer Bill Cust Care Count ID
    ,   #{rem1}                                                                 --Remark1
    ,   #{rem2}                                                                 --Remark2
    ,   #{crtUserId}                                                            --Create User ID
    ,   SYSDATE                                                                 --Create Date
    ,   #{updUserId}                                                            --Update User ID
    ,   SYSDATE                                                                 --Update Date
    ,   #{salesOrdId}                                                           --
    ,   #{onHold}                                                               --
    ,   #{cpntId}                                                               --
    ,   #{corpCustType}                                                         --
    ,   #{agreementType}                                                        --
    ,   #{bndlId}                                                               --Homecare Order seq
)
</insert>






<insert id="insertHMC0011D" parameterType="Map">
<selectKey keyProperty="ordSeqNo" resultType="int" order="BEFORE">
SELECT  HMC0011D_SEQ.NEXTVAL                                                    AS ordSeqNo
FROM    DUAL
</selectKey>
/* [com.coway.trust.biz.sales.eKeyInApi.impl.EKeyInApiMapper.insertHMC0011D] 20191218 - KR JAEMAJEM */
INSERT
INTO    HMC0011D                                                                --HomeCare Order No
(
        ORD_SEQ_NO                                                              --HC ORD Sequence
    ,   CUST_ID                                                                 --Customer ID
    ,   SALES_DT                                                                --Sales date
    ,   MAT_ORD_NO                                                              --Mattress Order No
    ,   FRA_ORD_NO                                                              --Frame Order No
    ,   CRT_DT                                                                  --Create Date
    ,   CRT_USER_ID                                                             --Create User Id
    ,   UPD_DT                                                                  --Update Date
    ,   UPD_USER_ID                                                             --Update User Id
    ,   MAT_PRE_ORD_ID                                                          --eKeyin Mat ord_id
    ,   FRA_PRE_ORD_ID                                                          --eKeyin Fra Ord_id
    ,   STUS_ID                                                                 --eKeyin Status id
    ,   BNDL_NO                                                                 --BNDL_NO
    ,   SRV_ORD_ID                                                              --SAL0225D SRV_ORD_ID
)VALUES(
        #{ordSeqNo}                                                             --HC ORD Sequence
    ,   #{custId}                                                               --Customer ID
    ,   SYSDATE                                                                 --Sales date
    ,   null                                                                    --Mattress Order No
    ,   null                                                                    --Frame Order No
    ,   SYSDATE                                                                 --Create Date
    ,   #{crtUserId}                                                            --Create User Id
    ,   SYSDATE                                                                 --Update Date
    ,   #{updUserId}                                                            --Update User Id
    ,   #{matPreOrdId}                                                          --eKeyin Mat ord_id
    ,   #{fraPreOrdId}                                                          --eKeyin Fra Ord_id
    ,   1                                                                       --eKeyin Status id
    ,   'SB'||LPAD(#{ordSeqNo}, 8, '0')                                         --BNDL_NO
    ,   NULL                                                                    --SAL0225D SRV_ORD_ID
)
</insert>






<update id="updateBndlIdSAL0213M" parameterType="Map">
/* [com.coway.trust.biz.sales.eKeyInApi.impl.EKeyInApiMapper.updateBndlIdSAL0213M] 20191220 - KR JAEMAJEM */
UPDATE  SAL0213M A                                                              -- Homecare Order seq
SET     A.BNDL_ID = #{bndlId}                                                   -- Status ID
WHERE   A.PRE_ORD_ID = #{preOrdId}                                              -- Pre Order ID
AND     A.BNDL_ID IS NULL
</update>






<update id="updateSAL0213M" parameterType="Map">
/* [com.coway.trust.biz.sales.eKeyInApi.impl.EKeyInApiMapper.updateSAL0213M] 20191220 - KR JAEMAJEM */
UPDATE  SAL0213M A                                                              --Pre-Order_table
SET     A.STUS_ID = CASE    WHEN A.STUS_ID = 1  THEN 1                          --1(Active)
                            WHEN A.STUS_ID = 21 THEN 104                        --21(Failed) 104(Processing)
                                                ELSE 1                          --1(Active)
                                                END
    ,   A.SRV_PAC_ID = #{srvPacId}                                              -- Srv Pac ID
    ,   A.CUST_CNTC_ID = #{custCntcId}                                          -- defectCodeId
    ,   A.KEYIN_BRNCH_ID = #{keyinBrnchId}                                      -- defectCodeId
    ,   A.INST_ADD_ID = #{instAddId}                                            -- resultRemark
    ,   A.DSC_BRNCH_ID = #{dscBrnchId}                                          -- Dsc Branch ID
    ,   A.INSTCT = #{instct}                                                    -- Instruction
    ,   A.ITM_STK_ID = #{itmStkId}                                              -- Item Stock ID
    ,   A.PROMO_ID = #{promoId}                                                 -- Prome ID
    ,   A.MTH_RENT_AMT = #{mthRentAmt}                                          -- Update Date
    ,   A.TOT_AMT = #{totAmt}                                                   -- Total Amount
    ,   A.NOR_AMT = #{norAmt}                                                   -- Nor Amount Date
    ,   A.DISC_RNT_FEE = #{discRntFee}                                          -- Disc Rent Fee
    ,   A.TOT_PV = #{totPv}                                                     -- Total Pv
    ,   A.TOT_PV_GST = #{totPvGst}                                              -- Total Pv Gst
    ,   A.PRC_ID = #{prcId}                                                     -- Prc ID
    ,   A.MEM_CODE = #{memCode}                                                 -- Member Code
    ,   A.CUST_CRC_ID = #{custCrcId}                                            -- resultRemark
    ,   A.BANK_ID = #{bankId}                                                   -- Bank ID
    ,   A.RENT_PAY_MODE_ID = #{rentPayModeId}                                   -- Rental Pay Mode Id
    ,   A.CUST_BILL_CNT_ID = #{custBillCntId}                                   -- Customer Bill Count ID
    ,   A.CUST_BILL_ADD_ID = #{custBillAddId}                                   -- Customer Bill Add ID
    ,   A.CUST_BILL_EMAIL = #{custBillEmail}                                    -- Customer Bill Email
    ,   A.UPD_USER_ID = #{updUserId}                                            -- Update User ID
    ,   A.UPD_DT = SYSDATE                                                      -- Update Date
WHERE   A.PRE_ORD_ID = #{preOrdId}                                              -- Pre Order ID
AND     A.STUS_ID IN (1, 21)                                                    -- SYS0038M : 1(ACT), 21(FAL)
</update>






<update id="updateHMC0011D" parameterType="Map">
/* [com.coway.trust.biz.sales.eKeyInApi.impl.EKeyInApiMapper.updateHMC0011D] 20191221 - KR JAEMAJEM */
UPDATE  HMC0011D A                                                              --HomeCare Order No
SET     A.UPD_DT = SYSDATE                                                      --Update Date
    ,   A.UPD_USER_ID = #{updUserId}                                            --Update User Id
    ,   A.STUS_ID = #{stusId}                                                   --eKeyin Status id
WHERE   A.ORD_SEQ_NO = #{ordSeqNo}                                              --HC ORD Sequence
AND     A.STUS_ID IN (1, 21)                                                    -- SYS0038M : 1(ACT), 21(FAL)
</update>






<update id="cancelSAL0213M" parameterType="Map">
/* [com.coway.trust.biz.sales.eKeyInApi.impl.EKeyInApiMapper.cancelSAL0213M] 20191221 - KR JAEMAJEM */
UPDATE  SAL0213M A                                                              --Pre-Order_table
SET     A.STUS_ID = 10                                                          -- Status ID-SYS0038M : 10(Cancelled)
    ,   A.UPD_USER_ID = #{updUserId}                                            -- Update User ID
    ,   A.UPD_DT = SYSDATE                                                      -- Update Date
WHERE   A.PRE_ORD_ID = #{preOrdId}                                              -- Pre Order ID
AND     A.STUS_ID IN (1, 21)                                                    -- SYS0038M : 1(ACT), 21(FAL)
</update>






<update id="cancelHMC0011D" parameterType="Map">
/* [com.coway.trust.biz.sales.eKeyInApi.impl.EKeyInApiMapper.cancelHMC0011D] 20191221 - KR JAEMAJEM */
UPDATE  HMC0011D A                                                              --HomeCare Order No
SET     A.UPD_DT = SYSDATE                                                      --Update Date
    ,   A.UPD_USER_ID = #{updUserId}                                            --Update User Id
    ,   A.STUS_ID = 10                                                          --Status ID-SYS0038M : 10(Cancelled)
WHERE   A.ORD_SEQ_NO = #{ordSeqNo}                                              --HC ORD Sequence
AND     A.STUS_ID IN (1, 21)                                                    -- SYS0038M : 1(ACT), 21(FAL)
</update>






<select id="selectAttachmentImgFile" parameterType="Map" resultType="egovMap">
<![CDATA[
/* [com.coway.trust.biz.sales.eKeyInApi.impl.EKeyInApiMapper.selectAttachmentImgFile] 20191227 - KR JAEMAJEM */
SELECT  A.ATCH_FILE_ID                                                          AS ATCH_FILE_ID
    ,   A.ATCH_FILE_NAME                                                        AS ATCH_FILE_NAME
    ,   A.FILE_SUB_PATH                                                         AS FILE_SUB_PATH
    ,   A.PHYSICL_FILE_NAME                                                     AS PHYSICL_FILE_NAME
FROM    SYS0071D A                                                              --Attached File Table
WHERE   A.ATCH_FILE_ID = #{atchFileId}                                          --Attached File ID
]]>
</select>
</mapper>