<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.coway.trust.biz.sales.mambership.impl.MembershipRentalQuotationMapper">

    
    <select id="quotationList" parameterType="Map" resultType="egovMap">
			      
					SELECT S.QOTAT_ID   ,
						       S.QOTAT_REF_NO   ,
						       S.SALES_ORD_NO   ,
						       S.NAME   ,
						       S.QOTAT_VAL_ID_DT   ,
						       S.SRV_CNTRCT_PAC_DESC   ,
						       S.QOTAT_CNTRCT_DUR   ,
						       S.QOTAT_CRT_DT   ,
						       S.USER_NAME   ,
						       S.C1   ,
						       S.C2   
					FROM ( SELECT E1.QOTAT_ID   ,
						                E1.QOTAT_REF_NO   ,
						                E1.QOTAT_CNTRCT_DUR   ,
						                E1.QOTAT_VAL_ID_DT   ,
						                E1.QOTAT_CRT_DT   ,
						                E2.SRV_CNTRCT_PAC_DESC   ,
						                E3.SALES_ORD_NO   ,
						                E4.NAME   ,
						                E5.USER_NAME   ,
						                CASE     WHEN ( E1.QOTAT_VAL_ID_DT <![CDATA[<]]>  to_date( SYSDATE )) THEN 82
						                            WHEN ( 4 = E1.QOTAT_STUS_ID ) THEN 81
						                            ELSE E1.QOTAT_STUS_ID
						                END C1  ,
						                CASE 
							                     WHEN ( E1.QOTAT_VAL_ID_DT <![CDATA[<]]>   to_date(SYSDATE ) ) THEN 'EXP'
							                     WHEN ( 4 = E1.QOTAT_STUS_ID ) THEN 'CON'
							                     WHEN ( 1 = E1.QOTAT_STUS_ID ) THEN 'ACT'
							                     WHEN ( 8 = E1.QOTAT_STUS_ID ) THEN 'DEA'
							                     ELSE ''
						                END C2  
						         FROM SAL0083D E1
						                JOIN SAL0081D E2   ON E2.SRV_CNTRCT_PAC_ID = E1.QOTAT_PCKG_ID
						                JOIN SAL0001D E3   ON E3.SALES_ORD_ID = E1.QOTAT_ORD_ID
						                JOIN SAL0029D E4   ON E4.CUST_ID = E3.CUST_ID
						                JOIN SYS0047M E5   ON E5.USER_ID = E1.QOTAT_CRT_USER_ID
						          WHERE 1=1
						          
						            <if test="QUOT_NO != null and QUOT_NO != ''">
                                              AND ( E1.QOTAT_REF_NO = #{QUOT_NO} )
                                    </if>
                                    
                                    <if test="ORD_NO != null and ORD_NO != ''">
                                               AND ( E3.SALES_ORD_NO = #{ORD_NO } )
                                    </if>    
                                    
                                    <if test="CRT_USER_ID != null and CRT_USER_ID != ''">
                                                  AND ( E5.USER_NAME = #{CRT_USER_ID} )
                                    </if>       
						            
						            
						            <if test="CRT_SDT != null and CRT_SDT != ''">
                                                 AND ( E1.QOTAT_CRT_DT <![CDATA[>=]]>   to_date(#{CRT_SDT} ,'dd/mm/yyyy' ) )
                                    </if>   
                                    
                                    <if test="CRT_EDT != null and CRT_EDT != ''">
                                                 AND ( E1.QOTAT_CRT_DT <![CDATA[<=]]>   to_date(#{CRT_EDT} ,'dd/mm/yyyy' ) )
                                    </if>   
                                    
                                    
                                    <if test="STUS_ID != null and  STUS_ID != ''">
                                                        AND E1.QOTAT_VAL_ID_DT <![CDATA[<]]>  to_date(SYSDATE)
                                                        AND  E1.QOTAT_STUS_ID IN
                                                    <foreach item="item" collection="STUS_ID" index="index" open="(" separator="," close=")">
                                                       #{item}
                                                    </foreach>
                                    </if>
						              
						        ) S
						  ORDER BY S.QOTAT_ID  DESC




					
											
		      
		 </select>
		 
		 <select id="newConfirm" parameterType="Map" resultType="egovMap">
					 SELECT S.SALES_ORD_ID   ,
							       S.SALES_ORD_NO   ,
							       S.REF_NO   ,
							       S.SALES_DT   ,
							       S.CUST_ID   ,
							       S.CUST_CNT_ID   ,
							       S.CUST_ADD_ID   ,
							       S.MEM_ID   ,
							       S.BRNCH_ID   ,
							       S.APP_TYPE_ID   ,
							      -- S.DSCNT_AMT   ,
							     --  S.TAX_AMT   ,
							       S.TOT_AMT   ,
							       S.PROMO_ID   ,
							       S.BINDING_NO   ,
							       S.CC_PROMO_ID   ,
							       S.TOT_PV   ,
							       S.REM   ,
							       S.PV_MONTH   ,
							       S.PV_YEAR   ,
							       S.STUS_CODE_ID   ,
							       S.UPD_DT   ,
							       S.UPD_USER_ID   ,
							       S.SYNC_CHK   ,
							       S.CUST_PO_NO   ,
							       S.REN_CHK_ID   ,
							       S.INST_PRIOD   ,
							       S.DO_NO   ,
							       S.DEPT_CODE   ,
							       S.GRP_CODE   ,
							       S.ORG_CODE   ,
							       S.SALES_ORD_ID_OLD   ,
							       S.EDIT_TYPE_ID   ,
							       S.CUST_BILL_ID   ,
							       S.MTH_RENT_AMT   ,
							       S.LOK   ,
							       S.AEON_STUS_ID   ,
							       S.COMM_DT   ,
							       S.CRT_USER_ID   ,
							       S.CRT_DT   ,
							       S.PAY_COM_DT   ,
							       S.DEF_RENT_AMT   ,
							       S.REF_DOC_ID   ,
							       --S.RENT_PROMO_ID   ,
							       S.SALES_HM_ID   ,
							       S.SALES_SM_ID   ,
							       S.SALES_GM_ID   ,
							       S.ADV_BILL   ,
							       S.CNVR_SCHEME_ID   ,
							       S.CUST_CARE_CNT_ID   
							  FROM ( SELECT E.SALES_ORD_ID   ,
							                E.SALES_ORD_NO   ,
							                E.REF_NO   ,
							                E.SALES_DT   ,
							                E.CUST_ID   ,
							                E.CUST_CNT_ID   ,
							                E.CUST_ADD_ID   ,
							                E.MEM_ID   ,
							                E.BRNCH_ID   ,
							                E.APP_TYPE_ID   ,
							                --E.DSCNT_AMT   ,
							                --E.TAX_AMT   ,
							                E.TOT_AMT   ,
							                E.PROMO_ID   ,
							                E.BINDING_NO   ,
							                E.CC_PROMO_ID   ,
							                E.TOT_PV   ,
							                E.REM   ,
							                E.PV_MONTH   ,
							                E.PV_YEAR   ,
							                E.STUS_CODE_ID   ,
							                E.UPD_DT   ,
							                E.UPD_USER_ID   ,
							                E.SYNC_CHK   ,
							                E.CUST_PO_NO   ,
							                E.REN_CHK_ID   ,
							                E.INST_PRIOD   ,
							                E.DO_NO   ,
							                E.DEPT_CODE   ,
							                E.GRP_CODE   ,
							                E.ORG_CODE   ,
							                E.SALES_ORD_ID_OLD   ,
							                E.EDIT_TYPE_ID   ,
							                E.CUST_BILL_ID   ,
							                E.MTH_RENT_AMT   ,
							                E.LOK    ,
							                E.AEON_STUS_ID   ,
							                E.COMM_DT   ,
							                E.CRT_USER_ID   ,
							                E.CRT_DT   ,
							                E.PAY_COM_DT   ,
							                E.DEF_RENT_AMT   ,
							                E.REF_DOC_ID   ,
							                E.SALES_HM_ID   ,
							                E.SALES_SM_ID   ,
							                E.SALES_GM_ID   ,
							                E.ADV_BILL   ,
							                E.CNVR_SCHEME_ID   ,
							                E.CUST_CARE_CNT_ID   
							         FROM SAL0001D E
							                JOIN SAL0002D Extent2   ON Extent2.SALES_ORD_ID = E.SALES_ORD_ID
							          WHERE  ( E.SALES_ORD_NO = #{ORD_NO} )
							                   AND ( 4 = E.STUS_CODE_ID ) AND ROWNUM <![CDATA[<=]]>   1 ) S
					 
		 </select>
		 
		 
		  <select id="newOListuotationList" parameterType="Map" resultType="egovMap">
				
				select SRV_FILTER_ID,
				       SRV_FILTER_STK_ID,
				       STK_CODE,
				       STK_DESC,
				       C2,
				       C3,
				       SRV_FILTER_STUS_ID,
				       SRV_FILTER_PRV_CHG_DT,
				       SRV_FILTER_PRIOD,
				       CODE,
				       C5,
				       C6,
				       expireDateInt,
				       todayDateInt,
				       MONTHS_BETWEEN( to_date( todayDateInt||'01','yyyymmdd') ,to_date(expireDateInt||'01','yyyymmdd')) expInt
				 from (      
				 SELECT R.C1   ,
				                                   R.SRV_FILTER_ID   ,
				                                   R.SRV_FILTER_STK_ID   ,
				                                   R.STK_CODE   ,
				                                   R.STK_DESC   ,
				                                   R.C2   ,
				                                   R.C3   ,
				                                   R.SRV_FILTER_STUS_ID   ,
				                                   to_char(R.SRV_FILTER_PRV_CHG_DT  ,'dd-mm-yyyy') SRV_FILTER_PRV_CHG_DT ,
				                                   R.SRV_FILTER_PRIOD   ,
				                                   R.C4   CODE ,
				                                   R.C5   ,
				                                   R.C6,
				                                   to_char(add_months(R.SRV_FILTER_PRV_CHG_DT ,12),'yyyymm' ) expireDateInt,
				                                   to_char(add_months(sysdate ,12),'yyyymm' ) todayDateInt
				                              FROM ( SELECT DISTINCT a87d.SRV_FILTER_ID   ,
				                                                     a87d.SRV_FILTER_STK_ID   ,
				                                                     a87d.SRV_FILTER_PRIOD   ,
				                                                     a87d.SRV_FILTER_PRV_CHG_DT   ,
				                                                     a87d.SRV_FILTER_STUS_ID   ,
				                                                     a26m.STK_CODE   ,
				                                                     a26m.STK_DESC   ,
				                                                     1 C1  ,
				                                                     CASE   WHEN ( a87d.SRV_FILTER_UPD_DT IS NOT NULL ) THEN       a87d.SRV_FILTER_UPD_DT    END C2  ,
				                                                     CASE   WHEN ( s47M.USER_NAME IS NOT NULL ) THEN s47M.USER_NAME      ELSE ' - '    END C3  ,
				                                                     CASE   WHEN ( s13m.CODE IS NOT NULL ) THEN s13m.CODE   ELSE  ' - '     END C4  ,
				                                                     UTILS.CONVERT_TO_NUMBER(0,1,0) C5  ,
				                                                     0 C6
				                                             FROM SAL0090D s90d
				                                                    JOIN SAL0002D s02d   ON s90d.SRV_SO_ID = s02d.SALES_ORD_ID
				                                                    JOIN SAL0087D a87d   ON s90d.SRV_CONFIG_ID = a87d.SRV_CONFIG_ID
				                                                    JOIN SYS0026M a26m   ON a87d.SRV_FILTER_STK_ID = a26m.STK_ID
				                                                    LEFT JOIN SYS0047M  s47M   ON a87d.SRV_FILTER_UPD_USER_ID = s47M. USER_ID
				                                                    LEFT JOIN LOG0001M sl01m   ON ( a87d.SRV_FILTER_STK_ID = sl01m.BOM_PART_ID )
				                                                      AND ( ( s02d.ITM_STK_ID = sl01m.BOM_STK_ID )   OR ( ( s02d.ITM_STK_ID IS NULL ) AND ( sl01m.BOM_STK_ID IS NULL ) ) )
				                                                    LEFT JOIN SYS0013M s13m   ON sl01m.BOM_PART_TYPE_ID = s13m.CODE_ID
				                                      WHERE  ( 1 = s90d.SRV_STUS_ID )
				                                               AND ( 1 = a87d.SRV_FILTER_STUS_ID )
				                                               AND ( s90d.SRV_SO_ID =#{ORD_ID})
				                               ) R
				                         )sel
         </select>
		 
		 <select id="newGetExpDate" parameterType="Map" resultType="egovMap">
					select 
			                   MONTHS_BETWEEN( to_date( #{TO_YYYYMM} ||'01','yyyymmdd') ,to_date(#{EX_YYYYMM}  ||'01','yyyymmdd')) expInt
			        from dual
		 </select>
		 
		 
         <select id="getSrvMemCode" parameterType="Map" resultType="egovMap">
         
					         /* Formatted on 2017-10-11 오후 2:44:03 (QP5 v5.115.810.9015) */
					  SELECT   SRV_CNTRCT_PAC_ID code_Id , SRV_CNTRCT_PAC_DESC code_Name
					    FROM   SAL0081D
					   WHERE   SRV_CNTRCT_PAC_STUS_ID = 1
					ORDER BY   SRV_CNTRCT_PAC_DESC DESC
					

         </select>
    
    
    
         <select id="mPackageInfo" parameterType="Map" resultType="egovMap">
                   SELECT S.SRV_CNTRCT_PAC_ID   ,
					       S.SRV_PAC_ITM_PRODUCT_ID   ,
					       UTILS.CONVERT_TO_NUMBER(S.SRV_PAC_ITM_SVC_FREQ,10,0) C1  ,
					       S.SRV_CNTRCT_PAC_DUR   ,
					       S.SRV_PAC_ITM_RENTAL   ,
					       S.SRV_PAC_ITM_PV   
					  FROM ( SELECT Extent1.SRV_CNTRCT_PAC_ID SRV_CNTRCT_PAC_ID  ,
					                Extent1.SRV_CNTRCT_PAC_DUR SRV_CNTRCT_PAC_DUR  ,
					                Extent2.SRV_PAC_ITM_PRODUCT_ID SRV_PAC_ITM_PRODUCT_ID  ,
					                Extent2.SRV_PAC_ITM_SVC_FREQ SRV_PAC_ITM_SVC_FREQ  ,
					                Extent2.SRV_PAC_ITM_RENTAL SRV_PAC_ITM_RENTAL  ,
					                Extent2.SRV_PAC_ITM_PV SRV_PAC_ITM_PV  
					         FROM SAL0081D Extent1
					                JOIN SAL0082D Extent2   ON ( Extent2.SRV_CNTRCT_PAC_ID = Extent1.SRV_CNTRCT_PAC_ID )
					                AND ( Extent2.SRV_PAC_ITM_PRODUCT_ID = #{stockId} )
					          WHERE  Extent1.SRV_CNTRCT_PAC_ID =#{packId}  
					       <![CDATA[    AND ROWNUM <= 1     ]]>
					) S
         </select>
         
         
         <select id="getPromotionCode" parameterType="Map" resultType="egovMap">
                   <![CDATA[
									SELECT V.PROMO_ID   code_Id  ,
										       V.PROMO_CODE   ,
										       V.PROMO_CODE||'-'||V.PROMO_DESC  code_Name
									  FROM ( SELECT E.PROMO_ID   ,
									                E.PROMO_CODE   ,
									                E.PROMO_DESC   
									         FROM SAL0017D E
									          WHERE  ( 1330 = E.PROMO_TYPE_ID )
									                   AND ( 1 = E.PROMO_STUS_ID )
									                   AND ( E.PROMO_DT_FROM <= sysdate )
									                   AND ( E.PROMO_DT_END >= sysdate ) ) V
	                      ]]>
         </select>
         
          <select id="getFilterPromotionCode" parameterType="Map" resultType="egovMap">
                   <![CDATA[
                                    SELECT V.PROMO_ID   code_Id  ,
                                               V.PROMO_CODE   ,
                                               V.PROMO_DESC    code_Name
                                      FROM ( SELECT E.PROMO_ID   ,
                                                    E.PROMO_CODE   ,
                                                    E.PROMO_DESC   
                                             FROM SAL0017D E
                                              WHERE  ( 0 = E.PROMO_TYPE_ID )
                                                       AND ( 1 = E.PROMO_STUS_ID )
                                                       AND ( E.PROMO_DT_FROM <= sysdate )
                                                       AND ( E.PROMO_DT_END >= sysdate ) ) V
                          ]]>
         </select>
         
         
         <select id="getPromoPricePercent" parameterType="Map" resultType="egovMap">
					         SELECT S.PROMO_ID   ,
								       S.PROMO_CODE   ,
								       S.PROMO_DESC   ,
								       S.PROMO_PRC_PRCNT   
					  FROM SAL0017D S
					 WHERE  S.PROMO_ID = #{PROMO_ID}
                        AND ROWNUM   <![CDATA[<]]>= 1
         </select>
                  
       <resultMap id="mFCMap" type="egovMap" ></resultMap>
    
    <select id="getFilterCharge"  statementType="CALLABLE"   parameterType="Map">
       <![CDATA[ 
            {
                  call SP_GET_ORD_MBRSH_FILTER_CHRG ( #{ORD_ID} ,  #{PROMO_ID} ,#{p1, mode=OUT, jdbcType=CURSOR, javaType=ResultSet, resultMap=mFCMap})
            }
         ]]>
      </select>   
      
      
      
        <select id="getOrderCurrentBillMonth" parameterType="Map" resultType="egovMap">
    
			    SELECT * 
			      FROM ( SELECT S.SALES_ORD_ID   ,
			                            S.RENT_INST_NO   ,
						                TO_CHAR(S.RENT_INST_DT,'yyyymmdd')   RENT_INST_DT,
						                S.RENT_INST_TYPE_ID   ,
						                S.RENT_INST_AMT   ,
						                S.RENT_INST_INSERT_MONTH   ,
						                S.RENT_INST_INSERT_YEAR   ,
						                S.RENT_INST_ID,   
						                TO_CHAR(SYSDATE,'yyyymm')||'01' NOW_DATE 
			      FROM ( SELECT R.SALES_ORD_ID   ,
			                    R.RENT_INST_NO   ,
			                    R.RENT_INST_DT   ,
			                    R.RENT_INST_TYPE_ID   ,
			                    R.RENT_INST_AMT   ,
			                    R.RENT_INST_INSERT_MONTH  ,
			                    R.RENT_INST_INSERT_YEAR   ,
			                    R.RENT_INST_ID   
			             FROM SAL0070D R
			              WHERE  R.SALES_ORD_ID = ${ORD_ID}
			              <if test="RENT_INST_DT != null and RENT_INST_DT != ''">   
                              AND   RENT_INST_DT =  SYSDATE
                          </if>
			              
			              ) S
			      ORDER BY S.RENT_INST_NO DESC )
			      WHERE ROWNUM <![CDATA[<]]>= 1
      </select>
      
         
    <select id="getSAL0093D_SEQ" parameterType="Map" resultType="egovMap">
                 <![CDATA[     
                          SELECT SAL0095D_SRV_MEM_ID_SEQ.NEXTVAL  SEQ  FROM DUAL 
                 ]]>
    </select>
    
        
    <insert id="insertQuotationInfo" parameterType="Map"   >
			    
			    INSERT INTO SAL0093D (SRV_MEM_QUOT_ID ,
			                                      SRV_SALES_ORD_ID,             
							                      SRV_MEM_QUOT_NO,              
							                      SRV_MEM_PAC_ID,               
							                      SRV_MEM_PAC_NET_AMT,          
							                      SRV_MEM_PAC_TXS,              
							                      SRV_MEM_PAC_AMT,              
							                      SRV_MEM_BS_NET_AMT,           
							                      SRV_MEM_BS_TXS,               
							                      SRV_MEM_BS_AMT,               
							                      SRV_MEM_PV,                   
							                      SRV_DUR,                      
							                      SRV_REM,                      
							                      SRV_QUOT_VAL_ID,                  
							                      SRV_CRT_DT,                       
							                      SRV_CRT_USER_ID,              
							                      SRV_QUOT_STUS_ID,             
							                      SRV_UPD_USER_ID,              
							                      SRV_UPD_DT,                   
							                      SRV_MEM_BS12_AMT,                 
							                      SRV_QUOT_CUST_CNT_ID,         
							                      SRV_MEM_QTY,                  
							                      SRV_PROMO_ID,                 
							                      SRV_SALES_MEM_ID,             
							                      SRV_MEM_ID,                   
							                      SRV_ORD_STK_ID,               
							                      SRV_FREQ,                     
							                      SRV_PAC_PROMO_ID,
							                      EMP_CHK)             
			  VALUES   (             #{SAL0093D_SEQ},
			                               #{srvSalesOrderId},
								            FN_GET_DOCNO(20) ,
								            #{srvMemPacId},
								            #{srvMemPacNetAmt},
								            #{srvMemPacTaxes},
								            #{srvMemPacAmt},
								            #{srvMemBSNetAmt},
								            #{srvMemBSTaxes},
								            #{srvMemBSAmt},
								            #{srvMemPv},
								            #{srvDuration},
								            #{srvRemark},
								            LAST_DAY(sysdate),
								            sysdate,
								            #{srvCreateBy},
								            #{srvQuotStatusId},
								            #{srvCreateBy},
								            sysdate,
								            #{srvMemBS12Amt},
								            #{srvQuotCustCntId},
								            #{srvMemQty},
								            #{srvPromoId},
								            #{srvSalesMemId},
								            #{srvMemId},
								            #{srvOrderStkId},
								            #{srvFreq},
								            #{srvPacPromoId} ,
								            #{empChk}
			            )
            
         </insert>   
         
         
     <insert id="insertSrvMembershipQuot_Filter" parameterType="Map"  >    
         
			INSERT INTO SAL0094D (SRV_MEM_QUOT_FILTER_ID,
						                      SRV_MEM_QUOT_ID,
						                      STK_ID,
						                      STK_PRIOD,
						                      STK_LAST_CHNG_DT,
						                      STK_FILTER_PRC,
						                      STK_NET_AMT,
						                      STK_TXS,
						                      STK_CHRG_PRC)
			  VALUES   (SAL0094D_SRV_MEM_QUOT_FILTER.NEXTVAL,
				            #{srvmemquotfilterid} ,
                            #{stkid},
                            #{stkperiod},
                            #{stklastchangedate},
                            #{stkfilterprice},
                            #{stknetamt},
                            #{stktaxes},
                            #{stkchargeprice}
			           )
			            
							            
     </insert>   
         
   <resultMap id="mOTSTND_INFO" type="egovMap" ></resultMap>
   
    <select id="getOderOutsInfo"  statementType="CALLABLE"   parameterType="Map">
       <![CDATA[  
            {
                  call SP_GET_ORD_OTSTND_INFO ( #{ORD_ID} , #{p1, mode=OUT, jdbcType=CURSOR, javaType=ResultSet, resultMap=mOTSTND_INFO})
            }
         ]]>
      </select>   
      
      
      
       <select id="mActiveQuoOrder" parameterType="Map" resultType="egovMap">
                 <![CDATA[     
                      SELECT S.QOTAT_ID   ,
							       S.QOTAT_REF_NO   ,
							       S.QOTAT_ORD_ID   ,
							       S.QOTAT_REM   ,
							       S.QOTAT_STUS_ID   ,
							       S.QOTAT_PAC_PROMO_ID   ,
							       S.QOTAT_FIL_PROMO_ID   ,
							       S.QOTAT_PCKG_ID   ,
							       S.QOTAT_PRODUCT_ID   ,
							       S.QOTAT_RENTAL_AMT   ,
							       S.QOTAT_EXP_FILTER_AMT   ,
							       S.QOTAT_CNTRCT_DUR   ,
							       S.QOTAT_CNTRCT_FREQ   ,
							       S.QOTAT_VAL_ID_DT   ,
							       S.QOTAT_SALESMAN_ID   ,
							       S.QOTAT_CRT_DT   ,
							       S.QOTAT_CRT_USER_ID   ,
							       S.QOTAT_GST_RATE   ,
							       S.QOTAT_GST_TAX_CODE_ID   
							  FROM ( SELECT E.QOTAT_ID   ,
							                E.QOTAT_REF_NO   ,
							                E.QOTAT_ORD_ID   ,
							                E.QOTAT_REM   ,
							                E.QOTAT_STUS_ID   ,
							                E.QOTAT_PAC_PROMO_ID   ,
							                E.QOTAT_FIL_PROMO_ID   ,
							                E.QOTAT_PCKG_ID   ,
							                E.QOTAT_PRODUCT_ID   ,
							                E.QOTAT_RENTAL_AMT   ,
							                E.QOTAT_EXP_FILTER_AMT   ,
							                E.QOTAT_CNTRCT_DUR   ,
							                E.QOTAT_CNTRCT_FREQ   ,
							                E.QOTAT_VAL_ID_DT   ,
							                E.QOTAT_SALESMAN_ID   ,
							                E.QOTAT_CRT_DT   ,
							                E.QOTAT_CRT_USER_ID   ,
							                E.QOTAT_GST_RATE   ,
							                E.QOTAT_GST_TAX_CODE_ID   
							         FROM SAL0083D E
							                JOIN SAL0001D Extent2   ON ( Extent2.SALES_ORD_ID = E.QOTAT_ORD_ID )
							                AND ( Extent2.SALES_ORD_NO =  #{ORD_NO})
							          WHERE  ( 1 = E.QOTAT_STUS_ID )
							                   AND ( E.QOTAT_VAL_ID_DT >= TO_DATE(SYSDATE)) AND ROWNUM <= 1 ) S
							                      
                 ]]>
      </select>
      
    <select id="selectSrchMembershipQuotationPop" parameterType="Map" resultType="egovMap">
        SELECT
            a.SRV_MEM_QUOT_ID,
            TO_CHAR(SRV_MEM_QUOT_ID) AS SRV_MEM_QUOT_ID_TXT, /* 중복방지용 CHAR 형 */
            a.SRV_MEM_QUOT_NO,
            a.SRV_MEM_PAC_AMT,
            a.SRV_MEM_BS_AMT,
            NVL(a.SRV_MEM_PAC_AMT,0) + NVL(a.SRV_MEM_BS_AMT,0) AS TOTAL_AMT,
            a.SRV_DUR,
            a.SRV_QUOT_VAL_ID,
            a.SRV_FREQ,
            c.SALES_ORD_ID,
            c.SALES_ORD_NO,
            c.CUST_ID,
            g.NAME AS CUST_NAME,
            c.APP_TYPE_ID,
            e.STK_DESC,
            f.SRV_MEM_PAC_ID,
            f.SRV_MEM_DESC 
        FROM
            SAL0093D a 
            LEFT JOIN PAY0024D b ON a.SRV_MEM_QUOT_ID = b.SRV_MEM_QOTAT_ID 
            LEFT JOIN SAL0001D c ON a.SRV_SALES_ORD_ID = c.SALES_ORD_ID 
            LEFT JOIN SAL0002D d ON c.SALES_ORD_ID = d.SALES_ORD_ID 
            LEFT JOIN SYS0026M e ON d.ITM_STK_ID = e.STK_ID 
            LEFT JOIN SAL0091M f ON a.SRV_MEM_PAC_ID = f.SRV_MEM_PAC_ID
            JOIN SAL0029D g ON c.CUST_ID = g.CUST_ID 
        WHERE 
            a.SRV_QUOT_STUS_ID = 1 
            AND b.SRV_MEM_LG_ID IS NULL 
            AND a.SRV_QUOT_VAL_ID <![CDATA[<=]]> TRUNC(SYSDATE)
            <if test="orderNo != null and orderNo != ''">
            AND c.SALES_ORD_NO = #{orderNo}
            </if>
            <if test="membershipType != null and membershipType != ''">
            AND f.SRV_MEM_PAC_ID = #{membershipType}
            </if>
            <if test="quotationNo != null and quotationNo != ''">
            AND a.SRV_MEM_QUOT_NO = #{quotationNo}
            </if>
            <if test="quotationDur != null and quotationDur != ''">
            AND a.SRV_DUR = #{quotationDur}
            </if>
            <if test="customerId != null and customerId != ''">
            AND c.CUST_ID = #{customerId}
            </if>
            <if test="customerNm != null and customerNm != ''">
            AND g.NAME = #{customerNm}
            </if>
            <if test="nric != null and nric != ''">
            AND g.NRIC = #{nric}
            </if>
            <if test="appType != null and appType != ''">
            AND c.APP_TYPE_ID = #{appType}
            </if>            
        ORDER BY c.SALES_ORD_NO ASC
    </select>
    
   <select id="selCheckExpService" parameterType="Map" resultType="egovMap">
                <![CDATA[     
					    SELECT * 
								  FROM ( SELECT S.SRV_PRD_ID   ,
								                S.SRV_CONFIG_ID   ,
								                S.SRV_MBRSH_ID   ,
								                S.SRV_PRD_START_DT   ,
								                S.SRV_PRD_EXPR_DT   ,
								                S.SRV_PRD_DUR   ,
								                S.SRV_PRD_STUS_ID   ,
								                S.SRV_PRD_REM   ,
								                S.SRV_PRD_CRT_DT   ,
								                S.SRV_PRD_CRT_USER_ID   ,
								                S.SRV_PRD_UPD_DT   ,
								                S.SRV_PRD_UPD_USER_ID   ,
								                S.SRV_PRD_CNTRCT_ID   ,
												tO_char(S.SRV_PRD_EXPR_DT,'yyyy' )  EXPR_YYYY  ,
								                tO_char(S.SRV_PRD_EXPR_DT,'mm' )  EXPR_mm ,
								                tO_char(sysdate,'yyyy' )  now_YYYY  ,
								                tO_char(sysdate,'mm' )  now_mm 
								  FROM ( SELECT E.SRV_PRD_ID   , 
								                E.SRV_CONFIG_ID   ,
								                E.SRV_MBRSH_ID   ,
								                E.SRV_PRD_START_DT   ,
								                E.SRV_PRD_EXPR_DT   ,
								                E.SRV_PRD_DUR   ,
								                E.SRV_PRD_STUS_ID   ,
								                E.SRV_PRD_REM   ,
								                E.SRV_PRD_CRT_DT   ,
								                E.SRV_PRD_CRT_USER_ID   ,
								                E.SRV_PRD_UPD_DT   ,
								                E.SRV_PRD_UPD_USER_ID   ,
								                E.SRV_PRD_CNTRCT_ID   
								         FROM SAL0090D Extent1
								                LEFT JOIN SAL0088D E   ON ( E.SRV_CONFIG_ID = Extent1.SRV_CONFIG_ID )
								                AND ( 1 = E.SRV_PRD_STUS_ID )
								          WHERE  ( Extent1.SRV_SO_ID =#{ORD_ID}  )
								                   AND ( 1 = Extent1.SRV_STUS_ID ) ) S
								  ORDER BY S.SRV_PRD_ID DESC )
								  WHERE ROWNUM <= 1
			 ]]>    
   </select>
      
</mapper>