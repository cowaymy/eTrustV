<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.coway.trust.biz.sales.mambership.impl.MembershipQuotationMapper">

    
    <select id="quotationList" parameterType="Map" resultType="egovMap">
			      
					SELECT R.QUOT_ID   ,
						       R.QTY_FILTER_CHRG   ,
						       R.QUOT_NO   ,
						       R.PAC_ID   ,
						       R.PAC_CODE   ,
						       R.PAC_DESC   ,
						       R.ORD_ID   ,
						       R.ORD_NO   ,
						       R.PAC_AMT   ,
						       R.FILTER_AMT   ,
						       R.TOT_AMT   ,
						       R.DUR DUR  ,
						       R.REM REM  ,
						       R.VALID_DT   ,
						       R.CRT_DT   ,
						       R.CRT_USER_ID   ,
						       R.QUOT_STUS_ID   ,
						       R.QUOT_STUS_CODE   ,
						       R.UPD_DT   ,
						       R.UPD_USER_ID   ,
						       R.CNT_ID   ,
						       R.CNT_NAME   ,
						       R.CNT_NRIC   ,
						       R.CNT_TEL_MOB   ,
						       R.CNT_TEL_OFF   ,
						       R.CNT_TEL_FAX   ,
						       R.CNT_TEL_RES   ,
						       R.CNT_EMAIL   ,
						       R.CNT_GENDER   ,
						       R.CNT_RACE   ,
						       R.PAC_PROMO_ID   ,
						       R.PAC_PROMO_CODE   ,
						       R.PAC_PROMO_DESC   ,
						       R.PROMO_ID   ,
						       R.PROMO_CODE   ,
						       R.PROMO_DESC   ,
						       R.BS_FREQ   ,
						       R.MEM_ID   ,
						       R.MEM_CODE   ,
						       R.MEM_NAME   ,
						       R.VALID_STUS   ,
						       R.VALID_STUS_ID   ,
						       R.CNVR_MEM_ID   ,
						       R.CNVR_MEM_NO   ,
						       R.STK_ID   ,
						       R.STK_CODE   ,
						       R.STK_DESC   ,
						       R.CUST_NAME   ,
						       R.CUST_IC   ,
						       R.TOT_CNT   ,
						       R.REF_NO REF_NO  
						  FROM ( SELECT sL.QUOT_ID   ,
						                sL.QTY_FILTER_CHRG   ,
						                sL.QUOT_NO   ,
						                sL.PAC_ID   ,
						                sL.PAC_CODE   ,
						                sL.PAC_DESC   ,
						                sL.ORD_ID   ,
						                sL.ORD_NO   ,
						                sL.PAC_AMT   ,
						                sL.FILTER_AMT   ,
						                sL.TOT_AMT   ,
						                sL.DUR DUR  ,
						                sL.REM REM  ,
						                sL.VALID_DT   ,
						                sL.CRT_DT   ,
						                sL.CRT_USER_ID   ,
						                sL.QUOT_STUS_ID   ,
						                sL.QUOT_STUS_CODE   ,
						                sL.UPD_DT   ,
						                sL.UPD_USER_ID   ,
						                sL.CNT_ID   ,
						                sL.CNT_NAME   ,
						                sL.CNT_NRIC   ,
						                sL.CNT_TEL_MOB   ,
						                sL.CNT_TEL_OFF   ,
						                sL.CNT_TEL_FAX   ,
						                sL.CNT_TEL_RES   ,
						                sL.CNT_EMAIL   ,
						                sL.CNT_GENDER   ,
						                sL.CNT_RACE   ,
						                sL.PAC_PROMO_ID   ,
						                sL.PAC_PROMO_CODE   ,
						                sL.PAC_PROMO_DESC   ,
						                sL.PROMO_ID   ,
						                sL.PROMO_CODE   ,
						                sL.PROMO_DESC   ,
						                sL.BS_FREQ   ,
						                sL.MEM_ID   ,
						                sL.MEM_CODE   ,
						                sL.MEM_NAME   ,
						                sL.VALID_STUS   ,
						                sL.VALID_STUS_ID   ,
						                sL.CNVR_MEM_ID   ,
						                sL.CNVR_MEM_NO   ,
						                sL.STK_ID   ,
						                sL.STK_CODE   ,
						                sL.STK_DESC   ,
						                sL.CUST_NAME   ,
						                sL.CUST_IC   ,
						                sL.TOT_CNT   ,
						                sL.REF_NO   
						         FROM ( SELECT V.QUOT_ID   ,
								                       V.QTY_FILTER_CHRG   ,
								                       V.QUOT_NO   ,
								                       V.PAC_ID   ,
								                       V.PAC_CODE   ,
								                       V.PAC_DESC   ,
								                       V.ORD_ID   ,
								                       V.ORD_NO   ,
								                       V.PAC_AMT   ,
								                       V.FILTER_AMT   ,
								                       V.TOT_AMT   ,
								                       V.DUR DUR  ,
								                       V.REM REM  ,
								                       V.VALID_DT   ,
								                       V.CRT_DT   ,
								                       V.CRT_USER_ID   ,
								                       V.QUOT_STUS_ID   ,
								                       V.QUOT_STUS_CODE   ,
								                       V.UPD_DT   ,
								                       V.UPD_USER_ID   ,
								                       V.CNT_ID   ,
								                       V.CNT_NAME   ,
								                       V.CNT_NRIC   ,
								                       V.CNT_TEL_MOB   ,
								                       V.CNT_TEL_OFF   ,
								                       V.CNT_TEL_FAX   ,
								                       V.CNT_TEL_RES   ,
								                       V.CNT_EMAIL   ,
								                       V.CNT_GENDER   ,
								                       V.CNT_RACE   ,
								                       V.PAC_PROMO_ID   ,
								                       V.PAC_PROMO_CODE   ,
								                       V.PAC_PROMO_DESC   ,
								                       V.PROMO_ID   ,
								                       V.PROMO_CODE   ,
								                       V.PROMO_DESC   ,
								                       V.BS_FREQ   ,
								                       V.MEM_ID   ,
								                       V.MEM_CODE   ,
								                       V.MEM_NAME   ,
								                       V.VALID_STUS   ,
								                       V.VALID_STUS_ID   ,
								                       V.CNVR_MEM_ID   ,
								                       V.CNVR_MEM_NO   ,
								                       V.STK_ID   ,
								                       V.STK_CODE   ,
								                       V.STK_DESC   ,
								                       V.CUST_NAME   ,
								                       V.CUST_IC   ,
								                       V.TOT_CNT   ,
								                       V.REF_NO   
						                FROM SAL1005V V ) sL
						          WHERE  1=1
						          
								            <if test="QUOT_NO != null and QUOT_NO != ''">
					                             AND  sL.QUOT_NO = #{QUOT_NO}
					                        </if>
					                        
			                                <if test="L_ORD_NO != null and L_ORD_NO != ''">
                                                  AND sL.ORD_NO   = #{L_ORD_NO}
                                            </if>
			                                 
			                                 <if test="CRT_SDT != null and CRT_SDT != ''">
                                                 AND sL.CRT_DT<![CDATA[>=]]> tO_date( #{CRT_SDT} , 'dd-mm-yyyy')
                                            </if>
						                  
						                    <if test="CRT_EDT != null and CRT_EDT != ''">
                                                 AND sL.CRT_DT<![CDATA[>=]]> tO_date( #{CRT_EDT} , 'dd-mm-yyyy')
                                            </if>
                                            
						                    <if test="CRT_USER_ID != null and CRT_USER_ID != ''">
                                                 AND sL.CRT_USER_ID = #{CRT_USER_ID}
                                            </if>
                                            
							                <if test="VALID_STUS_ID != null and VALID_STUS_ID != ''">
							                         
					                                    AND  sL.VALID_STUS_ID IN
						                            <foreach item="item" collection="VALID_STUS_ID" index="index" open="(" separator="," close=")">
						                               #{item}
						                            </foreach>
					                        </if>
						                 ) R
						  ORDER BY R.QUOT_ID ASC
											
		      
		 </select>
		 
		 
		  <select id="newOListuotationList" parameterType="Map" resultType="egovMap">
				
				select SRV_FILTER_ID,
				       SRV_FILTER_STK_ID,
				       STK_CODE,
				       STK_DESC,
				       C2,
				       C3,
				       SRV_FILTER_STUS_ID,
				       SRV_FILTER_PRV_CHG_DT,
				       SRV_FILTER_PRIOD,
				       CODE,
				       C5,
				       C6,
				       expireDateInt,
				       todayDateInt,
				       MONTHS_BETWEEN( to_date( todayDateInt||'01','yyyymmdd') ,to_date(expireDateInt||'01','yyyymmdd')) expInt
				 from (      
				 SELECT R.C1   ,
				                                   R.SRV_FILTER_ID   ,
				                                   R.SRV_FILTER_STK_ID   ,
				                                   R.STK_CODE   ,
				                                   R.STK_DESC   ,
				                                   R.C2   ,
				                                   R.C3   ,
				                                   R.SRV_FILTER_STUS_ID   ,
				                                   to_char(R.SRV_FILTER_PRV_CHG_DT  ,'dd-mm-yyyy') SRV_FILTER_PRV_CHG_DT ,
				                                   R.SRV_FILTER_PRIOD   ,
				                                   R.C4   CODE ,
				                                   R.C5   ,
				                                   R.C6,
				                                   to_char(add_months(R.SRV_FILTER_PRV_CHG_DT ,12),'yyyymm' ) expireDateInt,
				                                   to_char(add_months(sysdate ,12),'yyyymm' ) todayDateInt
				                              FROM ( SELECT DISTINCT a87d.SRV_FILTER_ID   ,
				                                                     a87d.SRV_FILTER_STK_ID   ,
				                                                     a87d.SRV_FILTER_PRIOD   ,
				                                                     a87d.SRV_FILTER_PRV_CHG_DT   ,
				                                                     a87d.SRV_FILTER_STUS_ID   ,
				                                                     a26m.STK_CODE   ,
				                                                     a26m.STK_DESC   ,
				                                                     1 C1  ,
				                                                     CASE   WHEN ( a87d.SRV_FILTER_UPD_DT IS NOT NULL ) THEN       a87d.SRV_FILTER_UPD_DT    END C2  ,
				                                                     CASE   WHEN ( s47M.USER_NAME IS NOT NULL ) THEN s47M.USER_NAME      ELSE ' - '    END C3  ,
				                                                     CASE   WHEN ( s13m.CODE IS NOT NULL ) THEN s13m.CODE   ELSE  ' - '     END C4  ,
				                                                     UTILS.CONVERT_TO_NUMBER(0,1,0) C5  ,
				                                                     0 C6
				                                             FROM SAL0090D s90d
				                                                    JOIN SAL0002D s02d   ON s90d.SRV_SO_ID = s02d.SALES_ORD_ID
				                                                    JOIN SAL0087D a87d   ON s90d.SRV_CONFIG_ID = a87d.SRV_CONFIG_ID
				                                                    JOIN SYS0026M a26m   ON a87d.SRV_FILTER_STK_ID = a26m.STK_ID
				                                                    LEFT JOIN SYS0047M  s47M   ON a87d.SRV_FILTER_UPD_USER_ID = s47M. USER_ID
				                                                    LEFT JOIN LOG0001M sl01m   ON ( a87d.SRV_FILTER_STK_ID = sl01m.BOM_PART_ID )
				                                                      AND ( ( s02d.ITM_STK_ID = sl01m.BOM_STK_ID )   OR ( ( s02d.ITM_STK_ID IS NULL ) AND ( sl01m.BOM_STK_ID IS NULL ) ) )
				                                                    LEFT JOIN SYS0013M s13m   ON sl01m.BOM_PART_TYPE_ID = s13m.CODE_ID
				                                      WHERE  ( 1 = s90d.SRV_STUS_ID )
				                                               AND ( 1 = a87d.SRV_FILTER_STUS_ID )
				                                               AND ( s90d.SRV_SO_ID =#{ORD_ID})
				                               ) R
				                         )sel
         </select>
		 
		 <select id="newGetExpDate" parameterType="Map" resultType="egovMap">
					select 
			                   MONTHS_BETWEEN( to_date( #{TO_YYYYMM} ||'01','yyyymmdd') ,to_date(#{EX_YYYYMM}  ||'01','yyyymmdd')) expInt
			        from dual
		 </select>
		 
		 
         <select id="getSrvMemCode" parameterType="Map" resultType="egovMap">
                    SELECT C.SRV_MEM_PAC_ID   code_Id,   
                           C.SRV_MEM_DESC    code_Name 
                    FROM SAL0002D A , 
                                  SAL0092M B , 
                                  SAL0091M C
                    WHERE  1=1 
                    AND   A.ITM_STK_ID =B.SRV_MEM_ITM_STK_ID 
                    AND   B.SRV_MEM_PAC_ID =C.SRV_MEM_PAC_ID
                    AND   B.SRV_MEM_ITM_STUS_ID = '1'
                    AND   C.SRV_MEM_STUS_ID  =1
                    AND   C.PAC_TYPE = '1'
                    AND   A.SALES_ORD_ID =#{SALES_ORD_ID}
                    ORDER BY C. SRV_MEM_CODE ASC
                    
         </select>
    
    
    
         <select id="mPackageInfo" parameterType="Map" resultType="egovMap">
                   <![CDATA[
						SELECT   S.SRV_MEM_PAC_ID,
							         S.SRV_MEM_ITM_STK_ID,
							         S.SRV_MEM_ITM_PRIOD,
							         CASE WHEN (S.SRV_MEM_DUR IS NOT NULL) THEN S.SRV_MEM_DUR ELSE 0 END
						             C1,
							         S.SRV_MEM_ITM_PRC,
							         S.SRV_MEM_ITM_PV
						  FROM   (SELECT   V.SRV_MEM_PAC_ID,
								                   V.SRV_MEM_DUR,
								                   M.SRV_MEM_ITM_STK_ID,
								                   M.SRV_MEM_ITM_PRC,
								                   M.SRV_MEM_ITM_PV,
								                   M.SRV_MEM_ITM_PRIOD
						            FROM      SAL0091M V
						                   JOIN     SAL0092M M    ON     (V.SRV_MEM_PAC_ID = M.SRV_MEM_PAC_ID)
						                   AND (1 = M.SRV_MEM_ITM_STUS_ID)
						                   AND ( #{STOCK_ID} = M.SRV_MEM_ITM_STK_ID)
						           WHERE   V.SRV_MEM_PAC_ID = #{SELPACKAGE_ID}  AND ROWNUM <= 1) S
		              ]]>
         </select>
         
         
         <select id="getPromotionCode" parameterType="Map" resultType="egovMap">
                   <![CDATA[
																                                          
							SELECT distinct A.PROMO_ID   code_Id ,
							       A.PROMO_CODE||'-'||A.PROMO_DESC  code_Name,
							       A.PROMO_DISC_TYPE, 
							       A.PROMO_RPF_DISC_AMT
							    FROM SAL0017D A ,
							         SAL0018D B ,
							         SAL0002D C, 
							         SAL0001D D, 
							         SAL0029D  E
							WHERE 1=1
							    AND A.PROMO_ID = B.PROMO_ID             
							    AND A.PROMO_STUS_ID = '1'
							    AND B.PROMO_ITM_STUS_ID = '1'
							    AND A.PROMO_TYPE_ID = '2282'    
							    AND A.PROMO_APP_TYPE_ID = '2288'
							    AND A.PROMO_DT_FROM <= SYSDATE        
							    AND A.PROMO_DT_END >= SYSDATE 
							    AND B.PROMO_ITM_STK_ID = C.ITM_STK_ID
							    AND C.SALES_ORD_ID =  #{SALES_ORD_ID}
							    AND A.PROMO_SRV_MEM_PAC_ID = #{SRV_MEM_PAC_ID}       
							    AND D.CUST_ID = E.CUST_ID
							    AND (A.PROMO_CUST_TYPE = E.TYPE_ID    OR A.PROMO_CUST_TYPE  =0 )
							      ]]>
					            <if test="E_YN != null and E_YN != ''">
                                         AND A.EMP_CHK = #{E_YN}        
                                </if>
                                            
							 
							    
	                    
         </select>
         
          <select id="getFilterPromotionCode" parameterType="Map" resultType="egovMap">
                   <![CDATA[
						                             
						SELECT 
						         distinct A.PROMO_ID code_Id,
						         A.PROMO_CODE || '-' || A.PROMO_DESC code_Name
						FROM SAL0017D  A 
						WHERE  A.PROMO_SRV_MEM_PAC_ID = #{PROMO_SRV_MEM_PAC_ID}  
						AND    A.PROMO_APP_TYPE_ID = '2290'   
						AND    A.PROMO_APP_TYPE_ID = '2288'
						AND    A.PROMO_DT_FROM< = SYSDATE
						AND    A.PROMO_DT_END > = SYSDATE
						AND    A.PROMO_STUS_ID  = '1'
                          ]]>
                          
                                <if test="E_YN != null and E_YN != ''">
                                         AND A.EMP_CHK = #{E_YN}        
                                </if>
                                            
         </select>
         
         
          <select id="getFilterPromotionAmt" parameterType="Map" resultType="egovMap">
                   <![CDATA[
                                                     
									                      
									SELECT  SUM( C.AMT)   NORMA_AMT            -- AMT = 팝업의 Normal Price
									FROM SAL0203D A, SYS0026M B, SAL0016M C
									WHERE A.SRV_PAC_ID =   #{SRV_PAC_ID}           --  SERVICE_PACKAGE ID (PROMOTOIN 아님)
									AND A.SRV_PAC_TYPE =   1              -- 0 = RENTAL MEMEBERSHIP / 1 = OUTRIGHT MEMBERSHIP
									AND A.SRV_ITM_STK_ID = (SELECT  B.ITM_STK_ID 
									                            FROM SAL0001D A , 
									                                 SAL0002D B  
									                        WHERE A.SALES_ORD_ID =B.SALES_ORD_ID
									                        AND A.SALES_ORD_NO =#{SALES_ORD_NO} )
									AND A.BOM_COMPNT = B.STK_CODE
									AND B.STK_ID = C.STK_ID
									AND B.STUS_CODE_ID = '1'            -- FIXED VALUE
									AND C.MEM_PAC_ID = '0'              -- FIXED VALUE
									AND C.APP_TYPE_ID = '67'            -- FIXED VALUE
									AND C.STUS_CODE_ID = '1'            -- FIXED VALUE
                          ]]>
         </select>
         
                                 
                        
         
         <select id="getPromoPricePercent" parameterType="Map" resultType="egovMap">
         		     SELECT  PROMO_PRC_PRCNT , PROMO_DISC_TYPE ,PROMO_ADD_DISC_PRC
				            FROM  SAL0017D   
				    WHERE 1=1
				            AND PROMO_ID =#{PROMO_ID}
         </select>
                  
       
       <resultMap id="filterCharge" type="egovMap" ></resultMap>
    
      <select id="getFilterCharge"  parameterType="Map" statementType="CALLABLE"   >
       <![CDATA[ 
            {
                  call SP_GET_ORD_MBRSH_FILTER_CHRG ( #{ORD_ID} ,  #{PROMO_ID} ,#{p1, mode=OUT, jdbcType=CURSOR, javaType=ResultSet, resultMap=filterCharge})
            }
         ]]>
      </select>   
      
          <select id="getFilterChargeList" parameterType="Map" resultType="egovMap">
       <![CDATA[ 
	       	            
				SELECT BOM_COMPNT
				       ,BOM_COMPNT_DESC
				       ,SRV_FILTER_PRV_CHG_DT
				       ,SRV_FILTER_PRIOD
				       ,AMT
				       ,AMT -  NVL(DISAMT,0)   AS DISAMT
				 FROM(  
				        SELECT  
				            A.BOM_COMPNT,
				            A.BOM_COMPNT_DESC,
				            D.SRV_FILTER_PRV_CHG_DT,
				            D.SRV_FILTER_PRIOD,
				            C.AMT ,
				            NVL( ( SELECT  DECODE (PROMO_DISC_TYPE  ,  '0',
				                                                (C.AMT * (X.PROMO_PRC_PRCNT/100 )),
				                                                '1',
				                                                (X.PROMO_PRC_PRCNT) ,
				                                                 X.PROMO_PRC_PRCNT
				                                                ) 
				            FROM  SAL0017D  X WHERE  PROMO_ID =#{PROMO_ID}) ,0)DISAMT 
				        FROM SAL0203D A 
				             ,SYS0026M B
				             ,SAL0016M C 
				             ,SAL0001D S1D   
				             ,SAL0002D S2D 
				             ,SAL0090D E  
				             ,SAL0087D D
				         WHERE A.SRV_PAC_ID         = #{SRV_PAC_ID}            --  SERVICE_PACKAGE ID (PROMOTOIN 아님)
				            AND A.SRV_PAC_TYPE      =   1                             -- 0 = RENTAL MEMEBERSHIP / 1 = OUTRIGHT MEMBERSHIP
				            AND A.SRV_ITM_STK_ID   = S2D.ITM_STK_ID 
				            AND A.BOM_COMPNT        = B.STK_CODE
				            AND B.STK_ID                 = C.STK_ID
				            AND B.STUS_CODE_ID = '1'                                    -- FIXED VALUE
				            AND C.MEM_PAC_ID   = '0'                                     -- FIXED VALUE
				            AND C.APP_TYPE_ID  = '67'                                    -- FIXED VALUE
				            AND C.STUS_CODE_ID = '1'                                    -- FIXED VALUE
				            AND S1D.SALES_ORD_ID    = S2D.SALES_ORD_ID
				            AND S1D.SALES_ORD_NO   =#{SALES_ORD_NO}
				            AND S1D.SALES_ORD_ID    = E.SRV_SO_ID
				            AND C.STK_ID                  = D.SRV_FILTER_STK_ID(+)
				            AND D.SRV_CONFIG_ID       = E.SRV_CONFIG_ID(+)
				)
				
         ]]>
      </select>   
      
      
 <select id="getFilterChargeListSum" parameterType="Map" resultType="egovMap">
       <![CDATA[ 
              SELECT         SUM(DISAMT) DISAMT FROM (
                SELECT BOM_COMPNT
                       ,BOM_COMPNT_DESC
                       ,SRV_FILTER_PRV_CHG_DT
                       ,SRV_FILTER_PRIOD
                       ,AMT
                       ,AMT - DISAMT AS DISAMT
                 FROM(  
                        SELECT  
                            A.BOM_COMPNT,
                            A.BOM_COMPNT_DESC,
                            D.SRV_FILTER_PRV_CHG_DT,
                            D.SRV_FILTER_PRIOD,
                            C.AMT ,
                            ( SELECT  DECODE (PROMO_DISC_TYPE  ,  '0',
                                                                (C.AMT * (X.PROMO_PRC_PRCNT/100 )),
                                                                '1',
                                                                ( X.PROMO_PRC_PRCNT) ,
                                                                 X.PROMO_PRC_PRCNT
                                                                ) 
                            FROM  SAL0017D  X WHERE  PROMO_ID =#{PROMO_ID}) DISAMT 
                        FROM SAL0203D A 
                             ,SYS0026M B
                             ,SAL0016M C 
                             ,SAL0001D S1D   
                             ,SAL0002D S2D 
                             ,SAL0090D E  
                             ,SAL0087D D
                         WHERE A.SRV_PAC_ID         = #{SRV_PAC_ID}            --  SERVICE_PACKAGE ID (PROMOTOIN 아님)
                            AND A.SRV_PAC_TYPE      =   1                             -- 0 = RENTAL MEMEBERSHIP / 1 = OUTRIGHT MEMBERSHIP
                            AND A.SRV_ITM_STK_ID   = S2D.ITM_STK_ID 
                            AND A.BOM_COMPNT        = B.STK_CODE
                            AND B.STK_ID                 = C.STK_ID
                            AND B.STUS_CODE_ID = '1'                                    -- FIXED VALUE
                            AND C.MEM_PAC_ID   = '0'                                     -- FIXED VALUE
                            AND C.APP_TYPE_ID  = '67'                                    -- FIXED VALUE
                            AND C.STUS_CODE_ID = '1'                                    -- FIXED VALUE
                            AND S1D.SALES_ORD_ID    = S2D.SALES_ORD_ID
                            AND S1D.SALES_ORD_NO   =#{SALES_ORD_NO}
                            AND S1D.SALES_ORD_ID    = E.SRV_SO_ID
                            AND C.STK_ID                  = D.SRV_FILTER_STK_ID(+)
                            AND D.SRV_CONFIG_ID       = E.SRV_CONFIG_ID(+)
                )
                )
         ]]>
      </select>   
      
      
   
      
      
      
        <select id="getOrderCurrentBillMonth" parameterType="Map" resultType="egovMap">
    
			    SELECT * 
			      FROM ( SELECT S.SALES_ORD_ID   ,
			                            S.RENT_INST_NO   ,
						                TO_CHAR(S.RENT_INST_DT,'yyyymmdd')   RENT_INST_DT,
						                S.RENT_INST_TYPE_ID   ,
						                S.RENT_INST_AMT   ,
						                S.RENT_INST_INSERT_MONTH   ,
						                S.RENT_INST_INSERT_YEAR   ,
						                S.RENT_INST_ID,   
						                TO_CHAR(SYSDATE,'yyyymm')||'01' NOW_DATE 
			      FROM ( SELECT R.SALES_ORD_ID   ,
			                    R.RENT_INST_NO   ,
			                    R.RENT_INST_DT   ,
			                    R.RENT_INST_TYPE_ID   ,
			                    R.RENT_INST_AMT   ,
			                    R.RENT_INST_INSERT_MONTH  ,
			                    R.RENT_INST_INSERT_YEAR   ,
			                    R.RENT_INST_ID   
			             FROM SAL0070D R
			              WHERE  R.SALES_ORD_ID = ${ORD_ID}
			              <if test="RENT_INST_DT != null and RENT_INST_DT != ''">   
                              AND   RENT_INST_DT =  SYSDATE
                          </if>
			              
			              ) S
			      ORDER BY S.RENT_INST_NO DESC )
			      WHERE ROWNUM <![CDATA[<]]>= 1
      </select>
      
      
      
      
         
    <select id="getSAL0093D_SEQ" parameterType="Map" resultType="egovMap">
                 <![CDATA[     
                          SELECT SAL0095D_SRV_MEM_ID_SEQ.NEXTVAL  SEQ  FROM DUAL 
                 ]]>
    </select>
    
        
    <insert id="insertQuotationInfo" parameterType="Map"   >
			    
			    INSERT INTO SAL0093D (SRV_MEM_QUOT_ID ,
			                                      SRV_SALES_ORD_ID,             
							                      SRV_MEM_QUOT_NO,              
							                      SRV_MEM_PAC_ID,               
							                      SRV_MEM_PAC_NET_AMT,          
							                      SRV_MEM_PAC_TXS,              
							                      SRV_MEM_PAC_AMT,              
							                      SRV_MEM_BS_NET_AMT,           
							                      SRV_MEM_BS_TXS,               
							                      SRV_MEM_BS_AMT,               
							                      SRV_MEM_PV,                   
							                      SRV_DUR,                      
							                      SRV_REM,                      
							                      SRV_QUOT_VAL_ID,                  
							                      SRV_CRT_DT,                       
							                      SRV_CRT_USER_ID,              
							                      SRV_QUOT_STUS_ID,             
							                      SRV_UPD_USER_ID,              
							                      SRV_UPD_DT,                   
							                      SRV_MEM_BS12_AMT,                 
							                      SRV_QUOT_CUST_CNT_ID,         
							                      SRV_MEM_QTY,                  
							                      SRV_PROMO_ID,                 
							                      SRV_SALES_MEM_ID,             
							                      SRV_MEM_ID,                   
							                      SRV_ORD_STK_ID,               
							                      SRV_FREQ,                     
							                      SRV_PAC_PROMO_ID,
							                      EMP_CHK)             
			  VALUES   (             #{SAL0093D_SEQ},
			                               #{srvSalesOrderId},
								            FN_GET_DOCNO(20) ,
								            #{srvMemPacId},
								            #{srvMemPacNetAmt},
								            #{srvMemPacTaxes},
								            #{srvMemPacAmt},
								            #{srvMemBSNetAmt},
								            #{srvMemBSTaxes},
								            #{srvMemBSAmt},
								            #{srvMemPv},
								            #{srvDuration},
								            #{srvRemark},
								            LAST_DAY(sysdate),
								            sysdate,
								            #{srvCreateBy},
								            #{srvQuotStatusId},
								            #{srvCreateBy},
								            sysdate,
								            #{srvMemBS12Amt},
								            #{srvQuotCustCntId},
								            #{srvMemQty},
								            #{srvPromoId},
								            #{srvSalesMemId},
								            #{srvMemId},
								            #{srvOrderStkId},
								            #{srvFreq},
								            #{srvPacPromoId} ,
								            #{empChk}
			            )
            
         </insert>   
         
         
     <insert id="insertSrvMembershipQuot_Filter" parameterType="Map"  >    
         
			INSERT INTO SAL0094D (SRV_MEM_QUOT_FILTER_ID,
						                      SRV_MEM_QUOT_ID,
						                      STK_ID,
						                      STK_PRIOD,
						                      STK_LAST_CHNG_DT,
						                      STK_FILTER_PRC,
						                      STK_NET_AMT,
						                      STK_TXS,
						                      STK_CHRG_PRC)
			  VALUES   (SAL0094D_SRV_MEM_QUOT_FILTER.NEXTVAL,
				            #{srvmemquotfilterid} ,
                            #{stkid},
                            #{stkperiod},
                            #{stklastchangedate},
                            #{stkfilterprice},
                            #{stknetamt},
                            #{stktaxes},
                            #{stkchargeprice}
			           )
			            
							            
     </insert>   
         
         
         
    
     <resultMap id="getOderOutsInfoMap" type="egovMap" ></resultMap>
     
    <select id="getOderOutsInfo"   parameterType="Map"  statementType="CALLABLE">
       <![CDATA[  
            {
                  call SP_GET_ORD_OTSTND_INFO ( #{ORD_ID} , #{p1, mode=OUT, jdbcType=CURSOR, javaType=ResultSet, resultMap=getOderOutsInfoMap})
            }
         ]]>
      </select>   
      
      
      
       <select id="mActiveQuoOrder" parameterType="Map" resultType="egovMap">
                 <![CDATA[     
                       SELECT  S.SRV_MEM_QUOT_ID   ,
							       S.SRV_SALES_ORD_ID   ,
							       S.SRV_MEM_QUOT_NO   ,
							       S.SRV_MEM_PAC_ID   ,
							       S.SRV_MEM_PAC_NET_AMT   ,
							       S.SRV_MEM_PAC_TXS   ,
							       S.SRV_MEM_PAC_AMT   ,
							       S.SRV_MEM_BS_NET_AMT   ,
							       S.SRV_MEM_BS_TXS   ,
							       S.SRV_MEM_BS_AMT   ,
							       S.SRV_MEM_PV   ,
							       S.SRV_DUR SRV_DUR  ,
							       S.SRV_REM SRV_REM  ,
							       S.SRV_QUOT_VAL_ID   ,
							       S.SRV_CRT_DT   ,
							       S.SRV_CRT_USER_ID   ,
							       S.SRV_QUOT_STUS_ID   ,
							       S.SRV_UPD_USER_ID   ,
							       S.SRV_UPD_DT   ,
							       S.SRV_MEM_BS12_AMT   ,
							       S.SRV_QUOT_CUST_CNT_ID   ,
							       S.SRV_MEM_QTY   ,
							       S.SRV_PROMO_ID   ,
							       S.SRV_SALES_MEM_ID   ,
							       S.SRV_MEM_ID   ,
							       S.SRV_ORD_STK_ID   ,
							       S.SRV_FREQ   ,
							       S.SRV_PAC_PROMO_ID   
							  FROM SAL0093D S
							         JOIN SAL0001D A   ON S.SRV_SALES_ORD_ID = A.SALES_ORD_ID
							 WHERE  ( 1 = S.SRV_QUOT_STUS_ID )
							          AND ( A.SALES_ORD_NO = #{ORD_NO} )
							          AND ( S.SRV_QUOT_VAL_ID >= SYSDATE ) AND ROWNUM <= 1
                 ]]>
      </select>
      
    <select id="selectSrchMembershipQuotationPop" parameterType="Map" resultType="egovMap">
        SELECT
            a.SRV_MEM_QUOT_ID,
            TO_CHAR(SRV_MEM_QUOT_ID) AS SRV_MEM_QUOT_ID_TXT, /* 중복방지용 CHAR 형 */
            a.SRV_MEM_QUOT_NO,
            a.SRV_MEM_PAC_AMT,
            a.SRV_MEM_BS_AMT,
            NVL(a.SRV_MEM_PAC_AMT,0) + NVL(a.SRV_MEM_BS_AMT,0) AS TOTAL_AMT,
            a.SRV_DUR,
            a.SRV_QUOT_VAL_ID,
            a.SRV_FREQ,
            c.SALES_ORD_ID,
            c.SALES_ORD_NO,
            c.CUST_ID,
            g.NAME AS CUST_NAME,
            c.APP_TYPE_ID,
            e.STK_DESC,
            f.SRV_MEM_PAC_ID,
            f.SRV_MEM_DESC 
        FROM
            SAL0093D a 
            LEFT JOIN PAY0024D b ON a.SRV_MEM_QUOT_ID = b.SRV_MEM_QOTAT_ID 
            LEFT JOIN SAL0001D c ON a.SRV_SALES_ORD_ID = c.SALES_ORD_ID 
            LEFT JOIN SAL0002D d ON c.SALES_ORD_ID = d.SALES_ORD_ID 
            LEFT JOIN SYS0026M e ON d.ITM_STK_ID = e.STK_ID 
            LEFT JOIN SAL0091M f ON a.SRV_MEM_PAC_ID = f.SRV_MEM_PAC_ID
            JOIN SAL0029D g ON c.CUST_ID = g.CUST_ID 
        WHERE 
            a.SRV_QUOT_STUS_ID = 1 
            AND b.SRV_MEM_LG_ID IS NULL 
            AND a.SRV_QUOT_VAL_ID <![CDATA[<=]]> TRUNC(SYSDATE)
            <if test="orderNo != null and orderNo != ''">
            AND c.SALES_ORD_NO = #{orderNo}
            </if>
            <if test="membershipType != null and membershipType != ''">
            AND f.SRV_MEM_PAC_ID = #{membershipType}
            </if>
            <if test="quotationNo != null and quotationNo != ''">
            AND a.SRV_MEM_QUOT_NO = #{quotationNo}
            </if>
            <if test="quotationDur != null and quotationDur != ''">
            AND a.SRV_DUR = #{quotationDur}
            </if>
            <if test="customerId != null and customerId != ''">
            AND c.CUST_ID = #{customerId}
            </if>
            <if test="customerNm != null and customerNm != ''">
            AND g.NAME = #{customerNm}
            </if>
            <if test="nric != null and nric != ''">
            AND g.NRIC = #{nric}
            </if>
            <if test="appType != null and appType != ''">
            AND c.APP_TYPE_ID = #{appType}
            </if>            
        ORDER BY c.SALES_ORD_NO ASC
    </select>
      
</mapper>