<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.coway.trust.biz.sales.mambership.impl.MembershipRentalStatusMapper">

    <select id="selectCnvrList" parameterType="Map" resultType="egovMap">
		SELECT A.RS_CNVR_ID ,
			       A.CODE BATCH_STATUS  ,
			       A.RS_STUS_ID   ,
			       A.NAME BATCH_NAME ,
			       A.RS_CNVR_CNFM_USER_ID   ,
			       A.CNFM_USER_NAME   ,
			       TO_CHAR(A.RS_CNVR_CNFM_DT , 'DD/MM/YYYY')  RS_CNVR_CNFM_DT  ,
			       A.RS_CNVR_USER_ID   ,
			       A.USER_NAME   ,
			       TO_CHAR(A.RS_CNVR_DT, 'DD/MM/YYYY')  RS_CNVR_DT  ,
			       A.RS_CNVR_NO   ,
			       A.RS_CNVR_STUS_ID   ,
			       A.CODE1  CONVERT_STATUS  ,
			       A.NAME1  CONVERT_NAME  ,
			       TO_CHAR(A.RS_CNVR_CRT_DT, 'DD/MM/YYYY')  RS_CNVR_CRT_DT   ,
			       A.RS_CNVR_CRT_USER_ID   ,
			       A.CRT_USER_NAME   ,
			       A.RS_CNVR_REACT_FEES_APPLY   ,
			       A.RS_CNVR_REM   ,
			       A.RS_CNVR_STUS_FROM   ,
			       A.RS_CNVR_STUS_TO   ,
			       TO_CHAR(A.RS_CNVR_UPD_DT, 'DD/MM/YYYY')  RS_CNVR_UPD_DT   ,
			       A.RS_CNVR_UPD_USER_ID   ,
			       A.UPD_USER_NAME   
	  FROM ( SELECT TT.RS_CNVR_ID   ,
			                TT.RS_STUS_ID   ,
			                TT.RS_CNVR_STUS_ID   ,
			                TT.RS_CNVR_STUS_FROM   ,
			                TT.RS_CNVR_STUS_TO   ,
			                TT.RS_CNVR_CRT_USER_ID   ,
			                TT.RS_CNVR_CRT_DT   ,
			                TT.RS_CNVR_UPD_USER_ID   ,
			                TT.RS_CNVR_UPD_DT   ,
			                TT.RS_CNVR_CNFM_USER_ID   ,
			                TT.RS_CNVR_CNFM_DT   ,
			                TT.RS_CNVR_USER_ID   ,
			                TT.RS_CNVR_DT   ,
			                TT.RS_CNVR_NO   ,
			                TT.RS_CNVR_REACT_FEES_APPLY   ,
			                TT.RS_CNVR_REM   ,
			                TT.CODE1 CODE  ,
			                TT.NAME1 NAME  ,
			                TT.CODE2 CODE1  ,
			                TT.NAME2 NAME1  ,
			                CASE WHEN TT.CNFM_USER_ID IS NOT NULL THEN TT.CNFM_USER_NAME ELSE ' ' END CNFM_USER_NAME  ,
			                CASE WHEN TT.USER_ID IS NOT NULL  THEN TT.USER_NAME ELSE ' ' END USER_NAME  ,
			                CASE WHEN TT.CRT_USER_ID IS NOT NULL  THEN TT.CRT_USER_NAME ELSE ' ' END CRT_USER_NAME  ,
			                CASE WHEN G.USER_ID IS NOT NULL  THEN G.USER_NAME ELSE ' ' END UPD_USER_NAME  
			         FROM ( SELECT A.RS_CNVR_ID RS_CNVR_ID  ,
					                       A.RS_STUS_ID   ,
					                       A.RS_CNVR_STUS_ID   ,
					                       A.RS_CNVR_STUS_FROM   ,
					                       A.RS_CNVR_STUS_TO   ,
					                       A.RS_CNVR_CRT_USER_ID   ,
					                       A.RS_CNVR_CRT_DT   ,
					                       A.RS_CNVR_UPD_USER_ID   ,
					                       A.RS_CNVR_UPD_DT   ,
					                       A.RS_CNVR_CNFM_USER_ID   ,
					                       A.RS_CNVR_CNFM_DT   ,
					                       A.RS_CNVR_USER_ID   ,
					                       A.RS_CNVR_DT   ,
					                       A.RS_CNVR_NO   ,
					                       A.RS_CNVR_REACT_FEES_APPLY   ,
					                       A.RS_CNVR_REM   ,
					                       B.CODE CODE1  ,
					                       B.NAME NAME1  ,
					                       C.CODE CODE2  ,
					                       C.NAME NAME2  ,
					                       D.USER_ID CNFM_USER_ID  ,
					                       D.USER_NAME CNFM_USER_NAME  ,
					                       E.USER_ID USER_ID  ,
					                       E.USER_NAME USER_NAME  ,
					                       F.USER_ID CRT_USER_ID  ,
					                       F.USER_NAME CRT_USER_NAME  
					                FROM SAL0072D A
					                       JOIN SYS0038M B   ON B.STUS_CODE_ID = A.RS_STUS_ID
					                       JOIN SYS0038M C   ON C.STUS_CODE_ID = A.RS_CNVR_STUS_ID
					                       LEFT JOIN SYS0047M D   ON D.USER_ID = A.RS_CNVR_CNFM_USER_ID
					                       LEFT JOIN SYS0047M E   ON E.USER_ID = A.RS_CNVR_USER_ID
					                       LEFT JOIN SYS0047M F   ON F.USER_ID = A.RS_CNVR_CRT_USER_ID
					                 WHERE  A.RS_CNVR_TYPE_ID  = 1320 
	                
				                 <if test="rsStusId != null and rsStusId != ''">
			                           AND A.RS_STUS_ID IN
			                         <foreach item="item" collection="rsStusId" index="index" open="(" separator="," close=")">
			                           #{item}
			                         </foreach>
			                       </if>
			
				                 <if test="rsCnvrStusId != null and rsCnvrStusId != ''">
			                           AND A.RS_CNVR_STUS_ID IN
			                         <foreach item="item" collection="rsCnvrStusId" index="index" open="(" separator="," close=")">
			                           #{item}
			                         </foreach>
			                       </if>
			
				                 <if test="rsCnvrStusFrom != null and rsCnvrStusFrom != ''">
			                           AND A.RS_CNVR_STUS_FROM IN
			                         <foreach item="item" collection="rsCnvrStusFrom" index="index" open="(" separator="," close=")">
			                           #{item}
			                         </foreach>
			                       </if>
			
				                 <if test="rsCnvrStusTo != null and rsCnvrStusTo != ''">
			                           AND A.RS_CNVR_STUS_TO IN
			                         <foreach item="item" collection="rsCnvrStusTo" index="index" open="(" separator="," close=")">
			                           #{item}
			                         </foreach>
			                       </if>
				                          ) TT
				                LEFT JOIN SYS0047M G   ON G.USER_ID = TT.RS_CNVR_UPD_USER_ID
			          WHERE 1=1
			              <if test="rsCnvrNo != null and rsCnvrNo != ''">
			              AND TT.RS_CNVR_NO = #{rsCnvrNo}
			              </if>
			              <if test="stRsCnvrCrtDt != null and stRsCnvrCrtDt != ''">
			              AND TO_CHAR(TT.RS_CNVR_CRT_DT, 'yyyymmdd') BETWEEN #{stRsCnvrCrtDt} AND #{edRsCnvrCrtDt}
			              </if>
		                     <if test="creatUser != null and creatUser != ''">
			              AND CASE WHEN  TT.USERID3 IS NOT NULL  THEN TT.USERNAME3 ELSE ' ' END = #{creatUser} 
			              </if>		              
		                     <if test="stRsCnvrCnfmDt != null and stRsCnvrCnfmDt != ''">
			              AND TO_CHAR( TT.RS_CNVR_CNFM_DT, 'yyyymmdd') BETWEEN #{stRsCnvrCnfmDt} AND #{edRsCnvrCnfmDt}
			              </if>		              
		                     <if test="rsCnvrRem != null and rsCnvrRem != ''">
			              AND TT.RS_CNVR_REM LIKE '%'||#{rsCnvrRem}||'%' 
			              </if>		              
		                     <if test="confirmUser != null and confirmUser != ''">
			              AND CASE WHEN TT.USERID1 IS NOT NULL  THEN TT.USERNAME1 ELSE ' ' END = #{confirmUser}  
			              </if>
			              ) A
		  ORDER BY A.RS_CNVR_NO ASC
  
    </select>
    
    <select id="selectCnvrDetailList" parameterType="Map" resultType="egovMap">
		SELECT TT.RS_ITM_ID   ,
			       TT.RS_SYS_APP_TYPE_ID   ,
			       TT.APP_TYPE  ,
			       TT.RS_ITM_CNVR_USER_ID   ,
			       TT.CNVR_USER_NAME   ,
			       TT.RS_ITM_CNVR_DT   ,
			       TT.RS_CNVR_ID   ,
			       TT.RS_ITM_CNVR_STUS_ID   ,
			       TT.CNVR_STUS   ,
			       TO_CHAR(TT.RS_ITM_CRT_DT , 'DD/MM/YYYY')    RS_ITM_CRT_DT ,
			       TT.RS_ITM_CRT_USER_ID   ,
			       TT.CRT_USER_NAME   ,
			       TT.RS_ITM_STUS_ID   ,
			       TT.RS_SYS_SO_ID   ,
			       TT.RS_ITM_ORD_NO   ,
			       TT.RS_SYS_RENTAL_STUS   ,
			       TO_CHAR(TT.RS_ITM_UPD_DT  , 'DD/MM/YYYY')   RS_ITM_UPD_DT,
			       TT.RS_ITM_UPD_USER_ID   ,
			       TT.UPD_USER_NAME   ,
			       TT.RS_ITM_VALID_REM   ,
			       TT.RS_ITM_VALID_STUS   ,
			       TT.VALID_STUS  ,
			       TT.VALID_STUS_NAME   ,
			       TT.RS_ITM_CNTRCT_ID   ,
			       TT.RS_ITM_CNTRCT_NO   
		  FROM ( SELECT A.RS_ITM_ID   ,
				                A.RS_CNVR_ID   ,
				                A.RS_ITM_STUS_ID   ,
				                A.RS_ITM_ORD_NO   ,
				                A.RS_SYS_SO_ID   ,
				                A.RS_SYS_APP_TYPE_ID   ,
				                A.RS_SYS_RENTAL_STUS   ,
				                A.RS_ITM_VALID_STUS   ,
				                A.RS_ITM_VALID_REM   ,
				                A.RS_ITM_CNVR_STUS_ID   ,
				                A.RS_ITM_CNVR_USER_ID   ,
				                A.RS_ITM_CNVR_DT   ,
				                A.RS_ITM_CRT_USER_ID   ,
				                A.RS_ITM_CRT_DT   ,
				                A.RS_ITM_UPD_USER_ID   ,
				                A.RS_ITM_UPD_DT   ,
				                A.RS_ITM_CNTRCT_ID   ,
				                A.RS_ITM_CNTRCT_NO   ,
				                C.CODE CNVR_STUS  ,
				                D.CODE VALID_STUS  ,
				                D.NAME VALID_STUS_NAME  ,
				                CASE WHEN  E.CODE_ID IS NOT NULL THEN E.CODE ELSE ' ' END APP_TYPE  ,
				                CASE WHEN  F.USER_ID IS NOT NULL THEN F.USER_NAME ELSE ' ' END CNVR_USER_NAME  ,
				                CASE WHEN  G.USER_ID IS NOT NULL THEN G.USER_NAME ELSE ' ' END CRT_USER_NAME  ,
				                CASE WHEN  H.USER_ID IS NOT NULL THEN H.USER_NAME ELSE ' ' END UPD_USER_NAME  
				         FROM SAL0073D A
				                JOIN SAL0072D B   ON ( B.RS_CNVR_ID = A.RS_CNVR_ID )
				                AND  B.RS_CNVR_TYPE_ID = 1320
				                JOIN SYS0038M C   ON C.STUS_CODE_ID = A.RS_ITM_CNVR_STUS_ID
				                JOIN SYS0038M D   ON D.STUS_CODE_ID = A.RS_ITM_VALID_STUS
				                LEFT JOIN SYS0013M E   ON E.CODE_ID = A.RS_SYS_APP_TYPE_ID
				                LEFT JOIN SYS0047M F   ON F.USER_ID = A.RS_ITM_CNVR_USER_ID
				                LEFT JOIN SYS0047M G   ON G.USER_ID = A.RS_ITM_CRT_USER_ID
				                LEFT JOIN SYS0047M H   ON H.USER_ID = A.RS_ITM_UPD_USER_ID
				          WHERE A.RS_ITM_STUS_ID = #{rsStusId}
		                      AND A.RS_CNVR_ID = #{rsCnvrId} ) TT
			  ORDER BY TT.RS_ITM_ID ASC
    </select>
    
    <select id="selectCnvrDetail" parameterType="Map" resultType="egovMap">
	    SELECT TT.RS_CNVR_ID   ,
			       TT.RS_STUS_CODE  ,
			       TT.RS_STUS_ID   ,
			       TT.RS_STUS_NAME   ,
			       TT.RS_CNVR_CNFM_USER_ID   ,
			       TT.CNFM_USER_NAME   ,
			       TO_CHAR(TT.RS_CNVR_CNFM_DT  , 'DD-MM-YYYY hh24:mi AM') RS_CNVR_CNFM_DT ,
			       TT.RS_CNVR_USER_ID   ,
			       TT.USER_NAME  ,
			       TO_CHAR(TT.RS_CNVR_DT , 'DD-MM-YYYY hh24:mi AM')  RS_CNVR_DT ,
			       TT.RS_CNVR_NO   ,
			       TT.RS_CNVR_STUS_ID   ,
			       TT.CNVR_STUS_CODE ,
			       TT.CNVR_STUS_CODE_NAME ,
			       TO_CHAR(TT.RS_CNVR_CRT_DT , 'DD-MM-YYYY hh24:mi AM')  RS_CNVR_CRT_DT,
			       TT.RS_CNVR_CRT_USER_ID   ,
			       TT.CRT_USER_NAME   ,
			       TT.RS_CNVR_REACT_FEES_APPLY   ,
			       TT.RS_CNVR_REM   ,
			       TT.RS_CNVR_STUS_FROM   ,
			       TT.RS_CNVR_STUS_TO   ,
			       TO_CHAR(TT.RS_CNVR_UPD_DT , 'DD-MM-YYYY hh24:mi AM')  RS_CNVR_UPD_DT ,
			       TT.RS_CNVR_UPD_USER_ID   ,
			       TT.UPD_USER_NAME 
		  FROM ( SELECT A.RS_CNVR_ID   ,
				                A.RS_STUS_ID   ,
				                A.RS_CNVR_STUS_ID   ,
				                A.RS_CNVR_STUS_FROM   ,
				                A.RS_CNVR_STUS_TO   ,
				                A.RS_CNVR_CRT_USER_ID   ,
				                A.RS_CNVR_CRT_DT   ,
				                A.RS_CNVR_UPD_USER_ID   ,
				                A.RS_CNVR_UPD_DT   ,
				                A.RS_CNVR_CNFM_USER_ID   ,
				                A.RS_CNVR_CNFM_DT   ,
				                A.RS_CNVR_USER_ID   ,
				                A.RS_CNVR_DT   ,
				                A.RS_CNVR_NO   ,
				                A.RS_CNVR_REACT_FEES_APPLY   ,
				                A.RS_CNVR_REM   ,
				                B.CODE RS_STUS_CODE  ,
				                B.NAME RS_STUS_NAME  ,
				                C.CODE CNVR_STUS_CODE  ,
				                C.NAME CNVR_STUS_CODE_NAME ,
				                CASE WHEN  D.USER_ID IS NOT NULL THEN D.USER_NAME ELSE ' ' END CNFM_USER_NAME  ,
				                CASE WHEN  E.USER_ID IS NOT NULL THEN E.USER_NAME ELSE ' ' END USER_NAME  ,
				                CASE WHEN  F.USER_ID IS NOT NULL THEN F.USER_NAME ELSE ' ' END CRT_USER_NAME  ,
				                CASE WHEN  G.USER_ID IS NOT NULL THEN G.USER_NAME ELSE ' ' END UPD_USER_NAME  
				         FROM SAL0072D A
				                JOIN SYS0038M B   ON B.STUS_CODE_ID = A.RS_STUS_ID
				                JOIN SYS0038M C   ON C.STUS_CODE_ID = A.RS_CNVR_STUS_ID
				                LEFT JOIN SYS0047M D   ON D.USER_ID = A.RS_CNVR_CNFM_USER_ID
				                LEFT JOIN SYS0047M E   ON E.USER_ID = A.RS_CNVR_USER_ID
				                LEFT JOIN SYS0047M F   ON F.USER_ID = A.RS_CNVR_CRT_USER_ID
				                LEFT JOIN SYS0047M G   ON G.USER_ID = A.RS_CNVR_UPD_USER_ID
				          WHERE  A.RS_CNVR_TYPE_ID = 1320 
		                      AND  A.RS_CNVR_ID = #{rsCnvrId}
		                      <![CDATA[
		                      AND ROWNUM <= 1 ) TT
		                      ]]>
    </select>
    
    <select id="selectCnvrDetailCount" parameterType="Map" resultType="int">
        SELECT COUNT(*) CNT 
          FROM SAL0073D A
            JOIN SAL0072D B  ON  B.RS_CNVR_ID = A.RS_CNVR_ID 
             AND B.RS_CNVR_TYPE_ID = 1320 
         WHERE A.RS_ITM_STUS_ID = #{rsStusId}
             AND A.RS_CNVR_ID = #{rsCnvrId}
    </select>
    
</mapper>