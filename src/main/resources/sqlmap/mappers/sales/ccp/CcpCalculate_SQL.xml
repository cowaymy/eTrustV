<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.coway.trust.biz.sales.ccp.impl.CcpCalculateMapper">

<select id="getRegionCodeList" parameterType="Map" resultType="egovMap">
SELECT Extent1.CODE_ID CODE_ID ,
  Extent1.CODE_MASTER_ID CODE_MASTER_ID ,
  Extent1.CODE CODE ,
  Extent1.CODE_NAME CODE_NAME ,
  Extent1.DISAB DISAB ,
  Extent1.CRT_DT CRT_DT ,
  Extent1.CRT_USER_ID CRT_USER_ID ,
  Extent1.UPD_DT UPD_DT ,
  Extent1.UPD_USER_ID UPD_USER_ID ,
  Extent1.OLD_CODE_ID OLD_CODE_ID
FROM SYS0013M Extent1
WHERE ( 0 = Extent1.DISAB )
AND ( Extent1.CODE_MASTER_ID = #{codeId} )
ORDER BY Extent1.CODE_ID ASC
</select>


<select id="selectDscCodeList"  resultType="egovMap">
SELECT Project1.BRNCH_ID ,
       Project1.CODE_NAME 
FROM ( SELECT Extent1.BRNCH_ID BRNCH_ID  ,
                Extent1.CODE || ' - ' || Extent1.NAME CODE_NAME  
         FROM SYS0005M Extent1
          WHERE  ( 1 = Extent1.STUS_ID )
                   AND ( Extent1.TYPE_ID IN ( 40,43 )
                  ) ) Project1
ORDER BY Project1.CODE_NAME ASC
</select>

<select id="selectReasonCodeFbList" resultType="egovMap">
    SELECT Extent1.RESN_ID CODE_ID  ,
       Extent1.CODE CODE  ,
       Extent1.CODE || ' - ' || Extent1.RESN_DESC CODE_NAME  
  FROM SYS0032M Extent1
 WHERE  ( Extent1.RESN_TYPE_ID = 207 )
          AND ( Extent1.STUS_CODE_ID = 1 )
</select>

<resultMap type="egovMap" id="calCcpListClobMap">
    <result property="CCP_REM" column="CCP_REM" jdbcType="CLOB" javaType="java.lang.String"/>
    <result property="CCP_PNC_REM" column="CCP_PNC_REM" jdbcType="CLOB" javaType="java.lang.String"/>
</resultMap>

<select id="selectCalCcpListAjax" parameterType="Map" resultMap="calCcpListClobMap">
			SELECT Filter1.CCP_ID   ,
			       Filter1.CCP_SCHEME_TYPE_ID   ,
			       Filter1.CCP_TYPE_ID   ,
			       TO_CHAR(Filter1.CCP_TOT_SCRE_POINT , 'FM9999999999990.0') CCP_TOT_SCRE_POINT  ,
			       Filter1.CCP_STUS_ID   , 
			       Filter1.CCP_RESN_ID   ,
			       Filter1.CCP_REM   ,
			       Filter1.CCP_RJ_STUS_ID   ,
			       Filter1.CCP_UPD_DT   ,
			       TO_CHAR(Filter1.CCP_UPD_DT, 'DD-MM-YYYY HH24:MI:SS ') ||'(' ||Filter1.USERNAME3 ||')' UPD_AT,
			       Filter1.SALESORDERID1 SALES_ORD_ID  ,
			       Filter1.SALES_ORD_NO   ,
			       Filter1.REF_NO   ,
			       Filter1.SALES_DT   ,
			       Filter1.CREATED1 CRT_DT  ,
			       TO_CHAR(Filter1.CREATED1 , 'DD-MM-YYYY AM HH:MI:SS ') ||'('||Filter1.USERNAME2 || ')' KEY_AT,
			       Filter1.STUS_CODE_ID,  
			       Filter1.CUSTOMERID1 CUST_ID  ,
			       Filter1.NAME3 NAME  ,
			       Filter1.NRIC1 NRIC  ,
			       Filter1.STK_ID   ,
			       Filter1.STK_CODE   ,
			       Filter1.STK_DESC   ,
			       Extent13.BRNCH_ID   ,
			       Extent13.NAME NAME1  ,
			       Extent13.REGN_ID   ,
			       CASE WHEN  972 = Filter1.CCP_TYPE_ID  THEN 'New Sales Order CCP' ELSE 'Reversal CCP' END CCP_TYPE  ,
			       CASE WHEN  1 = Filter1.STATUSCODEID1  THEN 'Active' WHEN ( 4 = Filter1.STATUSCODEID1 ) THEN 'Completed' ELSE 'Cancelled' END STATUS  ,
			       CASE WHEN  1 = Filter1.CCP_STUS_ID  THEN 'Active' WHEN ( 5 = Filter1.CCP_STUS_ID ) THEN 'Approved' ELSE 'Rejected' END CCP_STATUS  ,
			       CASE WHEN  969 = Filter1.CCP_SCHEME_TYPE_ID  THEN 'Individual CCP Scheme' ELSE 'Company CCP scheme' END CCP_SCHEME_TYPE  ,
			       CASE WHEN  Filter1.CCP_IS_HOLD IS NOT NULL THEN Filter1.CCP_IS_HOLD ELSE UTILS.CONVERT_TO_NUMBER(0,1,0) END CCP_IS_HOLD  ,
			       Filter1.BRANCHID2 BRANCHID1  ,
			       Filter1.USERNAME2 USER_NAME  ,
			       Filter1.USERNAME3 USERNAME1  ,
			       Filter1.MEM_CODE   ,
			       Filter1.RESN_DESC   ,
			       Filter1.NAME4 NAME2  
			FROM ( SELECT Extent1.CCP_ID   ,
			          Extent1.CCP_SCHEME_TYPE_ID   ,
			          Extent1.CCP_TYPE_ID   ,
			          Extent1.CCP_TOT_SCRE_POINT   ,
			          Extent1.CCP_STUS_ID   ,
			          Extent1.CCP_RESN_ID   ,
			          Extent1.CCP_REM   ,
			          Extent1.CCP_RJ_STUS_ID   ,
			          Extent1.CCP_UPD_DT   ,
			          Extent1.CCP_IS_HOLD   ,
			          Extent3.SALES_ORD_ID SALESORDERID1  ,
			          Extent3.SALES_ORD_NO   ,
			          Extent3.REF_NO   ,
			          Extent3.SALES_DT   ,
			          Extent3.BRNCH_ID BRANCHID3  ,
			          Extent3.STUS_CODE_ID STATUSCODEID1  ,
			          Extent3.CRT_DT CREATED1  ,
			          Extent3.STUS_CODE_ID,
			          Extent4.BRNCH_ID BRANCHID2  ,
			          Extent5.USER_NAME USERNAME2  ,
			          Extent6.USER_NAME USERNAME3  ,
			          Extent7.MEM_CODE   ,
			          Extent8.RESN_DESC   ,
			          Extent9.CUST_ID CUSTOMERID1  ,
			          Extent9.NAME NAME3  ,
			          Extent9.NRIC NRIC1  ,
			          Extent11.STK_ID   ,
			          Extent11.STK_CODE   ,
			          Extent11.STK_DESC   ,
			          Extent12.NAME NAME4  
			       FROM SAL0102D Extent1
			          JOIN ( SELECT Extent2.CCP_SALES_ORD_ID K1  ,
			                        MAX(Extent2.CCP_ID)  A1  
			                  FROM SAL0102D Extent2
			                  GROUP BY Extent2.CCP_SALES_ORD_ID ) GroupBy1   ON Extent1.CCP_ID = GroupBy1.A1
			          JOIN SAL0001D Extent3   ON Extent1.CCP_SALES_ORD_ID = Extent3.SALES_ORD_ID
			          LEFT JOIN SAL0045D Extent4   ON Extent3.SALES_ORD_ID = Extent4.SALES_ORD_ID
			          LEFT JOIN SYS0047M Extent5   ON Extent3.CRT_USER_ID = Extent5.USER_ID
			          LEFT JOIN SYS0047M Extent6   ON Extent1.CCP_UPD_USER_ID = Extent6.USER_ID
			          LEFT JOIN ORG0001D Extent7   ON Extent3.MEM_ID = Extent7.MEM_ID
			          LEFT JOIN SYS0032M Extent8   ON Extent1.CCP_RESN_ID = Extent8.RESN_ID
			          JOIN SAL0029D Extent9   ON Extent3.CUST_ID = Extent9.CUST_ID
			          JOIN SAL0002D Extent10   ON Extent3.SALES_ORD_ID = Extent10.SALES_ORD_ID
			          JOIN SYS0026M Extent11   ON Extent10.ITM_STK_ID = Extent11.STK_ID
			          LEFT JOIN SYS0038M Extent12   ON Extent1.CCP_RJ_STUS_ID = Extent12.STUS_CODE_ID
			          
			          <!-- WHERE   1 = Extent1.CCP_STUS_ID -->
			          
			          <!-- ## RENTAL  ONLY ## -->
			          WHERE Extent3.APP_TYPE_ID = 66
			          
			          <if test=" '' != calCcpStatus and null != calCcpStatus "> 
                             AND  Extent1.CCP_STUS_ID IN
                             <foreach collection="arryCalCcpStatus" item="value" open="(" separator="," close=")">
                                 <choose>
                                     <when test="value ==  4 ">
                                         #{value} , 6 , 10
                                     </when>
                                     <otherwise>
                                         #{value}
                                     </otherwise>
                                 </choose>
                             </foreach>
                          </if> 
			           
			          <if test=" '' != calActPoint and null != calActPoint">
			             AND UTILS.CONVERT_TO_NUMBER(0,18) = Extent1.CCP_TOT_SCRE_POINT
			          </if> 
			          
			          <if test=" '' != calReason and null != calReason">
			             AND Extent1.CCP_RESN_ID IN
			             <foreach collection="arryCalReason" item="value" open="(" separator="," close=")">
			               #{value}  
			             </foreach>   
			          </if>
			           
			          ) Filter1
			     JOIN SYS0005M Extent13   ON Filter1.BRANCHID3 = Extent13.BRNCH_ID
			     WHERE  1 = 1
			               <!--Start Condition  -->
			                 
			               <!-- Filter1.CCP_STUS_ID = 1 -->
			              
			              <if test=" '' != calOrdNo and null != calOrdNo"> 
			                 AND  Filter1.SALES_ORD_NO LIKE '%'||#{calOrdNo}||'%'   
			              </if>   
			               
			              <if test=" '' != calStartDate and null != calStartDate"> 
			                 AND  Filter1.SALES_DT >= TO_DATE(#{calStartDate}||' 00:00:00', 'DD-MM-YYYY HH24:MI:SS')     
			              </if>
			               
			              <if test=" '' != calEndDate and null != calEndDate"> 
			                 <![CDATA[
                             AND  Filter1.SALES_DT <= TO_DATE(#{calEndDate} ||' 23:59:59', 'DD-MM-YYYY HH24:MI:SS')     
                             ]]>
			              </if>
			               
			               <if test=" '' != calBranch and null != calBranch"> 
        			          AND Extent13.BRNCH_ID IN
        			          <foreach collection="arryCalBranch" item="value" open="(" separator="," close=")">
        			             #{value}
        			          </foreach>       
			               </if>
			               
			               <if test=" '' != calDscBranch and null != calDscBranch"> 
			                 AND  Filter1.BRANCHID2 = #{calDscBranch}
			               </if>
			               
			               <if test=" '' != calCustName and null != calCustName"> 
			                 AND  UPPER(Filter1.NAME3) LIKE '%'||UPPER(#{calCustName})||'%' 
			               </if>
			               
			               <if test=" '' != calNric and null != calNric"> 
			                 AND  UPPER(Filter1.NRIC1) LIKE '%'||UPPER(#{calNric})||'%'  
			               </if>
			               
			               <if test=" '' != calProductId and null != calProductId"> 
                             AND  Filter1.STK_ID = #{calProductId}
                           </if>
			               
			               <if test=" '' != calCcpType and null != calCcpType  "> 
			                 AND  Filter1.CCP_TYPE_ID = #{calCcpType}
			               </if>
			               
			               <if test=" '' != calScheme and null != calScheme"> 
			                 AND  Filter1.CCP_SCHEME_TYPE_ID = #{calScheme}
			               </if>
			               
			               <if test=" '' != calOrdRefNo and null != calOrdRefNo"> 
			                 AND  UPPER(Filter1.REF_NO) LIKE '%'||UPPER(#{calOrdRefNo})||'%'  
			               </if>
			              
			              <if test=" '' != calRegion and null != calRegion"> 
			                 AND  Extent13.REGN_ID = #{calRegion}
			              </if>
			               
			               <if test=" '' != calUpdator and null != calUpdator">
			                  AND  UPPER(Filter1.USERNAME3) =  UPPER(#{calUpdator})
			               </if>
			              <!--End Condition  -->                      
			  ORDER BY Filter1.CCP_ID ASC

</select>

<select id="getPrgId"  parameterType="Map" resultType="egovMap">
			SELECT 
			    LOG_ID ,
			    LOG_CRT_DT ,
			    LOG_CRT_USER_ID ,
			    C1 ,
			    IS_LOK ,
			    LOG_DT ,
			    SALES_ORD_ID ,
			    PRGRS_ID ,
			    PRGRS ,
			    REF_ID  
			  FROM ( SELECT Project1.LOG_ID   ,
			                Project1.LOG_CRT_DT   ,
			                Project1.LOG_CRT_USER_ID   ,
			                Project1.C1   ,
			                Project1.IS_LOK   ,
			                Project1.LOG_DT   ,
			                Project1.SALES_ORD_ID   ,
			                Project1.PRGRS_ID   ,
			                Project1.PRGRS   ,
			                Project1.REF_ID   
						  FROM ( SELECT Extent1.LOG_ID   ,
						                Extent1.SALES_ORD_ID   ,
						                Extent1.PRGRS_ID   ,
						                Extent1.LOG_DT   ,
						                Extent1.REF_ID   ,
						                Extent1.IS_LOK   ,
						                Extent1.LOG_CRT_USER_ID   ,
						                Extent1.LOG_CRT_DT   ,
						                Extent2.PRGRS   ,
						                CASE WHEN ( Extent3.USER_ID IS NOT NULL ) THEN Extent3.USER_NAME ELSE '' END C1  
							         FROM SAL0009D Extent1
							                JOIN SAL0010M Extent2   ON Extent2.PRGRS_ID = Extent1.PRGRS_ID
							                LEFT JOIN SYS0047M Extent3   ON Extent3.USER_ID = Extent1.LOG_CRT_USER_ID
							          WHERE  Extent1.SALES_ORD_ID = #{salesOrdId} ) Project1
			  ORDER BY Project1.LOG_ID DESC )
			  <![CDATA[
			  WHERE ROWNUM <= 1
			  ]]>
</select>


<select id="getOrderUnitList" parameterType="Map" resultType="egovMap">
    SELECT Extent4.SCRE_EVENT_ID CODE_ID  ,
       Extent4.SCRE_EVENT_CODE   ,
       Extent4.SCRE_EVENT_DESC CODE_NAME  ,
       Extent4.SCRE_EVENT_POINT_START   ,
       Extent4.SCRE_EVENT_POINT_END   ,
       Extent4.SCRE_EVENT_POINT   ,
       Extent4.SCRE_EVENT_TOT_POINT   ,
       Extent4.SCRE_EVENT_STUS_ID   ,
       Extent4.SCRE_EVENT_UPD_USER_ID   ,
       Extent4.SCRE_EVENT_UPD_DT   ,
       Extent4.SCRE_EVENT_PREV_SETT_ID   
  FROM SYS0009M Extent1
         JOIN SYS0008M Extent2   ON Extent1.CCP_MASTER_ID = Extent2.SCRE_CTGRY_MASTER_ID
         JOIN SYS0011M Extent3   ON Extent2.SCRE_CTGRY_ID = Extent3.SCRE_CTGRY_ID
         JOIN SYS0010M Extent4   ON Extent3.SCRE_CTGRY_EVENT_ID = Extent4.SCRE_EVENT_ID
 WHERE   Extent1.CCP_MASTER_ID = #{ccpMasterId} 
     AND  Extent2.SCRE_CTGRY_TYPE_ID = #{screCtgryTypeId} 
</select>

<select id="countOrderUnit" parameterType="Map" resultType="egovMap">
 SELECT Extent1.SALES_ORD_ID   , 
       Extent1.SALES_ORD_NO   ,
       Extent1.REF_NO   ,
       Extent1.SALES_DT   ,
       Extent1.CUST_ID   ,
       Extent1.CUST_CNT_ID   ,
       Extent1.CUST_ADD_ID   ,
       Extent1.MEM_ID   ,
       Extent1.BRNCH_ID   ,
       Extent1.APP_TYPE_ID   ,       
       Extent1.TOT_AMT   ,
       Extent1.PROMO_ID   ,
       Extent1.BINDING_NO   ,
       Extent1.CC_PROMO_ID   ,
       Extent1.TOT_PV   ,
       Extent1.REM   ,
       Extent1.PV_MONTH   ,
       Extent1.PV_YEAR   ,
       Extent1.STUS_CODE_ID   ,
       Extent1.UPD_DT   ,
       Extent1.UPD_USER_ID   ,
       Extent1.SYNC_CHK   ,
       Extent1.CUST_PO_NO   ,
       Extent1.REN_CHK_ID   ,
       Extent1.INST_PRIOD   ,
       Extent1.DO_NO   ,
       Extent1.DEPT_CODE   ,
       Extent1.GRP_CODE   ,
       Extent1.ORG_CODE   ,
       Extent1.SALES_ORD_ID_OLD   ,
       Extent1.EDIT_TYPE_ID   ,
       Extent1.CUST_BILL_ID   ,
       Extent1.MTH_RENT_AMT   ,
       Extent1.LOK   ,
       Extent1.AEON_STUS_ID   ,
       Extent1.COMM_DT   ,
       Extent1.CRT_USER_ID   ,
       Extent1.CRT_DT   ,
       Extent1.PAY_COM_DT   ,
       Extent1.DEF_RENT_AMT   ,
       Extent1.REF_DOC_ID   ,       
       Extent1.SALES_HM_ID   ,
       Extent1.SALES_SM_ID   ,
       Extent1.SALES_GM_ID   ,
       Extent1.ADV_BILL   ,
       Extent1.CNVR_SCHEME_ID   ,
       Extent1.CUST_CARE_CNT_ID   
  FROM SAL0001D Extent1
 WHERE  ( Extent1.CUST_ID = #{custId} )
          AND ( 66 = Extent1.APP_TYPE_ID )
          AND ( 4 = Extent1.STUS_CODE_ID )
</select>

<select id="comboUnitSelectValue" parameterType="Map" resultType="egovMap">
SELECT Extent3.SCRE_EVENT_ID   ,
       Extent3.SCRE_EVENT_CODE   ,
       Extent3.SCRE_EVENT_DESC   ,
       Extent3.SCRE_EVENT_POINT_START   ,
       Extent3.SCRE_EVENT_POINT_END   ,
       Extent3.SCRE_EVENT_POINT   ,
       Extent3.SCRE_EVENT_TOT_POINT   ,
       Extent3.SCRE_EVENT_STUS_ID   ,
       Extent3.SCRE_EVENT_UPD_USER_ID   ,
       Extent3.SCRE_EVENT_UPD_DT   ,
       Extent3.SCRE_EVENT_PREV_SETT_ID   
  FROM SYS0008M Extent1
         LEFT JOIN SYS0011M Extent2   ON Extent1.SCRE_CTGRY_ID = Extent2.SCRE_CTGRY_ID
         JOIN SYS0010M Extent3   ON Extent2.SCRE_CTGRY_EVENT_ID = Extent3.SCRE_EVENT_ID
 WHERE  ( Extent1.SCRE_CTGRY_TYPE_ID = #{ctgyTyId} )
          AND ( Extent1.SCRE_CTGRY_MASTER_ID = #{ctgyMstId} )
          <![CDATA[
          AND ( Extent3.SCRE_EVENT_POINT_START <= #{unitCount} )
          ]]>
          AND ( Extent3.SCRE_EVENT_POINT_END >= #{unitCount} )
          <![CDATA[
          AND ROWNUM <= 1
          ]]>
</select>

<select id="getScorePointByEventID"  parameterType="Map" resultType="egovMap">
			    SELECT Extent1.SCRE_EVENT_ID   ,
			       Extent1.SCRE_EVENT_CODE   ,
			       Extent1.SCRE_EVENT_DESC   ,
			       Extent1.SCRE_EVENT_POINT_START   ,
			       Extent1.SCRE_EVENT_POINT_END   ,
			       TO_CHAR(Extent1.SCRE_EVENT_POINT , 'FM9999999999990.0') SCRE_EVENT_POINT  ,
			       Extent1.SCRE_EVENT_TOT_POINT   ,
			       Extent1.SCRE_EVENT_STUS_ID   ,
			       Extent1.SCRE_EVENT_UPD_USER_ID   ,
			       Extent1.SCRE_EVENT_UPD_DT   ,
			       Extent1.SCRE_EVENT_PREV_SETT_ID   
			  FROM SYS0010M Extent1
			 WHERE  Extent1.SCRE_EVENT_ID = #{orderUnit}
</select>

<select id="getScoreEventTotalRental"  parameterType="Map" resultType="java.lang.Double">
SELECT 
        NVL(SUM(Filter1.MTH_RENT_AMT), 0) RENT_SUM 
             
  FROM ( SELECT 
               Extent1.SALES_ORD_ID SALESORDERID1  ,
                Extent1.SALES_ORD_NO SALES_ORD_NO  ,
                Extent1.REF_NO REF_NO  ,
                Extent1.SALES_DT SALES_DT  ,
                Extent1.CUST_ID CUST_ID  ,
                Extent1.CUST_CNT_ID CUST_CNT_ID  ,
                Extent1.CUST_ADD_ID CUST_ADD_ID  ,
                Extent1.MEM_ID MEM_ID  ,
                Extent1.BRNCH_ID BRNCH_ID  ,
                Extent1.APP_TYPE_ID APP_TYPE_ID  ,
                Extent1.TOT_AMT TOT_AMT  ,
                Extent1.PROMO_ID PROMO_ID  ,
                Extent1.BINDING_NO BINDING_NO  ,
                Extent1.CC_PROMO_ID CC_PROMO_ID  ,
                Extent1.TOT_PV TOT_PV  ,
                Extent1.REM REM  ,
                Extent1.PV_MONTH PV_MONTH  ,
                Extent1.PV_YEAR PV_YEAR  ,
                Extent1.STUS_CODE_ID STATUSCODEID1  ,
                Extent1.UPD_DT UPDATED1  ,
                Extent1.UPD_USER_ID UPDATOR1  ,
                Extent1.SYNC_CHK SYNC_CHK  ,
                Extent1.CUST_PO_NO CUST_PO_NO  ,
                Extent1.REN_CHK_ID REN_CHK_ID  ,
                Extent1.INST_PRIOD INST_PRIOD  ,
                Extent1.DO_NO DO_NO  ,
                Extent1.DEPT_CODE DEPT_CODE  ,
                Extent1.GRP_CODE GRP_CODE  ,
                Extent1.ORG_CODE ORG_CODE  ,
                Extent1.SALES_ORD_ID_OLD SALES_ORD_ID_OLD  ,
                Extent1.EDIT_TYPE_ID EDIT_TYPE_ID  ,
                Extent1.CUST_BILL_ID CUST_BILL_ID  ,
                Extent1.MTH_RENT_AMT MTH_RENT_AMT  ,
                Extent1.LOK ,
                Extent1.AEON_STUS_ID AEON_STUS_ID  ,
                Extent1.COMM_DT COMM_DT  ,
                Extent1.CRT_USER_ID CREATOR1  ,
                Extent1.CRT_DT CREATED1  ,
                Extent1.PAY_COM_DT PAY_COM_DT  ,
                Extent1.DEF_RENT_AMT DEF_RENT_AMT  ,
                Extent1.REF_DOC_ID REF_DOC_ID  ,
                Extent1.SALES_HM_ID SALES_HM_ID  ,
                Extent1.SALES_SM_ID SALES_SM_ID  ,
                Extent1.SALES_GM_ID SALES_GM_ID  ,
                Extent1.ADV_BILL ADV_BILL  ,
                Extent1.CNVR_SCHEME_ID CNVR_SCHEME_ID  ,
                Extent1.CUST_CARE_CNT_ID CUST_CARE_CNT_ID  ,
                Extent2.INSTALL_ENTRY_ID INSTALL_ENTRY_ID                 
         FROM SAL0001D Extent1
                JOIN SAL0046D Extent2   ON Extent1.SALES_ORD_ID = Extent2.SALES_ORD_ID
          WHERE  ( 66 = Extent1.APP_TYPE_ID )
                   AND ( Extent1.STUS_CODE_ID IN ( 4,10 )
                  ) ) Filter1
         JOIN ( SELECT ( SELECT MIN(Extent6.INSTALL_ENTRY_ID)  A1  
                         FROM SAL0001D Extent5
                                JOIN SAL0046D Extent6   ON Extent5.SALES_ORD_ID = Extent6.SALES_ORD_ID
                          WHERE  ( Extent5.CUST_ID = #{custId} )
                                   AND ( Project2.SALES_ORD_ID = Extent6.SALES_ORD_ID )
                                   AND ( 4 = Extent6.STUS_CODE_ID ) ) C1  
                FROM ( SELECT #{custId} AA  ,
                              Distinct1.SALES_ORD_ID SALES_ORD_ID  
                       FROM ( SELECT DISTINCT Extent4.SALES_ORD_ID SALES_ORD_ID  
                              FROM SAL0001D Extent3
                                     JOIN SAL0046D Extent4   ON Extent3.SALES_ORD_ID = Extent4.SALES_ORD_ID
                               WHERE  Extent3.CUST_ID = #{custId} ) Distinct1 ) Project2 ) Project3   ON Filter1.INSTALL_ENTRY_ID = Project3.C1
 WHERE  Filter1.CUST_ID = #{custId}
</select>

<select id="getScoreEventTotalRos" parameterType="Map" resultType="java.lang.Double"> 
  SELECT 
       NVL(SUM(Filter1.RENT_AMT) , 0) RENT_AMT     
  FROM ( SELECT Extent1.CUST_ID CUST_ID  ,
                Extent2.RENT_RUN_ID RENT_RUN_ID  ,
                Extent2.RENT_ID RENT_ID  ,
                Extent2.RENT_SO_ID RENT_SO_ID  ,
                Extent2.RENT_DOC_NO RENT_DOC_NO  ,
                Extent2.RENT_DOC_TYPE_ID RENT_DOC_TYPE_ID  ,
                Extent2.RENT_DT_TM RENT_DT_TM  ,
                Extent2.RENT_AMT RENT_AMT  ,
                Extent2.RENT_BATCH_NO RENT_BATCH_NO  ,
                Extent2.RENT_INST_NO RENT_INST_NO  ,
                Extent2.RENT_UPD_USER_ID RENT_UPD_USER_ID  ,
                Extent2.RENT_UPD_DT RENT_UPD_DT  ,
                Extent2.RENT_IS_SYNC RENT_IS_SYNC  ,
                Extent2.RENT_BILL_RUNNG_TOT RENT_BILL_RUNNG_TOT  ,
                Extent2.R01 R01  ,
                Extent2.R02 R02  ,
                Extent3.INSTALL_ENTRY_ID INSTALL_ENTRY_ID  
         FROM SAL0001D Extent1
                JOIN PAY0022D Extent2   ON Extent1.SALES_ORD_ID = Extent2.RENT_SO_ID
                JOIN SAL0046D Extent3   ON Extent1.SALES_ORD_ID = Extent3.SALES_ORD_ID
          WHERE  ( 66 = Extent1.APP_TYPE_ID )
                   AND ( Extent1.STUS_CODE_ID IN ( 4,10 )
                  ) ) Filter1
         JOIN ( SELECT ( SELECT MIN(Extent7.INSTALL_ENTRY_ID)  A1  
                         FROM SAL0001D Extent6
                                JOIN SAL0046D Extent7   ON Extent6.SALES_ORD_ID = Extent7.SALES_ORD_ID
                          WHERE  ( Extent6.CUST_ID = #{custId} )
                                   AND ( Project2.SALES_ORD_ID = Extent7.SALES_ORD_ID )
                                   AND ( 4 = Extent7.STUS_CODE_ID ) ) C1  
                FROM ( SELECT #{custId} AA  ,
                              Distinct1.SALES_ORD_ID SALES_ORD_ID  
                       FROM ( SELECT DISTINCT Extent5.SALES_ORD_ID SALES_ORD_ID  
                              FROM SAL0001D Extent4
                                     JOIN SAL0046D Extent5   ON Extent4.SALES_ORD_ID = Extent5.SALES_ORD_ID
                               WHERE  Extent4.CUST_ID = #{custId} ) Distinct1 ) Project2 ) Project3   ON Filter1.INSTALL_ENTRY_ID = Project3.C1
 WHERE  Filter1.CUST_ID = #{custId}
</select>

<select id="getScoreEventSuspension" parameterType="Map" resultType="egovMap"> 
   SELECT GroupBy2.K1 SALES_ORD_ID  ,
       GroupBy2.K2 SALES_ORD_NO  , 
       GroupBy2.RENT_AMT_SUM  ,
       GroupBy2.RENT_INST_NO ,
       GroupBy2.K4 TOT_AMT  
  FROM ( SELECT Extent1.SALES_ORD_ID K1  ,
                Extent1.SALES_ORD_NO K2  ,
                Extent1.CUST_ID K3  ,
                Extent1.TOT_AMT K4  ,
                SUM(Extent2.RENT_AMT)  RENT_AMT_SUM  ,
                MAX(UTILS.CONVERT_TO_FLOAT(Extent2.RENT_INST_NO,53))  RENT_INST_NO  
         FROM SAL0001D Extent1
                JOIN PAY0022D Extent2   ON Extent1.SALES_ORD_ID = Extent2.RENT_SO_ID
                JOIN SAL0046D Extent3   ON Extent1.SALES_ORD_ID = Extent3.SALES_ORD_ID
                JOIN ( SELECT ( SELECT MIN(Extent7.INSTALL_ENTRY_ID)  A1  
                                FROM SAL0001D Extent6
                                       JOIN SAL0046D Extent7   ON Extent6.SALES_ORD_ID = Extent7.SALES_ORD_ID
                                 WHERE  ( Extent6.CUST_ID = #{custId} )
                                          AND ( Project2.SALES_ORD_ID = Extent7.SALES_ORD_ID )
                                          AND ( 4 = Extent7.STUS_CODE_ID ) ) C1  
                       FROM ( SELECT #{custId} AA  ,
                                     Distinct1.SALES_ORD_ID SALES_ORD_ID  
                              FROM ( SELECT DISTINCT Extent5.SALES_ORD_ID SALES_ORD_ID  
  FROM SAL0001D Extent4
         JOIN SAL0046D Extent5   ON Extent4.SALES_ORD_ID = Extent5.SALES_ORD_ID
 WHERE  Extent4.CUST_ID = #{custId} ) Distinct1 ) Project2 ) Project3   ON Extent3.INSTALL_ENTRY_ID = Project3.C1
          WHERE  ( 66 = Extent1.APP_TYPE_ID )
                   AND ( Extent1.CUST_ID = #{custId} )
           GROUP BY Extent1.SALES_ORD_ID,Extent1.SALES_ORD_NO,Extent1.CUST_ID,Extent1.TOT_AMT ) GroupBy2
</select>

<select id="rentalSchemeStatusByOrdId" parameterType="Map" resultType="egovMap"> 
    SELECT Extent1.REN_SCH_ID   ,
       Extent1.SALES_ORD_ID   ,
       Extent1.STUS_CODE_ID   , 
       Extent1.REN_SCH_DT   ,
       Extent1.REN_SCH_TERMS   ,
       Extent1.IS_SYNC   
  FROM SAL0071D Extent1
  <![CDATA[
 WHERE  Extent1.SALES_ORD_ID = #{tempOrdId} AND ROWNUM <= 1
 ]]>
</select>

<select id="rentalInstNoByOrdId"  parameterType="Map" resultType="egovMap">
   SELECT 
    T1.RENT_INST_NO 
   FROM 
    (SELECT 
            RENT_INST_NO
       FROM 
            SAL0070D 
       WHERE 
            SALES_ORD_ID = #{tempOrdId}
       <![CDATA[      
       AND RENT_INST_DT <= SYSDATE
       ]]> 
       ORDER BY SAL0070D.RENT_INST_ID DESC) T1
     WHERE ROWNUM = 1
</select>

<select id="getScoreEventExistCust"  parameterType="Map" resultType="egovMap">
		SELECT 
		  T1.RENT_INST_NO
		FROM 
			( SELECT Extent2.RENT_RUN_ID   ,
			       Extent2.RENT_ID   ,
			       Extent2.RENT_SO_ID   ,
			       Extent2.RENT_DOC_NO   ,
			       Extent2.RENT_DOC_TYPE_ID   ,
			       Extent2.RENT_DT_TM   ,
			       Extent2.RENT_AMT   ,
			       Extent2.RENT_BATCH_NO   ,
			       Extent2.RENT_INST_NO   ,
			       Extent2.RENT_UPD_USER_ID   ,
			       Extent2.RENT_UPD_DT   ,
			       Extent2.RENT_IS_SYNC   ,
			       Extent2.RENT_BILL_RUNNG_TOT   ,
			       Extent2.R01 R01  ,
			       Extent2.R02 R02  
			  FROM SAL0001D Extent1
			         JOIN PAY0022D Extent2   ON Extent1.SALES_ORD_ID = Extent2.RENT_SO_ID
			 WHERE   Extent1.CUST_ID = #{custId}
			          AND  66 = Extent1.APP_TYPE_ID 
			          AND  Extent1.STUS_CODE_ID = 4 
			ORDER BY Extent2.RENT_INST_NO DESC ) T1
		WHERE ROWNUM = 1   
</select>

<select id="getCcpStusCodeList"  resultType="egovMap">
		SELECT STUS_CODE_ID CODE_ID,
		           CODE ,
		           NAME CODE_NAME
		FROM  
		           SYS0038M 
		WHERE  STUS_CODE_ID IN (1, 5 , 6)
</select>

<select id="getCcpRejectCodeList"  resultType="egovMap">
        SELECT STUS_CODE_ID CODE_ID,
                   CODE ,
                   NAME CODE_NAME
        FROM  
                   SYS0038M 
        WHERE  STUS_CODE_ID IN (1, 12 , 13, 17 , 18 ,10)
</select>

<select id="getCcpByCcpId" parameterType="Map" resultType="egovMap">
SELECT Extent1.CCP_ID   ,
       Extent3.SALES_ORD_NO   ,
       Extent3.CRT_DT   ,
       Extent4.USER_NAME   ,
       Extent3.SALES_ORD_ID   ,
       Extent1.CCP_TYPE_ID   ,
       Extent13.CODE_NAME   ,
       Extent3.REF_NO   ,
       Extent9.CUST_ID   ,
       Extent9.NAME   ,
       Extent9.NRIC   ,
       Extent7.TEL_M1   ,
       CASE WHEN ( 969 = Extent1.CCP_SCHEME_TYPE_ID ) THEN 0 ELSE 1 END CCP_SCHEME_TYPE_ID  ,
       Extent9.DOB   ,
       Extent12.STK_CODE   ,
       Extent12.STK_DESC   ,
       Extent3.SALES_DT   ,
       Extent14.NAME NAME1  ,
       Extent17.BRNCH_ID   ,
       Extent17.NAME NAME2  ,
       Extent1.CCP_TOT_SCRE_POINT   ,
       Extent1.CCP_STUS_ID   ,
       Extent15.NAME NAME3  ,
       CASE WHEN ( Extent18.RESN_ID IS NULL ) THEN 0 ELSE Extent18.RESN_ID END RESN_ID  ,
       CASE WHEN ( Extent18.RESN_DESC IS NULL ) THEN '' ELSE Extent18.RESN_DESC END RESN_DESC  ,
       CASE WHEN ( Extent1.CCP_REM IS NULL ) THEN NULL ELSE Extent1.CCP_REM END CCP_REM  ,
       CASE WHEN ( Extent1.CCP_PNC_REM IS NULL ) THEN NULL ELSE Extent1.CCP_PNC_REM END CCP_PNC_REM  ,
       CASE WHEN ( Extent1.CCP_RJ_STUS_ID IS NULL ) THEN 0 ELSE Extent1.CCP_RJ_STUS_ID END CCP_RJ_STUS_ID  ,
       CASE WHEN ( Extent16.NAME IS NULL ) THEN ' ' ELSE Extent16.NAME END NAME4  ,
       CASE WHEN ( 1 = Extent1.CCP_IS_LOU ) THEN 1 ELSE 0 END CCP_IS_LOU  ,
       CASE WHEN ( 1 = Extent1.CCP_IS_SAMAN ) THEN 1 ELSE 0 END CCP_IS_SAMAN  ,
       CASE WHEN ( 1 = Extent1.CCP_IS_HOLD ) THEN 1 ELSE 0 END CCP_IS_HOLD  ,
       CASE WHEN ( Extent10.SCRE_CTGRY_ID IS NOT NULL ) THEN Extent10.SCRE_CTGRY_ID ELSE 0 END SCRE_CTGRY_ID  ,
       Extent10.SCRE_CTGRY_DESC   ,
       Extent1.CCP_UPD_DT   ,
       Extent2.USER_NAME USERNAME1  ,
       NVL(Extent8.MODE_ID , 0)  MODE_ID ,
       '' C12  ,
       Extent6.AREA_ID      
  FROM SAL0102D Extent1
         LEFT JOIN SYS0047M Extent2   ON Extent1.CCP_UPD_USER_ID = Extent2.USER_ID
         JOIN SAL0001D Extent3   ON Extent1.CCP_SALES_ORD_ID = Extent3.SALES_ORD_ID
         LEFT JOIN SYS0047M Extent4   ON Extent3.CRT_USER_ID = Extent4.USER_ID
         LEFT JOIN SAL0045D Extent5   ON Extent3.SALES_ORD_ID = Extent5.SALES_ORD_ID
         LEFT JOIN SAL0023D Extent6   ON Extent5.ADD_ID = Extent6.CUST_ADD_ID
         LEFT JOIN SAL0027D Extent7   ON Extent3.CUST_CNT_ID = Extent7.CUST_CNTC_ID
         LEFT JOIN SAL0074D Extent8   ON Extent3.SALES_ORD_ID = Extent8.SALES_ORD_ID
         JOIN SAL0029D Extent9   ON Extent3.CUST_ID = Extent9.CUST_ID
         LEFT JOIN SYS0008M Extent10   ON Extent1.CCP_INCOME_RANGE_ID = Extent10.SCRE_CTGRY_ID
         JOIN SAL0002D Extent11   ON Extent3.SALES_ORD_ID = Extent11.SALES_ORD_ID
         JOIN SYS0026M Extent12   ON Extent11.ITM_STK_ID = Extent12.STK_ID
         LEFT JOIN SYS0013M Extent13   ON Extent1.CCP_TYPE_ID = Extent13.CODE_ID
         LEFT JOIN SYS0038M Extent14   ON Extent3.STUS_CODE_ID = Extent14.STUS_CODE_ID
         LEFT JOIN SYS0038M Extent15   ON Extent1.CCP_STUS_ID = Extent15.STUS_CODE_ID
         LEFT JOIN SYS0038M Extent16   ON Extent1.CCP_RJ_STUS_ID = Extent16.STUS_CODE_ID
         JOIN SYS0005M Extent17   ON Extent3.BRNCH_ID = Extent17.BRNCH_ID
         LEFT JOIN SYS0032M Extent18   ON Extent1.CCP_RESN_ID = Extent18.RESN_ID
        LEFT JOIN SYS0064M Extent19   ON Extent6.AREA_ID = Extent19.AREA_ID
        <![CDATA[
 WHERE  Extent1.CCP_ID = #{groupCode} AND ROWNUM <= 1
 ]]>
</select>


<select id="getIncomeRangeList"  parameterType="Map" resultType="egovMap"> 
    SELECT Extent2.SCRE_CTGRY_ID  CODE_ID ,
       Extent2.SCRE_CTGRY_MASTER_ID   ,
       Extent2.SCRE_CTGRY_TYPE_ID   ,
       Extent2.SCRE_CTGRY_CODE   ,
       Extent2.SCRE_CTGRY_DESC  CODE_NAME ,
       Extent2.SCRE_CTGRY_STUS_ID   ,
       Extent2.SCRE_CTGRY_CRT_USER_ID   ,
       Extent2.SCRE_CTGRY_CRT_DT   
  FROM SYS0009M Extent1
         LEFT JOIN SYS0008M Extent2   ON Extent1.CCP_MASTER_ID = Extent2.SCRE_CTGRY_MASTER_ID
 WHERE  ( Extent1.CCP_MASTER_PAY_TYPE_ID = #{rentPayModeId} )
          AND ( Extent1.CCP_MASTER_APLICNT_TYPE_ID = #{applicantTypeId} )
</select>

<resultMap type="egovMap" id="ccpInfoCLOBMap">
    <result property="CCP_REM" column="CCP_REM" jdbcType="CLOB" javaType="java.lang.String"/>
    <result property="CCP_PNC_REM" column="CCP_PNC_REM" jdbcType="CLOB" javaType="java.lang.String"/>
</resultMap>

<select id="selectCcpInfoByCcpId"  parameterType="Map" resultMap="ccpInfoCLOBMap" > 
    SELECT Extent1.CCP_ID   ,
       Extent1.CCP_STUS_ID   ,
       Extent1.CCP_TOT_SCRE_POINT   ,
       Extent1.CCP_INCOME_RANGE_ID   ,
       Extent2.NAME   ,
       CASE WHEN ( Extent1.CCP_REM IS NULL ) THEN NULL ELSE Extent1.CCP_REM END CCP_REM ,
       CASE WHEN ( Extent1.CCP_PNC_REM IS NULL ) THEN NULL ELSE Extent1.CCP_PNC_REM END CCP_PNC_REM ,
       CASE WHEN ( Extent3.RESN_ID IS NULL ) THEN 0 ELSE Extent3.RESN_ID END RESN_ID ,
       CASE WHEN ( Extent3.RESN_DESC IS NULL ) THEN '' ELSE Extent3.RESN_DESC END RESN_DESC ,
       CASE WHEN ( 1 = Extent1.CCP_IS_LOU ) THEN 1 ELSE 0 END CCP_IS_LOU ,
       CASE WHEN ( 1 = Extent1.CCP_IS_SAMAN ) THEN 1 ELSE 0 END CCP_IS_SAMAN ,
       CASE WHEN ( 1 = Extent1.CCP_IS_HOLD ) THEN 1 ELSE 0 END CCP_IS_HOLD ,
       CASE WHEN ( Extent5.NAME IS NULL ) THEN '' ELSE Extent5.NAME END NAME1  ,
       CASE WHEN ( Extent4.SCRE_CTGRY_DESC IS NULL ) THEN '' ELSE Extent4.SCRE_CTGRY_DESC END SCRE_CTGRY_DESC ,
       CASE WHEN ( Extent1.CCP_FICO IS NULL ) THEN 0 ELSE Extent1.CCP_FICO END CCP_FICO,
       NVL(Extent1.CCP_RJ_STUS_ID , 0) CCP_RJ_STUS_ID   
  FROM SAL0102D Extent1
         LEFT JOIN SYS0038M Extent2   ON Extent1.CCP_STUS_ID = Extent2.STUS_CODE_ID
         LEFT JOIN SYS0032M Extent3   ON Extent1.CCP_RESN_ID = Extent3.RESN_ID
         LEFT JOIN SYS0008M Extent4   ON Extent1.CCP_INCOME_RANGE_ID = Extent4.SCRE_CTGRY_ID
         LEFT JOIN SYS0038M Extent5   ON Extent1.CCP_RJ_STUS_ID = Extent5.STUS_CODE_ID
<![CDATA[        
 WHERE  Extent1.CCP_ID = #{ccpId} 
 AND ROWNUM <= 1
 ]]> 
</select>

<select id="selectSalesManViewByOrdId" parameterType="Map" resultType="egovMap">
    SELECT Limit1.SALES_ORD_ID   ,
       CASE WHEN ( Limit1.ORG_CODE IS NOT NULL ) THEN Limit1.ORG_CODE ELSE '' END ORG_CODE  ,
       CASE WHEN ( Limit1.MEMBERID1 IS NOT NULL ) THEN Limit1.MEMBERCODE1 ELSE '' END MEMBERCODE1  ,
       CASE WHEN ( Limit1.MEMBERID1 IS NOT NULL ) THEN Limit1.NAME1 ELSE '' END NAME1  ,
       CASE WHEN ( Limit1.TELMOBILE1 IS NOT NULL ) THEN Limit1.TELMOBILE1 ELSE '' END TELMOBILE1  ,
       CASE WHEN ( Limit1.GRP_CODE IS NOT NULL ) THEN Limit1.GRP_CODE ELSE '' END GRP_CODE  ,
       CASE WHEN ( Limit1.MEMBERID2 IS NOT NULL ) THEN Limit1.MEMBERCODE2 ELSE '' END MEMBERCODE2  ,
       CASE WHEN ( Limit1.MEMBERID2 IS NOT NULL ) THEN Limit1.NAME2 ELSE '' END NAME2  ,
       CASE WHEN ( Limit1.MEMBERID2 IS NOT NULL ) THEN Limit1.TELMOBILE2 ELSE '' END TELMOBILE2  ,
       CASE WHEN ( Limit1.DEPT_CODE IS NOT NULL ) THEN Limit1.DEPT_CODE ELSE '' END DEPT_CODE  ,
       CASE WHEN ( Limit1.MEMBERID3 IS NOT NULL ) THEN Limit1.MEMBERCODE3 ELSE '' END MEMBERCODE3  ,
       CASE WHEN ( Limit1.MEMBERID3 IS NOT NULL ) THEN Limit1.NAME3 ELSE '' END NAME3  ,
       CASE WHEN ( Limit1.TELMOBILE3 IS NOT NULL ) THEN Limit1.TELMOBILE3 ELSE '' END TELMOBILE3  ,
       CASE WHEN ( Limit1.MEM_ID IS NOT NULL ) THEN Limit1.MEM_CODE ELSE '' END MEM_CODE  ,
       CASE WHEN ( Limit1.MEM_ID IS NOT NULL ) THEN Limit1.NAME ELSE '' END NAME  ,
       CASE WHEN ( Limit1.TEL_MOBILE IS NOT NULL ) THEN Limit1.TEL_MOBILE ELSE '' END TEL_MOBILE  ,
       CASE WHEN ( Limit1.TEL_HUSE IS NOT NULL ) THEN Limit1.TEL_HUSE ELSE '' END TEL_HUSE  ,
       CASE WHEN ( Limit1.MEM_ID IS NOT NULL ) THEN Limit1.NRIC ELSE '' END NRIC  ,
       CASE WHEN ( Limit1.TEL_OFFICE IS NOT NULL ) THEN Limit1.TEL_OFFICE ELSE '' END TEL_OFFICE  ,
       CASE WHEN ( Limit1.MEM_TYPE IS NOT NULL ) THEN Limit1.MEM_TYPE ELSE 0 END MEM_TYPE  
  FROM ( SELECT Extent1.SALES_ORD_ID   ,
                Extent1.DEPT_CODE   ,
                Extent1.GRP_CODE   ,
                Extent1.ORG_CODE   ,
                Extent2.MEM_ID   ,
                Extent2.MEM_CODE   ,
                Extent2.MEM_TYPE   ,
                Extent2.NAME   ,
                Extent2.NRIC   ,
                Extent2.TEL_OFFICE   ,
                Extent2.TEL_HUSE   ,
                Extent2.TEL_MOBILE   ,
                Extent3.MEM_ID MEMBERID1  ,
                Extent3.MEM_CODE MEMBERCODE1  ,
                Extent3.NAME NAME1  ,
                Extent3.TEL_MOBILE TELMOBILE1  ,
                Extent4.MEM_ID MEMBERID2  ,
                Extent4.MEM_CODE MEMBERCODE2  ,
                Extent4.NAME NAME2  ,
                Extent4.TEL_MOBILE TELMOBILE2  ,
                Extent5.MEM_ID MEMBERID3  ,
                Extent5.MEM_CODE MEMBERCODE3  ,
                Extent5.NAME NAME3  ,
                Extent5.TEL_MOBILE TELMOBILE3  
         FROM SAL0001D Extent1
                LEFT JOIN ORG0001D Extent2   ON Extent2.MEM_ID = Extent1.MEM_ID
                LEFT JOIN ORG0001D Extent3   ON Extent3.MEM_ID = Extent1.SALES_GM_ID
                LEFT JOIN ORG0001D Extent4   ON Extent4.MEM_ID = Extent1.SALES_SM_ID
                LEFT JOIN ORG0001D Extent5   ON Extent5.MEM_ID = Extent1.SALES_HM_ID
                <![CDATA[
          WHERE  Extent1.SALES_ORD_ID = #{salesOrderId} AND ROWNUM <= 1 ) Limit1
          ]]>
</select>

<select id="countCallEntry" parameterType="Map" resultType="egovMap">
    SELECT GroupBy1.TOT_COUNT  
  FROM ( SELECT COUNT(1) TOT_COUNT  
         FROM CCR0006D Extent1
         WHERE Extent1.SALES_ORD_ID = #{salesOrdId}
         AND  10 != Extent1.STUS_CODE_ID )GroupBy1
</select>

<update id="updateCcpDecision" parameterType="Map">
			UPDATE SAL0102D
			SET 
			       CCP_SCHEME_TYPE_ID = #{saveCustTypeId},
			       CCP_INCOME_RANGE_ID = #{incomeRangeEdit},
			       CCP_TOT_SCRE_POINT = #{ccpTotalScorePoint},
			       CCP_STUS_ID = #{statusEdit},
			       CCP_RESN_ID = #{reasonCodeEdit},
			       CCP_REM = #{spcialRem},
			       CCP_RJ_STUS_ID = #{rejectStatusEdit},
			       CCP_UPD_DT = SYSDATE,
			       CCP_UPD_USER_ID = #{userId},      
			       CCP_IS_LOU = #{letterOfUdt},
			       CCP_IS_SAMAN =#{summon},
			       CCP_IS_SYNC = #{updateCCPIssynch},
			       CCP_PNC_REM = #{pncRem},
			       CCP_HAS_GRNT = #{hasGrnt},
			       CCP_IS_HOLD = #{onHoldCcp},
			       CCP_FICO = #{ficoScore}       
			WHERE   CCP_ID = #{saveCcpId}
</update>

<select id="getCcpDecisionList" parameterType="Map" resultType="EgovMap">
	    SELECT Extent1.CCP_ITM_ID   ,
	       Extent1.CCP_ID   ,
	       Extent1.CCP_SCRE_EVENT_ID   ,
	       Extent1.CCP_ITM_SCRE_UNIT   ,
	       Extent1.CCP_ITM_POINT_SCRE   ,
	       Extent1.CCP_ITM_REM   ,
	       Extent1.CCP_ITM_UPD_USER_ID   ,
	       Extent1.CCP_ITM_UPD_DT   ,
	       Extent1.CCP_ITM_STUS_ID   
	  FROM SAL0103D Extent1
	 WHERE  Extent1.CCP_ID = #{saveCcpId}
</select>

<update id="updateCcpDecisionStatus" parameterType="egovMap">
		UPDATE 
		    SAL0103D
		SET 
		    CCP_ITM_STUS_ID = #{ccpItmStusId}
		WHERE 
		    CCP_ITM_ID = #{ccpItmId}
</update>

<insert id="insertCcpDecision" parameterType="Map">
			INSERT INTO SAL0103D  (CCP_ITM_ID,
											    CCP_ID, 
											    CCP_SCRE_EVENT_ID,
											    CCP_ITM_SCRE_UNIT,
											    CCP_ITM_POINT_SCRE,
											    CCP_ITM_REM, 
											    CCP_ITM_UPD_USER_ID,
											    CCP_ITM_UPD_DT,
											    CCP_ITM_STUS_ID )
							  VALUES (SAL0103D_CCP_ITM_ID_SEQ.NEXTVAL,
								           #{saveCcpId},
								           #{insCcpScreEventId},
								           #{insCcpItmScreUnit},
								           #{insCcpItmPointScre},
								           NULL, 
								           #{userId},
								           SYSDATE,
								           #{insCcpItmStusId})
</insert>

<update id="updateOrdStus" parameterType="Map">
			UPDATE 
			        SAL0001D
			SET REM = #{ordRem},
			       STUS_CODE_ID = #{ordStusId},
			       UPD_DT = SYSDATE,
			       SYNC_CHK = #{syncChk},
			       UPD_USER_ID = #{userId}
			WHERE   SALES_ORD_ID = #{saveOrdId} 
    
</update>

<select id="getCancelOrd" parameterType="Map" resultType="EgovMap">
SELECT Extent1.SALES_ORD_ID   , 
       Extent1.SALES_ORD_NO   ,
       Extent1.REF_NO   ,
       Extent1.SALES_DT   ,
       Extent1.CUST_ID   ,
       Extent1.CUST_CNT_ID   ,
       Extent1.CUST_ADD_ID   ,
       Extent1.MEM_ID   ,
       Extent1.BRNCH_ID   ,
       Extent1.APP_TYPE_ID   ,       
       Extent1.TOT_AMT   ,
       Extent1.PROMO_ID   ,
       Extent1.BINDING_NO   ,
       Extent1.CC_PROMO_ID   ,
       Extent1.TOT_PV   ,
       Extent1.REM   ,
       Extent1.PV_MONTH   ,
       Extent1.PV_YEAR   ,
       Extent1.STUS_CODE_ID   ,
       Extent1.UPD_DT   ,
       Extent1.UPD_USER_ID   ,
       Extent1.SYNC_CHK   ,
       Extent1.CUST_PO_NO   ,
       Extent1.REN_CHK_ID   ,
       Extent1.INST_PRIOD   ,
       Extent1.DO_NO   ,
       Extent1.DEPT_CODE   ,
       Extent1.GRP_CODE   ,
       Extent1.ORG_CODE   ,
       Extent1.SALES_ORD_ID_OLD   ,
       Extent1.EDIT_TYPE_ID   ,
       Extent1.CUST_BILL_ID   ,
       Extent1.MTH_RENT_AMT   ,
       Extent1.LOK   ,
       Extent1.AEON_STUS_ID   ,
       Extent1.COMM_DT   ,
       Extent1.CRT_USER_ID   ,
       Extent1.CRT_DT   ,
       Extent1.PAY_COM_DT   ,
       Extent1.DEF_RENT_AMT   ,
       Extent1.REF_DOC_ID   ,       
       Extent1.SALES_HM_ID   ,
       Extent1.SALES_SM_ID   ,
       Extent1.SALES_GM_ID   ,
       Extent1.ADV_BILL   ,
       Extent1.CNVR_SCHEME_ID   ,
       Extent1.CUST_CARE_CNT_ID 
  FROM SAL0001D Extent1
 <![CDATA[
 WHERE  Extent1.SALES_ORD_ID = #{saveOrdId} AND ROWNUM <= 1
 ]]>
</select>

<select id="getAccRentLedgerAmt" parameterType="Map" resultType="egovMap">
    SELECT 
        SUM(Extent1.RENT_AMT)  RENT_AMT  
    FROM 
        PAY0022D Extent1
    WHERE  
        Extent1.RENT_SO_ID = #{saveOrdId}
</select>

<select id="getAccTradeLedgerAmt" parameterType="Map" resultType="egovMap">
    SELECT 
        SUM(Extent1.TRADE_AMT)  TRADE_AMT  
    FROM 
        PAY0035D Extent1
    WHERE  
        Extent1.TRADE_SO_ID = #{saveOrdId}
</select>

<select id="getCancelItm" parameterType="Map" resultType="egovMap">
		SELECT Extent1.SALES_ORD_ID   ,
		       Extent1.ITM_NO   ,
		       Extent1.ITM_STK_ID   ,
		       Extent1.ITM_PRC_ID   ,
		       Extent1.ITM_QTY   ,
		       Extent1.ITM_PRC   ,
		       Extent1.ITM_PV   ,
		       Extent1.STUS_CODE_ID   ,
		       Extent1.UPD_DT   ,
		       Extent1.UPD_USER_ID   ,
		       Extent1.EDIT_TYPE_ID   ,
		       Extent1.ITM_ID   ,
		       Extent1.ITM_CALL_ENTRY_ID   
		  FROM SAL0002D Extent1
		  <![CDATA[
		 WHERE  Extent1.SALES_ORD_ID = #{saveOrdId} AND ROWNUM <= 1
		 ]]>
</select>

<select id="crtSeqSAL0020D" resultType="java.lang.String">
    SELECT SAL0020D_SO_REQ_ID_SEQ.NEXTVAL FROM DUAL    
</select>

<select id="crtSeqCCR0006D" resultType="java.lang.String">
    SELECT CCR0006D_CALL_ENTRY_ID_SEQ.NEXTVAL FROM DUAL    
</select>

<select id="crtSeqCCR0007D" resultType="java.lang.String">
    SELECT CCR0007D_CALL_RESULT_ID_SEQ.NEXTVAL FROM DUAL    
</select>

<select id="crtSeqSAL0009D" resultType="java.lang.String">
    SELECT SAL0009D_LOG_ID_SEQ.NEXTVAL FROM DUAL
</select>

<insert id="insertOrderCancel"  parameterType="Map" >
INSERT INTO SAL0020D
  ( SO_REQ_ID,
    SO_REQ_SO_ID, 
    SO_REQ_STUS_ID, 
    SO_REQ_RESN_ID,
    SO_REQ_PREV_CALL_ENTRY_ID,
    SO_REQ_CUR_CALL_ENTRY_ID, 
    SO_REQ_CUR_STUS_ID,  
    SO_REQ_CRT_DT, 
    SO_REQ_CRT_USER_ID,
    SO_REQ_UPD_DT,
    SO_REQ_UPD_USER_ID, 
    SO_REQ_CUR_STK_ID, 
    SO_REQ_CUR_APP_TYPE_ID,
    SO_REQ_CUR_AMT, 
    SO_REQ_CUR_PV,
    SO_REQ_CURR_AMT,
    SO_REQ_ACTUAL_CANCL_DT, 
    SO_REQ_CANCL_TOT_OTSTND,
    SO_REQ_CANCL_PNALTY_AMT,
    SO_REQ_CANCL_OB_PRIOD,
    SO_REQ_CANCL_UNDER_COOL_PRIOD,
    SO_REQ_CANCL_RENTAL_OTSTND,
    SO_REQ_CANCL_TOT_USED_PRIOD,
    SO_REQ_NO,
    SO_REQ_CANCL_ADJ_AMT,
    SO_REQSTER,
    SO_REQ_PRE_RETN_DT,
    SO_REQ_REM, 
    SO_REQ_BANK_ACC,
    SO_REQ_ISS_BANK,
    SO_REQ_ACC_NAME,
    SO_REQ_ATTACH )
  VALUES ( #{soReqSeq} ,
            #{saveOrdId},
           #{soReqStatusId},
           #{soReqReasonId}, 
           #{soReqPrevCallEntryId}, 
           #{soReqCurCallEntryId}, 
           #{soReqCurStatusId},
           SYSDATE,
           #{userId},
           SYSDATE,
           #{userId},
           #{soReqCurStkId}, 
           #{soReqCurAppTypeId}, 
           #{soReqCurAmt}, 
           #{soReqCurPv}, 
           #{soReqCurRentAmt}, 
           SYSDATE, 
           #{soReqCancelTotalOutstanding}, 
           #{soReqCancelPenaltyAmt}, 
           #{soReqCancelObPeriod}, 
           #{soReqCancelIsUnderCoolPeriod}, 
           #{soReqCancelRentalOutstanding}, 
           #{soReqCancelTotalUsePeriod},
           #{soReqNo}, 
           #{soReqCancelAdjustmentAmt}, 
           #{soRequestor}, 
           TO_DATE(#{soReqPreReturnDate} , 'DD/MM/YYYY'), 
           #{soReqRemark}, 
           NULL, 
           NULL, 
           NULL, 
           NULL )
</insert>

<insert id="insertCallEntry" parameterType="Map">
    INSERT INTO CCR0006D
  ( CALL_ENTRY_ID,    
    SALES_ORD_ID, 
    TYPE_ID,
    STUS_CODE_ID,
    RESULT_ID,
    DOC_ID,
    CRT_USER_ID,
    CRT_DT,
    CALL_DT,
    IS_WAIT_FOR_CANCL,
    HAPY_CALLER_ID,
    UPD_DT,
    UPD_USER_ID,
    ORI_CALL_DT )
  VALUES ( #{callEntrySeq},
           #{saveOrdId},
           #{callEntryTypeId}, 
           #{callEntryStusCodeId}, 
           #{callEntryMasterResultId},
           #{callEntryDocId},
           #{userId},
           SYSDATE,
           SYSDATE,
           #{callEntryMasterIsWaitForCancel},
           #{callEntryMasterHappyCallerId}, 
           SYSDATE, 
           #{userId},
           SYSDATE )
</insert>

<insert id="insertCallResult" parameterType="Map">
    INSERT INTO CCR0007D
  ( CALL_RESULT_ID,
    CALL_ENTRY_ID,
    CALL_STUS_ID,
    CALL_DT,
    CALL_ACTN_DT, 
    CALL_FDBCK_ID, 
    CALL_CT_ID, 
    CALL_REM, 
    CALL_CRT_USER_ID,
    CALL_CRT_DT,
    CALL_CRT_USER_ID_DEPT,
    CALL_HC_ID,
    CALL_ROS_AMT, 
    CALL_SMS,
    CALL_SMS_REM )
  VALUES ( #{callResultSeq},
           #{callResultEntryId}, 
           #{callResultCallStatusId}, 
           SYSDATE,
           SYSDATE,
           #{callResultCallFeedbackId}, 
           #{callResultCallCtId}, 
           #{callResultCallRem},
           #{userId},
           SYSDATE,
           #{callResultCrtByDept},  
           #{callResultCallHcId},
           #{callResultCallRosAmt},
           #{callResultCallSms}, 
           #{callResultCallSmsRem})
</insert>

<update id="updateCallEntryId" parameterType="Map">
		UPDATE CCR0006D
		   SET RESULT_ID = #{updCallEntryResultId}
		 WHERE   CALL_ENTRY_ID = #{updCallEntryId} 
</update>

<update id="updateOrderRequest"  parameterType="Map">
	    UPDATE SAL0020D
	   SET SO_REQ_CUR_CALL_ENTRY_ID = #{updCallEntryId}
	 WHERE  SO_REQ_ID = #{soReqSeq}
</update>

<insert id="insertLog" parameterType="Map">
INSERT INTO SAL0009D
  ( LOG_ID,
    SALES_ORD_ID, 
    PRGRS_ID,
    LOG_DT,
    REF_ID,
    IS_LOK, 
    LOG_CRT_USER_ID,
    LOG_CRT_DT )
  VALUES ( #{logSeq},
	           #{saveOrdId},
	           #{logProgId},
	           SYSDATE,
	           #{logRefId},
	           #{logIsLock},
	           #{userId},
	           SYSDATE )
</insert>

<select id="chkECash" parameterType="Map" resultType="egovMap">
    SELECT
         ECASH
    FROM 
        SAL0001D
    WHERE 
        SALES_ORD_ID = #{saveOrdId}
    AND
        <![CDATA[
        ROWNUM <= 1
        ]]>    
</select>

<resultMap id="resultRowMap" type="EgovMap">
    <result property="resultRaw" column="RESULT_RAW" jdbcType="CLOB" javaType="java.lang.String"/>
</resultMap>
<select id="getResultRowForCTOSDisplayForCCPCalculation" parameterType="Map" resultMap="resultRowMap">
SELECT
		T1.BATCH_ID,
		T1.ORD_NO,
		T1.CUST_IC,
		T1.CUST_NAME,
		T1.PRCSS,
		T1.FICO_SCRE,
		T1.BATCH_NO,
		T1.RESULT_RAW,
		T1.CTOS_DT,
		T1.UPD_USER_ID,
		T1.CTOS_BANKRUPT,
		T1.ORD_ID,
		T1.CUST_ID,
		T1.MEM_ID,
		T1.CNT
FROM(
		  SELECT
		        BATCH_ID,
			    ORD_NO,
			    CUST_IC,
			    CUST_NAME,
			    PRCSS,
			    FICO_SCRE,
			    BATCH_NO,
			    RESULT_RAW,
			    CTOS_DT,
			    UPD_USER_ID,
			    CTOS_BANKRUPT,
			    ORD_ID,
			    CUST_ID,
			    MEM_ID,
			    ROW_NUMBER() OVER (PARTITION BY CUST_IC ORDER BY CTOS_DT DESC) CNT
		  FROM 
		        SAL0107D
		  WHERE
		        PRCSS = 1
		  AND
		        CTOS_DT IS NOT NULL 
		  AND
		       RESULT_RAW IS NOT NULL
		) T1
WHERE 
      T1.CUST_IC = #{nric}
AND T1.CNT = 1
</select>

</mapper>