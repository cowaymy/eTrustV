<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.coway.trust.biz.sales.ccp.impl.CcpCTOSB2BMapper">


<select id="selectCTOSB2BList" parameterType="Map" resultType="egovMap">
				SELECT
				    Extent1.BATCH_ID,
				    Extent1.FILE_NAME,
				    Extent1.ROW_CNT,
				    Extent2.COMPLE,
				    Extent2.ACT,
				    Extent2.ZERO,
				    Extent2.GT501,
				    Extent2.LT500,
				    TO_CHAR(Extent1.UPD_DT , 'DD/MM/YYYY HH24:MI:SS') UPD_DT,
				    Extent1.STUS,
				    Extent1.UPD_USER_ID
				FROM SAL0106D Extent1 JOIN ( SELECT      
				                                Project1.BATCH_ID, 
				                                SUM(Project1.COMPL) COMPLE,   
				                                SUM(Project1.ACT) ACT,  
				                                SUM(Project1.ZERO) ZERO,   
				                                SUM(Project1.GT501) GT501,  
				                                SUM(Project1.LT500) LT500  
				                            FROM(   SELECT        
				                                        T1.BATCH_ID,
				                                        <![CDATA[      
				                                        CASE WHEN(T2.PRCSS = 1) THEN 1 ELSE 0 END COMPL,   
				                                        CASE WHEN(T2.PRCSS = 0) THEN 1 ELSE 0 END ACT,     
				                                        CASE WHEN(T2.FICO_SCRE = 0) THEN 1 ELSE 0 END ZERO,       
				                                        CASE WHEN(T2.FICO_SCRE > 500) THEN 1 ELSE 0 END GT501,     
				                                        CASE WHEN(T2.FICO_SCRE <= 500 AND T2.FICO_SCRE > 0) THEN 1 ELSE 0 END LT500
				                                    FROM       
				                                        SAL0106D T1 JOIN SAL0107D T2 ON T2.BATCH_ID = T1.BATCH_ID     
				                                        JOIN SAL0001D T3 ON T2.ORD_NO = T3.SALES_ORD_NO     
				                                        JOIN SAL0102D T4 ON T4.CCP_SALES_ORD_ID = T3.SALES_ORD_ID) Project1       
				                             GROUP BY Project1.BATCH_ID) Extent2 ON Extent1.BATCH_ID = Extent2.BATCH_ID
				                             ]]>
				WHERE 1= 1
				<if test=" null != sDate and '' != sDate">
				                     AND Extent1.UPD_DT >= TO_DATE(#{sDate}||' 00:00:00', 'DD-MM-YYYY HH24:MI:SS')
				                </if>
				                <if test="null != eDate and '' != eDate">
				                     AND Extent1.UPD_DT <![CDATA[ <= ]]> TO_DATE(#{eDate} ||' 23:59:59', 'DD-MM-YYYY HH24:MI:SS')
				                </if>
				                
				                <!-- <if test=" null != stusArr and stusArr.length > 0">
				                    AND Extent1.STUS IN
				                    <foreach collection="stusArr" item="item" open="(" separator="," close=")">
				                       #{item}
				                    </foreach>
				                </if> -->
				ORDER BY Extent1.BATCH_ID DESC
</select>

<select id="getCTOSDetailList"  parameterType="Map" resultType="egovMap">
		 SELECT 
                T1.BATCH_ID,
                T1.ORD_NO, 
                T1.CUST_IC,
                T1.CUST_NAME,                
                T1.PRCSS,
                T4.CODE_NAME PRC_NAME,
                CASE WHEN (T1.PRCSS = 2) THEN T3.FICO_SCRE ELSE T1.FICO_SCRE END FICO_SCRE,
                TO_CHAR(T1.CTOS_DT , 'DD/MM/YYYY') CTOS_DT,
                T1.UPD_USER_ID, 
                T1.CTOS_BANKRUPT, 
                NVL(T2.CODE_NAME , ' ') CODE_NAME 
           FROM 
            SAL0107D T1 
            JOIN SYS0013M T2 ON T2.CODE = T1.CTOS_BANKRUPT AND T2.CODE_MASTER_ID = '380'            
            JOIN SAL0029D T3 ON T3.NRIC = T1.CUST_IC
            JOIN SYS0013M T4 ON T4.CODE = T1.PRCSS AND T4.CODE_MASTER_ID = '397'            
            WHERE 1 = 1	 
		 AND BATCH_ID = #{batchId} 
		  <if test=" null != ordNo and '' != ordNo">
		      AND ORD_NO = #{ordNo}
		 </if>
</select>

</mapper>