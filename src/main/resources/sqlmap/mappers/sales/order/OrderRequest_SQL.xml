<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.coway.trust.biz.sales.order.impl.OrderRequestMapper">
    
    <select id="selectResnCodeList" parameterType="Map" resultType="egovMap">
		SELECT T1.RESN_ID CODE
		     , T1.CODE || ' - ' || T1.RESN_DESC CODE_NAME
		  FROM SYS0032M T1
		 WHERE T1.RESN_TYPE_ID = #{resnTypeId}
		   AND T1.STUS_CODE_ID = #{stusCodeId}
		 ORDER BY T1.RESN_ID
    </select>
    
    <select id="selectOrderLastRentalBillLedger1" parameterType="Map" resultType="egovMap">
    <![CDATA[
		SELECT T.RENT_RUN_ID
		     , T.RENT_ID
		     , T.RENT_SO_ID
		     , T.RENT_DOC_NO
		     , T.RENT_DOC_TYPE_ID
		     , T.RENT_DT_TM
		     , T.RENT_AMT
		     , T.RENT_BATCH_NO
		     , T.RENT_INST_NO
		     , T.RENT_UPD_USER_ID
		     , T.RENT_UPD_DT
		     , T.RENT_IS_SYNC
		     , T.RENT_BILL_RUNNG_TOT
		     , T.R01
		     , T.R02
		  FROM
		     ( SELECT T1.RENT_RUN_ID
		            , T1.RENT_ID
		            , T1.RENT_SO_ID
		            , T1.RENT_DOC_NO
		            , T1.RENT_DOC_TYPE_ID
		            , T1.RENT_DT_TM
		            , T1.RENT_AMT
		            , T1.RENT_BATCH_NO
		            , T1.RENT_INST_NO
		            , T1.RENT_UPD_USER_ID
		            , T1.RENT_UPD_DT
		            , T1.RENT_IS_SYNC
		            , T1.RENT_BILL_RUNNG_TOT
		            , T1.R01
		            , T1.R02
		         FROM PAY0022D T1
		         LEFT
		         JOIN PAY0017D T2
		           ON T2.ACC_INV_VOID_INVC_NO = T1.RENT_DOC_NO
		        WHERE T1.RENT_SO_ID = #{salesOrderId}
		          AND ((159 = T1.RENT_DOC_TYPE_ID AND T1.RENT_INST_NO > 0 AND T1.RENT_AMT >= 0  )
		            OR (158 = T1.RENT_DOC_TYPE_ID AND T1.RENT_INST_NO > 0 ))
		          AND T2.ACC_INV_VOID_ID IS NULL
		        ORDER
		           BY T1.RENT_INST_NO DESC
		     ) T
		 WHERE ROWNUM <= 1
    ]]>
    </select>
    
    <insert id="insertSalesReqCancel" parameterType="salesReqCancelVO">
      <selectKey keyProperty="soReqId" resultType="Integer" order="BEFORE">
        SELECT SAL0020D_SO_REQ_ID_SEQ.NEXTVAL FROM DUAL
      </selectKey>
        INSERT
		  INTO SAL0020D 
		     ( SO_REQ_ID
		     , SO_REQ_SO_ID
		     , SO_REQ_STUS_ID
		     , SO_REQ_RESN_ID
		     , SO_REQ_PREV_CALL_ENTRY_ID
		     , SO_REQ_CUR_CALL_ENTRY_ID
		     , SO_REQ_CUR_STUS_ID
		     , SO_REQ_CRT_DT
		     , SO_REQ_CRT_USER_ID
		     , SO_REQ_UPD_DT
		     , SO_REQ_UPD_USER_ID
		     , SO_REQ_CUR_STK_ID
		     , SO_REQ_CUR_APP_TYPE_ID
		     , SO_REQ_CUR_AMT
		     , SO_REQ_CUR_PV
		     , SO_REQ_CURR_AMT
		     , SO_REQ_ACTUAL_CANCL_DT
		     , SO_REQ_CANCL_TOT_OTSTND
		     , SO_REQ_CANCL_PNALTY_AMT
		     , SO_REQ_CANCL_OB_PRIOD
		     , SO_REQ_CANCL_UNDER_COOL_PRIOD
		     , SO_REQ_CANCL_RENTAL_OTSTND
		     , SO_REQ_CANCL_TOT_USED_PRIOD
		     , SO_REQ_NO
		     , SO_REQ_CANCL_ADJ_AMT
		     , SO_REQSTER
		     , SO_REQ_PRE_RETN_DT
		     , SO_REQ_REM
		     , SO_REQ_BANK_ACC
		     , SO_REQ_ISS_BANK
		     , SO_REQ_ACC_NAME
		     , SO_REQ_ATTACH
		     ) 
		VALUES
		     ( #{soReqId}
		     , #{soReqSoId}
		     , #{soReqStusId}
		     , #{soReqResnId}
		     , #{soReqPrevCallEntryId}
		     , #{soReqCurCallEntryId}
		     , #{soReqCurStusId}
		     , SYSDATE
		     , #{soReqCrtUserId}
		     , SYSDATE
		     , #{soReqUpdUserId}
		     , #{soReqCurStkId}
		     , #{soReqCurAppTypeId}
		     , #{soReqCurAmt}
		     , #{soReqCurPv}
		     , #{soReqCurrAmt}
		     , TO_DATE(#{soReqActualCanclDt}, 'DD/MM/YYYY')
		     , #{soReqCanclTotOtstnd}
		     , #{soReqCanclPnaltyAmt}
		     , #{soReqCanclObPriod}
		     , #{soReqCanclUnderCoolPriod}
		     , #{soReqCanclRentalOtstnd}
		     , #{soReqCanclTotUsedPriod}
		     , #{soReqNo}
		     , #{soReqCanclAdjAmt}
		     , #{soReqster}
		     , TO_DATE(#{soReqPreRetnDt}, 'DD/MM/YYYY')
		     , #{soReqRem}
		     , #{soReqBankAcc}
		     , #{soReqIssBank}
		     , #{soReqAccName}
		     , #{soReqAttach}
             )
     </insert>
     
    <select id="selectSalesOrderD" parameterType="Map" resultType="egovMap">
	    SELECT EDIT_TYPE_ID
	         , T1.ITM_CALL_ENTRY_ID
	         , T1.ITM_ID
	         , T1.ITM_NO
	         , T1.ITM_PRC
	         , T1.ITM_PRC_ID
	         , T1.ITM_PV
	         , T1.ITM_QTY
	         , T1.ITM_STK_ID
	         , T1.SALES_ORD_ID
	         , T1.STK_LOC
	         , T1.STUS_CODE_ID
	         , T1.UPD_DT
	         , T1.UPD_USER_ID
	      FROM SAL0002D T1
	     WHERE T1.SALES_ORD_ID = #{salesOrdId}
    </select>
    
    <select id="selectInstallEntry" parameterType="Map" resultType="egovMap">
        SELECT T.INSTALL_ENTRY_ID
             , T.INSTALL_ENTRY_NO
             , T.SALES_ORD_ID
             , T.STUS_CODE_ID
             , T.CT_ID
             , T.INSTALL_DT
             , T.CALL_ENTRY_ID
             , T.INSTALL_STK_ID
             , T.INSTALL_RESULT_ID
             , T.CRT_USER_ID
             , T.CRT_DT
             , T.ALLOW_COMM
             , T.IS_TRADE_IN
             , T.CT_GRP
             , T.UPD_DT
             , T.UPD_USER_ID
             , T.REV_ID
             , T.SESION_CODE
             , T.CT_SUB_GRP
          FROM
             ( SELECT T1.INSTALL_ENTRY_ID
                    , T1.INSTALL_ENTRY_NO
                    , T1.SALES_ORD_ID
                    , T1.STUS_CODE_ID
                    , T1.CT_ID
                    , T1.INSTALL_DT
                    , T1.CALL_ENTRY_ID
                    , T1.INSTALL_STK_ID
                    , T1.INSTALL_RESULT_ID
                    , T1.CRT_USER_ID
                    , T1.CRT_DT
                    , T1.ALLOW_COMM
                    , T1.IS_TRADE_IN
                    , T1.CT_GRP
                    , T1.UPD_DT
                    , T1.UPD_USER_ID
                    , T1.REV_ID
                    , T1.SESION_CODE
                    , T1.CT_SUB_GRP
                 FROM SAL0046D T1
                WHERE T1.SALES_ORD_ID = #{salesOrdId}
                  AND T1.STUS_CODE_ID = '4'
                ORDER
                   BY T1.INSTALL_ENTRY_ID DESC
             ) T
         WHERE ROWNUM = 1
    </select>
    
    <select id="selectCallEntry" parameterType="Map" resultType="egovMap">
        SELECT T.CALL_ENTRY_ID
             , T.SALES_ORD_ID
             , T.TYPE_ID
             , T.STUS_CODE_ID
             , T.RESULT_ID
             , T.DOC_ID
             , T.CRT_USER_ID
             , T.CRT_DT
             , T.CALL_DT
             , T.IS_WAIT_FOR_CANCL
             , T.HAPY_CALLER_ID
             , T.UPD_DT
             , T.UPD_USER_ID
             , T.ORI_CALL_DT
          FROM
             ( SELECT T1.CALL_ENTRY_ID
                    , T1.SALES_ORD_ID
                    , T1.TYPE_ID
                    , T1.STUS_CODE_ID
                    , T1.RESULT_ID
                    , T1.DOC_ID
                    , T1.CRT_USER_ID
                    , T1.CRT_DT
                    , T1.CALL_DT
                    , T1.IS_WAIT_FOR_CANCL
                    , T1.HAPY_CALLER_ID
                    , T1.UPD_DT
                    , T1.UPD_USER_ID
                    , T1.ORI_CALL_DT
                 FROM CCR0006D T1
                WHERE T1.SALES_ORD_ID = #{salesOrdId}
                <if test='opt != null and opt =="1"'>
                  AND T1.TYPE_ID IN (257, 258)
                  AND T1.STUS_CODE_ID IN (1, 19, 30)
                </if>
                <if test='opt != null and opt =="2"'>
                  AND T1.TYPE_ID IN (257)
                  AND T1.STUS_CODE_ID IN (1, 19, 30)
                </if>
                <if test='opt != null and opt =="3"'>
                  AND T1.TYPE_ID IN (257, 258)
                  AND T1.STUS_CODE_ID IN (20)
                </if>
                ORDER
                   BY T1.CALL_ENTRY_ID DESC
             ) T
         WHERE ROWNUM = 1
    </select>

    <select id="selectCallEntryByEntryId" parameterType="Map" resultType="egovMap">
        SELECT T1.CALL_ENTRY_ID
             , T1.SALES_ORD_ID
             , T1.TYPE_ID
             , T1.STUS_CODE_ID
             , T1.RESULT_ID
             , T1.DOC_ID
             , T1.CRT_USER_ID
             , T1.CRT_DT
             , T1.CALL_DT
             , T1.IS_WAIT_FOR_CANCL
             , T1.HAPY_CALLER_ID
             , T1.UPD_DT
             , T1.UPD_USER_ID
             , T1.ORI_CALL_DT
          FROM CCR0006D T1
         WHERE T1.CALL_ENTRY_ID = #{callEntryId}
    </select>
    
    <update id="updateCallEntry" parameterType="callEntryVO">
        UPDATE CCR0006D
           SET RESULT_ID     = #{resultId}
             , UPD_DT        = SYSDATE
             , UPD_USER_ID   = #{updUserId}
         WHERE CALL_ENTRY_ID = #{callEntryId}
    </update>

    <update id="updateCallEntry2" parameterType="Map">
        UPDATE CCR0006D
           SET STUS_CODE_ID  = #{stusCodeId}
             , RESULT_ID     = #{resultId}
             , UPD_DT        = SYSDATE
             , UPD_USER_ID   = #{updUserId}
         WHERE CALL_ENTRY_ID = #{callEntryId}
    </update>

    <update id="updateRentalScheme" parameterType="Map">
        UPDATE SAL0071D
           SET STUS_CODE_ID = #{stusCodeId}
             , REN_SCH_DT   = SYSDATE
             , IS_SYNC      = #{isSync}
         WHERE IS_SYNC      = #{renSchId}
    </update>

    <update id="updateSalesOrderM" parameterType="salesOrderMVO">
        UPDATE SAL0001D
           SET TOT_AMT              = #{totAmt}
             , PROMO_ID             = #{promoId}
             , TOT_PV               = #{totPv}
             , UPD_DT               = SYSDATE
             , UPD_USER_ID          = #{updUserId}
             , MTH_RENT_AMT         = #{mthRentAmt}
             , DEF_RENT_AMT         = #{defRentAmt}
             , PROMO_DISC_PERIOD_TP = #{promoDiscPeriodTp}
             , PROMO_DISC_PERIOD    = #{promoDiscPeriod}
             , NOR_AMT              = #{norAmt}
             , NOR_RNT_FEE          = #{norRntFee}
             , DISC_RNT_FEE         = #{discRntFee}
         WHERE SALES_ORD_ID         = #{salesOrdId}
    </update>

    <update id="updateSalesOrderD" parameterType="salesOrderDVO">
		UPDATE SAL0002D
		   SET ITM_STK_ID   = #{itmStkId}
		     , ITM_PRC_ID   = #{itmPrcId}
		     , ITM_PRC      = #{itmPrc}
		     , ITM_PV       = #{itmPv}
		     , UPD_DT       = SYSDATE
		     , UPD_USER_ID  = #{updUserId}
		 WHERE SALES_ORD_ID = #{salesOrdId}
    </update>

    <select id="selectCompleteASIDByOrderIDSolutionReason" parameterType="Map" resultType="egovMap">
		SELECT T1.AS_ID
		     , T1.AS_NO
		     , T1.AS_SO_ID
		     , T1.AS_MEM_ID
		     , T1.AS_MEM_GRP
		     , T1.AS_REQST_DT
		     , T1.AS_REQST_TM
		     , T1.AS_APPNT_DT
		     , T1.AS_APPNT_TM
		     , T1.AS_BRNCH_ID
		     , T1.AS_MALFUNC_ID
		     , T1.AS_MALFUNC_RESN_ID
		     , T1.AS_REM_REQSTER
		     , T1.AS_REM_REQSTER_CNTC
		     , T1.AS_CALLLOG_ID
		     , T1.AS_STUS_ID
		     , T1.AS_SMS
		     , T1.AS_CRT_USER_ID
		     , T1.AS_CRT_DT
		     , T1.AS_UPD_USER_ID
		     , T1.AS_UPD_DT
		     , T1.AS_ENTRY_IS_SYNCH
		     , T1.AS_ENTRY_IS_EDIT
		     , T1.AS_TYPE_ID
		     , T1.AS_REQSTER_TYPE_ID
		     , T1.AS_IS_BS_WITHIN_30DAYS
		     , T1.AS_ALLOW_COMM
		     , T1.AS_PREV_MEM_ID
		     , T1.AS_REM_ADD_CNTC
		     , T1.AS_REM_REQSTER_CNTC_SMS
		     , T1.AS_REM_ADD_CNTC_SMS
		  FROM SVC0001D T1
		  JOIN SVC0004D T2 ON T2.AS_ENTRY_ID = T1.AS_ID
		   AND T2.AS_RESULT_STUS_ID = 4
		   AND T2.AS_SLUTN_RESN_ID = '#{asSlutnResnId}
		 WHERE T1.AS_SO_ID = #{salesOrdId}
		   AND TO_CHAR(T1.AS_APPNT_DT, 'YYYYMM') = TO_CHAR(SYADATE, 'YYYYMM')
		   AND ROWNUM = 1
    </select>
    
    <insert id="insertSalesOrderExchange" parameterType="salesOrderExchangeVO">
      <selectKey keyProperty="soExchgId" resultType="Integer" order="BEFORE">
        SELECT SAL0004D_SO_EXCHG_ID_SEQ.NEXTVAL FROM DUAL
      </selectKey>
		INSERT
		  INTO SAL0004D
		     ( SO_EXCHG_ID
		     , SO_ID
		     , SO_EXCHG_TYPE_ID
		     , SO_EXCHG_STUS_ID
		     , SO_EXCHG_RESN_ID
		     , SO_CUR_STUS_ID
		     , INSTALL_ENTRY_ID
		     , SO_EXCHG_OLD_APP_TYPE_ID
		     , SO_EXCHG_NW_APP_TYPE_ID
		     , SO_EXCHG_OLD_STK_ID
		     , SO_EXCHG_NW_STK_ID
		     , SO_EXCHG_OLD_PRC_ID
		     , SO_EXCHG_NW_PRC_ID
		     , SO_EXCHG_OLD_PRC
		     , SO_EXCHG_NW_PRC
		     , SO_EXCHG_OLD_PV
		     , SO_EXCHG_NW_PV
		     , SO_EXCHG_OLD_RENT_AMT
		     , SO_EXCHG_NW_RENT_AMT
		     , SO_EXCHG_OLD_PROMO_ID
		     , SO_EXCHG_NW_PROMO_ID
		     , SO_EXCHG_CRT_DT
		     , SO_EXCHG_CRT_USER_ID
		     , SO_EXCHG_UPD_DT
		     , SO_EXCHG_UPD_USER_ID
		     , SO_EXCHG_OLD_SRV_CONFIG_ID
		     , SO_EXCHG_NW_SRV_CONFIG_ID
		     , SO_EXCHG_SYNC_CHK
		     , SO_EXCHG_OLD_CALL_ENTRY_ID
		     , SO_EXCHG_NW_CALL_ENTRY_ID
		     , SO_EXCHG_STK_RET_MOV_ID
		     , SO_EXCHG_REM
		     , SO_EXCHG_OLD_DEF_RENT_AMT
		     , SO_EXCHG_NW_DEF_RENT_AMT
		     , SO_EXCHG_UNDER_FREE_AS_ID
		     , SO_EXCHG_OLD_CUST_ID
		     , SO_EXCHG_NW_CUST_ID
		     , SO_EXCHG_FORM_NO
		     ) 
		VALUES
		     ( #{soExchgId}
		     , #{soId}
		     , #{soExchgTypeId}
		     , #{soExchgStusId}
		     , #{soExchgResnId}
		     , #{soCurStusId}
		     , #{installEntryId}
		     , #{soExchgOldAppTypeId}
		     , #{soExchgNwAppTypeId}
		     , #{soExchgOldStkId}
		     , #{soExchgNwStkId}
		     , #{soExchgOldPrcId}
		     , #{soExchgNwPrcId}
		     , #{soExchgOldPrc}
		     , #{soExchgNwPrc}
		     , #{soExchgOldPv}
		     , #{soExchgNwPv}
		     , #{soExchgOldRentAmt}
		     , #{soExchgNwRentAmt}
		     , #{soExchgOldPromoId}
		     , #{soExchgNwPromoId}
		     , #{soExchgCrtDt}
		     , #{soExchgCrtUserId}
		     , #{soExchgUpdDt}
		     , #{soExchgUpdUserId}
		     , #{soExchgOldSrvConfigId}
		     , #{soExchgNwSrvConfigId}
		     , #{soExchgSyncChk}
		     , #{soExchgOldCallEntryId}
		     , #{soExchgNwCallEntryId}
		     , #{soExchgStkRetMovId}
		     , #{soExchgRem}
		     , #{soExchgOldDefRentAmt}
		     , #{soExchgNwDefRentAmt}
		     , #{soExchgUnderFreeAsId}
		     , #{soExchgOldCustId}
		     , #{soExchgNwCustId}
		     , #{soExchgFormNo}
		     )
    </insert>
    
    <select id="selecLastInstall" parameterType="Map" resultType="egovMap">
        SELECT T.INSTALL_ENTRY_ID
             , T.INSTALL_DT
          FROM
             ( SELECT T1.INSTALL_ENTRY_ID
                    , T2.INSTALL_DT
                 FROM SAL0046D T1
                    , SAL0047D T2
                WHERE T1.SALES_ORD_ID = #{salesOrdId}
                  AND T1.STUS_CODE_ID = 4
                  AND T1.INSTALL_ENTRY_ID = T2.ENTRY_ID
                  AND T2.STUS_CODE_ID = 4
                ORDER
                   BY T2.INSTALL_DT DESC
             ) T
         WHERE ROWNUM &lt;= 1
    </select>
    
    <select id="selectSrvConfiguration" parameterType="Map" resultType="egovMap">
        SELECT T1.SRV_CONFIG_ID
          FROM SAL0090D T1
         WHERE T1.SRV_SO_ID = #{salesOrdId}
           AND T1.SRV_STUS_ID = 1
           AND ROWNUM = 1
    </select>
    
    <select id="selectSrvConfigPeriod" parameterType="Map" resultType="egovMap">
        SELECT T1.SRV_PRD_ID
          FROM SAL0088D T1
         WHERE T1.SRV_CONFIG_ID = #{srvConfigId}
           AND T1.SRV_PRD_STUS_ID = 1
    </select>
    
    <select id="selectSrvConfigSetting" parameterType="Map" resultType="egovMap">
        SELECT T1.SRV_SETT_ID
          FROM SAL0089D T1
         WHERE T1.SRV_CONFIG_ID = #{srvConfigId}
           AND T1.SRV_SETT_STUS_ID = 1
    </select>
    
    <select id="selectSrvConfigFilter" parameterType="Map" resultType="egovMap">
        SELECT T1.SRV_FILTER_ID
          FROM SAL0087D T1
         WHERE T1.SRV_CONFIG_ID = #{srvConfigId}
           AND T1.SRV_FILTER_STUS_ID = 1
    </select>

    <insert id="insertSalesOrderExchangeBUSrvConfig" parameterType="salesOrderExchangeBUSrvConfigVO">
        INSERT
          INTO SAL0005D
             ( BU_SRV_CONFIG_ID
             , SO_EXCHG_ID
             , SRV_CONFIG_ID
             ) 
        VALUES
             ( SAL0005D_BU_SRV_CONFIG_ID_SEQ.NEXTVAL
             , #{soExchgId}
             , #{srvConfigId}
             )
    </insert>
    
	<insert id="insertSalesOrderExchangeBUSrvPeriod" parameterType="salesOrderExchangeBUSrvPeriodVO">
		INSERT
		  INTO SAL0007D 
		     ( BU_SRV_PRIOD_ID
		     , SO_EXCHG_ID
		     , SRV_PRD_ID
		     ) 
		VALUES
		     ( SAL0007D_BU_SRV_PRIOD_ID_SEQ.NEXTVAL
		     , #{soExchgId}
		     , #{srvPrdId}
		     ) 
    </insert>

    <insert id="insertSalesOrderExchangeBUSrvSetting" parameterType="salesOrderExchangeBUSrvSettingVO">
		INSERT
		  INTO SAL0008D
		     ( BU_SRV_SETNG_ID
		     , SO_EXCHG_ID
		     , SRV_SETT_ID
		     ) 
		VALUES
		     ( SAL0008D_BU_SRV_SETNG_ID_SEQ.NEXTVAL
		     , #{soExchgId}
		     , #{srvSettId}
		     ) 
    </insert>
    
    <insert id="insertSalesOrderExchangeBUSrvFilter" parameterType="salesOrderExchangeBUSrvFilterVO">
		INSERT
		  INTO SAL0006D
		     ( BU_SRV_FILTER_ID
		     , SO_EXCHG_ID
		     , SRV_FILTER_ID
		     ) 
		VALUES
		     ( SAL0006D_BU_SRV_FILTER_ID_SEQ.NEXTVAL
		     , #{soExchgId}
		     , #{srvFilterId}
		     )
    </insert>
    
    <insert id="insertInvStkMovement" parameterType="invStkMovementVO">
      <selectKey keyProperty="movId" resultType="Integer" order="BEFORE">
        SELECT LOG0013D_MOV_ID_SEQ.NEXTVAL FROM DUAL
      </selectKey>
		INSERT
		  INTO LOG0013D
		     ( MOV_ID
		     , INSTALL_ENTRY_ID
		     , MOV_FROM_LOC_ID
		     , MOV_TO_LOC_ID
		     , MOV_TYPE_ID
		     , MOV_STUS_ID
		     , MOV_CNFM
		     , MOV_CRT_DT
		     , MOV_UPD_DT
		     , MOV_CRT_USER_ID
		     , MOV_UPD_USER_ID
		     , STK_CRD_POST
		     , STK_CRD_POST_DT
		     , STK_CRD_POST_TO_WEB_ON_TM
		     ) 
		VALUES
		     ( #{movId}
		     , #{installEntryId}
		     , #{movFromLocId}
		     , #{movToLocId}
		     , #{movTypeId}
		     , #{movStusId}
		     , #{movCnfm}
		     , SYSDATE
		     , SYSDATE
		     , #{movCrtUserId}
		     , #{movUpdUserId}
		     , #{stkCrdPost}
		     , TO_DATE(#{stkCrdPostDt}, 'DD/MM/YYYY')
		     , #{stkCrdPostToWebOnTm}
		     )
    </insert>
    
    <update id="updateSoExchgStkRetMovId" parameterType="salesOrderExchangeVO">
		UPDATE SAL0004D
		   SET SO_EXCHG_STK_RET_MOV_ID = #{soExchgStkRetMovId}
		 WHERE SO_EXCHG_ID             = #{soExchgId}
    </update>
    
    <insert id="insertStkReturnEntry" parameterType="stkReturnEntryVO">
      <selectKey keyProperty="stkRetnId" resultType="Integer" order="BEFORE">
        SELECT LOG0038D_STK_RETN_ID_SEQ.NEXTVAL FROM DUAL
      </selectKey>
        INSERT
          INTO LOG0038D
             ( STK_RETN_ID
             , STUS_CODE_ID
             , TYPE_ID
             , SALES_ORD_ID
             , MOV_ID
             , REQST_DT
             , CRT_DT
             , CRT_USER_ID
             , UPD_DT
             , UPD_USER_ID
             , REF_ID
             , STOCK_ID
             , IS_SYNCH
             , RETN_NO
             , APP_DT
             , CT_ID
             , CT_GRP
             , CALL_ENTRY_ID
             , RT_SESION_CODE
             ) 
        VALUES
             ( #{stkRetnId}
             , #{stusCodeId}
             , #{typeId}
             , #{salesOrdId}
             , #{movId}
             , #{reqstDt}
             , SYSDATE
             , #{crtUserId}
             , SYSDATE
             , #{updUserId}
             , #{refId}
             , #{stockId}
             , #{isSynch}
             , #{retnNo}
             , TO_DATE(#{appDt}, 'DD/MM/YYYY')
             , #{ctId}
             , #{ctGrp}
             , #{callEntryId}
             , #{rtSesionCode}
             )
    </insert>

</mapper>