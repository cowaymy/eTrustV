<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.coway.trust.biz.sales.order.impl.OrderListMapper">

    <select id="selectOrderList" parameterType="Map" resultType="egovMap">
        SELECT DISTINCT T.APP_TYPE_CODE
             , T.APP_TYPE_NAME
             , T.CRT_USER_ID
             , T.CUST_IC
             , T.CUST_NAME
             , T.CUST_VA_NO
             , T.DSC_BRNCH_ID
             , T.KEYIN_BRNCH_ID
             , T.ORD_ID
             , T.ORD_NO
             , T.ORD_STUS_CODE
             , T.PO_NO
             , T.PRODUCT_CODE
             , T.PRODUCT_NAME
             , T.REF_NO
             , T.RENT_STUS
             , T.SALESMAN_MEM_ID
             , T.SALESMAN_CODE
             , T.SALESMAN_MEM_TYPE_ID
             , T.BILLING_GRP_ID
             , T.MAIL_TEL_MOB
             , T.MAIL_TEL_FAX
             , T.MAIL_TEL_OFF
             , T.MAIL_TEL_RES
             , T.INST_TEL_FAX
             , T.INST_TEL_MOB
             , T.INST_TEL_OFF
             , T.INST_TEL_RES
             , T.SIRIM_NO
             , T.SERIAL_NO
             , T.PROMO_CODE
             , T.PROMO_DESC
             , T.RELATED_NO
             , T.RELATED_ID
             , 1 C1
             , NVL(T.APP_TYPE_ID, 0) AS APP_TYPE_ID
             , NVL(T.CUST_ID, 0) AS CUST_ID
             , TO_CHAR(T.ORD_DT, 'DD/MM/YYYY') AS ORD_DT
             , NVL(T.ORD_STUS_ID, 0) AS ORD_STUS_ID
             , NVL(T.PRODUCT_ID, 0) AS PRODUCT_ID
             , T.PV_MONTH
             , T.PV_YEAR
          FROM ( SELECT V1.APP_TYPE_CODE
                      , V1.APP_TYPE_ID
                      , V1.APP_TYPE_NAME
                      , V1.CRT_USER_ID
                      , V1.CUST_IC
                      , V1.CUST_NAME
                      , V1.CUST_ID
                      , V1.CUST_VA_NO
                      , V1.DSC_BRNCH_ID
                      , V1.KEYIN_BRNCH_ID
                      , V1.ORD_DT
                      , V1.ORD_ID
                      , V1.ORD_NO
                      , V1.ORD_STUS_CODE
                      , V1.ORD_STUS_ID
                      , V1.PO_NO
                      , V1.PRODUCT_ID
                      , V1.PRODUCT_CODE
                      , V1.PRODUCT_NAME
                      , V1.REF_NO
                      , V1.RENT_STUS
                      , V1.SALESMAN_MEM_ID
                      , V1.SALESMAN_CODE
                      , V1.SALESMAN_MEM_TYPE_ID
                      , V1.BILLING_GRP_ID
                      , V1.MAIL_TEL_MOB
                      , V1.MAIL_TEL_FAX
                      , V1.MAIL_TEL_OFF
                      , V1.MAIL_TEL_RES
                      , V1.INST_TEL_FAX
                      , V1.INST_TEL_MOB
                      , V1.INST_TEL_OFF
                      , V1.INST_TEL_RES
                      , V1.SIRIM_NO
                      , V1.SERIAL_NO
                      , V1.ITM_PRC_ID
                      , V1.PV_MONTH
                      , V1.PV_YEAR
                      , V1.PROMO_CODE
                      , V1.PROMO_DESC
                      , V1.RELATED_NO
                      , V1.RELATED_ID
                   FROM SAL1013V V1
                  WHERE 1 = 1  
                <if test='ordDt == null || ordDt == ""'>
                    AND V1.ORD_DT BETWEEN TO_DATE(#{ordStartDt}||' 00:00:00', 'YYYY-MM-DD HH24:MI:SS') AND TO_DATE(#{ordEndDt}||' 23:59:59', 'YYYY-MM-DD HH24:MI:SS')
                </if>
                <if test='ordDt != null and ordDt != ""'>
                    AND TO_CHAR(V1.ORD_DT, 'DD/MM/YYYY') = #{ordDt}
                </if>
                <if test='ordNo != null and ordNo != ""'>
                    AND V1.ORD_NO = #{ordNo}
                </if>
                <if test='arrAppType != null and arrAppType != ""'>
                    AND V1.APP_TYPE_ID IN
                  <foreach item="item" collection="arrAppType" index="index" open="(" separator="," close=")">
                    #{item}
                  </foreach>
                </if>
                <if test='arrOrdStusId != null and arrOrdStusId != ""'>
                    AND V1.ORD_STUS_ID IN
                  <foreach item="item" collection="arrOrdStusId" index="index" open="(" separator="," close=")">
                    #{item}
                  </foreach>
                </if>
                <if test='arrKeyinBrnchId != null and arrKeyinBrnchId != ""'>
                    AND V1.KEYIN_BRNCH_ID IN
                  <foreach item="item" collection="arrKeyinBrnchId" index="index" open="(" separator="," close=")">
                    #{item}
                  </foreach>
                </if>
                <if test='arrDscBrnchId != null and arrDscBrnchId != ""'>
                    AND V1.DSC_BRNCH_ID IN
                  <foreach item="item" collection="arrDscBrnchId" index="index" open="(" separator="," close=")">
                    #{item}
                  </foreach>
                </if>
                <if test='custId != null and custId != ""'>
                    AND V1.CUST_ID = #{custId}
                </if>
                <if test='custName != null and custName != ""'>
                    AND V1.CUST_NAME LIKE '%'||#{custName}||'%'
                </if>
                <if test='custIc != null and custIc != ""'>
                    AND V1.CUST_IC LIKE '%'||#{custIc}||'%'
                </if>
                <if test='productId != null and productId != ""'>
                    AND V1.PRODUCT_ID = #{productId}
                </if>
                <if test='salesmanCode != null and salesmanCode != ""'>
                    AND V1.SALESMAN_CODE = #{salesmanCode}
                </if>
                <if test='arrRentStus != null and arrRentStus != ""'>
                    AND V1.RENT_STUS IN
                  <foreach item="item" collection="arrRentStus" index="index" open="(" separator="," close=")">
                    #{item}
                  </foreach>
                </if>
                <if test='refNo != null and refNo != ""'>
                    AND V1.REF_NO = #{refNo}
                </if>
                <if test='poNo != null and poNo != ""'>
                    AND V1.PO_NO = #{poNo}
                </if>
                <if test='contactNo != null and contactNo != ""'>
                    AND #{contactNo} IN (V1.MAIL_TEL_MOB, V1.MAIL_TEL_OFF, V1.MAIL_TEL_RES)
                </if>
                <if test='crtUserId != null and crtUserId != ""'>
                    AND V1.CRT_USER_ID = #{crtUserId}
                </if>
                <if test='promoCode != null and promoCode != ""'>
                    AND V1.PROMO_CODE = #{promoCode}
                </if>
                <if test='relatedNo != null and relatedNo != ""'>
                    AND V1.RELATED_NO = #{relatedNo}
                </if>
                <if test='invoicePoNo != null and invoicePoNo != ""'>
                    AND V1.ORD_ID IN (SELECT DISTINCT PO_ORD_ID  
                                        FROM PAY0015D
                                       WHERE PO_REF_NO = #{invoicePoNo})
                </if>
               ) T
           ORDER BY T.ORD_NO ASC
    </select>

    <select id="getApplicationTypeList" parameterType="Map" resultType="egovMap">
		    SELECT Project1.CODE_ID CODE_ID ,
					  Project1.CODE_MASTER_ID CODE_MASTER_ID ,
					  Project1.CODE CODE ,
					  Project1.CODE_NAME CODE_NAME ,
					  Project1.DISAB DISAB ,
					  Project1.CRT_DT CRT_DT ,
					  Project1.CRT_USER_ID CRT_USER_ID ,
					  Project1.UPD_DT UPD_DT ,
					  Project1.UPD_USER_ID UPD_USER_ID ,
					  Project1.OLD_CODE_ID OLD_CODE_ID
					FROM
					  (SELECT Extent1.CODE_ID CODE_ID ,
					    Extent1.CODE_MASTER_ID CODE_MASTER_ID ,
					    Extent1.CODE CODE ,
					    Extent1.CODE_NAME CODE_NAME ,
					    Extent1.DISAB DISAB ,
					    Extent1.CRT_DT CRT_DT ,
					    Extent1.CRT_USER_ID CRT_USER_ID ,
					    Extent1.UPD_DT UPD_DT ,
					    Extent1.UPD_USER_ID UPD_USER_ID ,
					    Extent1.OLD_CODE_ID OLD_CODE_ID
					  FROM SYS0013M Extent1
					  WHERE ( Extent1.CODE_MASTER_ID = #{codeId} )  
					  AND ( 0 = Extent1.DISAB )
					  ) Project1
		   ORDER BY Project1.CODE_NAME ASC
    </select>
    
    <select id="getUserCodeList" resultType="egovMap">
        SELECT USER_ID CODE_ID, USER_NAME CODE_NAME
		FROM SYS0047M
		WHERE USER_STUS_ID = 1 AND USER_TYPE_ID != 1 AND USER_TYPE_ID != 2 AND USER_TYPE_ID != 3
		ORDER BY USER_NAME 
    </select>

    <select id="getOrgCodeList" parameterType="Map" resultType="egovMap">
        SELECT Extent1.MEM_ID CODE_ID , 
                Extent1.MEM_CODE || ' - '  || Extent1.NAME CODE_NAME 
		FROM ORG0001D Extent1
				JOIN
					 (SELECT vMemberOrg.MEM_ID MEM_ID ,
						    vMemberOrg.MEM_CODE MEM_CODE ,
						    vMemberOrg.MEM_LVL MEM_LVL ,
						    vMemberOrg.DEPT_CODE DEPT_CODE ,
						    vMemberOrg.GRP_CODE GRP_CODE ,
						    vMemberOrg.ORG_CODE ORG_CODE ,
						    vMemberOrg.TOP_ORG_CODE TOP_ORG_CODE ,
						    vMemberOrg.MEM_UP_ID MEM_UP_ID ,
						    vMemberOrg.LVL3_UP_ID LVL3_UP_ID ,
						    vMemberOrg.LVL2_UP_ID LVL2_UP_ID ,
						    vMemberOrg.LVL1_UP_ID LVL1_UP_ID ,
						    vMemberOrg.LVL0_UP_ID LVL0_UP_ID
						  FROM ORG1001V vMemberOrg
					) Extent2
				ON ( Extent2.MEM_ID    = Extent1.MEM_ID )
				AND ( Extent2.MEM_LVL  = #{memLvl} )
		WHERE ( 1 = Extent1.STUS )
			    AND ( Extent1.MEM_TYPE = #{memType} )
    </select>
    
    <select id="getGrpCodeList" parameterType="Map" resultType="egovMap">
        SELECT Extent1.MEM_ID CODE_ID ,
				  Extent1.MEM_CODE MEM_CODE ,
				  Extent1.NAME NAME ,
				  Extent1.MEM_CODE || ' - '  || Extent1.NAME CODE_NAME ,
				  Extent2.DEPT_CODE DEPT_CODE ,
				  Extent2.GRP_CODE GRP_CODE ,
				  Extent2.ORG_CODE ORG_CODE
		FROM ORG0001D Extent1
			JOIN
				  (SELECT vMemberOrg.MEM_ID MEM_ID ,
						    vMemberOrg.MEM_CODE MEM_CODE ,
						    vMemberOrg.MEM_LVL MEM_LVL ,
						    vMemberOrg.DEPT_CODE DEPT_CODE ,
						    vMemberOrg.GRP_CODE GRP_CODE ,
						    vMemberOrg.ORG_CODE ORG_CODE ,
						    vMemberOrg.TOP_ORG_CODE TOP_ORG_CODE ,
						    vMemberOrg.MEM_UP_ID MEM_UP_ID ,
						    vMemberOrg.LVL3_UP_ID LVL3_UP_ID ,
						    vMemberOrg.LVL2_UP_ID LVL2_UP_ID ,
						    vMemberOrg.LVL1_UP_ID LVL1_UP_ID ,
						    vMemberOrg.LVL0_UP_ID LVL0_UP_ID
			         FROM ORG1001V vMemberOrg
				  ) Extent2
		  ON ( Extent2.MEM_ID    = Extent1.MEM_ID )
		  AND ( Extent2.MEM_LVL  = #{memLvl} )
	   WHERE ( 1 = Extent1.STUS )
	   AND ( Extent1.MEM_TYPE = #{memType} )
	   AND ( Extent2.MEM_UP_ID = #{upperLineMemberID} )
    </select>
</mapper>