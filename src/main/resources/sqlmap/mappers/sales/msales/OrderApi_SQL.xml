<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.coway.trust.biz.sales.msales.impl.OrderApiMapper">

    <!--Product 정보 조회 -->
    <select id="orderProductList" parameterType="Map" resultType="egovMap">
        SELECT STK_ID AS PRODUCT_CODE
             , C1 AS PRODUCT_NAME
          FROM
             ( SELECT DISTINCT T1.STK_ID
                    , T1.STK_CODE ||' - '||T1.STK_DESC C1
                    , T3.CODE_NAME
                 FROM SYS0026M T1
                    , SAL0082D T2
                    , SYS0013M T3
                    , SAL0016M T4
                WHERE T1.STK_ID = T2.SRV_PAC_ITM_PRODUCT_ID
                  AND T1.STK_CTGRY_ID = T3.CODE_ID
                  AND 1 != T1.IS_NCV
                  AND 1 = T2.SRV_PAC_ITM_STUS_ID
                  AND 61 = T1.STK_TYPE_ID
                  AND T2.SRV_CNTRCT_PAC_ID = #{srvPacId}
                  AND T1.STK_ID = T4.STK_ID
                  AND T4.AMT &gt; 0
                  AND 66 = #{salesType}
                <if test='searchType != null and searchType == "CODE"'>
                  AND STK_CODE LIKE '%'||#{searchKeyword}||'%'
                </if>
                <if test='searchType != null and searchType == "NAME"'>
                  AND UPPER(STK_DESC) LIKE '%'||UPPER(#{searchKeyword})||'%'
                </if>
                UNION ALL
                SELECT DISTINCT T1.STK_ID
                    , T1.STK_CODE ||' - '||T1.STK_DESC C1
                    , T3.CODE_NAME
                 FROM SYS0026M T1
                    , SAL0092M T2
                    , SYS0013M T3
                    , SAL0016M T4
                WHERE T1.STK_ID = T2.SRV_MEM_ITM_STK_ID
                  AND T1.STK_CTGRY_ID = T3.CODE_ID
                  AND 1 != T1.IS_NCV
                  AND 1 = T2.SRV_MEM_ITM_STUS_ID
                  AND 61 = T1.STK_TYPE_ID
                  AND T2.SRV_MEM_PAC_ID = #{srvPacId}
                  AND T1.STK_ID = T4.STK_ID
                  AND T4.AMT &gt; 0
                  AND 66 != #{salesType}
                <if test='searchType != null and searchType == "CODE"'>
                  AND STK_CODE LIKE '%'||#{searchKeyword}||'%'
                </if>
                <if test='searchType != null and searchType == "NAME"'>
                  AND UPPER(STK_DESC) LIKE '%'||UPPER(#{searchKeyword})||'%'
                </if>
             )
         ORDER BY STK_ID ASC
    </select>
    
</mapper>