<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.coway.trust.biz.sales.pst.impl.PSTRequestDOMapper">

    <!-- 
        CLOB 컬럼을 사용하기 위해서는 아래와 같이 resultMap을 선언 후
         <select id="selectClobData" parameterType="Map"  resultMap="clobMap"> 와 같이
          resultMap="clobMap" 을 사용해야 함.
    -->
	<resultMap id="clobMap" type="EgovMap">
        <result property="requestComment" column="request_comment" jdbcType="CLOB" javaType="java.lang.String"/>
        <result property="cdcConfirmComment" column="cdc_confirm_comment" jdbcType="CLOB" javaType="java.lang.String"/>
        <result property="hqConfirmComment" column="hq_confirm_comment" jdbcType="CLOB" javaType="java.lang.String"/>
    </resultMap>

	<insert id="insertSample" parameterType="SampleVO">
        INSERT INTO SYS_I18N
            (id, 
            language, 
            country, 
            message)
        VALUES
            (#{id}, 
            #{language}, 
            #{country}, 
            #{message})
	</insert>
	
	<select id="selectClobData" parameterType="Map"  resultMap="clobMap">
	<![CDATA[
		SELECT 
            base_cdc, 
            status_code, 
            request_dt,
            TO_CHAR(request_dt, 'yyyymmdd') as request_dt_format,
            request_comment, /* CLOB */
            cdc_confirm_comment, /* CLOB */
            hq_confirm_comment /* CLOB */
		FROM TST_SUPPLY_PLAN
		WHERE ROWNUM < 100
	]]>
	</select>
	
	<insert id="insertClobData" parameterType="Map">
        INSERT INTO TST_SUPPLY_PLAN
		(   base_year,
			base_week,
			base_cdc,
			request_comment
		)VALUES(
			#{baseYear},
            #{baseWeek},
            #{baseCdc},
            #{requestComment}
		)
	</insert>

    <resultMap id="clobMap2" type="EgovMap">
        <result property="otherXml" column="other_xml" jdbcType="CLOB" javaType="java.lang.String"/>
    </resultMap>
    
    <select id="selectClobOtherData" parameterType="Map"  resultMap="clobMap2">
    <![CDATA[
        SELECT
            'aa' as aa,
            'bb' as bb,
            other_xml 
        FROM TOAD_PLAN_TABLE
        WHERE other_xml IS NOT NULL
    ]]>
    </select>
	

	
	<insert id="insertSampleByMap" parameterType="Map">
        INSERT INTO SYS_I18N
            (id, 
            language, 
            country, 
            message)
        VALUES
            (#{id}, 
            #{language}, 
            #{country}, 
            #{message})
    </insert>
	

	<update id="updateSample">

			UPDATE SAMPLE
			SET ID=#{id}
				, NAME=#{name}
				, DESCRIPTION=#{description}
				, USE_YN=#{useYn}
				  WHERE ID=#{id}

	</update>

	<delete id="deleteSample">

			DELETE FROM SAMPLE
			WHERE ID=#{id}

	</delete>

	<select id="selectSample" parameterType="searchVO" resultType="SampleVO">

			SELECT
				'ID' as ID, 'NAME' as NAME, 'DESCRIPTION' as DESCRIPTION, 'USE_YN' as USE_YN, 'REG_USER' as REG_USER
			FROM DUAL

	</select>

	<select id="selectSampleList" parameterType="searchVO" resultType="egovMap">

			SELECT
				'ID' as ID, 'NAME' as NAME, 'DESCRIPTION' as DESCRIPTION, 'USE_YN' as USE_YN, 'REG_USER' as REG_USER
			FROM DUAL
			WHERE 1=1
			<if test="searchKeyword != null and searchKeyword != ''">
		        <choose>
		            <when test="searchCondition == 0">
						AND	ID LIKE '%' || #{searchKeyword} || '%'
					</when>
		            <when test="searchCondition == 1">
						AND	NAME LIKE '%' || #{searchKeyword} || '%'
					</when>
				</choose>
			</if>
	</select>
	
	<select id="selectSampleByParamsList" parameterType="Map" resultType="egovMap">

            SELECT
                'ID' as ID, 'NAME' as NAME, 'DESCRIPTION' as DESCRIPTION, 'USE_YN' as USE_YN, 'REG_USER' as REG_USER
            FROM DUAL
            WHERE 1=1
            <if test="sId != null and sId != ''">
			    AND #{sId} = #{sId}
			</if>

            <if test="sName != null and sName != ''">
                AND #{sName} = #{sName}
            </if>

            <if test="searchKeyword != null and searchKeyword != ''">
                <choose>
                    <when test="searchCondition == 0">
                        AND ID LIKE '%' || #{searchKeyword} || '%'
                    </when>
                    <when test="searchCondition == 1">
                        AND NAME LIKE '%' || #{searchKeyword} || '%'
                    </when>
                </choose>
            </if>
            UNION ALL
             SELECT
                'ID2' as ID, 'NAME2' as NAME, 'DESCRIPTION2' as DESCRIPTION, 'USE_YN2' as USE_YN, 'REG_USER2' as REG_USER
            FROM DUAL
    </select>

	<select id="selectSampleListTotCnt" parameterType="searchVO" resultType="int">

			SELECT COUNT(*) totcnt
			FROM DUAL
			WHERE 1=1
			<if test="searchKeyword != null and searchKeyword != ''">
		        <choose>
		            <when test="searchCondition == 0">
						AND ID LIKE '%' || #{searchKeyword} || '%'
					</when>
		            <when test="searchCondition == 1">
						AND	NAME LIKE '%' || #{searchKeyword} || '%'
					</when>
				</choose>
			</if>
	</select>

    <update id="updateSAL0062D"><!--PSTSalesM-->
        UPDATE SAL0062D
           SET PST_DEALER_MAIL_CNT_ID   = #{pstDealerMailCntId}
             , PST_DEALER_DELVRY_CNT_ID = #{pstDealerDelvryCntId}
             , PST_DEALER_MAIL_ADD_ID   = #{pstDealerMailAddId}
             , PST_DEALER_DELVRY_ADD_ID = #{pstDealerDelvryAddId}
             , PST_TOT_AMT              = #{pstTotAmt}
             , PST_STUS_ID              = #{pstStusId}
         WHERE PST_SALES_ORD_ID         = #{pstSalesOrdId}
    </update>
    
    <select id="selectPstRequestDOList" parameterType="Map" resultType="egovMap">
		SELECT T.PST_SALES_ORD_ID AS PST_SALES_ORD_ID
		     , T.CODE AS CODE
		     , T.PST_CUST_PO AS PST_CUST_PO
		     , T.PST_CUR_RATE AS PST_CUR_RATE
		     , T.PST_CUR_TYPE_ID AS PST_CUR_TYPE_ID
		     , T.PST_DEALER_DELVRY_ADD_ID AS PST_DEALER_DELVRY_ADD_ID
		     , T.PST_DEALER_DELVRY_CNT_ID AS PST_DEALER_DELVRY_CNT_ID
		     , T.PST_DEALER_ID AS PST_DEALER_ID
		     , T.PIC AS PIC
		     , T.PST_REF_NO AS PST_REF_NO
		     , T.PST_REM AS PST_REM
		     , T.PST_STUS_ID AS PST_STUS_ID
		     , T.PST_DEALER_MAIL_ADD_ID AS PST_DEALER_MAIL_ADD_ID
		     , T.PST_TOT_AMT AS PST_TOT_AMT
		     , T.C1 AS C1
		     , T.CRT_USER_ID AS CRT_USER_ID
		     , T.DEALER_NAME AS DEALER_NAME
		     , T.CODE1 AS CODE1
		     , T.DEALER_NRIC AS DEALER_NRIC
		     , T.USER_NAME AS USER_NAME
		     , T.USER_NAME1 AS USER_NAME1
		     , T.PST_DEALER_MAIL_CNT_ID AS PST_DEALER_MAIL_CNT_ID
		     , T.C2 AS C2
		  FROM ( SELECT T1.PST_SALES_ORD_ID AS PST_SALES_ORD_ID
		              , T1.PST_REF_NO AS PST_REF_NO
		              , T1.PST_DEALER_ID AS PST_DEALER_ID
		              , T1.PST_DEALER_MAIL_CNT_ID AS PST_DEALER_MAIL_CNT_ID
		              , T1.PST_DEALER_DELVRY_CNT_ID AS PST_DEALER_DELVRY_CNT_ID
		              , T1.PST_DEALER_MAIL_ADD_ID AS PST_DEALER_MAIL_ADD_ID
		              , T1.PST_DEALER_DELVRY_ADD_ID AS PST_DEALER_DELVRY_ADD_ID
		              , T1.PST_CUR_RATE AS PST_CUR_RATE
		              , T1.PST_CUR_TYPE_ID AS PST_CUR_TYPE_ID
		              , T1.PST_TOT_AMT AS PST_TOT_AMT
		              , T1.PST_REM AS PST_REM
		              , T1.PST_STUS_ID AS PST_STUS_ID
		              , T1.CRT_USER_ID AS CRT_USER_ID
		              , T1.PIC AS PIC
		              , T1.PST_CUST_PO AS PST_CUST_PO
		              , T2.CODE AS CODE
		              , T3.CODE AS CODE1
		              , T4.USER_NAME AS USER_NAME
		              , T5.USER_NAME AS USER_NAME1
		              , T6.DEALER_NAME AS DEALER_NAME
		              , T6.DEALER_NRIC AS DEALER_NRIC
		              , T1.CRT_DT AS C1
		              , NVL(T8.WH_LOC_ID, 0) AS C2
		           FROM SAL0062D T1
		           LEFT OUTER
		           JOIN SYS0013M T2
		             ON T2.CODE_ID = T1.PST_CUR_TYPE_ID
		           LEFT OUTER
		           JOIN SYS0038M T3
		             ON T3.STUS_CODE_ID = T1.PST_STUS_ID
		           LEFT OUTER
		           JOIN SYS0047M T4
		             ON T4.USER_ID = T1.PIC
		           LEFT OUTER
		           JOIN SYS0047M T5
		             ON T5.USER_ID = T1.CRT_USER_ID
		           LEFT OUTER
		           JOIN SAL0030D T6
		             ON T6.DEALER_ID = T1.PST_DEALER_ID
		           LEFT OUTER
		           JOIN SYS0005M T7
		             ON T7.BRNCH_ID = T6.DEALER_BRNCH_ID
		           LEFT OUTER
		           JOIN SYS0028M T8
		             ON T8.WH_LOC_BRNCH_ID = T6.DEALER_BRNCH_ID
		          WHERE (T1.PST_STUS_ID IN (1,4,10))
		            AND TO_CHAR(T1.CRT_DT, 'YYYY-MM-DD HH24:MI:SS') BETWEEN '2017-04-01 00:00:00' AND '2017-07-31 00:00:00'
		            <if test="pstSalesOrdId != null and pstSalesOrdId != ''">
		                AND PST_SALES_ORD_ID = #{pstSalesOrdId}
		            </if>
		) T
		ORDER BY T.PST_SALES_ORD_ID ASC

    </select>
    
    <select id="getPstRequestDODetailPop" parameterType="Map" resultType="egovMap">
        SELECT T1.PST_SALES_ORD_ID AS PST_SALES_ORD_ID
		     , T1.PST_REF_NO AS PST_REF_NO
		     , T1.PST_DEALER_ID AS PST_DEALER_ID
		     , T1.PST_DEALER_MAIL_CNT_ID AS PST_DEALER_MAIL_CNT_ID
		     , T1.PST_DEALER_DELVRY_CNT_ID AS PST_DEALER_DELVRY_CNT_ID
		     , T1.PST_DEALER_MAIL_ADD_ID AS PST_DEALER_MAIL_ADD_ID
		     , T1.PST_DEALER_DELVRY_ADD_ID AS PST_DEALER_DELVRY_ADD_ID
		     , T1.PST_CUR_RATE AS PST_CUR_RATE
		     , T1.PST_CUR_TYPE_ID AS PST_CUR_TYPE_ID
		     , T1.PST_TOT_AMT AS PST_TOT_AMT
		     , T1.PST_REM AS PST_REM
		     , T1.PST_STUS_ID AS PST_STUS_ID
		     , T1.CRT_USER_ID AS CRT_USER_ID
		     , T1.PIC AS PIC
		     , T1.PST_CUST_PO AS PST_CUST_PO
		     , T2.CODE AS CODE
		     , T3.CODE AS CODE1
		     , T4.USER_NAME AS USER_NAME
		     , T5.USER_NAME AS USER_NAME1
		     , T6.DEALER_NAME AS DEALER_NAME
		     , T6.DEALER_NRIC AS DEALER_NRIC
		     , T1.CRT_DT AS C1
		     , NVL(T8.WH_LOC_ID, 0) AS C2
		  FROM SAL0062D T1
		  LEFT OUTER
		  JOIN SYS0013M T2
		    ON T2.CODE_ID = T1.PST_CUR_TYPE_ID
		  LEFT OUTER
		  JOIN SYS0038M T3
		    ON T3.STUS_CODE_ID = T1.PST_STUS_ID
		  LEFT OUTER
		  JOIN SYS0047M T4
		    ON T4.USER_ID = T1.PIC
		  LEFT OUTER
		  JOIN SYS0047M T5
		    ON T5.USER_ID = T1.CRT_USER_ID
		  LEFT OUTER
		  JOIN SAL0030D T6
		    ON T6.DEALER_ID = T1.PST_DEALER_ID
		  LEFT OUTER
		  JOIN SYS0005M T7
		    ON T7.BRNCH_ID = T6.DEALER_BRNCH_ID
		  LEFT OUTER
		  JOIN SYS0028M T8
		    ON T8.WH_LOC_BRNCH_ID = T6.DEALER_BRNCH_ID
		 WHERE PST_SALES_ORD_ID = #{pstSalesOrdId}

    </select>
    
    <select id="getPstRequestDOStockDetailPop" parameterType="Map" resultType="egovMap">
        SELECT T1.PST_SALES_ORD_ID AS PST_SALES_ORD_ID
		     , T1.PST_ITM_STK_ID AS PST_ITM_STK_ID
		     , T1.PST_ITM_PRC AS PST_ITM_PRC
		     , T1.CRT_DT AS C1
		     , T1.CRT_USER_ID AS CRT_USER_ID
		     , T2.STK_CODE || ' - ' || T2.STK_DESC AS C2     
		     , T1.PST_ITM_REQ_QTY AS PST_ITM_REQ_QTY
		     , T1.PST_ITM_DO_QTY  AS PST_ITM_DO_QTY
		     , T1.PST_ITM_CAN_QTY AS PST_ITM_CAN_QTY
		     , T1.PST_ITM_BAL_QTY AS PST_ITM_BAL_QTY
		     , T1.PST_ITM_TOT_PRC *  CAST( T1.PST_ITM_BAL_QTY AS float) AS C3
		  FROM SAL0063D T1
		  LEFT OUTER
		  JOIN SYS0026M T2
		    ON T2.STK_ID = T1.PST_ITM_STK_ID
		 WHERE T1.PST_SALES_ORD_ID = #{pstSalesOrdId}

    </select>
</mapper>