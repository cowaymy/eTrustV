<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.coway.trust.biz.homecare.services.impl.htManualMapper">


    <!--
        CLOB 컬럼을 사용하기 위해서는 아래와 같이 resultMap을 선언 후
         <select id="selectClobData" parameterType="Map"  resultMap="clobMap"> 와 같이
          resultMap="clobMap" 을 사용해야 함.
    -->
    <resultMap id="clobMap" type="EgovMap">
        <result property="typeDesc" column="type_Desc" jdbcType="CLOB" javaType="java.lang.String"/>
    </resultMap>

    <select id="selectBranchList" parameterType="Map" resultType="egovMap">
    SELECT *
    FROM (
    <choose>
        <when test="userType == 7">
            SELECT s005m.brnch_id AS CODE_ID
                    , s005m.code || '-' || s005m.name AS CODE_NAME
                from SYS0005M s005m
                        ,SYS0013M s0013m
                where s005m.type_id = s0013m.code_id
                   and s005m.type_id in (42,48)
                 <choose>
                         <when test="memberLevel == 1">
                             AND S005M.CODE IN (
                                                            SELECT DISTINCT C.CODE
                                                            FROM SYS0047M A, ORG0001D B, SYS0005M C, ORG0005D D, ORG0005D E, ORG0001D F
                                                            WHERE 1=1 AND A.USER_NAME = B.MEM_CODE
                                                            AND B.MEM_ID = D.MEM_ID
                                                            AND D.DEPT_CODE = E.LAST_ORG_CODE
                                                            AND E.MEM_LVL ='2'
                                                            AND E.MEM_ID = F.MEM_ID
                                                            AND F.BRNCH = C.BRNCH_ID
                                                            AND A.USER_NAME  = #{userName}
                                                         )
                         </when>
                         <when test="memberLevel == 2">
                             AND S005M.CODE IN ( SELECT C.CODE FROM SYS0047M A, ORG0001D B, SYS0005M C WHERE 1 = 1 AND A.USER_NAME = B.MEM_CODE AND B.BRNCH = C.BRNCH_ID AND A.USER_NAME = #{userName} )
                         </when>
                         <when test="memberLevel == 3">
                             AND S005M.CODE IN ( SELECT C.CODE FROM SYS0047M A, ORG0001D B, SYS0005M C WHERE 1 = 1 AND A.USER_NAME = B.MEM_CODE AND B.BRNCH = C.BRNCH_ID AND A.USER_NAME = #{userName} )
                         </when>
                         <when test="memberLevel == 4">
                             AND S005M.CODE = (SELECT C.CODE FROM ORG0001D A, ORG0005D B, SYS0005M C WHERE A.MEM_ID = B.MEM_ID AND A.BRNCH = C.BRNCH_ID AND A.MEM_CODE = #{userName})
                         </when>
                 </choose>
                             order by s005m.CODE ASC
        </when>
        <when test="userType == 6672">
            SELECT s005m.brnch_id AS CODE_ID
                    , s005m.code || '-' || s005m.name AS CODE_NAME
                from SYS0005M s005m
                        ,SYS0013M s0013m
                where s005m.type_id = s0013m.code_id
                   and s005m.type_id in (5754)
                 <choose>
                         <when test="memberLevel == 1">
                             AND S005M.CODE IN (
                                                            SELECT DISTINCT C.CODE
                                                            FROM SYS0047M A, ORG0001D B, SYS0005M C, ORG0005D D, ORG0005D E, ORG0001D F
                                                            WHERE 1=1 AND A.USER_NAME = B.MEM_CODE
                                                            AND B.MEM_ID = D.MEM_ID
                                                            AND D.DEPT_CODE = E.LAST_ORG_CODE
                                                            AND E.MEM_LVL ='2'
                                                            AND E.MEM_ID = F.MEM_ID
                                                            AND F.BRNCH = C.BRNCH_ID
                                                            AND A.USER_NAME  = #{userName}
                                                         )
                         </when>
                         <when test="memberLevel == 2">
                             AND S005M.CODE IN ( SELECT C.CODE FROM SYS0047M A, ORG0001D B, SYS0005M C WHERE 1 = 1 AND A.USER_NAME = B.MEM_CODE AND B.BRNCH = C.BRNCH_ID AND A.USER_NAME = #{userName} )
                         </when>
                         <when test="memberLevel == 3">
                             AND S005M.CODE IN ( SELECT C.CODE FROM SYS0047M A, ORG0001D B, SYS0005M C WHERE 1 = 1 AND A.USER_NAME = B.MEM_CODE AND B.BRNCH = C.BRNCH_ID AND A.USER_NAME = #{userName} )
                         </when>
                         <when test="memberLevel == 4">
                             AND S005M.CODE = (SELECT C.CODE FROM ORG0001D A, ORG0005D B, SYS0005M C WHERE A.MEM_ID = B.MEM_ID AND A.BRNCH = C.BRNCH_ID AND A.MEM_CODE = #{userName})
                         </when>
                 </choose>
                             order by s005m.CODE ASC
        </when>
        <when test="userType == 4 or userType == 6 ">
                SELECT s005m.brnch_id AS code_id,
                       s005m.code || '-' || s005m.NAME AS code_name
                  FROM sys0005m s005m, sys0013m s0013m
                 WHERE s005m.type_id = s0013m.code_id AND s005m.type_id IN (42,48,5754)
                UNION ALL
                SELECT s005m.brnch_id AS code_id,
                       s005m.code || '-' || s005m.NAME AS code_name
                  FROM sys0005m s005m, sys0013m s0013m
                 WHERE s005m.type_id = s0013m.code_id AND s005m.code = 'DSC-28'
        </when>
        <when test="userType == 3">
                SELECT S005M.BRNCH_ID AS CODE_ID,
                           S005M.CODE || '-' || S005M.NAME AS CODE_NAME
                  FROM SYS0005M S005M, SYS0013M S0013M
                 WHERE S005M.TYPE_ID = S0013M.CODE_ID AND S005M.CODE = 'DSC-28'
        </when>
        <otherwise>
            SELECT S005M.BRNCH_ID AS CODE_ID
                     , S005M.CODE || '-' || S005M.NAME AS CODE_NAME
            FROM SYS0005M S005M
            WHERE S005M.TYPE_ID IN (42,48)
                            UNION ALL
                SELECT s005m.brnch_id AS code_id,
                       s005m.code || '-' || s005m.NAME AS code_name
                  FROM sys0005m s005m, sys0013m s0013m
                 WHERE s005m.type_id = s0013m.code_id AND s005m.code = 'DSC-28'
        </otherwise>
    </choose>
    ) PROJECT
    ORDER BY PROJECT.CODE_NAME ASC

          </select>




      <select id="getCdUpMemList" parameterType="Map" resultType="egovMap">
            SELECT * FROM (
            SELECT A.MEM_ID AS CODE_ID
            ,A.DEPT_CODE || '-' || B.NAME AS CODE_NAME
                    /*,B.MEM_CODE || '-' || B.NAME AS CODE_NAME*/
            FROM ORG0005D A
                    ,ORG0001D B
                    ,SYS0005M C
            WHERE A.MEM_ID = B.MEM_ID
                AND A.BRNCH_ID = C.BRNCH_ID
                AND A.DEPT_CODE IS NOT NULL
                AND B.MEM_TYPE = 7
            <if test="userType == '7'.toString()">
                    AND B.STUS IN (1,8)
                <if test="memLevl == '1'.toString()">
                    AND A.MEM_LVL  = '3'
                    AND A.BRNCH_ID = #{groupCode}
                 </if>
                <if test="memLevl == '2'.toString()">
                    AND (A.DEPT_CODE || B.NAME) IN ( SELECT C.DEPT_CODE || D.NAME
                                                      FROM ORG0001D A,
                                                           ORG0005D B,
                                                           ORG0005D C,
                                                           ORG0001D D
                                                     WHERE A.MEM_ID = B.MEM_ID
                                                       AND B.DEPT_CODE = C.LAST_GRP_CODE
                                                       AND A.MEM_CODE = #{userName}
                                                       AND C.MEM_LVL = '3'
                                                       AND C.MEM_ID = D.MEM_ID
                                                       )
                </if>
                <if test="memLevl == '3'.toString()">
                    AND A.MEM_LVL = #{memLevl}
                    AND A.BRNCH_ID = #{groupCode}
                    AND B.MEM_CODE  =#{userName}
                </if>
                <if test="memLevl == '4'.toString()">
                    AND A.MEM_LVL = '3'
                    AND A.BRNCH_ID = #{groupCode}
                   <!--  AND B.MEM_CODE  = #{userName} -->
                     AND B.STUS = '1'
                </if>
            </if>
            <if test="userType == '4'.toString() and groupCode != '151'.toString() ">
                    AND A.MEM_LVL = '3'
                    AND A.BRNCH_ID = #{groupCode}
                    AND B.STUS = '1'
            </if>
            <if test = "userType == '4'.toString() and groupCode == '151'.toString() ">
                    AND A.MEM_LVL = '3'
                    AND A.BRNCH_ID = #{groupCode}
                    AND B.STUS = '1'
                UNION
                     SELECT A.MEM_ID AS CODE_ID
                    ,A.DEPT_CODE || '-' || B.NAME AS CODE_NAME
                    /*,B.MEM_CODE || '-' || B.NAME AS CODE_NAME*/
            FROM ORG0005D A
                    ,ORG0001D B
                    ,SYS0005M C
            WHERE A.MEM_ID = B.MEM_ID
                AND A.BRNCH_ID = C.BRNCH_ID
                AND A.DEPT_CODE IS NOT NULL
                AND A.BRNCH_ID = '151'
                AND B.STUS = '1'
            </if>

           ) PROJECT
           ORDER BY CODE_NAME
       </select>



        <select id="getCdDeptList" parameterType="Map" resultType="egovMap">
          SELECT * FROM (
          SELECT A.MEM_ID AS CODE_ID
                    ,A.DEPT_CODE || '-' || B.NAME AS CODE_NAME
            FROM ORG0005D A
                    ,ORG0001D B
                    ,SYS0005M C
            WHERE A.MEM_ID = B.MEM_ID
                AND A.BRNCH_ID = C.BRNCH_ID
                AND A.DEPT_CODE IS NOT NULL
                AND B.MEM_TYPE = 7
            <if test="userType == '2'.toString()">
                    AND B.STUS IN (1,8)
                <if test="memLevl == '1'.toString()">
                    AND A.MEM_LVL  = '3'
                    AND A.BRNCH_ID = #{groupCode}
                 </if>
                <if test="memLevl == '2'.toString()">
                    AND (A.DEPT_CODE || B.NAME) IN ( SELECT C.DEPT_CODE || D.NAME
                                                      FROM ORG0001D A,
                                                           ORG0005D B,
                                                           ORG0005D C,
                                                           ORG0001D D
                                                     WHERE A.MEM_ID = B.MEM_ID
                                                       AND B.DEPT_CODE = C.LAST_GRP_CODE
                                                       AND A.MEM_CODE = #{userName}
                                                       AND C.MEM_LVL = '3'
                                                       AND C.MEM_ID = D.MEM_ID
                                                       )
                </if>
                <if test="memLevl == '3'.toString()">
                    AND A.MEM_LVL = #{memLevl}
                    AND A.BRNCH_ID = #{groupCode}
                    AND B.MEM_CODE  =#{userName}
                </if>
                <if test="memLevl == '4'.toString()">
                    AND A.BRNCH_ID = #{groupCode}
                    AND B.MEM_CODE  = #{userName}
                </if>
            </if>
            <if test="userType == '4'.toString() and groupCode != '151'.toString() ">
                    AND A.MEM_LVL = '3'
                    AND A.BRNCH_ID = #{groupCode}
                    AND B.STUS = '1'
            </if>

             <if test = "userType == '4'.toString() and groupCode == '151'.toString() ">
                    AND A.MEM_LVL = '3'
                    AND A.BRNCH_ID = #{groupCode}
                    AND B.STUS = '1'
                UNION
                     SELECT A.MEM_ID AS CODE_ID
                    ,A.DEPT_CODE || '-' || B.NAME AS CODE_NAME
                    /*,B.MEM_CODE || '-' || B.NAME AS CODE_NAME*/
            FROM ORG0005D A
                    ,ORG0001D B
                    ,SYS0005M C
            WHERE A.MEM_ID = B.MEM_ID
                AND A.BRNCH_ID = C.BRNCH_ID
                AND A.DEPT_CODE IS NOT NULL
                AND A.BRNCH_ID = '151'
                AND B.STUS = '1'
            </if>
            ) PROJECT
            ORDER BY CODE_NAME
       </select>

           <select id="getCdList_1" parameterType="Map" resultType="egovMap">

                SELECT ROWNUM AS rnum ,
                           a.*
                  FROM (
                SELECT DISTINCT b.dept_code,
                       b.mem_id,
                       d.mem_code AS cody_id,
                       d.name AS cody_name,
                       d.stus
                  FROM sys0005m a,
                       org0005d b,
                       org0001d d,
                       sys0038m extent2
                 WHERE  a.brnch_id = d.brnch
                    AND b.mem_id = d.mem_id
                    AND d.stus = '1'
                    AND d.mem_type = '7'
                    AND b.mem_lvl = '4'
                    <if test="deptListSpl != null and deptListSpl != ''">
                        AND b.dept_code IN
                       <foreach item="item" collection="deptListSpl" index="index" open="(" separator="," close=")">
                        #{item}
                       </foreach>

                       <if test = "item == 'CTS2044'  ">
                        UNION
                    SELECT DISTINCT b.dept_code,
                       b.mem_id,
                       d.mem_code AS cody_id,
                       d.name AS cody_name,
                       d.stus
                FROM sys0005m a,
                       org0005d b,
                       org0001d d,
                       sys0038m extent2
                 WHERE  a.brnch_id = d.brnch
                    AND b.mem_id = d.mem_id
                    AND d.stus = '1'
                    AND a.brnch_id = '151'
                       </if>

                    </if>
                    ) a
                 ORDER BY DEPT_CODE ASC, CODY_ID ASC
          </select>


           <select id="getCdList" parameterType="Map" resultType="egovMap">

                select b.mem_code as CODE_ID
                        ,b.name as CODE_NAME
                from ORG1001V a
                        ,ORG0001D b
                where a.MEM_ID = b.MEM_ID
                and b.MEM_TYPE = 7
                <if test="groupCode != null and groupCode != ''">
                    and brnch = #{groupCode}
                </if>
                order by b.mem_code

          </select>



  <select id="selectHsManualList" parameterType="Map" resultType="egovMap">
    SELECT * FROM (
      SELECT DISTINCT C.CUST_ID CUST_ID,
                               C.NAME NAME,
                               SOM.SRV_ORD_NO CCS_ORD_NO,
                               SO.SALES_ORD_NO SALES_ORD_NO ,
                               HSM.MONTH,
                               HSM.YEAR YEAR,
                               HSM.MONTH || '/' || HSM.YEAR HS_DATE,
                               HSM.NO,
                               HSM.CODY_ID,
                               HSM.STUS_CODE_ID STUS_CODE_ID,
                               EXTENT2.CODE CODE,
                               SAL023.AREA_ID,
                               ( SELECT MEM_CODE
                                 FROM ORG0001D ME
                                 WHERE 1 = 1
                                     AND ME.MEM_ID = HSM.CODY_ID
                               ) AS C5,
                               SOM.SRV_ORD_ID AS SALES_ORD_ID,
                               SOM.BRNCH_ID AS BRNCH_ID,
                               SAL023.ADDR_DTL AS ADDRESS,
                               (CASE WHEN (SOM.SRV_TYPE = 6861)THEN SOM.SALES_PROD_SZ ELSE NULL END) AS STK_DESC,
                               SCP.SRV_PRD_DUR HS_FREQ,
                               (CASE WHEN ( EXTRACT(MONTH FROM LAST_BRM.SETL_DT) = EXTRACT(MONTH FROM ADD_MONTHS(SYSDATE,-1) ) AND EXTRACT(YEAR FROM LAST_BRM.SETL_DT) = EXTRACT(YEAR FROM ADD_MONTHS(SYSDATE,-1) ) ) THEN STUS.CODE
                               ELSE 'X' END ) PREV_MTH_HS_STATUS,
                                 STUS1.CODE HT_STATUS,
                               MEM2.DEPT_CODE ,
                               HSM.SCHDUL_ID ,
                               MEM3.MEM_CODE HT_MGR_CODE ,
                               BRNCH.CODE HT_BRNCH_CODE ,
                               MEM4.DEPT_CODE DEPT_CODE_1 ,
                               AP.CODE AS APPTYPE ,
                               SOM.SALES_PROD_SZ,
                               SRT.CODE AS SRV_TYPE,
                               SOM.SRV_TYPE AS SERVICE_TYPE,
                               SOM.UNIT_TYPE
      FROM SAL0225D SOM
      LEFT JOIN SVC0008D HSM ON SOM.SRV_ORD_ID = HSM.SALES_ORD_ID
                                         AND hsm.YEAR = #{myBSYear}
                                         AND hsm.MONTH = #{myBSMonth}
      <![CDATA[
        AND NVL(HSM.TYPE_ID, 0) <> ( SELECT CODE_ID
                                                     FROM SYS0013M
                                                     WHERE CODE_MASTER_ID = 34
                                                         AND CODE = 'MSS'
        )
      ]]>

      LEFT JOIN SAL0001D SO ON SOM.SRV_ORD_ID = SO.SALES_ORD_ID AND SO.BNDL_ID IS NOT NULL
      LEFT JOIN SAL0029D C ON SOM.CUST_ID = C.CUST_ID
      LEFT JOIN SYS0013M CORPTYPE ON C.CORP_TYPE_ID = CORPTYPE.CODE_ID
      LEFT JOIN SYS0038M EXTENT2 ON HSM.STUS_CODE_ID = EXTENT2.STUS_CODE_ID
      LEFT JOIN SAL0045D I ON I.SALES_ORD_ID = SOM.SRV_ORD_ID
      LEFT JOIN SAL0023D SAL023 ON I.ADD_ID = SAL023.CUST_ADD_ID
      LEFT JOIN SVC0006D LAST_BRM ON LAST_BRM.SCHDUL_ID = HSM.SCHDUL_ID
      LEFT JOIN SAL0090D SC ON SC.SRV_SO_ID = SOM.SRV_ORD_ID
      LEFT JOIN SAL0088D SCP ON SC.SRV_CONFIG_ID = SCP.SRV_CONFIG_ID
      LEFT JOIN SYS0038M STUS ON STUS.STUS_CODE_ID = LAST_BRM.RESULT_STUS_CODE_ID
      LEFT JOIN ORG0001D MEM ON MEM.MEM_ID = SC.SRV_CODY_ID
      LEFT JOIN ORG0005D MEM2 ON MEM.MEM_ID = MEM2.MEM_ID
      LEFT JOIN SYS0038M STUS1 ON STUS1.STUS_CODE_ID = MEM.STUS
      LEFT JOIN ORG0001D MEM3 ON MEM2.MEM_UP_ID = MEM3.MEM_ID
      LEFT JOIN ORG0005D MEM4 ON MEM3.MEM_ID = MEM4.MEM_ID
      LEFT JOIN SYS0005M BRNCH ON BRNCH.BRNCH_ID = MEM.BRNCH
      LEFT JOIN SAL0095D SAL95D ON SOM.SRV_ORD_ID = SAL95D.SRV_SALES_ORD_ID
      LEFT JOIN SYS0013M AP ON SOM.APP_TYPE_ID = AP.CODE_ID
      LEFT JOIN SYS0013M SRT ON SOM.SRV_TYPE = SRT.CODE_ID
      WHERE 1 = 1

      <![CDATA[ AND SOM.STUS_CODE_ID NOT IN (8,10)  ]]>

      <if test="userType == '3'.toString()">
        AND MEM.MEM_CODE IN (SELECT MEM_CODE FROM ORG0001D WHERE MEM_TYPE = '3' AND STUS = '1')
      </if>
    ) A WHERE 1 = 1

    <if test="ManuaSalesOrder != null and ManuaSalesOrder != ''">
      AND A.CCS_ORD_NO = #{ManuaSalesOrder}
    </if>

    <if test="ManuaSalesOrderNo != null and ManuaSalesOrderNo != ''">
      AND A.SALES_ORD_NO = #{ManuaSalesOrderNo}
    </if>

    <if test="ManualCustomer != null and ManualCustomer != ''">
      AND A.CUST_ID = #{ManualCustomer}
    </if>

    <if test="manualCustomer != null and manualCustomer != ''">
      AND A.CUST_ID = #{manualCustomer}
    </if>

    <if test="cmdBranchCode1 != null and cmdBranchCode1 != ''">
      AND ( A.HT_BRNCH_CODE = SUBSTR(#{cmdBranchCode1},1,6))
    </if>

    <if test="cmdCdManager1 != null and cmdCdManager1 != ''">
      AND A.DEPT_CODE_1 =  SUBSTR(#{cmdCdManager1},1,7)
    </if>

    <if test="saleOrdListSp != null and saleOrdListSp != '' ">
      AND A.SALES_ORD_NO IN
      <foreach item="item" collection="saleOrdListSp" index="index" open="(" separator="," close=")">
        #{item}
      </foreach>
    </if>

    <if test="serviceTypeIdHsManua != null and serviceTypeIdHsManua != '' ">
      AND A.SERVICE_TYPE = #{serviceTypeIdHsManua}
    </if>

    <if test='listProductIdHsManua != null and listProductIdHsManua != ""'>
      AND A.SALES_PROD_SZ IN
      <foreach item="item" collection="listProductIdHsManua" index="index" open="(" separator="," close=")">
        #{item}
      </foreach>
    </if>

    <if test='unitTypeIdHsManua != null and unitTypeIdHsManua != ""'>
      AND A.UNIT_TYPE IN
     <foreach item="item" collection="unitTypeIdHsManua" index="index" open="(" separator="," close=")">
       #{item}
     </foreach>
    </if>
  </select>

<!-- cyc 2017- Nov- 13 -->
 <select id="selectHsConfigList" parameterType="Map" resultType="egovMap">
    SELECT * FROM (
    SELECT
    DISTINCT
    C.CUST_ID CUST_ID,
    C.NAME NAME,
    <!-- CASE WHEN SO.SALES_ORD_NO IS NOT NULL THEN SO.SALES_ORD_NO ELSE SOM.SRV_ORD_NO END AS SALES_ORD_NO, -->
    SOM.SALES_ORD_NO,
    SOM.SRV_ORD_ID AS SALES_ORD_ID,
    SOM.BRNCH_ID AS BRNCH_ID,
    SAL90.SRV_CODY_ID,
    ORG01.MEM_CODE,
    ORG01.BRNCH,
    BRANCH.CODE
    FROM  (
        SELECT SALES_ORD_ID SRV_ORD_ID,BRNCH_ID,CUST_ID,SALES_ORD_NO ,STUS_CODE_ID FROM SAL0001D WHERE BNDL_ID IS NOT NULL
        UNION
        SELECT SRV_ORD_ID ,BRNCH_ID,CUST_ID, SRV_ORD_NO SALES_ORD_NO, STUS_CODE_ID FROM SAL0225D
    ) SOM
    <!-- LEFT JOIN SAL0001D SO ON SOM.SRV_ORD_ID = SO.SALES_ORD_ID AND SO.BNDL_ID IS NOT NULL -->
    LEFT JOIN SAL0029D C ON  SOM.CUST_ID = C.CUST_ID
    LEFT JOIN SAL0090D SAL90 ON SAL90.SRV_SO_ID = SOM.SRV_ORD_ID
    AND SAL90.SRV_STUS_ID NOT IN (8)
    LEFT JOIN ORG0001D ORG01 ON ORG01.MEM_ID = SAL90.SRV_CODY_ID
    LEFT JOIN SYS0005M BRANCH ON ORG01.BRNCH = BRANCH.BRNCH_ID
                                WHERE 1=1

                 <![CDATA[ AND SOM.STUS_CODE_ID NOT IN (8,10)
                                ]]>
    ) A WHERE 1=1
                               <if test="ManuaSalesOrder != null and ManuaSalesOrder != ''">
                                      AND A.SALES_ORD_NO = #{ManuaSalesOrder}
                               </if>
                               <if test="ManualCustomer != null and ManualCustomer != ''">
                                      AND A.CUST_ID = #{ManualCustomer}
                               </if>
                               <if test="manualCustomer != null and manualCustomer != ''">
                                      AND A.CUST_ID = #{manualCustomer}
                               </if>
                                <if test="saleOrdListSp != null and saleOrdListSp != '' ">
                                    AND A.SALES_ORD_NO IN
                                   <foreach item="item" collection="saleOrdListSp" index="index" open="(" separator="," close=")">
                                    #{item}
                                    </foreach>
                                </if>

          </select>




                    <select id="selectHsManualListPop" parameterType="Map" resultType="egovMap">


                            SELECT   distinct HSM.SCHDUL_ID
                                        ,C.NAME Name
                                        , SOM.Srv_ORD_ID SALES_ORD_ID
                                         ,SOM.Srv_ORD_NO SALES_ORD_NO
                                         ,HSM.MONTH
                                         ,HSM.YEAR YEAR
                                         ,HSM.MONTH || '/' || HSM.YEAR HS_DATE
                                         ,HSM.NO
                                         ,HSM.CODY_ID
                                         ,HSM.STUS_CODE_ID STUS_CODE_ID
                                         ,EXTENT2.CODE CODE
                                         ,sys064.CODY_BRNCH_CODE AS BRNCH_ID
                                         ,SAL023.area_id,
                                           sys064.area_id,
                                           sys064.CODY_BRNCH_CODE,
                                           sys064.CODY_MANGR_USER_ID,
                                           (select  MEM_CODE
                                               from ORG0001D ME
                                               where 1=1
                                               and ME.MEM_ID = HSM.cody_ID )AS cody_cd                   ,
                                            (SELECT MEM_CODE
                                               FROM ORG0001D ME
                                              WHERE 1 = 1 AND ME.MEM_ID = HSM.cody_ID)
                                               AS old_cody_cd
                                FROM SAL0225D SOM
                                        ,SAL0029D C
                                        ,SVC0008D HSM
                                        ,SYS0038M EXTENT2
                                        ,sal0023d sal023
                                        ,SYS0064M sys064
                                        ,SAL0045D INS
                                WHERE 1=1
                                AND SOM.CUST_ID = C.CUST_ID
                                AND SOM.SRV_ORD_ID = HSM.SALES_ORD_ID(+)
                                AND HSM.STUS_CODE_ID = EXTENT2.STUS_CODE_ID(+)
                                AND SOM.CUST_ID = SAL023.CUST_ID
                                AND SOM.SRV_ORD_ID = INS.SALES_ORD_ID
                                AND SAL023.CUST_ADD_ID = INS.ADD_ID
                                AND SAL023.AREA_ID = SYS064.AREA_ID
                 <![CDATA[ AND SOM.STUS_CODE_ID NOT IN (8,10)    ]]>
                             <if test="ManuaMyBSMonth != null and ManuaMyBSMonth != ''">
                                      AND  hsm.YEAR(+) = #{myBSYear}
                                      AND  hsm.MONTH(+) = #{myBSMonth}
                             </if>
                               <if test="ManuaSalesOrder != null and ManuaSalesOrder != ''">
                                      AND SOM.SRV_ORD_NO = #{ManuaSalesOrder}
                               </if>
                               <if test="ManualCustomer != null and ManualCustomer != ''">
                                      AND c.CUST_ID = #{ManualCustomer}
                               </if>
                                <if test="saleOrdListSp != null and saleOrdListSp != ''">
                                    AND SOM.SRV_ORD_NO IN
                                   <foreach item="item" collection="saleOrdListSp" index="index" open="(" separator="," close=")">
                                    #{item}
                                    </foreach>
                                </if>
          </select>




  <select id="selectHsAssiinlList" parameterType="Map" resultType="egovMap">

SELECT * FROM
    (
        SELECT
            ROW_NUMBER()
            OVER(PARTITION BY no
                 ORDER BY
                     result DESC
            ) AS dum_seq,
            project3.*
        FROM
            (
                SELECT
                    project2.no no,
                    project2.hs_date hs_date,
                    project2.stus_code_id stus_code_id,
                    project2.code code,
                    project2.sales_ord_no sales_ord_no,
                    project2.assign_cody  c5,
                    project2.action_cody  AS actn_mem_id,
                    project2.mem_id,
                    project2.name name,
                    project2.cust_id,
                    project2.ht_status,
                    project2.setl_dt,
                    project2.remarks,
                    project2.brnch_id AS brnch_id,
                    project2.schdul_id schdul_id,
                    project2.sales_ord_id,
                    project2.ht_brnch_code,
                    project2.ht_mgr_code,
                    project2.result AS result,
                    project2.dept_code,
                    project2.grpcode,
                    project2.crt_user_id,
                    CASE WHEN (substr(project2.mat_desc, 1, instr(project2.mat_desc, ' (C', 1, 1)) ) IS NULL
                            THEN project2.mat_desc
                        ELSE substr(project2.mat_desc,1, instr(project2.mat_desc, ' (C', 1, 1))
                    END mat_stk_desc,
                    CASE WHEN (substr(project2.fra_desc,1, instr(project2.fra_desc, ' (C', 1, 1)) ) IS NULL
                            THEN project2.fra_desc
                        ELSE
                            substr(project2.fra_desc, 1, instr(project2.fra_desc, ' (C', 1, 1))
                    END fra_stk_desc,
                    project2.apptype,
                    project2.sales_prod_sz,
                    project2.app_type_id,
                    project2.srv_type,
                    project2.unit_type,
                    project2.service_type,
                    project2.agingmth aging_mth
                FROM
                    (
                        (
                            SELECT DISTINCT hs.no AS no,
                                      hs.stus_code_id AS stus_code_id,
                                      hs.month || '/' || hs.year AS hs_date,
                                      hs.month,
                                      hs.year,
                                      st.code,
                                      hr.no AS result,
                                      so.sales_ord_no sales_ord_no,
                                      so.app_type_id,
                                      mi.stk_desc AS mat_desc,
                                      fi.stk_desc AS fra_desc,
                                      ap.code AS apptype,
                                      so.sales_prod_sz,
                                      cu2.name  name,
                                      cd.mem_code AS assign_cody,
                                      cd.mem_id,
                                      ac.mem_code AS action_cody,
                                      mg.state,
                                      mg.area,
                                      cu2.cust_id,
                                      stus.code AS ht_status,
                                      hr.setl_dt,
                                      rem.code_name AS remarks,
                                      br.brnch_id AS brnch_id,
                                      hs.schdul_id schdul_id,
                                      so.sales_ord_id AS sales_ord_id,
                                      br.code AS ht_brnch_code,
                                      mem3.mem_code ht_mgr_code,
                                      og.dept_code,
                                      CASE WHEN hs.crt_user_id = '2222'
                                              THEN ''
                                              ELSE usr.user_name
                                      END AS crt_user_id,
                                      so.pv_month,
                                      so.pv_year,
                                      t6.org_code AS orgcode,
                                      t6.grp_code AS grpcode,
                                      t6.dept_code AS deptcode,
                                      CASE WHEN srt.code IS NOT NULL
                                              THEN srt.code_name
                                          ELSE type.stk_ctgry
                                      END  AS srv_type,
                                      so.unit_type,
                                      so.srv_type AS service_type,
                                      ag.curr_mth_aging agingmth
                            FROM SVC0008D hs
                                JOIN (
                                    SELECT s1.sales_ord_id,
                                              s1.brnch_id,
                                              s1.cust_id,
                                              s1.sales_ord_no,
                                              s1.stus_code_id,
                                              s1.pv_year,
                                              s1.pv_month,
                                              s1.app_type_id,
                                              TO_NUMBER(s2.srv_type) srv_type,
                                              s2.sales_prod_sz,
                                              s2.unit_type unit_type,
                                              s1.bndl_id
                                    FROM SAL0001D s1
                                    JOIN SAL0225D s2 ON s2.srv_ord_id = s1.sales_ord_id
                                ) so ON so.sales_ord_id = hs.sales_ord_id
                                INNER JOIN SAL0045D ins ON ins.sales_ord_id = hs.sales_ord_id
                                INNER JOIN SAL0023D ad ON ad.cust_add_id = ins.add_id
                                LEFT JOIN SYS0064M mg ON mg.area_id = ad.area_id
                                LEFT JOIN SVC0006D hr ON hr.schdul_id = hs.schdul_id
                                LEFT JOIN SYS0038M st ON st.stus_code_id = hs.stus_code_id
                                INNER JOIN SYS0013M ap ON ap.code_id = so.app_type_id
                                JOIN SAL0029D cu2 ON cu2.cust_id = so.cust_id
                                LEFT JOIN ORG0001D cd ON cd.mem_id = hs.cody_id
                                LEFT JOIN SYS0038M stus ON stus.stus_code_id = cd.stus
                                LEFT JOIN ORG0001D ac ON ac.mem_id = hs.cody_id
                                LEFT JOIN SYS0005M br ON br.brnch_id = ac.brnch
                                LEFT JOIN ORG0005D og ON og.mem_id = cd.mem_id
                                LEFT JOIN ORG0001D mem3 ON og.mem_up_id = mem3.mem_id
                                LEFT JOIN SYS0047M usr ON hs.crt_user_id = usr.user_id
                                LEFT JOIN ORG1001V t6 ON t6.mem_id = og.mem_id
                                LEFT JOIN (
                                    SELECT fr.resn_id AS code_id,
                                               fr.code  || '-'  || fr.resn_desc AS code_name
                                    FROM SYS0032M fr
                                    WHERE ( 167 = fr.resn_type_id )
                                    AND ( 1 = fr.stus_code_id )
                                ) rem ON rem.code_id = hr.fail_resn_id
                                LEFT JOIN SYS0013M srt ON so.srv_type = srt.code_id
                                LEFT JOIN SAL0002D ms ON ms.sales_ord_id = so.sales_ord_id
                                LEFT JOIN SYS0026M mi ON mi.stk_id = ms.itm_stk_id
                                LEFT JOIN HMC0011D hc ON hc.ord_seq_no = so.bndl_id
                                LEFT JOIN SAL0001D fo ON fo.sales_ord_no = hc.fra_ord_no
                                LEFT JOIN SAL0002D fs ON fs.sales_ord_id = fo.sales_ord_id
                                LEFT JOIN SYS0026M fi ON fi.stk_id = fs.itm_stk_id
                                LEFT JOIN REP0010S ag ON ag.ord_id = hs.sales_ord_id
                                LEFT JOIN REP0011S type ON type.ord_no = so.sales_ord_no
                            WHERE cd.mem_id IS NOT NULL
                          <if test="cmdCdManager != null and cmdCdManager != ''">
                            AND MEM3.MEM_ID =  #{cmdCdManager}
                          </if>
                          <if test="userType == '3'.toString()">
                            AND MEM.MEM_CODE IN (SELECT MEM_CODE FROM ORG0001D WHERE MEM_TYPE = '3' AND STUS = '1')
                          </if>
                          <if test="cmdBranchCode != null and cmdBranchCode != ''">
                            AND ( BR.BRNCH_id = #{cmdBranchCode})
                          </if>
                           <if test="orgCode != null and orgCode != ''">
                            AND T6.ORG_CODE = #{orgCode}
                           </if>
                           <if test="grpCode != null and grpCode != ''">
                             AND T6.GRP_CODE = #{grpCode}
                          </if>
                           <if test="deptCode != null and deptCode != ''">
                             AND T6.DEPT_CODE = #{deptCode}
                          </if>
                           <![CDATA[
                            AND hs.TYPE_ID  <> (SELECT CODE_ID
                                                           FROM SYS0013M
                                                           WHERE CODE_MASTER_ID = 34
                                                            AND CODE = 'MSS')
                            ]]>

                  UNION

                            SELECT DISTINCT hs.no AS no,
                                      hs.stus_code_id AS stus_code_id,
                                      hs.month || '/' || hs.year AS hs_date,
                                      hs.month,
                                      hs.year,
                                      st.code,
                                      hr.no  AS result,
                                      so.sales_ord_no sales_ord_no,
                                      so.app_type_id,
                                      mi.stk_desc AS mat_desc,
                                      fi.stk_desc AS fra_desc,
                                      ap.code AS apptype,
                                      so.sales_prod_sz,
                                      cu2.name name,
                                      cd.mem_code AS assign_cody,
                                      cd.mem_id,
                                      ac.mem_code AS action_cody,
                                      mg.state,
                                      mg.area,
                                      cu2.cust_id,
                                      stus.code AS ht_status,
                                      hr.setl_dt,
                                      rem.code_name  AS remarks,
                                      br.brnch_id  AS brnch_id,
                                      hs.schdul_id schdul_id,
                                      so.sales_ord_id AS sales_ord_id,
                                      br.code AS ht_brnch_code,
                                      mem3.mem_code ht_mgr_code,
                                      og.dept_code,
                                      CASE WHEN hs.crt_user_id = '2222'
                                              THEN  ''
                                          ELSE usr.user_name
                                      END AS crt_user_id,
                                      so.pv_month,
                                      so.pv_year,
                                      t6.org_code AS orgcode,
                                      t6.grp_code AS grpcode,
                                      t6.dept_code AS deptcode,
                                      CASE WHEN srt.code IS NOT NULL
                                              THEN srt.code_name
                                          ELSE type.stk_ctgry
                                      END AS srv_type,
                                      so.unit_type,
                                      so.srv_type AS service_type,
                                      ag.curr_mth_aging agingmth
                            FROM SVC0008D hs
                                JOIN (
                                    SELECT srv_ord_id  sales_ord_id,
                                        brnch_id,
                                        cust_id,
                                        srv_ord_no sales_ord_no,
                                        stus_code_id,
                                        pv_year,
                                        pv_month,
                                        app_type_id,
                                        TO_NUMBER(srv_type) srv_type,
                                        sales_prod_sz,
                                        unit_type,
                                        0  bndl_id
                                    FROM SAL0225D
                                ) so ON so.sales_ord_id = hs.sales_ord_id
                                INNER JOIN SAL0045D ins ON ins.sales_ord_id = hs.sales_ord_id
                                INNER JOIN SAL0023D ad ON ad.cust_add_id = ins.add_id
                                LEFT JOIN SYS0064M mg ON mg.area_id = ad.area_id
                                LEFT JOIN SVC0006D hr ON hr.schdul_id = hs.schdul_id
                                LEFT JOIN SYS0038M st ON st.stus_code_id = hs.stus_code_id
                                INNER JOIN SYS0013M ap ON ap.code_id = so.app_type_id
                                JOIN SAL0029D cu2 ON cu2.cust_id = so.cust_id
                                LEFT JOIN ORG0001D cd ON cd.mem_id = hs.cody_id
                                LEFT JOIN SYS0038M stus ON stus.stus_code_id = cd.stus
                                LEFT JOIN ORG0001D ac ON ac.mem_id = hs.cody_id
                                LEFT JOIN SYS0005M br ON br.brnch_id = ac.brnch
                                LEFT JOIN ORG0005D og ON og.mem_id = cd.mem_id
                                LEFT JOIN ORG0001D mem3 ON og.mem_up_id = mem3.mem_id
                                LEFT JOIN SYS0047M usr ON hs.crt_user_id = usr.user_id
                                LEFT JOIN ORG1001V t6 ON t6.mem_id = og.mem_id
                                LEFT JOIN (
                                    SELECT  fr.resn_id      AS code_id,
                                                fr.code || '-' || fr.resn_desc AS code_name
                                    FROM SYS0032M fr
                                    WHERE ( 167 = fr.resn_type_id )
                                    AND ( 1 = fr.stus_code_id )
                                )  rem ON rem.code_id = hr.fail_resn_id
                                LEFT JOIN SYS0013M srt ON so.srv_type = srt.code_id
                                LEFT JOIN SAL0002D ms ON ms.sales_ord_id = so.sales_ord_id
                                LEFT JOIN SYS0026M mi ON mi.stk_id = ms.itm_stk_id
                                LEFT JOIN HMC0011D hc ON hc.ord_seq_no = so.bndl_id
                                LEFT JOIN SAL0001D fo ON fo.sales_ord_no = hc.fra_ord_no
                                LEFT JOIN SAL0002D fs ON fs.sales_ord_id = fo.sales_ord_id
                                LEFT JOIN SYS0026M fi ON fi.stk_id = fs.itm_stk_id
                                LEFT JOIN REP0010S ag ON ag.ord_id = hs.sales_ord_id
                                LEFT JOIN REP0011S type ON type.ord_no = so.sales_ord_no
                            WHERE cd.mem_id IS NOT NULL

                          <if test="cmdCdManager != null and cmdCdManager != ''">
                            AND MEM3.MEM_ID =  #{cmdCdManager}
                          </if>
                          <if test="userType == '3'.toString()">
                            AND MEM.MEM_CODE IN (SELECT MEM_CODE FROM ORG0001D WHERE MEM_TYPE = '3' AND STUS = '1')
                          </if>
                          <if test="cmdBranchCode != null and cmdBranchCode != ''">
                            AND ( BR.BRNCH_id = #{cmdBranchCode})
                          </if>
                           <if test="orgCode != null and orgCode != ''">
                            AND T6.ORG_CODE = #{orgCode}
                           </if>
                           <if test="grpCode != null and grpCode != ''">
                             AND T6.GRP_CODE = #{grpCode}
                          </if>
                           <if test="deptCode != null and deptCode != ''">
                             AND T6.DEPT_CODE = #{deptCode}
                          </if>
                           <![CDATA[
                            AND hs.TYPE_ID  <> (SELECT CODE_ID
                                                           FROM SYS0013M
                                                           WHERE CODE_MASTER_ID = 34
                                                            AND CODE = 'MSS')
                             ]]>
                        )

                        UNION
                        (
                          SELECT DISTINCT hs.no AS no,
                                    hs.stus_code_id   AS stus_code_id,
                                    hs.month || '/' || hs.year AS hs_date,
                                    hs.month,
                                    hs.year,
                                    st.code,
                                    hr.no AS result,
                                    so.sales_ord_no sales_ord_no,
                                    so.app_type_id,
                                    mi.stk_desc AS mat_desc,
                                    fi.stk_desc AS fra_desc,
                                    ap.code AS apptype,
                                    so.sales_prod_sz,
                                    cu.name,
                                    cd.mem_code AS assign_cody,
                                    cd.mem_id,
                                    ac.mem_code AS action_cody,
                                    mg.state,
                                    mg.area,
                                    cu.cust_id AS cust_id,
                                    stus.code AS ht_status,
                                    hr.setl_dt,
                                    rem.code_name AS remarks,
                                    br.brnch_id AS brnch_id,
                                    hs.schdul_id schdul_id,
                                    so.sales_ord_id AS sales_ord_id,
                                    br.code AS ht_brnch_code,
                                    mem3.mem_code ht_mgr_code,
                                    og.dept_code,
                                    CASE WHEN hs.crt_user_id = '2222'
                                             THEN ''
                                    ELSE usr.user_name END AS crt_user_id,
                                    so.pv_month,
                                    so.pv_year,
                                    t6.org_code AS orgcode,
                                    t6.grp_code AS grpcode,
                                    t6.dept_code AS deptcode,
                                    CASE WHEN srt.code IS NOT NULL
                                            THEN srt.code_name
                                    ELSE type.stk_ctgry
                                    END AS srv_type,
                                    so.unit_type,
                                    so.srv_type AS service_type,
                                    ag.curr_mth_aging agingmth
                        FROM svc0008d hs
                            JOIN (
                                SELECT s1.sales_ord_id,
                                            s1.brnch_id,
                                            s1.cust_id,
                                            s1.sales_ord_no,
                                            s1.stus_code_id,
                                            s1.pv_year,
                                            s1.pv_month,
                                            s1.app_type_id,
                                            TO_NUMBER(s2.srv_type) srv_type,
                                            s2.sales_prod_sz,
                                            s2.unit_type           unit_type,
                                            s1.bndl_id
                                FROM sal0001d s1
                                JOIN sal0225d s2 ON s2.srv_ord_id = s1.sales_ord_id
                            ) so ON so.sales_ord_id = hs.sales_ord_id
                            INNER JOIN sal0045d ins ON ins.sales_ord_id = hs.sales_ord_id
                            INNER JOIN sal0023d ad ON ad.cust_add_id = ins.add_id
                            LEFT JOIN sys0064m mg ON mg.area_id = ad.area_id
                            LEFT JOIN svc0006d hr ON hr.schdul_id = hs.schdul_id
                            LEFT JOIN sys0038m st ON st.stus_code_id = hs.stus_code_id
                            INNER JOIN sys0013m ap ON ap.code_id = so.app_type_id
                            INNER JOIN sal0029d cu ON cu.cust_id = so.cust_id
                            LEFT JOIN org0001d cd ON cd.mem_id = hs.cody_id
                            LEFT JOIN sys0038m stus ON stus.stus_code_id = cd.stus
                            LEFT JOIN org0001d ac ON ac.mem_id = hs.cody_id
                            LEFT JOIN sys0005m br ON br.brnch_id = ac.brnch
                            LEFT JOIN org0005d og ON og.mem_id = cd.mem_id
                            LEFT JOIN org0001d mem3 ON og.mem_up_id = mem3.mem_id
                            LEFT JOIN sys0047m usr ON hs.crt_user_id = usr.user_id
                            LEFT JOIN org1001v t6 ON t6.mem_id = og.mem_id
                            LEFT JOIN (
                                SELECT fr.resn_id AS code_id,
                                           fr.code || '-' || fr.resn_desc AS code_name
                                FROM sys0032m fr
                                WHERE ( 167 = fr.resn_type_id )
                                AND ( 1 = fr.stus_code_id )
                            ) rem ON rem.code_id = hr.fail_resn_id
                            LEFT JOIN sys0013m srt ON so.srv_type = srt.code_id
                            LEFT JOIN sal0002d ms ON ms.sales_ord_id = so.sales_ord_id
                            LEFT JOIN sys0026m mi ON mi.stk_id = ms.itm_stk_id
                            LEFT JOIN hmc0011d hc ON hc.ord_seq_no = so.bndl_id
                            LEFT JOIN sal0001d fo ON fo.sales_ord_no = hc.fra_ord_no
                            LEFT JOIN sal0002d fs ON fs.sales_ord_id = fo.sales_ord_id
                            LEFT JOIN sys0026m fi ON fi.stk_id = fs.itm_stk_id
                            LEFT JOIN rep0010s ag ON ag.ord_id = hs.sales_ord_id
                            LEFT JOIN rep0011s type ON type.ord_no = so.sales_ord_no
                        WHERE cd.mem_id IS NULL
                         <![CDATA[
                        AND hs.TYPE_ID  <> (SELECT CODE_ID
                                                       FROM SYS0013M
                                                       WHERE CODE_MASTER_ID = 34
                                                       AND CODE = 'MSS')
                        ]]>

                        UNION

                        SELECT DISTINCT hs.no AS no,
                                    hs.stus_code_id AS stus_code_id,
                                    hs.month || '/' || hs.year AS hs_date,
                                    hs.month,
                                    hs.year,
                                    st.code,
                                    hr.no AS result,
                                    so.sales_ord_no sales_ord_no,
                                    so.app_type_id,
                                    mi.stk_desc AS mat_desc,
                                    fi.stk_desc AS fra_desc,
                                    ap.code AS apptype,
                                    so.sales_prod_sz,
                                    cu.name,
                                    cd.mem_code AS assign_cody,
                                    cd.mem_id,
                                    ac.mem_code AS action_cody,
                                    mg.state,
                                    mg.area,
                                    cu.cust_id AS cust_id,
                                    stus.code AS ht_status,
                                    hr.setl_dt,
                                    rem.code_name AS remarks,
                                    br.brnch_id  AS brnch_id,
                                    hs.schdul_id schdul_id,
                                    so.sales_ord_id AS sales_ord_id,
                                    br.code AS ht_brnch_code,
                                    mem3.mem_code ht_mgr_code,
                                    og.dept_code,
                                    CASE WHEN hs.crt_user_id = '2222'
                                            THEN ''
                                    ELSE usr.user_name END AS crt_user_id,
                                    so.pv_month,
                                    so.pv_year,
                                    t6.org_code AS orgcode,
                                    t6.grp_code AS grpcode,
                                    t6.dept_code AS deptcode,
                                    CASE WHEN srt.code IS NOT NULL
                                            THEN srt.code_name
                                    ELSE type.stk_ctgry END AS srv_type,
                                    so.unit_type,
                                    so.srv_type AS service_type,
                                    ag.curr_mth_aging agingmth
                        FROM svc0008d hs
                            JOIN (
                                SELECT srv_ord_id sales_ord_id,
                                    brnch_id,
                                    cust_id,
                                    srv_ord_no sales_ord_no,
                                    stus_code_id,
                                    pv_year,
                                    pv_month,
                                    app_type_id,
                                    TO_NUMBER(srv_type) srv_type,
                                    sales_prod_sz,
                                    unit_type,
                                    0 bndl_id
                                FROM sal0225d
                            ) so ON so.sales_ord_id = hs.sales_ord_id
                            INNER JOIN sal0045d ins ON ins.sales_ord_id = hs.sales_ord_id
                            INNER JOIN sal0023d ad ON ad.cust_add_id = ins.add_id
                            LEFT JOIN sys0064m mg ON mg.area_id = ad.area_id
                            LEFT JOIN svc0006d hr ON hr.schdul_id = hs.schdul_id
                            LEFT JOIN sys0038m st ON st.stus_code_id = hs.stus_code_id
                            INNER JOIN sys0013m ap ON ap.code_id = so.app_type_id
                            INNER JOIN sal0029d cu ON cu.cust_id = so.cust_id
                            LEFT JOIN org0001d cd ON cd.mem_id = hs.cody_id
                            LEFT JOIN sys0038m stus ON stus.stus_code_id = cd.stus
                            LEFT JOIN org0001d ac ON ac.mem_id = hs.cody_id
                            LEFT JOIN sys0005m br ON br.brnch_id = ac.brnch
                            LEFT JOIN org0005d og ON og.mem_id = cd.mem_id
                            LEFT JOIN org0001d mem3 ON og.mem_up_id = mem3.mem_id
                            LEFT JOIN sys0047m usr ON hs.crt_user_id = usr.user_id
                            LEFT JOIN org1001v t6 ON t6.mem_id = og.mem_id
                            LEFT JOIN (
                                SELECT fr.resn_id      AS code_id,
                                           fr.code || '-' || fr.resn_desc AS code_name
                                FROM sys0032m fr
                                WHERE ( 167 = fr.resn_type_id )
                                AND ( 1 = fr.stus_code_id )
                            ) rem ON rem.code_id = hr.fail_resn_id
                            LEFT JOIN sys0013m srt ON so.srv_type = srt.code_id
                            LEFT JOIN sal0002d ms ON ms.sales_ord_id = so.sales_ord_id
                            LEFT JOIN sys0026m mi ON mi.stk_id = ms.itm_stk_id
                            LEFT JOIN hmc0011d hc ON hc.ord_seq_no = so.bndl_id
                            LEFT JOIN sal0001d fo ON fo.sales_ord_no = hc.fra_ord_no
                            LEFT JOIN sal0002d fs ON fs.sales_ord_id = fo.sales_ord_id
                            LEFT JOIN sys0026m fi ON fi.stk_id = fs.itm_stk_id
                            LEFT JOIN rep0010s ag ON ag.ord_id = hs.sales_ord_id
                            LEFT JOIN rep0011s type ON type.ord_no = so.sales_ord_no
                        WHERE cd.mem_id IS NULL
                        <![CDATA[
                        AND hs.TYPE_ID  <> (SELECT CODE_ID
                                                       FROM SYS0013M
                                                       WHERE CODE_MASTER_ID = 34
                                                        AND CODE = 'MSS')
                        ]]>
                        )
                    ) project2
                WHERE
                        1 = 1
                 <if test="myBSMonth != null and myBSMonth != ''">
                  AND Project2.YEAR = TO_CHAR(to_date(#{myBSMonth} ,'MM/YYYY'),'YYYY')
                  AND Project2.MONTH = TO_CHAR(to_date(#{myBSMonth},'MM/YYYY'),'MM')
                </if>
                 <choose>
                  <when test="myBSMonth != ''">
                    <if test="txtHsOrderNo != null and txtHsOrderNo != ''">
                      AND Project2.NO = #{txtHsOrderNo}
                    </if>
                  </when>
                  <otherwise>
                    <if test="txtHsOrderNo != null and txtHsOrderNo != ''">
                      AND Project2.NO = #{txtHsOrderNo}
                    </if>
                  </otherwise>
                </choose>
                <choose>
                  <when test="myBSMonth != ''">
                    <if test="txtSalesOrder != null and txtSalesOrder != ''">
                      AND ( Project2.SALES_ORD_NO = #{txtSalesOrder})
                    </if>
                  </when>
                  <otherwise>
                    <choose>
                      <when test="txtHsOrderNo != ''">
                        <if test="txtSalesOrder != null and txtSalesOrder != ''">
                          AND ( Project2.SALES_ORD_NO = #{txtSalesOrder})
                        </if>
                      </when>
                      <otherwise>
                        <if test="txtSalesOrder != null and txtSalesOrder != ''">
                          AND ( Project2.SALES_ORD_NO = #{txtSalesOrder})
                        </if>
                      </otherwise>
                    </choose>
                  </otherwise>
                </choose>
                <if test="txtAssigncodyCode != null and txtAssigncodyCode != ''">
                  AND Project2.ASSIGN_CODY = #{txtAssigncodyCode}
                </if>
                <if test="myInstallMonth != null and myInstallMonth != ''">
                  AND Project2.PV_MONTH = TO_CHAR(to_date(#{myInstallMonth},'MM/YYYY'),'MM')
                </if>
                <if test="myInstallMonth != null and myInstallMonth != ''">
                  AND Project2.PV_YEAR = TO_CHAR(to_date(#{myInstallMonth} ,'MM/YYYY'),'YYYY')
                </if>
                <if test="cmbStatusType != null and cmbStatusType != ''">
                  AND Project2.STUS_CODE_ID = #{cmbStatusType}
                </if>
                <if test="txtCustomer != null and txtCustomer != ''">
                  AND Project2.CUST_ID  = #{txtCustomer}
                </if>
                <if test='arrAppType != null and arrAppType != ""'>
                  AND Project2.APP_TYPE_ID IN
                  <foreach item="item" collection="arrAppType" index="index" open="(" separator="," close=")">
                    #{item}
                  </foreach>
                </if>
                <if test="serviceTypeIdHsManagement != null and serviceTypeIdHsManagement != '' ">
                    AND Project2.SERVICE_TYPE = #{serviceTypeIdHsManagement}
                </if>
                <if test='arrListProductIdHsManagement != null and arrListProductIdHsManagement != ""'>
                    AND Project2.SALES_PROD_SZ IN
                  <foreach item="item" collection="arrListProductIdHsManagement" index="index" open="(" separator="," close=")">
                    #{item}
                  </foreach>
                </if>
                <if test='arrUnitTypeIdHsManagement != null and arrUnitTypeIdHsManagement != ""'>
                  AND Project2.UNIT_TYPE IN
                  <foreach item="item" collection="arrUnitTypeIdHsManagement" index="index" open="(" separator="," close=")">
                    #{item}
                  </foreach>
                </if>
                <if test="startDate != '' and startDate != '' ">
                    <![CDATA[ AND  Project2.SETL_DT >= TO_DATE(#{startDate}, 'DD/MM/YYYY') ]]>
                </if>
                <if test="endDate != '' and endDate != '' ">
                    <![CDATA[  AND Project2.SETL_DT <=  TO_DATE(#{endDate}, 'DD/MM/YYYY') ]]>
                </if>
            ) project3
        <![CDATA[
        ) WHERE DUM_SEQ = 1
        AND ROWNUM <= 50000
        ]]>
       </select>

       <select id="selectHsAssiinlList_1" parameterType="Map" resultType="egovMap">
                         SELECT Project2.C1 C1  ,
                                    Project2.SCHDUL_ID SCHDUL_ID  ,
                                    Project2.No No  ,
                                    Project2.HS_DATE HS_DATE  ,
                                    Project2.CODY_ID CODY_ID,
                                    Project2.STUS_CODE_ID STUS_CODE_ID  ,
                                    Project2.Code Code  ,
                                    Project2.SALES_ORD_ID SALES_ORD_ID  ,
                                    Project2.SALES_ORD_NO SALES_ORD_NO  ,
                                    Project2.Code1 Code1  ,
                                    Project2.C2 C2  ,
                                    Project2.C3 C3  ,
                                    Project2.C4 C4  ,
                                    Project2.CODY_ID CODY_ID  ,
                                    Project2.C5 C5  ,
                                    Project2.C6 C6  ,
                                    Project2.C7 C7  ,
                                    Project2.INST_STATE INST_STATE  ,
                                    Project2.INST_AREA INST_AREA  ,
                                    Project2.C8 C8  ,
                                    Project2.Name Name  ,
                                    Project2.NRIC NRIC  ,
                                    Project2.CODY_STATUS,
                                    Project2.BRNCH_ID,
                                    Project2.cust_id,
                                    Project2.actn_mem_id
                      FROM (
                                 SELECT Project2.SCHDUL_ID SCHDUL_ID  ,
                                          Project2.No No  ,
                                          Project2.HS_DATE HS_DATE   ,
                                          Project2.CODY_ID CODY_ID  ,
                                          Project2.STUS_CODE_ID STUS_CODE_ID  ,
                                          Project2.Code Code  ,
                                          Project2.SALES_ORD_ID SALES_ORD_ID  ,
                                          Project2.SALES_ORD_NO SALES_ORD_NO  ,
                                          Project2.Name Name  ,
                                          Project2.NRIC NRIC  ,
                                          Project2.Code1 Code1  ,
                                          Project2.INST_STATE INST_STATE  ,
                                          Project2.INST_AREA INST_AREA  ,
                                          Project2.C1 C1  ,
                                          Project2.C2 C2  ,
                                          Project2.C3 C3  ,
                                          Project2.C4 C4  ,
                                          Project2.C5 C5  ,
                                          Project2.C6 C6  ,
                                          Project2.C7 C7  ,
                                          Project2.C8 C8  ,
                                          Project2.CODY_STATUS as CODY_STATUS,
                                          Project2.BRNCH_ID as BRNCH_ID,
                                          Project2.cust_id as cust_id,
                                          Project2.actn_mem_id AS actn_mem_id,
                                          ROW_NUMBER() OVER ( ORDER BY Project2.SCHDUL_ID ASC  ) ROW_NUMBER
                             FROM ( SELECT Distinct1.SCHDUL_ID SCHDUL_ID  ,
                                                   Distinct1.No No  ,
                                                   Distinct1.HS_DATE HS_DATE  ,
                                                   Distinct1.CODY_ID CODY_ID  ,
                                                   Distinct1.STUS_CODE_ID STUS_CODE_ID  ,
                                                   Distinct1.Code Code  ,
                                                   Distinct1.SALES_ORD_ID SALES_ORD_ID  ,
                                                   Distinct1.SALES_ORD_NO SALES_ORD_NO  ,
                                                   Distinct1.Name Name  ,
                                                   Distinct1.NRIC NRIC  ,
                                                   Distinct1.Code1 Code1  ,
                                                   Distinct1.INST_STATE INST_STATE  ,
                                                   Distinct1.INST_AREA INST_AREA  ,
                                                   Distinct1.C1 C1  ,
                                                   Distinct1.C2 C2  ,
                                                   Distinct1.C3 C3  ,
                                                   Distinct1.C4 C4  ,
                                                   Distinct1.C5 C5  ,
                                                   Distinct1.C6 C6  ,
                                                   Distinct1.C7 C7  ,
                                                   Distinct1.C8 C8  ,
                                                   Distinct1.CODY_STATUS as CODY_STATUS,
                                                   Distinct1.BRNCH_ID as BRNCH_ID,
                                                   Distinct1.cust_id cust_id,
                                                   Distinct1.actn_mem_id
                                    FROM (
                                                    SELECT DISTINCT Extent1.SCHDUL_ID SCHDUL_ID,
                                                                 Extent1.NO NO,
                                                                 Extent1.MONTH  || '/' ||   Extent1.YEAR HS_DATE,
                                                                 Extent1.CODY_ID CODY_ID,
                                                                 Extent1.STUS_CODE_ID STUS_CODE_ID,
                                                                 Extent2.CODE CODE,
                                                                 Extent3.SALES_ORD_ID SALES_ORD_ID,
                                                                 Extent3.SALES_ORD_NO SALES_ORD_NO,
                                                                 Extent4.NAME NAME,
                                                                 Extent4.NRIC NRIC,
                                                                 Extent5.CODE CODE1,
                                                                 Extent6.INST_STATE INST_STATE,
                                                                 Extent6.INST_AREA INST_AREA,
                                                                 1 C1,
                                                                 CASE WHEN (Extent7.RESULT_ID IS NOT NULL)
                                                                         THEN Extent7.RESULT_ID
                                                                 ELSE 0 END C2,
                                                                 CASE WHEN (Extent7.RESULT_ID IS NOT NULL)
                                                                         THEN  Extent7.NO
                                                                  ELSE '' END C3,
                                                                 CASE WHEN (Extent8.MEM_ID IS NOT NULL)
                                                                         THEN Extent8.MEM_TYPE
                                                                  ELSE  0 END C4,
                                                                 CASE WHEN (Extent8.MEM_ID IS NOT NULL)
                                                                         THEN Extent8.MEM_CODE
                                                                    ELSE '' END C5,
                                                                 CASE WHEN (Extent8.MEM_ID IS NOT NULL)
                                                                         THEN  Extent8.STUS
                                                                  ELSE 0 END C6,
                                                                 CASE WHEN (Extent6.FIRST_INSTALL_DT  IS NOT NULL)
                                                                         THEN (Extent6.FIRST_INSTALL_DT)
                                                                 ELSE  ('1900-01-01 00:00:00')
                                                                 END C7,
                                                                 CASE WHEN (Extent9.MEM_ID IS NOT NULL)
                                                                          THEN Extent9.MEM_CODE
                                                                 ELSE '' END C8,
                                                                 Extent4.STUS_CODE_ID as CODY_STATUS,
                                                                 Extent3.BRNCH_ID as BRNCH_ID,
                                                                 Extent3.cust_id cust_id,
                                                                 Extent1.actn_mem_id as actn_mem_id
                                                    FROM SVC0008D Extent1
                                                            ,SYS0038M Extent2
                                                            ,SAL0001D Extent3
                                                            ,SAL0029D Extent4
                                                            ,SYS0013M Extent5
                                                            , (SELECT vOrderInstallationInfo.ORD_ID ORD_ID,
                                                                          vOrderInstallationInfo.INST_STATE INST_STATE,
                                                                          vOrderInstallationInfo.INST_AREA INST_AREA,
                                                                          vOrderInstallationInfo.INST_CNT_NAME INST_CNT_NAME,
                                                                          vOrderInstallationInfo.INST_CNT_NRIC INST_CNT_NRIC,
                                                                          vOrderInstallationInfo.INST_CNT_EMAIL INST_CNT_EMAIL,
                                                                          vOrderInstallationInfo.INST_CNT_TEL_M INST_CNT_TEL_M,
                                                                          vOrderInstallationInfo.INST_CNT_TEL_O INST_CNT_TEL_O,
                                                                          vOrderInstallationInfo.INST_CNT_TEL_R INST_CNT_TEL_R,
                                                                          vOrderInstallationInfo.INST_CNT_TEL_F INST_CNT_TEL_F,
                                                                          vOrderInstallationInfo.INST_CNT_GENDER INST_CNT_GENDER,
                                                                          vOrderInstallationInfo.FIRST_INSTALL_NO FIRST_INSTALL_NO,
                                                                          vOrderInstallationInfo.FIRST_INSTALL_CT_CODE FIRST_INSTALL_CT_CODE,
                                                                          vOrderInstallationInfo.FIRST_INSTALL_CT_NAME FIRST_INSTALL_CT_NAME,
                                                                          vOrderInstallationInfo.FIRST_INSTALL_DT FIRST_INSTALL_DT,
                                                                          vOrderInstallationInfo.FIRST_INSTALL_REM FIRST_INSTALL_REM,
                                                                          vOrderInstallationInfo.FIRST_INSTALL_SIRIM_NO FIRST_INSTALL_SIRIM_NO,
                                                                          vOrderInstallationInfo.FIRST_INSTALL_SERIAL_NO FIRST_INSTALL_SERIAL_NO,
                                                                          vOrderInstallationInfo.LAST_INSTALL_NO LAST_INSTALL_NO,
                                                                          vOrderInstallationInfo.LAST_INSTALL_CT_CODE LAST_INSTALL_CT_CODE,
                                                                          vOrderInstallationInfo.LAST_INSTALL_CT_NAME LAST_INSTALL_CT_NAME,
                                                                          vOrderInstallationInfo.LAST_INSTALL_DT LAST_INSTALL_DT,
                                                                          vOrderInstallationInfo.LAST_INSTALL_REM  LAST_INSTALL_REM,
                                                                          vOrderInstallationInfo.LAST_INSTALL_SIRIM_NO LAST_INSTALL_SIRIM_NO,
                                                                          vOrderInstallationInfo.LAST_INSTALL_SERIAL_NO LAST_INSTALL_SERIAL_NO,
                                                                          vOrderInstallationInfo.DSC_ID DSC_ID,
                                                                          vOrderInstallationInfo.DSC_CODE DSC_CODE,
                                                                          vOrderInstallationInfo.DSC_NAME DSC_NAME,
                                                                          vOrderInstallationInfo.INSTCT INSTCT,
                                                                          vOrderInstallationInfo.PREFER_INST_DT PREFER_INST_DT,
                                                                          vOrderInstallationInfo.PREFER_INST_TM PREFER_INST_TM,
                                                                          vOrderInstallationInfo.INSTALL_ADDR_ID INSTALL_ADDR_ID,
                                                                          vOrderInstallationInfo.INSTALL_CNTC_ID INSTALL_CNTC_ID,
                                                                          vOrderInstallationInfo.INST_CNT_DEPT  INST_CNT_DEPT,
                                                                          vOrderInstallationInfo.INST_CNT_POST  INST_CNT_POST,
                                                                          vOrderInstallationInfo.VRIFY_REM VRIFY_REM
                                                                     FROM SAL1010V vOrderInstallationInfo
                                                                     ) Extent6
                                                                    ,SVC0006D Extent7
                                                                    ,ORG0001D Extent8
                                                                    ,ORG0001D Extent9
                                               WHERE Extent2.STUS_CODE_ID =  Extent1.STUS_CODE_ID
                                                        AND Extent3.SALES_ORD_ID = Extent1.SALES_ORD_ID
                                                        AND Extent4.CUST_ID = Extent3.CUST_ID
                                                        AND Extent5.CODE_ID =  Extent3.APP_TYPE_ID
                                                        AND Extent6.ORD_ID =  Extent1.SALES_ORD_ID
                                                        AND Extent7.SCHDUL_ID(+) =  Extent1.SCHDUL_ID
                                                        AND Extent8.MEM_ID(+) = Extent1.CODY_ID
                                                        AND Extent9.MEM_ID(+) = Extent7.CODY_ID
                                                        AND 306 = Extent7.TYPE_ID(+)
                                                        AND 1 = Extent7.RESULT_IS_CURR(+)
                                                        AND 1 = Extent1.STUS_CODE_ID
                                                        AND ( Extent3.SALES_ORD_NO = #{salesOrder})
                                                        <![CDATA[
                                                        AND Extent1.TYPE_ID  <> (SELECT CODE_ID
                                                                                               FROM SYS0013M
                                                                                               WHERE CODE_MASTER_ID = 34
                                                                                               AND CODE = 'MSS')
                                                        ]]>
                                            ) Distinct1
                                    ) Project2
                      ) Project2
                     WHERE  Project2.row_number > 0
                     ORDER BY Project2.SCHDUL_ID ASC
          </select>

          <select id="selectHsFilterList" parameterType="Map" resultType="egovMap">
                        SELECT Distinct1.C1 C1  ,
                                   Distinct1.STK_ID STK_ID  ,
                                   Distinct1.STK_CODE STK_CODE  ,
                                   Distinct1.STK_DESC STK_DESC,
                                   Distinct1.SERIAL_CHK,
                                   Distinct1.SRV_FILTER_ID,
                                   Distinct1.srv_config_id,
                                   Distinct1.IS_RETURN
                              FROM ( SELECT DISTINCT Extent3.STK_ID STK_ID  ,
                                                     Extent3.STK_CODE STK_CODE  ,
                                                     Extent3.STK_DESC STK_DESC  ,
                                                     Extent3.SERIAL_CHK,
                                                     1 C1,
                                                     Filter1.SRV_FILTER_ID,
                                                     Filter1.srv_config_id,
                                                     Filter1.IS_RETURN
                                     FROM ( SELECT Extent1.SRV_SO_ID SRV_SO_ID  ,
                                                   Extent2.SRV_FILTER_STK_ID SRV_FILTER_STK_ID,
                                                   Extent2.SRV_FILTER_ID,
                                                   Extent1.srv_config_id,
                                                   Extent2.IS_RETURN
                                            FROM SAL0090D Extent1
                                                   JOIN SAL0087D Extent2   ON ( Extent1.SRV_CONFIG_ID = Extent2.SRV_CONFIG_ID )
                                                   AND ( 1 = Extent2.SRV_FILTER_STUS_ID )
                                             WHERE  ( 1 = Extent1.SRV_STUS_ID )
                                   <![CDATA[                       AND ( 443 <> Extent2.SRV_FILTER_ID ) ) Filter1 ]]>
                                            JOIN SYS0026M Extent3   ON Filter1.SRV_FILTER_STK_ID = Extent3.STK_ID
                                      WHERE  Filter1.SRV_SO_ID = #{salesOrderId} ) Distinct1

                    </select>




            <select id="selectHsViewfilterInfo" parameterType="Map" resultType="egovMap">
            <!-- <![CDATA[
                    SELECT
                        E.STK_ID STK_ID  ,
                        E.STK_CODE STK_CODE  ,
                        E.STK_DESC STK_DESC  ,
                        NVL(F.BS_RESULT_PART_QTY, 0) as name,
                        NVL(F.BS_RESULT_ITM_ID, 0) as BS_RESULT_ITM_ID
                    FROM
                    SVC0008D A
                    INNER JOIN (
                        SELECT A1.*
                        FROM SVC0006D A1
                        INNER JOIN (
                            SELECT MAX(NO) AS NO
                            FROM SVC0006D
                            WHERE SCHDUL_ID = #{selSchdulId}
                            GROUP BY SCHDUL_ID
                        ) B1 ON A1.NO = B1.NO
                    ) B ON A.SCHDUL_ID = B.SCHDUL_ID
                    INNER JOIN SAL0090D C ON A.SALES_ORD_ID = C.SRV_SO_ID
                    INNER JOIN SAL0087D D ON C.SRV_CONFIG_ID = D.SRV_CONFIG_ID AND D.SRV_FILTER_ID NOT IN (443) AND D.SRV_FILTER_STUS_ID = 1 AND C.SRV_STUS_ID = 1
                    INNER JOIN SYS0026M E ON D.SRV_FILTER_STK_ID = E.STK_ID
                    LEFT OUTER JOIN SVC0007D F ON B.RESULT_ID = F.BS_RESULT_ID AND D.SRV_FILTER_ID = F.BS_RESULT_PART_ID
                    WHERE A.SCHDUL_ID = #{selSchdulId}
                ]]> -->

                <![CDATA[

            SELECT  DISTINCT distinct1.SRV_FILTER_STK_ID AS STK_ID,
                           distinct1.STK_CODE,
                           distinct1.STK_DESC,
                           distinct1.SERIAL_CHK,
                           c.BS_RESULT_ITM_ID,
                           c.SERIAL_NO,
                           CASE WHEN distinct1.SRV_FILTER_STK_ID = c.BS_RESULT_PART_ID
                                   THEN C.BS_RESULT_PART_QTY
                                   ELSE 0
                                   END AS NAME,
                           distinct1.IS_RETURN
               FROM( SELECT  e.SRV_FILTER_STK_ID AS STK_ID,
                           f.STK_CODE,
                           f.STK_DESC,
                           f.SERIAL_CHK,
                           e.SRV_FILTER_STK_ID,
                           e.IS_RETURN
                     FROM SVC0008D A,
                              SAL0090D D,
                              SAL0087D E,
                              SYS0026M F
                      where A.SALES_ORD_ID = D.SRV_SO_ID
                      AND D.SRV_CONFIG_ID = E.SRV_CONFIG_ID
                      AND E.SRV_FILTER_STK_ID = F.STK_ID
                      AND E.SRV_FILTER_STUS_ID = '1'
                      AND A.SCHDUL_ID = #{selSchdulId} ) distinct1, (select Y.BS_RESULT_PART_ID, Y.SERIAL_NO, BS_RESULT_ITM_ID, BS_RESULT_PART_QTY
                                                                          from SVC0007D Y ,(SELECT SCHDUL_ID,
                                                                                           MAX(X.RESULT_ID) AS RESULT_ID
                                                                                           FROM SVC0006D X
                                                                                           GROUP BY X.SCHDUL_ID) Z
                                                                          where  z.RESULT_ID = y.BS_RESULT_ID
                                                                          and z.SCHDUL_ID =#{selSchdulId2}
                                                                   ) C
                where distinct1.STK_ID = C.BS_RESULT_PART_ID(+)
                ]]>
         </select>


         <insert id="insertHsResult" parameterType="Map" >
              insert into SVC0008D (
                       SCHDUL_ID
                        ,NO
                        ,SALES_ORD_ID
                        ,MONTH
                        ,YEAR
                        ,STUS_CODE_ID
                        ,LAST_SVC
                        ,LOK
                        ,TYPE_ID
                        ,CODY_ID
                        ,CRT_USER_ID
                        ,CRT_DT,
                      PREV_CODY_ID
                        )
                 values (
                      #{schdulId}
                    , #{no}
                    , #{salesOrdId}
                    , #{month}
                    , #{year}
                    , #{stus}
                    , #{lastSvc}
                    , #{lok}
                    , #{typeId}
                    , #{codyId}
                    , #{creator}
                    , SYSDATE
                    , 0
            )
            </insert>


     <insert id="updateAssignCody" parameterType="Map" >
                       UPDATE SVC0008D
                           SET CODY_ID =#{codyId},
                               UPD_USER_ID =#{updator} ,
                               UPD_DT =SYSDATE
                           WHERE SCHDUL_ID =#{schdulId}
     </insert>

          <insert id="updateAssignHT" parameterType="Map" >
                       UPDATE SVC0008D
                           SET CODY_ID =#{codyId},
                               UPD_USER_ID =#{updator} ,
                               UPD_DT =SYSDATE
                           WHERE SCHDUL_ID =#{schdulId}
     </insert>

     <update id="updateAssignCody90D" parameterType="Map" >
                       UPDATE SAL0090D
                        SET SRV_CODY_ID = #{codyId},
                           SRV_UPD_USER_ID = #{updator} ,
                           SRV_UPD_DT = SYSDATE
                        WHERE SRV_SO_ID = (SELECT SALES_ORD_ID FROM SVC0008D
                                                            WHERE SCHDUL_ID = #{schdulId})
     </update>


        <select id="getNextSchdulId"  resultType="int">
             select GBSLCVD.SVC0008D_SCHDUL_ID_SEQ.nextval
                from dual
        </select>

        <select id="getNextSvc006dSeq"  resultType="int">
             select GBSLCVD.SVC0006D_RESULT_ID_SEQ.NEXTVAL
                from dual
        </select>



        <select id="selectHsInitDetailPop"  parameterType="Map" resultType="egovMap">

                    SELECT Limit1.SCHDUL_ID SCHDUL_ID  ,
                           Limit1.NO NO  ,
                           Limit1.MONTH MONTH  ,
                           Limit1.YEAR YEAR  ,
                           Limit1.MONTH || '/' || Limit1.YEAR monthy,
                           Limit1.STUS_CODE_ID STUS_CODE_ID  ,
                           Limit1.CODE CODE  ,
                           Limit1.SALES_ORD_NO SALES_ORD_NO  ,
                           Limit1.CODE1 CODE1  ,
                           Limit1.SALES_ORD_ID SALES_ORD_ID  ,
                           Limit1.CODE_NAME CODE_NAME  ,
                           Limit1.SRV_REM SRV_REM  ,
                           Limit1.SRV_BS_WEEK SRV_BS_WEEK  ,
                           CASE
                                WHEN ( Limit1.RESULT_ID IS NOT NULL ) THEN Limit1.NO1
                           ELSE ''
                              END C1  ,
                           CASE
                                WHEN ( Limit1.RESULT_ID IS NOT NULL ) THEN Limit1.RESULT_ID
                           ELSE 0
                              END C2  ,
                           Limit1.NAME NAME  ,
                           Limit1.NRIC NRIC  ,
                        <!--    Limit1.STK_CODE STK_CODE  ,
                           Limit1.STK_DESC STK_DESC  ,
                           Limit1.STK_ID STK_ID  , -->
                           Limit1.CODY_ID CODY_ID,
                            Limit1.CANC_REQ_NO
                      FROM ( SELECT Extent1.SCHDUL_ID SCHDUL_ID  ,
                                    Extent1.NO NO  ,
                                    Extent1.MONTH MONTH  ,
                                    Extent1.YEAR YEAR  ,
                                    Extent1.CODY_ID CODY_ID  ,
                                    Extent1.STUS_CODE_ID STUS_CODE_ID  ,
                                    Extent2.CODE_NAME CODE_NAME  ,
                                    Extent3.CODE CODE  ,
                                    Extent4.SRV_ORD_ID SALES_ORD_ID  ,
                                    Extent4.SRV_ORD_NO SALES_ORD_NO  ,
                                 <!--    Extent6.STK_ID STK_ID  ,
                                    Extent6.STK_CODE STK_CODE  ,
                                    Extent6.STK_DESC STK_DESC  , -->
                                    Extent7.NAME NAME  ,
                                    Extent7.NRIC NRIC  ,
                                    Extent8.SRV_REM SRV_REM  ,
                                    Extent8.SRV_BS_WEEK SRV_BS_WEEK  ,
                                    Extent9.CODE CODE1  ,
                                    Extent11.RESULT_ID RESULT_ID  ,
                                    Extent11.NO NO1,
                                    Extent1.CANC_REQ_NO as CANC_REQ_NO
                             FROM SVC0008D Extent1
                                    JOIN SYS0013M Extent2   ON Extent1.TYPE_ID = Extent2.CODE_ID
                                    JOIN SYS0038M Extent3   ON Extent1.STUS_CODE_ID = Extent3.STUS_CODE_ID
                                    JOIN SAL0225D Extent4   ON Extent1.SALES_ORD_ID = Extent4.SRV_ORD_ID
                                    <!-- JOIN SAL0002D Extent5   ON Extent4.SALES_ORD_ID = Extent5.SALES_ORD_ID -->
                                    <!-- JOIN SYS0026M Extent6   ON Extent5.ITM_STK_ID = Extent6.STK_ID -->
                                    JOIN SAL0029D Extent7   ON Extent4.CUST_ID = Extent7.CUST_ID
                                    LEFT  JOIN SAL0090D Extent8   ON ( Extent4.SRV_ORD_ID = Extent8.SRV_SO_ID )
                                    AND ( 1 = Extent8.SRV_STUS_ID )
                                    JOIN SYS0013M Extent9   ON Extent4.APP_TYPE_ID = Extent9.CODE_ID
                                    JOIN SAL0045D Extent10   ON Extent4.SRV_ORD_ID = Extent10.SALES_ORD_ID
                                    LEFT JOIN SVC0006D Extent11   ON ( Extent1.SCHDUL_ID = Extent11.SCHDUL_ID )
                                    AND ( 1 = Extent11.RESULT_IS_CURR )
                <![CDATA[             WHERE  Extent1.SCHDUL_ID = #{schdulId} AND ROWNUM <= 1 ) Limit1 ]]>


        </select>




             <insert id="insertHsResultfinal" parameterType="Map" >
               INSERT INTO GBSLCVD.SVC0006D (
                       RESULT_ID, NO, TYPE_ID, SCHDUL_ID, SALES_ORD_ID , CODY_ID
                      ,SETL_DT,RESULT_STUS_CODE_ID,FAIL_RESN_ID  , REN_COLCT_ID,WH_ID
                      ,RESULT_REM,RESULT_CRT_DT,RESULT_CRT_USER_ID,RESULT_UPD_DT,RESULT_UPD_USER_ID
                      ,RESULT_IS_SYNC,RESULT_IS_EDIT,RESULT_STOCK_USE,RESULT_IS_CURR,RESULT_MTCH_ID
                      ,RESULT_IS_ADJ
                      ,TEMPERATE_SETNG,NEXT_APPNT_DT,NEXT_APPNT_TM
                      ,OWNER_CODE,RESULT_CUST_NAME,RESULT_MOBILE_NO
                      ,RESULT_RPT_EMAIL_NO,RESULT_ACEPT_NAME,SGN_DT
                       )
                VALUES ( #{resultId}, #{docNo} , #{typeId},#{schdulId} ,#{salesOrdId} ,#{codyId}
                              ,TO_DATE(#{setlDt},'DD-MM-YYYY'),#{resultStusCodeId},NVL(#{failResnId},0),NVL(#{renColctId},0),#{whId}
                            ,#{resultRem} ,SYSDATE,#{resultCrtUserId},SYSDATE ,#{resultUpdUserId}
                            ,#{resultIsSync},#{resultIsEdit},#{resultStockUse},#{resultIsCurr},#{resultMtchId}
                            ,#{resultIsAdj}
                            ,#{temperateSetng},to_date(#{nextAppntDt},'yyyymmdd'),#{nextAppointmentTime}
                            ,#{ownerCode},#{resultCustName},#{resultMobileNo}
                            ,#{resultRptEmailNo},#{resultAceptName},#{sgnDt}
                 )


             </insert>



            <update id="UpdateHsResultM" parameterType="Map">
               update GBSLCVD.SVC0006D
                           SET STUS_CODE_ID = #{resultStusCodeId}
                                ,ACTN_MEM_ID = #{actnMemId}
                                ,ACTN_MEM_ID = #{srvBsWeek}
                         WHERE   SCHDUL_ID = #{hidschdulId}




             </update>


            <update id="updateHsResultD" parameterType="Map">
               update GBSLCVD.SVC0007D
                           SET BS_RESULT_PART_ID = #{bsResultPartId}
                                ,BS_RESULT_PART_DESC = #{bsResultPartDesc}
                                ,BS_RESULT_PART_QTY = #{bsResultPartQty}
                                ,BS_RESULT_CRT_USER_ID = #{bsResultCrtUserId}
                                ,BS_RESULT_FILTER_CLM = #{bsResultFilterClm}
                         WHERE   BS_RESULT_ITM_ID = #{bsResultItmId}

             </update>



            <update id="updateHsResultM" parameterType="Map">
               update GBSLCVD.SVC0006D
                           SET FAIL_RESN_ID = #{failReason}
                                ,REN_COLCT_ID = #{renColctId}
                         WHERE   SCHDUL_ID = #{hidschdulId}
             </update>



            <insert id="insertHsResultCopy" parameterType="Map">
                     INSERT INTO SVC0006D
                             (RESULT_ID
                             ,NO
                            ,TYPE_ID
                            ,SCHDUL_ID
                            ,SALES_ORD_ID
                            ,CODY_ID
                            ,SETL_DT
                            ,RESULT_STUS_CODE_ID
                            ,FAIL_RESN_ID
                            ,REN_COLCT_ID
                            ,WH_ID
                            ,RESULT_REM
                            ,RESULT_CRT_DT
                            ,RESULT_CRT_USER_ID
                            ,RESULT_UPD_DT
                            ,RESULT_UPD_USER_ID
                            ,RESULT_IS_SYNC
                            ,RESULT_IS_EDIT
                            ,RESULT_STOCK_USE
                            ,RESULT_IS_CURR
                            ,RESULT_MTCH_ID
                            ,RESULT_IS_ADJ
                            ,RESULT_ENTRY_POINT
                            ,RESULT_MOBILE_ID)
                 SELECT #{resultId} AS RESULT_ID,
                          NO,
                          TYPE_ID,
                          SCHDUL_ID,
                          SALES_ORD_ID,
                          CODY_ID,
                          SETL_DT,
                          RESULT_STUS_CODE_ID,
                          FAIL_RESN_ID,
                          REN_COLCT_ID,
                          WH_ID,
                          RESULT_REM,
                          RESULT_CRT_DT,
                          RESULT_CRT_USER_ID,
                          RESULT_UPD_DT,
                          RESULT_UPD_USER_ID,
                          RESULT_IS_SYNC,
                          RESULT_IS_EDIT,
                          RESULT_STOCK_USE,
                          RESULT_IS_CURR,
                          RESULT_MTCH_ID,
                          RESULT_IS_ADJ,
                          RESULT_ENTRY_POINT,
                          RESULT_MOBILE_ID
                   FROM(SELECT  RESULT_ID,
                          NO,
                          TYPE_ID,
                          SCHDUL_ID,
                          SALES_ORD_ID,
                          CODY_ID,
                          SETL_DT,
                          RESULT_STUS_CODE_ID,
                          FAIL_RESN_ID,
                          REN_COLCT_ID,
                          WH_ID,
                          RESULT_REM,
                          RESULT_CRT_DT,
                          RESULT_CRT_USER_ID,
                          RESULT_UPD_DT,
                          RESULT_UPD_USER_ID,
                          RESULT_IS_SYNC,
                          RESULT_IS_EDIT,
                          RESULT_STOCK_USE,
                          RESULT_IS_CURR,
                          RESULT_MTCH_ID,
                          RESULT_IS_ADJ,
                          RESULT_ENTRY_POINT,
                          RESULT_MOBILE_ID
                     FROM SVC0006D a
                    WHERE a.SCHDUL_ID = #{hidschdulId}
                    ORDER BY RESULT_ID DESC)
                    WHERE ROWNUM = 1


            </insert>


        <select id="cmbCollectTypeComboList"  parameterType="Map" resultType="egovMap">
        select a.CODE ,a.c1
        from (
             SELECT Extent1.CODE CODE1 , Extent1.CODE || '-' || Extent1.RESN_DESC c1,resn_id as code
              FROM SYS0032M Extent1
             WHERE  ( 174 = Extent1.resn_type_id )
                      AND ( 1 = Extent1.STUS_CODE_ID )
              ORDER BY Extent1.CODE ASC
            ) a
        </select>

        <select id="cmbCollectTypeComboList2"  parameterType="Map" resultType="egovMap">
        select a.CODE CODE_ID, a.c1 CODE_NAME
        from (
             SELECT Extent1.CODE CODE1 , Extent1.CODE || '-' || Extent1.RESN_DESC c1,resn_id as code
              FROM SYS0032M Extent1
             WHERE  ( 174 = Extent1.resn_type_id )
                      AND ( 1 = Extent1.STUS_CODE_ID )
              ORDER BY Extent1.CODE ASC
            ) a
        </select>



             <select id="selectHSResultMCnt"  parameterType="Map" resultType="int">
                        SELECT count(*) cnt
                          FROM SVC0006D Extent1
                        WHERE  Extent1.SCHDUL_ID = #{hidschdulId}

              </select>

             <select id="getSVC008D_NO"  parameterType="Map" resultType="java.lang.String">
                        SELECT NO
                          FROM SVC0008D Extent1
                        WHERE  Extent1.SCHDUL_ID = #{hidschdulId}

              </select>


             <select id="selectHSScheduleMCnt"  parameterType="Map" resultType="int">
                        SELECT count(*) cnt
                          FROM SVC0008D Extent1
                        WHERE  Extent1.SCHDUL_ID = #{hidschdulId}
              </select>


             <select id="selectHSResultMList"  parameterType="Map" resultType="egovMap">
                        SELECT Extent1.RESULT_ID RESULT_ID  ,
                               Extent1.NO NO  ,
                               Extent1.TYPE_ID TYPE_ID  ,
                               Extent1.SCHDUL_ID SCHDUL_ID  ,
                               Extent1.SALES_ORD_ID SALES_ORD_ID  ,
                               Extent1.CODY_ID CODY_ID  ,
                               Extent1.SETL_DT SETL_DT  ,
                               Extent1.RESULT_STUS_CODE_ID RESULT_STUS_CODE_ID  ,
                               Extent1.FAIL_RESN_ID FAIL_RESN_ID  ,
                               Extent1.REN_COLCT_ID REN_COLCT_ID  ,
                               Extent1.WH_ID WH_ID  ,
                               Extent1.RESULT_REM RESULT_REM  ,
                               Extent1.RESULT_CRT_DT RESULT_CRT_DT  ,
                               Extent1.RESULT_CRT_USER_ID RESULT_CRT_USER_ID  ,
                               Extent1.RESULT_UPD_DT RESULT_UPD_DT  ,
                               Extent1.RESULT_UPD_USER_ID RESULT_UPD_USER_ID  ,
                               Extent1.RESULT_IS_SYNC RESULT_IS_SYNC  ,
                               Extent1.RESULT_IS_EDIT RESULT_IS_EDIT  ,
                               Extent1.RESULT_STOCK_USE RESULT_STOCK_USE  ,
                               Extent1.RESULT_IS_CURR RESULT_IS_CURR  ,
                               Extent1.RESULT_MTCH_ID RESULT_MTCH_ID  ,
                               Extent1.RESULT_IS_ADJ RESULT_IS_ADJ  ,
                               Extent1.RESULT_ENTRY_POINT RESULT_ENTRY_POINT  ,
                               Extent1.RESULT_MOBILE_ID RESULT_MOBILE_ID
                          FROM SVC0006D Extent1
                <![CDATA[        WHERE  Extent1.SCHDUL_ID = #{hidschdulId}  AND ROWNUM <= 1    ]]>

                    </select>



                 <select id="selectHSDocNoList"  parameterType="Map" resultType="egovMap">

                        SELECT Extent1.DOC_NO_ID DOC_NO_ID  ,
                               CASE
                                    WHEN ( Extent1.DOC_NO IS NOT NULL ) THEN Extent1.DOC_NO
                               ELSE ''
                                  END C1  ,
                               CASE
                                    WHEN ( Extent1.DOC_NO_PREFIX IS NOT NULL ) THEN Extent1.DOC_NO_PREFIX
                               ELSE ''
                                  END C2
                          FROM SYS0022C Extent1
                     <![CDATA[       WHERE  Extent1.DOC_NO_ID = 11 AND ROWNUM <= 1 ]]>


                    </select>


                  <update id="updateDocNo" parameterType="Map">

                            UPDATE SYS0022C
                               SET DOC_NO = #{docNo}
                             WHERE   DOC_NO_ID = '11'
                    </update>





                  <update id="updateHsScheduleM" parameterType="Map">
                        UPDATE SVC0008D
                           SET STUS_CODE_ID = #{resultStusCodeId}
                                ,ACTN_MEM_ID  = #{actnMemId}
                                ,CODY_ID = #{actnMemId}
                         WHERE   SCHDUL_ID = #{hidschdulId}

                    </update>


                  <update id="updateHsSrvConfigM" parameterType="Map">
                        UPDATE SVC0009D
                           SET SRV_REM = #{srvRem}
                                ,SRV_PREV_DT = #{srvPrevDt}
                                ,SRV_BS_WEEK = #{srvBsWeek}
                          WHERE   ID = #{salesOrdId}
<!--                          WHERE   SRV_CONFIG_ID = #{salesOrdId} -->

                    </update>



                    <select id="cmbServiceMemList" parameterType="Map" resultType="egovMap">
                                SELECT Extent1.MEM_ID CODE_ID  ,
                                           Extent1.MEM_CODE   || '-' ||  Extent1.NAME as CODE_NAME,
                                          Extent1.MEM_CODE MEM_CODE  ,
                                          Extent1.NAME NAME
                                     FROM ORG0001D Extent1
                                    WHERE   Extent1.MEM_TYPE IN ( 2,3 )
                                        AND  1 = Extent1.STUS
                                     ORDER BY Extent1.MEM_CODE ASC
                    </select>




                   <select id="failReasonList" parameterType="Map" resultType="egovMap">
                            SELECT Extent1.RESN_ID AS CODE_ID,
                                       Extent1.CODE  || '-' || Extent1.RESN_DESC AS CODE_NAME
                              FROM SYS0032M Extent1
                             WHERE  ( 167 = Extent1.RESN_TYPE_ID )
                                      AND ( 1 = Extent1.STUS_CODE_ID )
                              ORDER BY Extent1.CODE ASC
                    </select>



                    <select id="serMemList" parameterType="Map" resultType="egovMap">
                            SELECT   SRV_CODY_ID  CODE_ID
                                        ,MEM_CODE||'-'||NAME   CODE_NAME
                                FROM SAL0090D A , SAL0001D B , ORG0001D C
                                WHERE A.SRV_SO_ID = B.SALES_ORD_ID
                                AND  A.SRV_CODY_ID = C.MEM_ID
                                AND B.SALES_ORD_NO =#{SRV_SO_ID}
                                 ORDER BY MEM_CODE ASC
                    </select>


                    <select id="selectSrvConfiguration" parameterType="Map" resultType="egovMap">
                                SELECT Extent1.RESULT_ID RESULT_ID  ,
                                       Extent1.NO NO  ,
                                       Extent1.TYPE_ID TYPE_ID  ,
                                       Extent1.SCHDUL_ID SCHDUL_ID  ,
                                       Extent1.SALES_ORD_ID SALES_ORD_ID  ,
                                       Extent1.CODY_ID CODY_ID  ,
                                       Extent1.SETL_DT SETL_DT  ,
                                       Extent1.RESULT_STUS_CODE_ID RESULT_STUS_CODE_ID  ,
                                       Extent1.FAIL_RESN_ID FAIL_RESN_ID  ,
                                       Extent1.REN_COLCT_ID REN_COLCT_ID  ,
                                       Extent1.WH_ID WH_ID  ,
                                       Extent1.RESULT_REM RESULT_REM  ,
                                       Extent1.RESULT_CRT_DT RESULT_CRT_DT  ,
                                       Extent1.RESULT_CRT_USER_ID RESULT_CRT_USER_ID  ,
                                       Extent1.RESULT_UPD_DT RESULT_UPD_DT  ,
                                       Extent1.RESULT_UPD_USER_ID RESULT_UPD_USER_ID  ,
                                       Extent1.RESULT_IS_SYNC RESULT_IS_SYNC  ,
                                       Extent1.RESULT_IS_EDIT RESULT_IS_EDIT  ,
                                       Extent1.RESULT_STOCK_USE RESULT_STOCK_USE  ,
                                       Extent1.RESULT_IS_CURR RESULT_IS_CURR  ,
                                       Extent1.RESULT_MTCH_ID RESULT_MTCH_ID  ,
                                       Extent1.RESULT_IS_ADJ RESULT_IS_ADJ  ,
                                       Extent1.RESULT_ENTRY_POINT RESULT_ENTRY_POINT  ,
                                       Extent1.RESULT_MOBILE_ID RESULT_MOBILE_ID
                                  FROM SVC0006D Extent1
                            <![CDATA[    WHERE  Extent1.SCHDUL_ID = #{hidschdulId} AND ROWNUM <= 1 ]]>
                            </select>


                    <select id="selectDetailList" parameterType="Map" resultType="egovMap">
                                SELECT Extent1.RESULT_ID RESULT_ID  ,
                                       Extent1.NO NO  ,
                                       Extent1.TYPE_ID TYPE_ID  ,
                                       Extent1.SCHDUL_ID SCHDUL_ID  ,
                                       Extent1.SALES_ORD_ID SALES_ORD_ID  ,
                                       Extent1.CODY_ID CODY_ID  ,
                                       Extent1.SETL_DT SETL_DT  ,
                                       Extent1.RESULT_STUS_CODE_ID RESULT_STUS_CODE_ID  ,
                                       Extent1.FAIL_RESN_ID FAIL_RESN_ID  ,
                                       Extent1.REN_COLCT_ID REN_COLCT_ID  ,
                                       Extent1.WH_ID WH_ID  ,
                                       Extent1.RESULT_REM RESULT_REM  ,
                                       Extent1.RESULT_CRT_DT RESULT_CRT_DT  ,
                                       Extent1.RESULT_CRT_USER_ID RESULT_CRT_USER_ID  ,
                                       Extent1.RESULT_UPD_DT RESULT_UPD_DT  ,
                                       Extent1.RESULT_UPD_USER_ID RESULT_UPD_USER_ID  ,
                                       Extent1.RESULT_IS_SYNC RESULT_IS_SYNC  ,
                                       Extent1.RESULT_IS_EDIT RESULT_IS_EDIT  ,
                                       Extent1.RESULT_STOCK_USE RESULT_STOCK_USE  ,
                                       Extent1.RESULT_IS_CURR RESULT_IS_CURR  ,
                                       Extent1.RESULT_MTCH_ID RESULT_MTCH_ID  ,
                                       Extent1.RESULT_IS_ADJ RESULT_IS_ADJ  ,
                                       Extent1.RESULT_ENTRY_POINT RESULT_ENTRY_POINT  ,
                                       Extent1.RESULT_MOBILE_ID RESULT_MOBILE_ID
                                  FROM SVC0006D Extent1
                            <![CDATA[    WHERE  Extent1.SCHDUL_ID = #{salesOrderId} AND ROWNUM <= 1 ]]>
                            </select>




         <insert id="insertHsResultD" parameterType="Map">
              insert into SVC0007D (
                         BS_RESULT_ITM_ID
                        ,BS_RESULT_ID
                        ,BS_RESULT_PART_ID
                        ,BS_RESULT_PART_DESC
                        ,BS_RESULT_PART_QTY
                        ,BS_RESULT_REM
                        ,BS_RESULT_CRT_DT
                        ,BS_RESULT_CRT_USER_ID
                        ,BS_RESULT_FILTER_CLM
                        ,SERIAL_NO
                        )
                 values (
                     SVC0007D_BS_RESULT_ITM_ID_SEQ.nextval
                    , #{bsResultId}
                    , #{bsResultPartId}
                    , #{bsResultPartDesc}
                    , nvl(#{bsResultPartQty},1)
                    , #{bsResultRem}
                    , sysdate
                    , #{bsResultCrtUserId}
                    , #{bsResultFilterClm}
                    , nvl(#{serialNo}, '')
            )
            </insert>






         <select id="selectHsViewBasicInfo" parameterType="Map" resultType="egovMap">

   SELECT Limit1.SCHDUL_ID SCHDUL_ID  ,
                           Limit1.NO NO  ,
                           Limit1.MONTH MONTH  ,
                           Limit1.YEAR YEAR  ,
                           Limit1.MONTH || '/' || Limit1.YEAR monthy,
                           Limit1.STUS_CODE_ID STUS_CODE_ID  ,
                           Limit1.CODE CODE  ,
                           Limit1.SALES_ORD_NO SALES_ORD_NO  ,
                           Limit1.CODE1 CODE1  ,
                           Limit1.SALES_ORD_ID SALES_ORD_ID  ,
                           Limit1.CODE_NAME CODE_NAME  ,
                           Limit1.SRV_REM SRV_REM  ,
                           Limit1.SRV_BS_WEEK SRV_BS_WEEK  ,
                           CASE
                                WHEN ( Limit1.RESULT_ID IS NOT NULL ) THEN Limit1.NO1
                           ELSE ''
                              END C1  ,
                           CASE
                                WHEN ( Limit1.RESULT_ID IS NOT NULL ) THEN Limit1.RESULT_ID
                           ELSE 0
                              END C2  ,
                           Limit1.NAME NAME  ,
                           Limit1.NRIC NRIC  ,
                           Limit1.CODY_ID CODY_ID,
                           Limit1.fail_resn_id fail_resn_id  ,
                           Limit1.fail_resn_id fail_resn_id  ,
                           Limit1.ren_colct_id ren_colct_id  ,
                           Limit1.result_rem result_rem  ,
                           to_char (Limit1.setl_dt,'DD/MM/YYYY') AS setl_dt,
                           Limit1.prev_svc_area prev_svc_area,
                           Limit1.next_svc_area next_svc_area,
                           Limit1.distance distance,
                           Limit1.CANC_REQ_NO,
                           Limit1.INSTCT,
                           Limit1.NEXT_APPNT_DT,
						   Limit1.NEXT_APPNT_TM
                      FROM ( SELECT Extent1.SCHDUL_ID SCHDUL_ID  ,
                                    Extent1.NO NO  ,
                                    Extent1.MONTH MONTH  ,
                                    Extent1.YEAR YEAR  ,
                                    Extent1.CODY_ID CODY_ID  ,
                                    Extent1.STUS_CODE_ID STUS_CODE_ID  ,
                                    Extent2.CODE_NAME CODE_NAME  ,
                                    Extent3.CODE CODE  ,
                                    Extent4.SRV_ORD_ID SALES_ORD_ID  ,
                                    Extent4.SRV_ORD_NO SALES_ORD_NO  ,
                                    Extent7.NAME NAME  ,
                                    Extent7.NRIC NRIC  ,
                                    Extent8.SRV_REM SRV_REM  ,
                                    Extent8.SRV_BS_WEEK SRV_BS_WEEK  ,
                                    Extent9.CODE CODE1  ,
                                    Extent11.RESULT_ID RESULT_ID  ,
                                    Extent11.NO NO1  ,
                                    extent11.fail_resn_id fail_resn_id  ,
                                    extent11.ren_colct_id ren_colct_id  ,
                                    extent11.result_rem result_rem  ,
                                    extent11.setl_dt setl_dt,
                                    Extent1.prev_svc_area prev_svc_area,
                                    Extent1.next_svc_area next_svc_area,
                                    Extent1.distance distance,
                                    Extent1.CANC_REQ_NO,
                                    Extent8.SRV_REM AS INSTCT,
                                    TO_CHAR(Extent11.NEXT_APPNT_DT,'DD/MM/YYYY') AS NEXT_APPNT_DT ,
                                    CASE WHEN SUBSTR(Extent11.NEXT_APPNT_TM, -2) >= '60' THEN
            							TO_CHAR(TO_DATE(SUBSTR(Extent11.NEXT_APPNT_TM, 1, 2) || '00', 'HH24MI'), 'HH:MI AM')
        							WHEN Extent11.NEXT_APPNT_TM >= '2400' THEN
            							TO_CHAR(TO_DATE('0000', 'HH24MI'), 'HH:MI AM')
        							ELSE
            							TO_CHAR(TO_DATE(Extent11.NEXT_APPNT_TM, 'HH24MI'), 'HH:MI AM')
        							END AS NEXT_APPNT_TM
                             FROM SVC0008D Extent1
                                    JOIN SYS0013M Extent2   ON Extent1.TYPE_ID = Extent2.CODE_ID
                                    JOIN SYS0038M Extent3   ON Extent1.STUS_CODE_ID = Extent3.STUS_CODE_ID
                                    JOIN SAL0225D Extent4   ON Extent1.SALES_ORD_ID = Extent4.SRV_ORD_ID
                                    JOIN SAL0029D Extent7   ON Extent4.CUST_ID = Extent7.CUST_ID
                                    JOIN SAL0090D Extent8   ON ( Extent4.SRV_ORD_ID = Extent8.SRV_SO_ID )
                                    AND ( 1 = Extent8.SRV_STUS_ID )
                                    JOIN SYS0013M Extent9   ON Extent4.APP_TYPE_ID = Extent9.CODE_ID
                                    JOIN SAL0045D Extent10   ON Extent4.SRV_ORD_ID = Extent10.SALES_ORD_ID
                                    LEFT JOIN SVC0006D Extent11   ON ( Extent1.SCHDUL_ID = Extent11.SCHDUL_ID )
                                    AND ( 1 = Extent11.RESULT_IS_CURR )
                                     JOIN SAL0023D B ON B.CUST_ADD_ID  = Extent10.ADD_ID
                                    LEFT JOIN SYS0064M C ON C.AREA_ID = B.AREA_ID
                                   WHERE  Extent1.SCHDUL_ID = #{schdulId}
                                   <![CDATA[            AND ROWNUM <= 1 ) Limit1 ]]>

                            </select>





                 <select id="selectSettleInfo" parameterType="Map" resultType="egovMap">
          <![CDATA[
                        SELECT *
                              FROM ( SELECT Project1.ORD_ID ORD_ID  ,
                                            Project1.ORD_NO ORD_NO  ,
                                            Project1.APP_TYPE_CODE APP_TYPE_CODE  ,
                                            Project1.STOCK_CODE STOCK_CODE  ,
                                            Project1.STOCK_DESC STOCK_DESC  ,
                                            Project1.CONFIG_BS_GEN CONFIG_BS_GEN  ,
                                            Project1.SRV_MEM_FREQ SRV_MEM_FREQ  ,
                                            Project1.C1 C1  ,
                                            Project1.C2 C2  ,
                                            Project1.C3 C3  ,
                                            Project1.C4 C4  ,
                                            Project1.CONFIG_BS_REM CONFIG_BS_REM  ,
                                            Project1.CONFIG_SETT_AS CONFIG_SETT_AS  ,
                                            Project1.CONFIG_SETT_BS CONFIG_SETT_BS  ,
                                            Project1.CONFIG_SETT_INS CONFIG_SETT_INS  ,
                                            Project1.CONFIG_BS_WEEK CONFIG_BS_WEEK  ,
                                            Project1.CUST_NAME CUST_NAME  ,
                                            Project1.CUST_NRIC CUST_NRIC
                              FROM ( SELECT Extent1.ORD_ID ORD_ID  ,
                                            Extent1.ORD_NO ORD_NO  ,
                                            Extent1.APP_TYPE_CODE APP_TYPE_CODE  ,
                                            Extent1.STOCK_CODE STOCK_CODE  ,
                                            Extent1.STOCK_DESC STOCK_DESC  ,
                                            Extent1.CUST_NAME CUST_NAME  ,
                                            Extent1.CUST_NRIC CUST_NRIC  ,
                                            CASE
                                                 WHEN ( Extent3.MEM_ID IS NOT NULL ) THEN Extent3.MEM_ID
                                            ELSE 0
                                               END C1  ,
                                            CASE
                                                 WHEN ( Extent3.MEM_ID IS NOT NULL ) THEN Extent3.MEM_CODE
                                            ELSE ''
                                               END C2  ,
                                            CASE
                                                 WHEN ( Extent3.MEM_ID IS NOT NULL ) THEN Extent3.NAME
                                            ELSE ''
                                               END C3  ,
                                            Extent4.SETL_DT C4  ,
                                            Extent2.CONFIG_SETT_INS CONFIG_SETT_INS  ,
                                            Extent2.CONFIG_SETT_BS CONFIG_SETT_BS  ,
                                            Extent2.CONFIG_SETT_AS CONFIG_SETT_AS  ,
                                            Extent2.CONFIG_BS_GEN CONFIG_BS_GEN  ,
                                            Extent2.CONFIG_BS_WEEK CONFIG_BS_WEEK  ,
                                            Extent2.CONFIG_BS_REM CONFIG_BS_REM  ,
                                            Extent2.SRV_MEM_FREQ SRV_MEM_FREQ
                                     FROM ( SELECT vOrderBasicInfo.ORD_ID ORD_ID  ,
                                                   vOrderBasicInfo.ORD_NO ORD_NO  ,
                                                   vOrderBasicInfo.RENTAL_STUS RENTAL_STUS  ,
                                                   vOrderBasicInfo.ORD_STUS_ID ORD_STUS_ID  ,
                                                   vOrderBasicInfo.ORD_STUS_CODE ORD_STUS_CODE  ,
                                                   vOrderBasicInfo.ORD_STUS_NAME ORD_STUS_NAME  ,
                                                   vOrderBasicInfo.ORD_DT ORD_DT  ,
                                                   vOrderBasicInfo.INSTLMT_PRIOD INSTLMT_PRIOD  ,
                                                   vOrderBasicInfo.ORD_AMT ORD_AMT  ,
                                                   vOrderBasicInfo.ORD_MTH_RENTAL ORD_MTH_RENTAL  ,
                                                   vOrderBasicInfo.ORD_PV ORD_PV  ,
                                                   vOrderBasicInfo.ORD_PV_MONTH ORD_PV_MONTH  ,
                                                   vOrderBasicInfo.ORD_PV_YEAR ORD_PV_YEAR  ,
                                                   vOrderBasicInfo.ORD_REF_NO ORD_REF_NO  ,
                                                   vOrderBasicInfo.ORD_PO_NO ORD_PO_NO  ,
                                                   vOrderBasicInfo.ORD_DEPT_CODE ORD_DEPT_CODE  ,
                                                   vOrderBasicInfo.ORD_GRP_CODE ORD_GRP_CODE  ,
                                                   vOrderBasicInfo.ORD_ORG_CODE ORD_ORG_CODE  ,
                                                   vOrderBasicInfo.ORD_CRT_USER_ID ORD_CRT_USER_ID  ,
                                                   vOrderBasicInfo.ORD_CRT_DT ORD_CRT_DT  ,
                                                   vOrderBasicInfo.APP_TYPE_ID APP_TYPE_ID  ,
                                                   vOrderBasicInfo.APP_TYPE_CODE APP_TYPE_CODE  ,
                                                   vOrderBasicInfo.APP_TYPE_DESC APP_TYPE_DESC  ,
                                                   vOrderBasicInfo.STOCK_ID STOCK_ID  ,
                                                   vOrderBasicInfo.STOCK_CODE STOCK_CODE  ,
                                                   vOrderBasicInfo.STOCK_DESC STOCK_DESC  ,
                                                   vOrderBasicInfo.CUST_ID CUST_ID  ,
                                                   vOrderBasicInfo.CUST_TYPE CUST_TYPE  ,
                                                   vOrderBasicInfo.CUST_NAME CUST_NAME  ,
                                                   vOrderBasicInfo.CUST_NRIC CUST_NRIC  ,
                                                   vOrderBasicInfo.CUST_DOB CUST_DOB  ,
                                                   vOrderBasicInfo.CUST_NATION CUST_NATION  ,
                                                   vOrderBasicInfo.CUST_GENDER CUST_GENDER  ,
                                                   vOrderBasicInfo.CUST_RACE CUST_RACE  ,
                                                   vOrderBasicInfo.CUST_EMAIL CUST_EMAIL  ,
                                                   vOrderBasicInfo.CUST_VA_NO CUST_VA_NO  ,
                                                   vOrderBasicInfo.CUST_PASSPORT_EXPR CUST_PASSPORT_EXPR  ,
                                                   vOrderBasicInfo.CUST_VISA_EXPR CUST_VISA_EXPR  ,
                                                   vOrderBasicInfo.ORD_PROMO_ID ORD_PROMO_ID  ,
                                                   vOrderBasicInfo.ORD_PROMO_CODE ORD_PROMO_CODE  ,
                                                   vOrderBasicInfo.ORD_PROMO_DESC ORD_PROMO_DESC  ,
                                                   vOrderBasicInfo.ORD_MEM_ID ORD_MEM_ID  ,
                                                   vOrderBasicInfo.ORD_MEM_CODE ORD_MEM_CODE  ,
                                                   vOrderBasicInfo.ORD_MEM_NAME ORD_MEM_NAME  ,
                                                   vOrderBasicInfo.ORD_MEM_NRIC ORD_MEM_NRIC  ,
                                                   vOrderBasicInfo.ORD_MEM_TYPE_ID ORD_MEM_TYPE_ID  ,
                                                   vOrderBasicInfo.ORD_MEM_TYPE_CODE ORD_MEM_TYPE_CODE  ,
                                                   vOrderBasicInfo.ORD_MEM_TYPE_NAME ORD_MEM_TYPE_NAME  ,
                                                   vOrderBasicInfo.COOL_OFF_PRIOD COOL_OFF_PRIOD  ,
                                                   vOrderBasicInfo.KEYIN_BRNCH_ID KEYIN_BRNCH_ID  ,
                                                   vOrderBasicInfo.KEYIN_BRNCH_CODE KEYIN_BRNCH_CODE  ,
                                                   vOrderBasicInfo.KEYIN_BRNCH_NAME KEYIN_BRNCH_NAME  ,
                                                   vOrderBasicInfo.ORD_REM ORD_REM  ,
                                                   vOrderBasicInfo.RENT_CHK_ID RENT_CHK_ID  ,
                                                   vOrderBasicInfo.ORD_HM_ID ORD_HM_ID  ,
                                                   vOrderBasicInfo.ORD_SM_ID ORD_SM_ID  ,
                                                   vOrderBasicInfo.ORD_GM_ID ORD_GM_ID  ,
                                                   vOrderBasicInfo.ORD_ADDR_ID ORD_ADDR_ID  ,
                                                   vOrderBasicInfo.ORD_CNTC_ID ORD_CNTC_ID  ,
                                                   vOrderBasicInfo.ORD_PROMO_RELATED_NO ORD_PROMO_RELATED_NO  ,
                                                   vOrderBasicInfo.UPD_DT UPD_DT  ,
                                                   vOrderBasicInfo.UPD_USER_ID UPD_USER_ID  ,
                                                   vOrderBasicInfo.JOM_PAY_REF JOM_PAY_REF  ,
                                                   vOrderBasicInfo.STK_CTGRY_ID STK_CTGRY_ID  ,
                                                   vOrderBasicInfo.STK_CTGRY_NAME STK_CTGRY_NAME  ,
                                                   vOrderBasicInfo.CUST_TYPE_ID CUST_TYPE_ID  ,
                                                   vOrderBasicInfo.CUST_BILL_ID CUST_BILL_ID  ,
                                                   vOrderBasicInfo.OBLIGT_YEAR OBLIGT_YEAR
                                            FROM SAL1006V vOrderBasicInfo ) Extent1
                                            LEFT JOIN ( SELECT vOrderSrvMemConfigInfo.ORD_ID ORD_ID  ,
                                                               vOrderSrvMemConfigInfo.CONFIG_ID CONFIG_ID  ,
                                                               vOrderSrvMemConfigInfo.CONFIG_SETT_INS CONFIG_SETT_INS  ,
                                                               vOrderSrvMemConfigInfo.CONFIG_SETT_BS CONFIG_SETT_BS  ,
                                                               vOrderSrvMemConfigInfo.CONFIG_SETT_AS CONFIG_SETT_AS  ,
                                                               vOrderSrvMemConfigInfo.CONFIG_BS_GEN CONFIG_BS_GEN  ,
                                                               vOrderSrvMemConfigInfo.CONFIG_BS_MEM_ID CONFIG_BS_MEM_ID  ,
                                                               vOrderSrvMemConfigInfo.CONFIG_BS_WEEK CONFIG_BS_WEEK  ,
                                                               vOrderSrvMemConfigInfo.CONFIG_BS_REM CONFIG_BS_REM  ,
                                                               vOrderSrvMemConfigInfo.SRV_MEM_ID SRV_MEM_ID  ,
                                                               vOrderSrvMemConfigInfo.SRV_MEM_NO SRV_MEM_NO  ,
                                                               vOrderSrvMemConfigInfo.SRV_MEM_BILL_NO SRV_MEM_BILL_NO  ,
                                                               vOrderSrvMemConfigInfo.SRV_MEM_PAC_ID SRV_MEM_PAC_ID  ,
                                                               vOrderSrvMemConfigInfo.SRV_MEM_PAC_CODE SRV_MEM_PAC_CODE  ,
                                                               vOrderSrvMemConfigInfo.SRV_MEM_PAC_NAME SRV_MEM_PAC_NAME  ,
                                                               vOrderSrvMemConfigInfo.SRV_MEM_START_DT SRV_MEM_START_DT  ,
                                                               vOrderSrvMemConfigInfo.SRV_MEM_EXPR_DT SRV_MEM_EXPR_DT  ,
                                                               vOrderSrvMemConfigInfo.SRV_MEM_FREQ SRV_MEM_FREQ  ,
                                                               vOrderSrvMemConfigInfo.SRV_MEM_DUR SRV_MEM_DUR  ,
                                                               vOrderSrvMemConfigInfo.SRV_MEM_SALESMAN_CODE SRV_MEM_SALESMAN_CODE  ,
                                                               vOrderSrvMemConfigInfo.SRV_MEM_SALESMAN_NAME SRV_MEM_SALESMAN_NAME  ,
                                                               vOrderSrvMemConfigInfo.LAST_SRV_MEM_ID LAST_SRV_MEM_ID  ,
                                                               vOrderSrvMemConfigInfo.LAST_SRV_MEM_START_DATE LAST_SRV_MEM_START_DATE  ,
                                                               vOrderSrvMemConfigInfo.LAST_SRV_MEM_EXPR_DATE LAST_SRV_MEM_EXPR_DATE
                                                        FROM SAL1014V vOrderSrvMemConfigInfo ) Extent2   ON Extent1.ORD_ID = Extent2.ORD_ID
                                            LEFT JOIN ORG0001D Extent3   ON Extent2.CONFIG_BS_MEM_ID = Extent3.MEM_ID
                                            LEFT JOIN SVC0006D Extent4   ON ( Extent1.ORD_ID = Extent4.SALES_ORD_ID )
                                            AND ( 4 = Extent4.RESULT_STUS_CODE_ID )
                                      WHERE  Extent1.ORD_ID = #{salesOrdId} ) Project1
                              ORDER BY Project1.C4 DESC )
                              WHERE ROWNUM <= 1
                        ]]>
                            </select>




              <select id="selectHistoryHSResult" parameterType="Map" resultType="egovMap">
                   <![CDATA[


                       SELECT Distinct1.C1 C1  ,
                           Distinct1.RESULT_ID RESULT_ID  ,
                           Distinct1.NO NO  ,
                           Distinct1.RESULT_IS_CURR RESULT_IS_CURR  ,
                           Distinct1.CODE CODE  ,
                           Distinct1.MEM_CODE MEM_CODE  ,
                           Distinct1.SETL_DT SETL_DT  ,
                           Distinct1.RESULT_STOCK_USE RESULT_STOCK_USE  ,
                           Distinct1.RESULT_CRT_DT RESULT_CRT_DT  ,
                           Distinct1.USER_NAME USER_NAME
                      FROM ( SELECT DISTINCT Filter1.RESULT_ID RESULT_ID  ,
                                             Filter1.NO NO  ,
                                             Filter1.SETL_DT SETL_DT  ,
                                             Filter1.RESULT_CRT_DT RESULT_CRT_DT  ,
                                             decode(Filter1.RESULT_STOCK_USE,'1','O','X') RESULT_STOCK_USE  ,
                                             decode(Filter1.RESULT_IS_CURR,'1','Current',Filter1.RESULT_IS_CURR)  RESULT_IS_CURR  ,
                                             Filter1.CODE CODE  ,
                                             1 C1  ,
                                             Filter1.MEM_CODE MEM_CODE  ,
                                             Extent4.USER_NAME USER_NAME
                             FROM ( SELECT Extent1.RESULT_ID RESULT_ID  ,
                                           Extent1.NO NO  ,
                                           Extent1.SCHDUL_ID SCHDUL_ID  ,
                                           Extent1.SETL_DT SETL_DT  ,
                                           Extent1.RESULT_CRT_DT RESULT_CRT_DT  ,
                                           Extent1.RESULT_CRT_USER_ID RESULT_CRT_USER_ID  ,
                                           Extent1.RESULT_STOCK_USE RESULT_STOCK_USE  ,
                                           Extent1.RESULT_IS_CURR RESULT_IS_CURR  ,
                                           Extent2.CODE CODE  ,
                                           Extent3.MEM_CODE MEM_CODE
                                    FROM SVC0006D Extent1
                                           JOIN SYS0038M Extent2   ON Extent1.RESULT_STUS_CODE_ID = Extent2.STUS_CODE_ID
                                           LEFT JOIN ORG0001D Extent3   ON Extent1.CODY_ID = Extent3.MEM_ID
                                     WHERE  8 <> Extent1.RESULT_STUS_CODE_ID
                                      and Extent1.RESULT_IS_CURR = '1' ) Filter1
                                    LEFT JOIN SYS0047M Extent4   ON Filter1.RESULT_CRT_USER_ID = Extent4.USER_ID
                              WHERE  Filter1.SCHDUL_ID = #{selSchdulId} ) Distinct1



                                                      ]]>

<!--                         SELECT Limit1.RESULT_ID RESULT_ID  ,
                                   Limit1.SALES_ORD_ID SALES_ORD_ID  ,
                                   Limit1.SALES_ORD_NO SALES_ORD_NO  ,
                                   Limit1.NO1 NO  ,
                                   Limit1.MONTH MONTH  ,
                                   Limit1.YEAR YEAR  ,
                                   Limit1.NO NO1  ,
                                   Limit1.STUS_CODE_ID STUS_CODE_ID  ,
                                   Limit1.CODE CODE  ,
                                  (Limit1.SETL_DT) C1  ,
                                   Limit1.REN_COLCT_ID REN_COLCT_ID  ,
                                   Limit1.CODE1 CODE1  ,
                                   Limit1.RESN_DESC RESN_DESC  ,
                                   CASE
                                        WHEN ( Limit1.SRV_REM IS NOT NULL ) THEN Limit1.SRV_REM
                                   ELSE ''
                                      END C2  ,
                                   Limit1.CODY_ID CODY_ID  ,
                                   Limit1.MEM_CODE MEM_CODE  ,
                                   Limit1.NAME NAME  ,
                                   Limit1.FAIL_RESN_ID FAIL_RESN_ID  ,
                                   Limit1.CODE2 CODE2  ,
                                   Limit1.REASONDESC1 REASONDESC1  ,
                                   Limit1.WH_LOC_CODE WH_LOC_CODE  ,
                                   Limit1.WH_LOC_DESC WH_LOC_DESC  ,
                                   Limit1.RESULT_REM RESULT_REM  ,
                                   Limit1.USER_NAME USER_NAME  ,
                                   Limit1.RESULT_CRT_DT RESULT_CRT_DT  ,
                                   Limit1.RESULT_IS_CURR RESULT_IS_CURR
                              FROM ( SELECT Extent1.RESULT_ID RESULT_ID  ,
                                            Extent1.NO NO  ,
                                            Extent1.SALES_ORD_ID SALES_ORD_ID  ,
                                            Extent1.CODY_ID CODY_ID  ,
                                            Extent1.SETL_DT SETL_DT  ,
                                            Extent1.FAIL_RESN_ID FAIL_RESN_ID  ,
                                            Extent1.REN_COLCT_ID REN_COLCT_ID  ,
                                            Extent1.RESULT_REM RESULT_REM  ,
                                            Extent1.RESULT_CRT_DT RESULT_CRT_DT  ,
                                            Extent1.RESULT_IS_CURR RESULT_IS_CURR  ,
                                            Extent2.NO NO1  ,
                                            Extent2.MONTH MONTH  ,
                                            Extent2.YEAR YEAR  ,
                                            Extent3.SALES_ORD_NO SALES_ORD_NO  ,
                                            Extent4.SRV_REM SRV_REM  ,
                                            Extent5.STUS_CODE_ID STUS_CODE_ID  ,
                                            Extent5.CODE CODE  ,
                                            Extent6.CODE CODE1  ,
                                            Extent6.RESN_DESC RESN_DESC  ,
                                            Extent7.MEM_CODE MEM_CODE  ,
                                            Extent7.NAME NAME  ,
                                            Extent8.CODE CODE2  ,
                                            Extent8.RESN_DESC REASONDESC1  ,
                                            Extent9.WH_LOC_CODE WH_LOC_CODE  ,
                                            Extent9.WH_LOC_DESC WH_LOC_DESC  ,
                                            Extent10.USER_NAME USER_NAME
                                     FROM SVC0006D Extent1
                                            JOIN SVC0008D Extent2   ON Extent2.SCHDUL_ID = Extent1.SCHDUL_ID
                                            JOIN SAL0001D Extent3   ON Extent3.SALES_ORD_ID = Extent2.SALES_ORD_ID
                                            JOIN SAL0090D Extent4   ON ( Extent4.SRV_SO_ID = Extent3.SALES_ORD_ID )
                                            AND ( 1 = Extent4.SRV_STUS_ID )
                                            JOIN SYS0038M Extent5   ON Extent5.STUS_CODE_ID = Extent1.RESULT_STUS_CODE_ID
                                            LEFT JOIN SYS0032M Extent6   ON Extent6.RESN_ID = Extent1.REN_COLCT_ID
                                            LEFT JOIN ORG0001D Extent7   ON Extent7.MEM_ID = Extent1.CODY_ID
                                            LEFT JOIN SYS0032M Extent8   ON Extent8.RESN_ID = Extent1.FAIL_RESN_ID
                                            LEFT JOIN SYS0028M Extent9   ON Extent9.WH_LOC_ID = Extent1.WH_ID
                                            LEFT JOIN SYS0047M Extent10   ON Extent10.USER_ID = Extent1.RESULT_CRT_USER_ID
                                      WHERE  Extent1.RESULT_ID = #{hrResultId} AND ROWNUM <= 1 ) Limit1 -->

                            </select>









                 <select id="selectFilterTransaction" parameterType="Map" resultType="egovMap">
                   <![CDATA[
                            SELECT Distinct1.C1 C1  ,
                                   Distinct1.NO NO  ,
                                   Distinct1.RESULT_IS_CURR RESULT_IS_CURR  ,
                                   Distinct1.STK_ID STK_ID  ,
                                   Distinct1.STK_CODE STK_CODE  ,
                                   Distinct1.STK_DESC STK_DESC  ,
                                   Distinct1.BS_RESULT_FILTER_CLM BS_RESULT_FILTER_CLM  ,
                                   Distinct1.RESULT_CRT_DT RESULT_CRT_DT  ,
                                   Distinct1.BS_RESULT_PART_QTY BS_RESULT_PART_QTY  ,
                                   Distinct1.USER_NAME USER_NAME
                              FROM ( SELECT DISTINCT Filter1.NO NO  ,
                                                     Filter1.RESULT_CRT_DT RESULT_CRT_DT  ,
                                                     Filter1.RESULT_IS_CURR RESULT_IS_CURR  ,
                                                     Filter1.BS_RESULT_PART_QTY BS_RESULT_PART_QTY  ,
                                                     decode(Filter1.BS_RESULT_FILTER_CLM,'0','X','O') BS_RESULT_FILTER_CLM,
                                                     Filter1.STK_ID STK_ID  ,
                                                     Filter1.STK_CODE STK_CODE  ,
                                                     Filter1.STK_DESC STK_DESC  ,
                                                     1 C1  ,
                                                     Extent4.USER_NAME USER_NAME
                                     FROM ( SELECT Extent1.NO NO  ,
                                                   Extent1.SCHDUL_ID SCHDUL_ID  ,
                                                   Extent1.RESULT_CRT_DT RESULT_CRT_DT  ,
                                                   Extent1.RESULT_CRT_USER_ID RESULT_CRT_USER_ID  ,
                                                   Extent1.RESULT_IS_CURR RESULT_IS_CURR  ,
                                                   Extent2.BS_RESULT_PART_QTY BS_RESULT_PART_QTY  ,
                                                   Extent2.BS_RESULT_FILTER_CLM BS_RESULT_FILTER_CLM  ,
                                                   Extent3.STK_ID STK_ID  ,
                                                   Extent3.STK_CODE STK_CODE  ,
                                                   Extent3.STK_DESC STK_DESC
                                            FROM SVC0006D Extent1
                                                   JOIN SVC0007D Extent2   ON Extent1.RESULT_ID = Extent2.BS_RESULT_ID
                                                   JOIN SYS0026M Extent3   ON Extent2.BS_RESULT_PART_ID = Extent3.STK_ID
                                             WHERE  ( 306 = Extent1.TYPE_ID )
                                                      AND ( 0 <> Extent2.BS_RESULT_PART_ID )
                                                      AND ( Extent2.BS_RESULT_PART_QTY > 0 ) ) Filter1
                                            LEFT JOIN SYS0047M Extent4   ON Filter1.RESULT_CRT_USER_ID = Extent4.USER_ID
                                      WHERE  Filter1.SCHDUL_ID = #{selSchdulId} ) Distinct1
                        ]]>
                            </select>








                    <select id="selectConfigBasicInfo" parameterType="Map" resultType="egovMap">
                    SELECT * FROM (
                     SELECT
                    Extent2.ORD_ID ORD_ID  ,
                    Extent2.ORD_NO ORD_NO  ,
                    Extent2.APP_TYPE_CODE APP_TYPE_CODE  ,
                    Extent2.CUST_NAME CUST_NAME  ,
                    Extent2.CUST_NRIC CUST_NRIC  ,
                    CASE WHEN ( Extent3.MEM_ID IS NOT NULL ) THEN Extent3.MEM_ID
                    ELSE 0 END C1  ,
                    CASE WHEN ( Extent3.MEM_ID IS NOT NULL ) THEN Extent3.MEM_CODE
                    ELSE '' END C2  ,
                    CASE WHEN ( Extent3.MEM_ID IS NOT NULL ) THEN Extent3.NAME
                    ELSE '' END C3  ,
                    to_char (Extent4.SETL_DT,'DD/MM/YYYY') C4,
                    Extent2.CONFIG_SETT_INS CONFIG_SETT_INS  ,
                    Extent2.CONFIG_SETT_BS CONFIG_SETT_BS  ,
                    Extent2.CONFIG_SETT_AS CONFIG_SETT_AS  ,
                    Extent2.CONFIG_BS_GEN CONFIG_BS_GEN  ,
                    Extent2.CONFIG_BS_WEEK CONFIG_BS_WEEK  ,
                    Extent2.CONFIG_BS_REM CONFIG_BS_REM  ,
                    Extent2.SRV_MEM_FREQ SRV_MEM_FREQ  ,
                    Extent2.CONFIG_ID,
                    Extent2.CONFIG_BS_MEM_ID,
                    Extent2.STOCK
                    FROM (

                    SELECT
                            SOM.SRV_ORD_ID ORD_ID,
                            SOM.SRV_ORD_NO ORD_NO,
                            SOM.STUS_CODE_ID ORD_STUS_ID,
                            S.CODE ORD_STUS_CODE,
                            S.NAME ORD_STUS_NAME,
                            SOM.SALES_DT ORD_DT,
                            NVL(SOM.INST_PRIOD,0) INSTLMT_PRIOD,
                            SOM.TOT_AMT AS ORD_AMT,
                            (
                                CASE
                                    WHEN SOM.APP_TYPE_ID = 66 THEN NVL(SOM.MTH_RENT_AMT,0)
                                    ELSE 0
                                END
                            ) ORD_MTH_RENTAL,
                            NVL(SOM.TOT_PV,0) ORD_PV,
                            NVL(SOM.PV_MONTH,0) ORD_PV_MONTH,
                            NVL(SOM.PV_YEAR,0) ORD_PV_YEAR,
                            NVL(SOM.REF_NO,' ') ORD_REF_NO,
                            NVL(SOM.CUST_PO_NO,' ') ORD_PO_NO,
                            NVL(SOM.DEPT_CODE,' ') ORD_DEPT_CODE,
                            NVL(SOM.GRP_CODE,' ') ORD_GRP_CODE,
                            NVL(SOM.ORG_CODE,' ') ORD_ORG_CODE,
                            NVL(U.USER_NAME,' ') ORD_CRT_USER_ID,
                            SOM.CRT_DT ORD_CRT_DT,
                            SOM.APP_TYPE_ID,
                            T.CODE APP_TYPE_CODE,
                            T.CODE_NAME APP_TYPE_DESC,
                            C.CUST_ID CUST_ID,
                            (
                                CASE
                                    WHEN C.TYPE_ID NOT IN  964
                                         AND C.CORP_TYPE_ID > 0 THEN ( NVL(CUSTTYPE.CODE_NAME,' ')
                                    || ' ('
                                    || NVL(CORPTYPE.CODE_NAME,' ')
                                    || ')' )
                                    ELSE NVL(CUSTTYPE.CODE_NAME,' ')
                                END
                            ) CUST_TYPE,
                            C.NAME CUST_NAME,
                            C.NRIC CUST_NRIC,
                            (
                                CASE
                                    WHEN NVL(C.TYPE_ID,0) = 964 THEN NVL(C.DOB,TO_DATE('19000101','YYYYMMDD') )
                                    ELSE TO_DATE('19000101','YYYYMMDD')
                                END
                            ) AS CUST_DOB,
                            NVL(CO.NAME,' ') CUST_NATION,
                            (
                                CASE
                                    WHEN NVL(C.TYPE_ID,0) = 964 THEN NVL(C.GENDER,' ')
                                    ELSE ' '
                                END
                            ) CUST_GENDER,
                            NVL(RC.CODE_NAME,' ') CUST_RACE,
                            NVL(C.EMAIL,' ') CUST_EMAIL,
                            NVL(C.CUST_VA_NO,' ') CUST_VA_NO,
                            C.PAS_SPORT_EXPR CUST_PASSPORT_EXPR,
                            C.VISA_EXPR CUST_VISA_EXPR,
                            NVL(SOM.PROMO_ID,0) ORD_PROMO_ID,
                            NVL(PM.PROMO_CODE,' ') ORD_PROMO_CODE,
                            NVL(PM.PROMO_DESC,' ') ORD_PROMO_DESC,
                            NVL(MEM.MEM_ID,0) ORD_MEM_ID,
                            NVL(MEM.MEM_CODE,' ') ORD_MEM_CODE,
                            NVL(MEM.NAME,' ') ORD_MEM_NAME,
                            NVL(MEM.NRIC,' ') ORD_MEM_NRIC,
                            NVL(MEM.MEM_TYPE,0) ORD_MEM_TYPE_ID,
                            NVL(MT.CODE,' ') ORD_MEM_TYPE_CODE,
                            NVL(MT.CODE_NAME,' ') ORD_MEM_TYPE_NAME,
                            NVL(SOM.BRNCH_ID,0) KEYIN_BRNCH_ID,
                            NVL(B.CODE,' ') KEYIN_BRNCH_CODE,
                            NVL(B.NAME,' ') KEYIN_BRNCH_NAME,
                            NVL(SOM.REM,' ') ORD_REM,
                            0 AS RENT_CHK_ID,
                            NVL(SOM.SALES_HM_ID,0) ORD_HM_ID,
                            NVL(SOM.SALES_SM_ID,0) ORD_SM_ID,
                            NVL(SOM.SALES_GM_ID,0) ORD_GM_ID,
                            NVL(SOM.CUST_ADD_ID,0) ORD_ADDR_ID,
                            NVL(SOM.CUST_CNT_ID,0) ORD_CNTC_ID,
                            NVL(SOM.CUST_CARE_CNT_ID,0) CUST_CARE_CNT_ID,
                            SOM.UPD_DT UPD_DT,
                            NVL(U2.USER_NAME,' ') UPD_USER_ID,
                            CBM.CUST_BILL_PAY_REF_NO1 JOM_PAY_REF,
                            C.TYPE_ID CUST_TYPE_ID,
                            NVL(SOM.CUST_BILL_ID,0) CUST_BILL_ID,
                            SOM.EMP_CHK,
                            SOM.EX_TRADE,
                            SOM.GST_CHK,
                            SOM.CNVR_SCHEME_ID,
                            SOM.PROMO_DISC_PERIOD_TP,
                            PERD.CODE_NAME PROMO_DISC_PERIOD_TP_NM,
                            SOM.PROMO_DISC_PERIOD,
                            SOM.NOR_AMT,
                            SOM.NOR_RNT_FEE,
                            SOM.DISC_RNT_FEE,
                            SOM.SRV_PAC_ID,
                            SOM.ADV_BILL,
                            SOM.SALES_PROD_SZ STOCK,
                            FLOOR(MONTHS_BETWEEN(SYSDATE,C.CRT_DT) ) CRT_DUR,
                            NVL(cg.SRV_CONFIG_ID, 0) CONFIG_ID  ,
                            (CASE WHEN NVL(cs1.SRV_SETT_STUS_ID, 0) = 1 THEN 1
                            ELSE 0 END) CONFIG_SETT_INS  ,
                            (CASE WHEN NVL(cs2.SRV_SETT_STUS_ID, 0) = 1 THEN 1
                            ELSE 0 END) CONFIG_SETT_BS  ,
                            (CASE WHEN NVL(cs3.SRV_SETT_STUS_ID, 0) = 1 THEN 1
                            ELSE 0 END) CONFIG_SETT_AS ,
                            NVL(cg.SRV_BS_GEN, 0) CONFIG_BS_GEN ,
                            NVL(cg.SRV_CODY_ID, 0) CONFIG_BS_MEM_ID ,
                            NVL(cg.SRV_BS_WEEK, 0) CONFIG_BS_WEEK ,
                            NVL(cg.SRV_REM, ' ') CONFIG_BS_REM ,
                            sm.SRV_MEM_ID ,
                            NVL(sm.SRV_MEM_NO, ' ') SRV_MEM_NO ,
                            NVL(sm.SRV_MEM_BILL_NO, ' ') SRV_MEM_BILL_NO ,
                            NVL(sm.SRV_START_DT, TO_DATE('01/01/1900', 'dd/mm/yyyy')) SRV_MEM_START_DT,
                            NVL(sm.SRV_EXPR_DT, TO_DATE('01/01/1900', 'dd/mm/yyyy')) SRV_MEM_EXPR_DT,
                            NVL(Prd.SRV_PRD_DUR, 0) SRV_MEM_FREQ  ,
                            NVL(sm.SRV_DUR, 0) SRV_MEM_DUR  ,
                            NVL(mem1.MEM_CODE, ' ') SRV_MEM_SALESMAN_CODE  ,
                            NVL(mem1.NAME, ' ') SRV_MEM_SALESMAN_NAME

                        FROM
                            SAL0225D SOM
                            JOIN SAL0029D C ON C.CUST_ID = SOM.CUST_ID
                            LEFT JOIN SYS0013M CORPTYPE ON CORPTYPE.CODE_ID = C.CORP_TYPE_ID AND C.TYPE_ID NOT IN 964 AND C.CORP_TYPE_ID > 0
                            LEFT JOIN SYS0013M CUSTTYPE ON CUSTTYPE.CODE_ID = C.TYPE_ID
                            JOIN SYS0013M T ON T.CODE_ID = SOM.APP_TYPE_ID
                            JOIN SYS0038M S ON S.STUS_CODE_ID = SOM.STUS_CODE_ID
                            LEFT JOIN SAL0024D CBM ON SOM.CUST_BILL_ID = CBM.CUST_BILL_ID
                            LEFT JOIN SYS0047M U ON U.USER_ID = SOM.CRT_USER_ID
                            LEFT JOIN SYS0047M U2 ON U2.USER_ID = SOM.UPD_USER_ID
                            LEFT JOIN SYS0005M B ON B.BRNCH_ID = SOM.BRNCH_ID
                            LEFT JOIN SYS0015M CO ON CO.CNTY_ID = C.NATION AND NVL(C.TYPE_ID,0) = 964
                            LEFT JOIN SYS0013M RC ON RC.CODE_ID = C.RACE_ID AND NVL(C.TYPE_ID,0) = 964
                            LEFT JOIN SAL0017D PM ON PM.PROMO_ID = SOM.PROMO_ID AND NVL(SOM.PROMO_ID,0) NOT IN  0
                            LEFT JOIN ORG0001D MEM ON MEM.MEM_ID = SOM.MEM_ID AND NVL(SOM.MEM_ID,0) NOT IN 0
                            LEFT JOIN SYS0013M MT ON MEM.MEM_TYPE = MT.CODE_ID
                            LEFT JOIN SYS0013M PERD ON PERD.CODE_ID = SOM.PROMO_DISC_PERIOD_TP
                            LEFT JOIN SAL0090D cg   ON cg.SRV_SO_ID = SOM.SRV_ORD_ID AND cg.SRV_STUS_ID = 1
                            LEFT JOIN SAL0089D cs1  ON cs1.SRV_CONFIG_ID = cg.SRV_CONFIG_ID AND cs1.SRV_SETT_TYPE_ID = 281
                            LEFT JOIN SAL0089D cs2   ON cs2.SRV_CONFIG_ID = cg.SRV_CONFIG_ID AND cs2.SRV_SETT_TYPE_ID = 280
                            LEFT JOIN SAL0089D cs3   ON cs3.SRV_CONFIG_ID = cg.SRV_CONFIG_ID AND cs3.SRV_SETT_TYPE_ID = 279
                            LEFT JOIN SAL0095D sm   ON sm.SRV_SALES_ORD_ID = SOM.SRV_ORD_ID AND sm.SRV_MEM_ID NOT IN  0
                            LEFT JOIN SAL0088D Prd   ON Prd.SRV_CONFIG_ID = cg.SRV_CONFIG_ID AND Prd.SRV_PRD_STUS_ID = 1
                            AND TO_CHAR(SYSDATE,'YYYYMMDD') BETWEEN TO_CHAR(Prd.SRV_PRD_START_DT,'YYYYMM')||'01' AND TO_CHAR(LAST_DAY(Prd.SRV_PRD_EXPR_DT),'YYYYMMDD')
                            LEFT JOIN ORG0001D mem1   ON mem1.MEM_ID = NVL(sm.SRV_MEM_SALES_MEM_ID, 0) AND NVL(sm.SRV_MEM_SALES_MEM_ID, 0) NOT IN  0
                        WHERE
                            ( SOM.STUS_CODE_ID NOT IN 8 )

                            )Extent2
                            LEFT JOIN ORG0001D Extent3   ON Extent2.CONFIG_BS_MEM_ID = Extent3.MEM_ID
                            LEFT JOIN SVC0006D Extent4   ON ( Extent2.ORD_ID = Extent4.SALES_ORD_ID ) AND ( 4 = Extent4.RESULT_STUS_CODE_ID )
                            WHERE  Extent2.ORD_ID = #{salesOrdId}

                            ORDER BY Extent4.SETL_DT DESC )
                          <![CDATA[                              WHERE ROWNUM <= 1 ]]>
         </select>




                   <update id="updateHsSVC0006D" parameterType="Map">

                       UPDATE SVC0006D
                           SET SETL_DT = to_date(#{lstHSDate}, 'DD/MM/YYYY')
                         WHERE   SALES_ORD_ID = #{salesOrderId}

                     </update>



                   <update id="updateHsConfigBasic" parameterType="Map">

                       UPDATE SAL0090D
                           SET SRV_CODY_ID = #{hscodyId},
                               SRV_REM = #{remark},
                               SRV_BS_WEEK = #{srvBsWeek},
                               SRV_BS_GEN = #{availability},
                               <!-- Added By Chew Kah Kit -->
                               SRV_UPD_USER_ID = #{SrvUpdateAt},
                               SRV_UPD_DT = SYSDATE
                         WHERE   SRV_CONFIG_ID = #{srvConfigId}

                     </update>




                 <update id="updateHsconfigSetting" parameterType="Map">
                            UPDATE SAL0089D
                               SET SRV_SETT_STUS_ID = #{srvSettStusId}
                             WHERE   SRV_CONFIG_ID = #{configId}
                             and SRV_SETT_TYPE_ID = #{srvSettTypeId}
                 </update>





                   <select id="selectConfigBasicInfoYn" parameterType="Map" resultType="egovMap">
                        SELECT Extent1.SRV_CONFIG_ID SRV_CONFIG_ID  ,
                               Extent1.SRV_SO_ID SRV_SO_ID  ,
                               Extent1.SRV_CODY_ID SRV_CODY_ID  ,
                               Extent1.SRV_PREV_DT SRV_PREV_DT  ,
                               Extent1.SRV_REM SRV_REM  ,
                               Extent1.SRV_BS_GEN SRV_BS_GEN  ,
                               Extent1.SRV_CRT_DT SRV_CRT_DT  ,
                               Extent1.SRV_CRT_USER_ID SRV_CRT_USER_ID  ,
                               Extent1.SRV_UPD_DT SRV_UPD_DT  ,
                               Extent1.SRV_UPD_USER_ID SRV_UPD_USER_ID  ,
                               Extent1.SRV_STUS_ID SRV_STUS_ID  ,
                               Extent1.SRV_BS_WEEK SRV_BS_WEEK
                          FROM SAL0090D Extent1
                         WHERE   Extent1.SRV_SO_ID = #{salesOrderId}
                         <![CDATA[              AND ( 1 = Extent1.SRV_STUS_ID ) AND ROWNUM <= 1 ]]>
                    </select>



                    <select id="selectConfigSettingYn" parameterType="Map" resultType="egovMap">
                            SELECT Extent1.SRV_SETT_ID SRV_SETT_ID  ,
                                       Extent1.SRV_CONFIG_ID SRV_CONFIG_ID  ,
                                       Extent1.SRV_SETT_TYPE_ID SRV_SETT_TYPE_ID  ,
                                       Extent1.SRV_SETT_STUS_ID SRV_SETT_STUS_ID  ,
                                       Extent1.SRV_SETT_REM SRV_SETT_REM  ,
                                       Extent1.SRV_SETT_CRT_DT SRV_SETT_CRT_DT  ,
                                       Extent1.SRV_SETT_CRT_USER_ID SRV_SETT_CRT_USER_ID
                                  FROM SAL0089D Extent1
                                 WHERE  ( Extent1.SRV_CONFIG_ID =#{configId} )
                            <![CDATA[             AND ( 281 = Extent1.SRV_SETT_TYPE_ID ) AND ROWNUM <= 1 ]]>
                                 union all
                                SELECT Extent1.SRV_SETT_ID SRV_SETT_ID  ,
                                       Extent1.SRV_CONFIG_ID SRV_CONFIG_ID  ,
                                       Extent1.SRV_SETT_TYPE_ID SRV_SETT_TYPE_ID  ,
                                       Extent1.SRV_SETT_STUS_ID SRV_SETT_STUS_ID  ,
                                       Extent1.SRV_SETT_REM SRV_SETT_REM  ,
                                       Extent1.SRV_SETT_CRT_DT SRV_SETT_CRT_DT  ,
                                       Extent1.SRV_SETT_CRT_USER_ID SRV_SETT_CRT_USER_ID
                                  FROM SAL0089D Extent1
                                 WHERE  ( Extent1.SRV_CONFIG_ID =#{configId} )
                                <![CDATA[            AND ( 280 = Extent1.SRV_SETT_TYPE_ID ) AND ROWNUM <= 1 ]]>
                                union all
                                SELECT Extent1.SRV_SETT_ID SRV_SETT_ID  ,
                                       Extent1.SRV_CONFIG_ID SRV_CONFIG_ID  ,
                                       Extent1.SRV_SETT_TYPE_ID SRV_SETT_TYPE_ID  ,
                                       Extent1.SRV_SETT_STUS_ID SRV_SETT_STUS_ID  ,
                                       Extent1.SRV_SETT_REM SRV_SETT_REM  ,
                                       Extent1.SRV_SETT_CRT_DT SRV_SETT_CRT_DT  ,
                                       Extent1.SRV_SETT_CRT_USER_ID SRV_SETT_CRT_USER_ID
                                  FROM SAL0089D Extent1
                                 WHERE  ( Extent1.SRV_CONFIG_ID = #{configId} )
                      <![CDATA[         AND ( 279 = Extent1.SRV_SETT_TYPE_ID ) AND ROWNUM <= 1 ]]>

                     </select>



                    <select id="selectHSOrderView" parameterType="Map" resultType="egovMap">
                    SELECT Extent1.ORD_ID ORD_ID  ,
                               Extent1.ORD_NO ORD_NO  ,
                               Extent1.ORD_STUS_CODE ORD_STUS_CODE  ,
                               Extent1.APP_TYPE_CODE APP_TYPE_CODE  ,
                               Extent1.STOCK_CODE STOCK_CODE  ,
                               Extent1.STOCK_DESC STOCK_DESC  ,
                               Extent1.CUST_NAME CUST_NAME  ,
                               Extent1.CUST_NRIC CUST_NRIC  ,
<!--                               Extent2.INST_ADDR1 INST_ADDR1  ,
                               Extent2.INST_ADDR2 INST_ADDR2  ,
                               Extent2.INST_ADDR3 INST_ADDR3  ,
                               Extent2.INST_CNTY INST_CNTY  , -->
                               Extent2.INST_STATE INST_STATE  ,
                               Extent2.INST_AREA INST_AREA  ,
                        <!--        Extent2.INST_POST_CODE INST_POST_CODE  , -->
                               Extent2.INST_CNT_NAME INST_CNT_NAME  ,
                               Extent2.INST_CNT_TEL_M INST_CNT_TEL_M  ,
                               Extent2.INST_CNT_TEL_O INST_CNT_TEL_O  ,
                               Extent2.INST_CNT_TEL_R INST_CNT_TEL_R  ,
                               Extent2.LAST_INSTALL_NO LAST_INSTALL_NO  ,
                               Extent2.LAST_INSTALL_CT_CODE LAST_INSTALL_CT_CODE  ,
                               Extent2.LAST_INSTALL_CT_NAME LAST_INSTALL_CT_NAME  ,
                               Extent2.LAST_INSTALL_DT LAST_INSTALL_DT  ,
                               Extent2.LAST_INSTALL_SIRIM_NO LAST_INSTALL_SIRIM_NO  ,
                               Extent2.LAST_INSTALL_SERIAL_NO LAST_INSTALL_SERIAL_NO  ,
                               Extent2.INSTCT INSTCT  ,
                               Extent4.STK_ID STK_ID  ,
                               Extent5.CODE_NAME CODE_NAME  ,
                               (Extent1.ORD_DT) C1  ,
                               Extent2.LAST_INSTALL_DT C2  ,
                               CASE
                                    WHEN ( NOT ( ( Extent3.ORD_ID IS NULL )
                                      AND ( Extent3.CONFIG_SETT_INS IS NULL )
                                      AND ( Extent3.CONFIG_SETT_BS IS NULL )
                                      AND ( Extent3.CONFIG_SETT_AS IS NULL )
                                      AND ( Extent3.CONFIG_BS_GEN IS NULL )
                                      AND ( Extent3.CONFIG_BS_MEM_ID IS NULL )
                                      AND ( Extent3.CONFIG_BS_WEEK IS NULL )
                                      AND ( Extent3.CONFIG_BS_REM IS NULL )
                                      AND ( Extent3.SRV_MEM_ID IS NULL )
                                      AND ( Extent3.SRV_MEM_NO IS NULL )
                                      AND ( Extent3.SRV_MEM_BILL_NO IS NULL )
                                      AND ( Extent3.SRV_MEM_PAC_ID IS NULL )
                                      AND ( Extent3.SRV_MEM_PAC_CODE IS NULL )
                                      AND ( Extent3.SRV_MEM_PAC_NAME IS NULL )
                                      AND ( Extent3.SRV_MEM_FREQ IS NULL )
                                      AND ( Extent3.SRV_MEM_DUR IS NULL )
                                      AND ( Extent3.SRV_MEM_SALESMAN_CODE IS NULL )
                                      AND ( Extent3.SRV_MEM_SALESMAN_NAME IS NULL ) ) ) THEN Extent3.CONFIG_ID
                               ELSE 0
                                  END C3  ,
                               Extent3.SRV_MEM_PAC_NAME SRV_MEM_PAC_NAME  ,
                               Extent3.SRV_MEM_EXPR_DT SRV_MEM_EXPR_DT
                          FROM ( SELECT *
                                 FROM SAL1006V vOrderBasicInfo ) Extent1
                                 JOIN ( SELECT *
                                        FROM SAL1010V vOrderInstallationInfo ) Extent2   ON Extent1.ORD_ID = Extent2.ORD_ID
                                 LEFT JOIN ( SELECT *
                                             FROM SAL1014V vOrderSrvMemConfigInfo ) Extent3   ON Extent1.ORD_ID = Extent3.ORD_ID
                                 JOIN SYS0026M Extent4   ON ( Extent1.STOCK_CODE = Extent4.STK_CODE )
                                 OR ( ( Extent1.STOCK_CODE IS NULL )
                                 AND ( Extent4.STK_CODE IS NULL ) )
                                 JOIN SYS0013M Extent5   ON Extent4.STK_CTGRY_ID = Extent5.CODE_ID
                     <![CDATA[   WHERE  Extent1.ORD_ID = #{salesOrdId} AND ROWNUM <= 1 ]]>

                    </select>




                    <select id="selectHSAddFilterSetInfo" parameterType="Map" resultType="egovMap">
                    SELECT
                    e.stk_code,
                    e.stk_id code_id,
                 ( e.stk_code
                 || '-'
                    || e.stk_desc ) code_name
                    FROM
                    sal0002d a
                    join  sys0026m b on a.itm_stk_id = b.stk_id
                    join  log0043m c  on b.stk_code = c.matrl_no
                    join log0044d d on    c.bom = d.bom
                    join sys0026m e on d.bom_compnt = e.stk_code
                    where E.STK_TYPE_ID = '62'
                    AND   A.SALES_ORD_ID = #{salesOrdId}
<![CDATA[      AND   TO_CHAR(D.VALID_FROM_DT,'YYYYMMDD') <   TO_CHAR(SYSDATE,'YYYYMMDD')
                    AND   TO_CHAR(D.VALID_TO_DT,'YYYYMMDD')   >   TO_CHAR(SYSDATE,'YYYYMMDD')
]]>
            union
                    SELECT
                    e.stk_code,
                    e.stk_id code_id,
                    ( e.stk_code
                    || '-'
                    || e.stk_desc ) code_name
                    FROM
                    sal0002d a
                    join  sys0026m b1 on a.itm_stk_id = b1.stk_id
                    join sys0026m b on b.stk_id = b1.MASTER_STK_ID
                    join  log0043m c  on b.stk_code = c.matrl_no
                    join log0044d d on    c.bom = d.bom
                    join sys0026m e on d.bom_compnt = e.stk_code
                    where E.STK_TYPE_ID = '62'
                    AND   A.SALES_ORD_ID = #{salesOrdId}
<![CDATA[      AND   TO_CHAR(D.VALID_FROM_DT,'YYYYMMDD') <   TO_CHAR(SYSDATE,'YYYYMMDD')
                    AND   TO_CHAR(D.VALID_TO_DT,'YYYYMMDD')   >   TO_CHAR(SYSDATE,'YYYYMMDD')
]]>
                         <!--    SELECT  E.STK_CODE, E.STK_ID CODE_ID, (E.STK_CODE || '-' || E.STK_DESC) CODE_NAME
                            FROM
                            SAL0002D A,
                            SYS0026M B,
                            LOG0043M C,
                            LOG0044D D,
                            SYS0026M E
                            WHERE 1=1
                            AND   A.ITM_STK_ID  = B.STK_ID
                            AND   B.STK_CODE    = C.MATRL_NO
                            AND   C.BOM         = D.BOM
                            AND   D.BOM_COMPNT  = E.STK_CODE
                            AND   E.STK_TYPE_ID = '62'
                            AND   A.SALES_ORD_ID = #{salesOrdId}
<![CDATA[               AND   TO_CHAR(D.VALID_FROM_DT,'YYYYMMDD') <   TO_CHAR(SYSDATE,'YYYYMMDD')
                            AND   TO_CHAR(D.VALID_TO_DT,'YYYYMMDD')   >   TO_CHAR(SYSDATE,'YYYYMMDD')
]]>-->
                    </select>



                    <select id="addSrvFilterIdCnt" parameterType="Map" resultType="egovMap">

                            SELECT count(*) cnt
                              FROM SAL0090D Extent1
                                     JOIN SAL0087D Extent2   ON Extent1.SRV_CONFIG_ID = Extent2.SRV_CONFIG_ID
                             WHERE  ( Extent1.SRV_SO_ID = #{salesOrdId} )
                                      AND ( 1 = Extent1.SRV_STUS_ID )
                                      AND ( Extent2.SRV_FILTER_STK_ID = #{filterCode} )
                                      AND ( 1 = Extent2.SRV_FILTER_STUS_ID )

                    </select>




                <select id="getSrvConfigFilter_SAL0087D" parameterType="Map" resultType="egovMap">

                            SELECT Extent1.SRV_FILTER_ID SRV_FILTER_ID  ,
                                   Extent1.SRV_CONFIG_ID SRV_CONFIG_ID  ,
                                   Extent1.SRV_FILTER_STK_ID SRV_FILTER_STK_ID  ,
                                   Extent1.SRV_FILTER_PRIOD SRV_FILTER_PRIOD  ,
                                   Extent1.SRV_FILTER_PRV_CHG_DT SRV_FILTER_PRV_CHG_DT  ,
                                   Extent1.SRV_FILTER_STUS_ID SRV_FILTER_STUS_ID  ,
                                   Extent1.SRV_FILTER_REM SRV_FILTER_REM  ,
                                   Extent1.SRV_FILTER_CRT_DT SRV_FILTER_CRT_DT  ,
                                   Extent1.SRV_FILTER_CRT_USER_ID SRV_FILTER_CRT_USER_ID  ,
                                   Extent1.SRV_FILTER_UPD_DT SRV_FILTER_UPD_DT  ,
                                   Extent1.SRV_FILTER_UPD_USER_ID SRV_FILTER_UPD_USER_ID  ,
                                   Extent1.SRV_FILTER_EXPR_DT SRV_FILTER_EXPR_DT
                              FROM SAL0087D Extent1, SAL0090D A
                              WHERE A.SRV_CONFIG_ID = Extent1.SRV_CONFIG_ID
                              AND  ( A.SRV_SO_ID = #{salesOrdId} )
                             <![CDATA[           AND ( Extent1.SRV_FILTER_STK_ID = #{filterCode} ) AND ROWNUM <= 1 ]]>

                    </select>




          <insert id="saveChanges" parameterType="Map">
                        INSERT INTO GBSLCVD.SAL0087D (
                               SRV_FILTER_ID, SRV_CONFIG_ID, SRV_FILTER_STK_ID,
                               SRV_FILTER_PRIOD, SRV_FILTER_PRV_CHG_DT, SRV_FILTER_STUS_ID,
                               SRV_FILTER_REM, SRV_FILTER_CRT_DT, SRV_FILTER_CRT_USER_ID,
                               SRV_FILTER_UPD_DT, SRV_FILTER_UPD_USER_ID
                               <!-- , SRV_FILTER_EXPR_DT,
                               SRV_FILTER_LAST_SERIAL, SRV_FILTER_PREV_SERIAL, PART_TYPE,
                               FILTER_BARCD_CHK_Y_N, FILTER_BARCD_SERIAL_NO -->
                               )
                            VALUES ( SAL0087D_SRV_FILTER_ID_SEQ.nextval,
                                     #{SRV_CONFIG_ID},
                                     #{SRV_FILTER_STK_ID},
                                     #{SRV_FILTER_PRIOD},
                                     TO_DATE(#{SRV_FILTER_PRV_CHG_DT},'DD/MM/YYYY'),
                                     #{SRV_FILTER_STUS_ID},
                                     #{SRV_FILTER_REM},
                                     SYSDATE,
                                     #{SRV_FILTER_UPD_USER_ID},
                                     SYSDATE,
                                     #{SRV_FILTER_CRT_USER_ID}
                                <!--     SRV_FILTER_EXPR_DT,
                                      SRV_FILTER_LAST_SERIAL ,
                                      SRV_FILTER_PREV_SERIAL ,
                                      PART_TYPE ,
                                      FILTER_BARCD_CHK_Y_N ,
                                      FILTER_BARCD_SERIAL_NO   -->
                                     )
            </insert>

            <insert id="saveHsFilterInfoAdd" parameterType="Map">
            INSERT INTO SAL0087D (
                                                SRV_FILTER_ID,
                                                SRV_CONFIG_ID,
                                                SRV_FILTER_STK_ID,
                                                SRV_FILTER_PRIOD,
                                                SRV_FILTER_PRV_CHG_DT,
                                                SRV_FILTER_STUS_ID,
                                                SRV_FILTER_REM,
                                                SRV_FILTER_CRT_DT,
                                                SRV_FILTER_CRT_USER_ID,
                                                SRV_FILTER_UPD_DT,
                                                SRV_FILTER_UPD_USER_ID
                                                )
                         VALUES  (
                                        SAL0087D_SRV_FILTER_ID_SEQ.nextval,
                                        (SELECT SRV_CONFIG_ID FROM SAL0090D WHERE SRV_SO_ID = #{salesOrdId} AND SRV_STUS_ID = 1 ),
                                        #{filterCode},
                                        ( SELECT  D.LEAD_TM_OFFSET
                                          FROM
                                          SAL0002D A,
                                          SYS0026M B,
                                          LOG0043M C,
                                          LOG0044D D,
                                          SYS0026M E
                                          WHERE 1=1
                                          AND   A.ITM_STK_ID  = B.STK_ID
                                          AND   B.STK_CODE    = C.MATRL_NO
                                          AND   C.BOM         = D.BOM
                                          AND   D.BOM_COMPNT  = E.STK_CODE
                                          AND   E.STK_TYPE_ID = '62'
                                          AND   A.SALES_ORD_ID = #{salesOrdId}
                                          AND   E.STK_ID = #{filterCode}
<![CDATA[                             AND   TO_CHAR(D.VALID_FROM_DT,'YYYYMMDD') <   TO_CHAR(SYSDATE,'YYYYMMDD')
                                          AND   TO_CHAR(D.VALID_TO_DT,'YYYYMMDD')   >   TO_CHAR(SYSDATE,'YYYYMMDD') ]]>
                                          UNION
                                          SELECT  D.LEAD_TM_OFFSET
                                          FROM
                                          SAL0002D A,
                                          sys0026m b1,
                                            sys0026m b,
                                          LOG0043M C,
                                          LOG0044D D,
                                          SYS0026M E
                                          WHERE 1=1
                                          AND   A.ITM_STK_ID  = B1.STK_ID
                                          AND   b.stk_id = b1.MASTER_STK_ID
                                          AND   B.STK_CODE    = C.MATRL_NO
                                          AND   C.BOM         = D.BOM
                                          AND   D.BOM_COMPNT  = E.STK_CODE
                                          AND   E.STK_TYPE_ID = '62'
                                          AND   A.SALES_ORD_ID = #{salesOrdId}
                                          AND   E.STK_ID = #{filterCode}
<![CDATA[                             AND   TO_CHAR(D.VALID_FROM_DT,'YYYYMMDD') <   TO_CHAR(SYSDATE,'YYYYMMDD')
                                          AND   TO_CHAR(D.VALID_TO_DT,'YYYYMMDD')   >   TO_CHAR(SYSDATE,'YYYYMMDD')), ]]>
                                        TO_DATE(#{lastChangeDate},'DD/MM/YYYY'),
                                        '1',
                                        NVL(#{remark}, ''),
                                        SYSDATE,
                                        #{updator},
                                        SYSDATE,
                                        #{updator}
                                      )
                <!--        INSERT INTO SAL0087D (
                                                SRV_FILTER_ID,
                                                SRV_CONFIG_ID,
                                                SRV_FILTER_STK_ID,
                                                SRV_FILTER_PRIOD,
                                                SRV_FILTER_PRV_CHG_DT,
                                                SRV_FILTER_STUS_ID,
                                                SRV_FILTER_REM,
                                                SRV_FILTER_CRT_DT,
                                                SRV_FILTER_CRT_USER_ID,
                                                SRV_FILTER_UPD_DT,
                                                SRV_FILTER_UPD_USER_ID
                                                )
                         VALUES  (
                                        SAL0087D_SRV_FILTER_ID_SEQ.nextval,
                                        (SELECT SRV_CONFIG_ID FROM SAL0090D WHERE SRV_SO_ID = #{salesOrdId}),
                                        #{filterCode},
                                        ( SELECT  D.LEAD_TM_OFFSET
                                          FROM
                                          SAL0002D A,
                                          SYS0026M B,
                                          LOG0043M C,
                                          LOG0044D D,
                                          SYS0026M E
                                          WHERE 1=1
                                          AND   A.ITM_STK_ID  = B.STK_ID
                                          AND   B.STK_CODE    = C.MATRL_NO
                                          AND   C.BOM         = D.BOM
                                          AND   D.BOM_COMPNT  = E.STK_CODE
                                          AND   E.STK_TYPE_ID = '62'
                                          AND   A.SALES_ORD_ID = #{salesOrdId}
                                          AND   E.STK_ID = #{filterCode}
<![CDATA[                             AND   TO_CHAR(D.VALID_FROM_DT,'YYYYMMDD') <   TO_CHAR(SYSDATE,'YYYYMMDD')
                                          AND   TO_CHAR(D.VALID_TO_DT,'YYYYMMDD')   >   TO_CHAR(SYSDATE,'YYYYMMDD') ), ]]>
                                        TO_DATE(#{lastChangeDate},'DD/MM/YYYY'),
                                        '1',
                                        NVL(#{remark}, ''),
                                        SYSDATE,
                                        #{updator},
                                        SYSDATE,
                                        #{updator}
                                      )-->
            </insert>


                    <select id="getSrvConfigId_SAL009" parameterType="Map" resultType="String">

                         SELECT Extent1.SRV_CONFIG_ID SRV_CONFIG_ID
                          FROM SAL0090D Extent1
                         WHERE  ( Extent1.SRV_SO_ID = #{salesOrdId} )
                    <![CDATA[             AND ( 1 = Extent1.SRV_STUS_ID ) AND ROWNUM <= 1   ]]>

                    </select>



                    <select id="getbomPartPriod_LOG0001M" parameterType="Map" resultType="String">

                        SELECT Extent1.BOM_PART_PRIOD BOM_PART_PRIOD
                          FROM LOG0001M Extent1
                         WHERE  ( Extent1.BOM_PART_ID = #{filterCode} )
                                  AND ( 1 = Extent1.BOM_PART_STUS_ID )
                                  AND ( 547 = Extent1.BOM_TYPE_ID )
                        <![CDATA[          AND ( Extent1.BOM_STK_ID = #{productID} ) AND ROWNUM <= 1 ]]>

                    </select>




                    <select id="getSalesDtSAL_0001D" parameterType="Map" resultType="String">

                        SELECT Extent1.SALES_DT SALES_DT
                          FROM SAL0001D Extent1
                        <![CDATA[   WHERE  Extent1.SALES_ORD_ID = #{salesOrdId} AND ROWNUM <= 1 ]]>

                    </select>






                    <select id="selectOrderInactiveFilter" parameterType="Map" resultType="egovMap">

                            SELECT Distinct1.C1 C1  ,
                                   Distinct1.SRV_FILTER_ID SRV_FILTER_ID  ,
                                   Distinct1.SRV_FILTER_STK_ID SRV_FILTER_STK_ID  ,
                                   Distinct1.STK_CODE STK_CODE  ,
                                   Distinct1.STK_DESC STK_DESC  ,
                                   Distinct1.C2 C2  ,
                                   Distinct1.C3 C3  ,
                                   Distinct1.SRV_FILTER_STUS_ID SRV_FILTER_STUS_ID  ,
                                   Distinct1.SRV_FILTER_PRV_CHG_DT SRV_FILTER_PRV_CHG_DT
                              FROM ( SELECT DISTINCT 1 C1  ,
                                                     CASE
                                                          WHEN ( Extent2.SRV_FILTER_UPD_DT IS NOT NULL ) THEN Extent2.SRV_FILTER_UPD_DT   END C2  ,
                                                     CASE
                                                          WHEN ( Extent4.USER_NAME IS NOT NULL ) THEN Extent4.USER_NAME
                                                     ELSE ' '
                                                        END C3  ,
                                                     Extent2.SRV_FILTER_ID SRV_FILTER_ID  ,
                                                     Extent2.SRV_FILTER_STK_ID SRV_FILTER_STK_ID  ,
                                                     Extent2.SRV_FILTER_PRV_CHG_DT SRV_FILTER_PRV_CHG_DT  ,
                                                     Extent2.SRV_FILTER_STUS_ID SRV_FILTER_STUS_ID  ,
                                                     Extent3.STK_CODE STK_CODE  ,
                                                     Extent3.STK_DESC STK_DESC
                                     FROM SAL0090D Extent1
                                            JOIN SAL0087D Extent2   ON Extent1.SRV_CONFIG_ID = Extent2.SRV_CONFIG_ID
                                            LEFT JOIN SYS0026M Extent3   ON Extent2.SRV_FILTER_STK_ID = Extent3.STK_ID
                                            LEFT JOIN SYS0047M Extent4   ON Extent2.SRV_FILTER_UPD_USER_ID = Extent4.USER_ID
                                      WHERE  ( 1 = Extent1.SRV_STUS_ID )
                                               AND ( 8 = Extent2.SRV_FILTER_STUS_ID )
                                               AND ( Extent1.SRV_SO_ID = #{salesOrdId}  ) ) Distinct1

                     </select>







                      <select id="selectOrderActiveFilter" parameterType="Map" resultType="egovMap">
                                SELECT Distinct1.C1 C1  ,
                                       Distinct1.SRV_FILTER_ID SRV_FILTER_ID  ,
                                       Distinct1.SRV_FILTER_STK_ID SRV_FILTER_STK_ID  ,
                                       Distinct1.STK_CODE STK_CODE  ,
                                       Distinct1.STK_DESC STK_DESC  ,
                                       Distinct1.C2 C2  ,
                                       Distinct1.C3 C3  ,
                                       Distinct1.SRV_FILTER_STUS_ID SRV_FILTER_STUS_ID  ,
                                       to_char(Distinct1.SRV_FILTER_PRV_CHG_DT,'yyyy/mm/dd') SRV_FILTER_PRV_CHG_DT  ,
                                       Distinct1.SRV_FILTER_PRIOD SRV_FILTER_PRIOD ,
                                       Distinct1.SRV_FILTER_LAST_SERIAL SRV_FILTER_LAST_SERIAL ,
                                       Distinct1.SRV_FILTER_PREV_SERIAL SRV_FILTER_PREV_SERIAL ,
                                       Distinct1.C4 C4  ,
                                       Distinct1.C5 C5  ,
                                       Distinct1.C6 C6
                                  FROM ( SELECT DISTINCT Extent3.SRV_FILTER_ID SRV_FILTER_ID  ,
                                                         Extent3.SRV_FILTER_STK_ID SRV_FILTER_STK_ID  ,
                                                         Extent3.SRV_FILTER_PRIOD SRV_FILTER_PRIOD  ,
                                                         Extent3.SRV_FILTER_PRV_CHG_DT SRV_FILTER_PRV_CHG_DT  ,
                                                         Extent3.SRV_FILTER_STUS_ID SRV_FILTER_STUS_ID ,
                                                         Extent3.SRV_FILTER_LAST_SERIAL SRV_FILTER_LAST_SERIAL,
                                                         Extent3.SRV_FILTER_PREV_SERIAL SRV_FILTER_PREV_SERIAL,
                                                         Extent4.STK_CODE STK_CODE  ,
                                                         Extent4.STK_DESC STK_DESC  ,
                                                         1 C1  ,
                                                         CASE
                                                              WHEN ( Extent3.SRV_FILTER_UPD_DT IS NOT NULL ) THEN Extent3.SRV_FILTER_UPD_DT   END C2  ,
                                                         CASE
                                                              WHEN ( Extent5.USER_NAME IS NOT NULL ) THEN Extent5.USER_NAME
                                                         ELSE  ' '
                                                            END C3  ,
                                                         CASE
                                                              WHEN ( Extent7.CODE IS NOT NULL ) THEN Extent7.CODE
                                                         ELSE  ' '
                                                            END C4  ,
                                                         UTILS.CONVERT_TO_NUMBER(0,1,0) C5  ,
                                                         0 C6
                                         FROM SAL0090D Extent1
                                                JOIN SAL0002D Extent2   ON Extent1.SRV_SO_ID = Extent2.SALES_ORD_ID
                                                JOIN SAL0087D Extent3   ON Extent1.SRV_CONFIG_ID = Extent3.SRV_CONFIG_ID
                                                JOIN SYS0026M Extent4   ON Extent3.SRV_FILTER_STK_ID = Extent4.STK_ID
                                                LEFT JOIN SYS0047M Extent5   ON Extent3.SRV_FILTER_UPD_USER_ID = Extent5.USER_ID
                                                LEFT JOIN LOG0001M Extent6   ON ( Extent3.SRV_FILTER_STK_ID = Extent6.BOM_PART_ID )
                                                AND ( ( Extent2.ITM_STK_ID = Extent6.BOM_STK_ID )
                                                OR ( ( Extent2.ITM_STK_ID IS NULL )
                                                AND ( Extent6.BOM_STK_ID IS NULL ) ) )
                                                LEFT JOIN SYS0013M Extent7   ON Extent6.BOM_PART_TYPE_ID = Extent7.CODE_ID
                                          WHERE  ( 1 = Extent1.SRV_STUS_ID )
                                                   AND ( 1 = Extent3.SRV_FILTER_STUS_ID )
                                                   AND ( Extent1.SRV_SO_ID = #{salesOrdId} ) ) Distinct1
                   </select>


                 <update id="updateHsFilterSiriNo" parameterType="Map">
                            UPDATE SAL0087D
                               SET SRV_FILTER_LAST_SERIAL= #{lastSerialNo}
                                  ,SRV_FILTER_PREV_SERIAL = (select SRV_FILTER_LAST_SERIAL FROM  SAL0087D  WHERE   SRV_FILTER_ID =#{srvFilterId})
                                  ,SRV_FILTER_PRV_CHG_DT= to_date(#{settleDate}, 'DD/MM/YYYY')
                                  ,SRV_FILTER_UPD_USER_ID= #{hidCodyId}
                                  ,SRV_FILTER_UPD_DT= sysdate
                                  ,IS_RETURN = #{isReturn}
                             WHERE 1=1
                             and SRV_FILTER_ID = #{srvFilterId}
                 </update>




                    <select id="select0087DFilter" parameterType="Map" resultType="String">
                             select SRV_FILTER_LAST_SERIAL
                             from SAL0087D
                              WHERE 1=1
                             and SRV_FILTER_ID = #{srvFilterId}

                     </select>




                  <update id="updateHs009d" parameterType="Map">

                       UPDATE SAL0090D
                           <!-- SET SRV_REM = #{remark}, -->
                           <!-- [19-09-2018] AMEND PARAMETER VALUE -->
                           SET SRV_REM = #{instruction},
                               SRV_PREV_DT = to_date(#{settleDate}, 'DD/MM/YYYY'),
                               SRV_BS_WEEK = #{srvBsWeek},
                               SRV_CODY_ID = #{hidCodyId},
                               SRV_UPD_DT = sysdate
                         WHERE   SRV_SO_ID = #{hidSalesOrdId} AND SRV_STUS_ID = 1

                     </update>

                     <select id="selectBranch_id"  parameterType="Map" resultType="egovMap">
                        SELECT BRNCH_ID CODE_ID,
                                     CODE CODE_NAME
                        FROM SYS0005M
                        WHERE 1=1
                         <if test="groupCode != null and groupCode != ''">
                           AND TYPE_ID=#{groupCode}
                         </if>
                        GROUP BY BRNCH_ID,CODE ORDER BY BRNCH_ID
                    </select>

                    <select id="selectCTMByDSC_id" parameterType="Map" resultType="egovMap">
                        SELECT  A.MEM_ID CODE_ID, b.dept_code || '-' || a.NAME  AS CODE_NAME
                        FROM ORG0001D A, ORG0005D B, SYS0005M C
                        WHERE  A.MEM_ID = B.MEM_ID
                        AND    A.BRNCH  =  C.BRNCH_ID
                        AND    B.MEM_LVL = '2'
                        AND    A.STUS = '1'
                        <if test="groupCode != null and groupCode !='' ">
                               AND    C.BRNCH_ID = #{groupCode}
                        </if>

                    </select>

                    <select id="selectCheckMemCode" parameterType="Map" resultType="egovMap">
                        SELECT MEM_CODE
                        FROM ORG0001D
                        WHERE MEM_CODE = #{hscodyId}
                        AND STUS = '1'
                    </select>

                     <select id="selectSerMember" parameterType="Map" resultType="egovMap">
                            SELECT   SRV_CODY_ID
                                        , MEM_CODE
                                FROM SAL0090D A , SAL0001D B , ORG0001D C
                                WHERE A.SRV_SO_ID = B.SALES_ORD_ID
                                AND  A.SRV_CODY_ID = C.MEM_ID
                                AND B.SALES_ORD_NO =#{SRV_SO_ID}
                                 ORDER BY MEM_CODE ASC
                    </select>
                    <!-- <select id="selectHSCodyList" parameterType="Map" resultType="egovMap">
                            SELECT A.MEM_CODE CODE_ID, A.MEM_CODE || '-' ||  A.NAME CODE_NAME
                            FROM  ORG0001D A, ORG0005D B
                            WHERE A.MEM_ID = B.MEM_ID AND A.STUS =  '1' AND B.DEPT_CODE = #{codyMangrUserId} AND B.MEM_LVL = '4'
                    </select> -->

                    <select id="selectHTMemberList" parameterType="Map" resultType="egovMap">
                        SELECT DISTINCT D.MEM_CODE CODE_ID, D.MEM_CODE || '-' ||  D.NAME CODE_NAME
                        FROM (SELECT MEM_CODE, NAME, 1 AS QUERYNO
                              FROM ORG0001D
                              WHERE MEM_ID = (SELECT SRV_CODY_ID FROM SAL0090D WHERE SRV_SO_ID = (SELECT SRV_ORD_ID FROM SAL0225D WHERE SRV_ORD_NO = #{entry_orderNo}) AND SRV_STUS_ID = 1 )
                               UNION
                                SELECT A.MEM_CODE, A.NAME , 2 AS QUERYNO
                              FROM  ORG0001D A, ORG0005D B
                              WHERE A.MEM_ID = B.MEM_ID AND A.STUS =  '1' AND B.MEM_LVL = '4'
                              AND A.MEM_CODE LIKE 'HT%'
<!--                               <if test="memType != 4">
                              AND B.MEM_UP_ID = (SELECT MEM_ID FROM ORG0001D WHERE MEM_CODE = (SELECT HR_CODE FROM SYS0047M WHERE USER_ID = #{htUserId}))
                              </if> -->
                              ORDER BY MEM_CODE
                              ) D
                              ORDER BY D.MEM_CODE
                    </select>

                      <select id="selectMemberId" parameterType="Map" resultType="string">
                       select mem_id
                         from ORG0001D
                        where mem_Code = #{hscodyId}
                      </select>

                      <update id="updateSrvCodyId" parameterType="Map">

                        update
                                 (  SELECT SRV_CODY_ID
                                    FROM SAL0090D A , SAL0001D B
                                    WHERE A.SRV_SO_ID = B.SALES_ORD_ID
                                    AND B.SALES_ORD_NO =#{srvSoId}
                                 ) a
                                 SET a.SRV_CODY_ID  = #{hscodyId}

                     </update>


                     <insert id="insertCcr0001d" parameterType="Map">
                            INSERT INTO CCR0001D (
                                HC_ID
                                , HCSOID
                                , HC_CALL_ENTRY_ID
                                , HC_TYPE_NO
                                , HC_TYPE_ID
                                , HC_STUS_ID
                                , HC_COMMENT_TYPE_ID
                                , HC_COMMENT_GID
                                , HC_COMMENT_SID
                                , HC_COMMENT_DID
                                , CRT_USER_ID
                                , CRT_DT
                                , UPD_USER_ID
                                , UPD_DT
                                , HC_NO_SVC
                                , HC_LOK
                                , HC_CLOS_ID
                            )
                            VALUES(
                                CCR0001D_HC_ID_SEQ.NEXTVAL
                                , #{hcsoid}
                                , 0
                                , #{hcTypeNo}
                                , 509
                                , 33
                                , 0
                                , 0
                                , 0
                                , 0
                                , #{crtUserId}
                                , SYSDATE
                                , #{updUserId}
                                , SYSDATE
                                , 0
                                , 1
                                , 81
                            )

                     </insert>



                      <update id="saveDeactivateFilter" parameterType="Map">

                            UPDATE SAL0087D
                               SET SRV_FILTER_STUS_ID = #{srvFilterStusId} ,
                                   SRV_FILTER_UPD_DT = sysdate,
                                   SRV_FILTER_UPD_USER_ID = #{updator}
                             WHERE   SRV_FILTER_ID = #{SRV_FILTER_ID}

                     </update>




                      <update id="saveFilterUpdate" parameterType="Map">

                             UPDATE SAL0087D
                               SET SRV_FILTER_UPD_DT = sysdate,
                               <if test="SRV_FILTER_PRV_CHG_DT != null and SRV_FILTER_PRV_CHG_DT != ''">
                            SRV_FILTER_PRV_CHG_DT = to_date(#{SRV_FILTER_PRV_CHG_DT},'yyyymmdd'),
                         </if>

                                   SRV_FILTER_UPD_USER_ID = #{updator}
                             WHERE   SRV_FILTER_ID = #{SRV_FILTER_ID}


                     </update>




           <resultMap id="thSFilterUseHistoryMap" type="egovMap"></resultMap>
           <select id="selecthSFilterUseHistorycall" parameterType="Map"  statementType="CALLABLE" resultType="EgovMap">
                 {
                    call  SP_GET_ORD_FLT_USE_HIST(#{OrderID},#{SrvFilterStkId},#{cv_1, mode=OUT, jdbcType=CURSOR, javaType=ResultSet, resultMap=thSFilterUseHistoryMap})
                 }
            </select>


            <select id="isHsAlreadyResult" parameterType="Map" resultType="java.lang.Integer">
        <![CDATA[
               SELECT  COUNT(NO) CNT
               FROM  SVC0008D
               WHERE NO =#{serviceNo}  AND STUS_CODE_ID <> '1'
        ]]>
    </select>

            <select id="saveValidation" parameterType="Map" resultType="java.lang.Integer">
                SELECT COUNT(*) CNT
                FROM SVC0008D A,
                     SVC0006D B
                WHERE A.SCHDUL_ID = B.SCHDUL_ID
                AND A.NO = #{serviceNo}
            </select>

            <select id="GetDocNo"  parameterType="Map" resultType="java.lang.String">
                        select doc_no_prefix||doc_no as doc_no from SYS0022C
                        where doc_no_id = #{doctype}

              </select>

              <select id="GetDocNo1"  parameterType="Map" resultType="int">
                        select doc_no as doc_no from SYS0022C
                        where doc_no = #{nextNo}

              </select>


              <select id="selectQryBS_Rev" parameterType="Map" resultType="egovMap">
                SELECT NO,
                       SCHDUL_ID,
                       NVL (SALES_ORD_ID, 0) AS SALES_ORD_ID,
                       NVL (CODY_ID, 0) AS CODY_ID,
                       SETL_DT SETL_DT,
                       NVL (RESULT_STUS_CODE_ID, 0) AS RESULT_STUS_CODE_ID,
                       NVL (FAIL_RESN_ID, 0) AS FAIL_RESN_ID,
                       NVL (REN_COLCT_ID, 0) AS REN_COLCT_ID,
                       NVL (WH_ID, 0) AS WH_ID,
                       NVL (RESULT_REM, 0) AS RESULT_REM,
                       RESULT_STOCK_USE,
                       NVL (RESULT_ID, 0) AS RESULT_ID
                  FROM (SELECT ROW_NUMBER ()
                               OVER (PARTITION BY SCHDUL_ID, SALES_ORD_ID ORDER BY NO DESC)
                                  RNN,
                               NO,
                               SCHDUL_ID,
                               NVL (SALES_ORD_ID, 0) AS SALES_ORD_ID,
                               NVL (CODY_ID, 0) AS CODY_ID,
                               TO_CHAR (SETL_DT, 'YYYY-MM-DD') SETL_DT,
                               NVL (RESULT_STUS_CODE_ID, 0) AS RESULT_STUS_CODE_ID,
                               NVL (FAIL_RESN_ID, 0) AS FAIL_RESN_ID,
                               NVL (REN_COLCT_ID, 0) AS REN_COLCT_ID,
                               NVL (WH_ID, 0) AS WH_ID,
                               NVL (RESULT_REM, 0) AS RESULT_REM,
                               RESULT_STOCK_USE,
                               NVL (RESULT_ID, 0) AS RESULT_ID
                          FROM SVC0006D
                         WHERE SCHDUL_ID = #{ScheduleID} AND SALES_ORD_ID = #{SalesOrderId})
                 WHERE RNN = 1

          </select>

          <insert id="addbsResultMas_Rev" parameterType="Map">
                insert into svc0006d
                (RESULT_ID,
                NO,
                TYPE_ID,
                SCHDUL_ID,
                SALES_ORD_ID,
                CODY_ID,
                SETL_DT,
                RESULT_STUS_CODE_ID,
                FAIL_RESN_ID,
                REN_COLCT_ID,
                WH_ID,
                RESULT_REM,
                RESULT_CRT_DT,
                RESULT_CRT_USER_ID,
                RESULT_IS_SYNC,
                RESULT_IS_EDIT,
                RESULT_STOCK_USE,
                RESULT_IS_CURR,
                RESULT_MTCH_ID,
                RESULT_IS_ADJ
                )
                values
                (
                   #{ResultID},
                #{No}
                ,#{TypeID}
                ,#{ScheduleID}
                ,#{SalesOrderId}
                ,#{CodyID}
                ,TO_DATE(#{SettleDate},'YYYY-MM-DD')
                ,#{ResultStatusCodeID}
                ,#{FailReasonID}
                ,#{RenCollectionID}
                ,#{WarehouseID}
                ,#{ResultRemark}
                ,sysdate
                ,#{ResultCreator}
                ,#{ResultIsSync}
                ,#{ResultIsEdit}
                ,#{ResultStockUse}
                ,#{ResultIsCurrent}
                ,#{ResultMatchID}
                ,#{ResultIsAdjust}
                )
          </insert>

          <select id="selectQryResultDet" parameterType="Map" resultType="egovMap">

            select BS_RESULT_PART_ID
                ,BS_RESULT_PART_DESC
                ,BS_RESULT_PART_QTY
                ,BS_RESULT_REM
                ,BS_RESULT_FILTER_CLM
          from SVC0007D
         where BS_RESULT_ID = #{ResultMatchID}
         order by BS_RESULT_ITM_ID

          </select>

          <select id="getBSResultM_resultID" parameterType="Map" resultType="int">
                select    SVC0006D_RESULT_ID_SEQ.nextval  result_id from dual
          </select>

          <insert id="addbsResultDet_Rev" parameterType="Map">
          insert into svc0007d
            (BS_RESULT_ITM_ID
            ,BS_RESULT_ID
            ,BS_RESULT_PART_ID
            ,BS_RESULT_PART_DESC
            ,BS_RESULT_PART_QTY
            ,BS_RESULT_REM
            ,BS_RESULT_CRT_DT
            ,BS_RESULT_CRT_USER_ID
            ,BS_RESULT_FILTER_CLM
            ,SERIAL_NO
            )
            values
            (
            SVC0007D_BS_RESULT_ITM_ID_SEQ.nextval
            ,#{BSResultID}
            ,#{BSResultPartID}
            ,nvl(#{BSResultPartDesc},'')
            ,#{BSResultPartQty}
            ,nvl(#{BSResultRemark},'')
            ,sysdate
            ,#{BSResultCreateBy}
            ,nvl(#{BSResultFilterClaim},0)
            ,nvl(#{SerialNo}, '')
            )
          </insert>

          <select id="selectQry_stkReqM" parameterType="Map" resultType="egovMap">

            select STK_REQ_LOC_FROM_ID,STK_REQ_LOC_TO_ID
                    ,STK_REQ_REM
              from LOG0016D a
                  ,LOG0015D b
             where REQ_ITM_REF_ID = #{ResultMatchID}
               and REQ_ITM_TYPE_ID = 458
               and REQ_ITM_STUS_ID = 4
               and a.REQ_ID = b.STK_REQ_ID
               and rownum = 1

          </select>

          <insert id="addstkReqM_Rev" parameterType="Map">
          insert into LOG0015D
            (STK_REQ_ID
            ,STK_REQ_NO
            ,STK_REQ_LOC_FROM_ID
            ,STK_REQ_LOC_TO_ID
            ,STK_REQ_REM
            ,STK_REQ_CRT_USER_ID
            ,STK_REQ_CRT_DT
            )
            values
            (
            LOG0015D_STK_REQ_ID_SEQ.nextval
            ,#{StkReqNo}
            ,#{StkReqLocFromID}
            ,#{StkReqLocToID}
            ,#{StkReqRemark}
            ,sysdate
            ,#{StkReqCreateBy}
            )
          </insert>

          <select id="getMobileWarehouseByMemID" parameterType="Map" resultType="int">
                select wh_loc_id
                  from SYS0028M a
                       ,ORG0001D b
                 where WH_LOC_TYPE_ID = 278
                   and b.MEM_CODE = a.WH_LOC_CODE
                   and b.MEM_ID = #{codyId}
          </select>

          <select id="selectQryBS" parameterType="Map" resultType="egovMap">
            select no,sales_ord_id
              from SVC0008D
             where SCHDUL_ID = #{ScheduleID}
               and rownum = 1
          </select>

          <select id="qry_stkReqD_Rev" parameterType="Map" resultType="egovMap">
            select BS_RESULT_PART_ID
                ,BS_RESULT_PART_DESC
                ,BS_RESULT_PART_QTY
                ,BS_RESULT_REM
                ,BS_RESULT_FILTER_CLM
          from SVC0007D
         where BS_RESULT_ID = #{ResultMatchID}
           and BS_RESULT_PART_ID !=0
           and BS_RESULT_PART_QTY >0
         order by BS_RESULT_ITM_ID
          </select>

          <select id="getStkReqM_StkReqID" parameterType="Map" resultType="int">
                select max(STK_REQ_ID) STK_REQ_ID from LOG0015D
          </select>

          <insert id="addStkReqD_Rev" parameterType="Map">

          insert into LOG0016D
            (REQ_ITM_ID
            ,REQ_ID
            ,REQ_ITM_TYPE_ID
            ,REQ_ITM_REF_ID
            ,REQ_ITM_STK_ID
            ,REQ_ITM_STK_DESC
            ,REQ_ITM_QTY
            ,REQ_ITM_STUS_ID
            ,REQ_ITM_REM
            )
            values
            (
            LOG0016D_REQ_ITM_ID_SEQ.nextval
            ,#{ReqID}
            ,#{ReqItemTypeID}
            ,#{ReqItemRefID}
            ,#{ReqItemStkID}
            ,#{ReqItemStkDesc}
            ,#{ReqItemQty}
            ,#{ReqItemStatusID}
            ,#{ReqItemRemark}
            )
          </insert>

          <insert id="addStkCrd_Rev" parameterType="Map">
          insert into LOG0014D
            (SR_CARD_ID
            ,LOC_ID
            ,STOCK_ID
            ,ENTRY_DT
            ,TYPE_ID
            ,REF_NO
            ,SALES_ORD_ID
            ,ITM_NO
            ,SRC_ID
            ,PRJCT_ID
            ,BATCH_NO
            ,QTY
            ,CURR_ID
            ,CURR_RATE
            ,COST
            ,PRC
            ,REM
            ,SERIAL_NO
            ,INSTALL_NO
            ,COST_DT
            ,APP_TYPE_ID
            ,STK_GRAD
            ,INSTALL_FAIL
            ,IS_SYNCH
            ,ENTRY_MTH_ID
            ,ORGN
            )
            values
            (
            LOG0014D_SR_CARD_ID_SEQ.nextval
            ,#{LocationID}
            ,#{StockID}
            ,sysdate
            ,#{TypeID}
            ,#{RefNo}
            ,#{SalesOrderId}
            ,#{ItemNo}
            ,#{SourceID}
            ,#{ProjectID}
            ,#{BatchNo}
            ,#{Qty}
            ,#{CurrID}
            ,#{CurrRate}
            ,#{Cost}
            ,#{Price}
            ,#{Remark}
            ,#{SerialNo}
            ,#{InstallNo}
            ,sysdate
            ,#{AppTypeID}
            ,#{StkGrade}
            ,#{InstallFail}
            ,#{IsSynch}
            ,#{EntryMethodID}
            ,#{Origin}
            )
          </insert>

          <update id="updateQry_CurBS" parameterType="Map">
          update SVC0006D
           set RESULT_IS_CURR = 1
              ,RESULT_UPD_DT = sysdate
              ,RESULT_UPD_USER_ID = #{userId}
        where schdul_id = #{ScheduleID}
        and RESULT_IS_CURR = 0
        and SALES_ORD_ID = #{SalesOrderId}
          </update>


          <update id="updateQry_CurBSZero" parameterType="Map">
          update SVC0006D
           set RESULT_IS_CURR = 0
              ,RESULT_UPD_DT = sysdate
              ,RESULT_UPD_USER_ID = #{userId}
            where schdul_id = #{ScheduleID}
            and RESULT_IS_CURR = 1
            and  result_id not in(
                                         select max(result_id)
                                         from SVC0006D
                                         where SCHDUL_ID  = #{ScheduleID}
                                   )
          </update>

          <select id="selectResultId" parameterType="Map"  resultType="egovMap">
             select max(result_id) result_id
             from SVC0006D
             where SCHDUL_ID  = #{ScheduleID}
             and  RESULT_IS_CURR = 1


          </select>

          <update id="updateQry_New" parameterType="Map">
          update SYS0022C
           set DOC_NO = #{nextDocNo_New}
        where DOC_NO_ID = #{ID_New}
          </update>

          <insert id="addbsResultMas" parameterType="Map">
          insert into SVC0006D
            (RESULT_ID
            ,NO
            ,TYPE_ID
            ,SCHDUL_ID
            ,SALES_ORD_ID
            ,CODY_ID
            ,SETL_DT
            ,RESULT_STUS_CODE_ID
            ,FAIL_RESN_ID
            ,REN_COLCT_ID
            ,WH_ID
            ,RESULT_REM
            ,RESULT_CRT_DT
            ,RESULT_CRT_USER_ID
            ,RESULT_UPD_DT
            ,RESULT_UPD_USER_ID
            ,RESULT_IS_SYNC
            ,RESULT_IS_EDIT
            ,RESULT_STOCK_USE
            ,RESULT_IS_CURR
            ,RESULT_MTCH_ID
            ,RESULT_IS_ADJ
            ,NEXT_APPNT_DT
			,NEXT_APPNT_TM
            )
            values
            (
            #{ResultId}
            ,#{No}
            ,#{TypeID}
            ,#{ScheduleID}
            ,#{SalesOrderId}
            ,#{CodyID}
            ,TO_DATE(#{SettleDate},'DD/MM/YYYY')
            ,#{ResultStatusCodeID}
            ,#{FailReasonID}
            ,#{RenCollectionID}
            ,#{WarehouseID}
            ,#{ResultRemark}
            ,sysdate
            ,#{ResultCreator}
            ,sysdate
            ,#{ResultCreator}
            ,#{ResultIsSync}
            ,#{ResultIsEdit}
            ,#{ResultStockUse}
            ,#{ResultIsCurrent}
            ,#{ResultMatchID}
            ,#{ResultIsAdjust}
            ,#{nextAppntDt}
		    ,#{nextAppntTime}
            )
          </insert>

          <update id="updatebsResultMas" parameterType="Map">
            UPDATE SVC0006D
            SET SETL_DT = TO_DATE( NVL(#{SettleDate},'01/01/1900'), 'DD/MM/YYYY'),
                RESULT_STUS_CODE_ID = #{ResultStatusCodeID},
                FAIL_RESN_ID = NVL(#{FailReasonID},'0'),
                REN_COLCT_ID = #{RenCollectionID},
                RESULT_REM = #{ResultRemark},
                RESULT_STOCK_USE = #{ResultStockUse},
				RESULT_UPD_DT =		SYSDATE,
				RESULT_UPD_USER_ID = #{ResultCreator}
 				, NEXT_APPNT_DT = #{nextAppntDt}
				, NEXT_APPNT_TM = #{nextAppntTime}
            WHERE SCHDUL_ID = #{ScheduleID}
            AND RESULT_IS_CURR = 1
          </update>

          <update id="updateQrySchedule" parameterType="Map">
          update SVC0008D
               set STUS_CODE_ID = #{ResultStatusCodeID}
                  ,ACTN_MEM_ID = #{CodyID}
            where SCHDUL_ID = #{ScheduleID}
          </update>

          <update id="updateQryConfig" parameterType="Map">
          update SAL0090D
           <!--  set SRV_REM = #{ResultRemark}-->
           <!-- [19-09-2018] AMEND PARAMETER VALUE -->
           set SRV_REM = #{ResultInstRemark}
              ,SRV_BS_WEEK = #{bsPreferWeek}
        where SRV_STUS_ID = 1
          and SRV_SO_ID =#{SalesOrderId}
          </update>

          <update id="updateQryConfig4" parameterType="Map">
          update SAL0090D
           <!-- set SRV_REM = #{ResultRemark} -->
           <!-- [19-09-2018] AMEND PARAMETER VALUE -->
           set SRV_REM = #{ResultInstRemark}
              ,SRV_PREV_DT = TO_DATE(#{SettleDate}, 'DD/MM/YYYY')
              ,SRV_BS_WEEK = #{bsPreferWeek}
        where SRV_STUS_ID = 1
          and SRV_SO_ID =#{SalesOrderId}
          </update>

          <select id="selectLocationID" parameterType="Map" resultType="int">
            select B.WH_LOC_ID
              from org0001d a
                  ,SYS0028M b
             where mem_id = #{CodyID}
               and b.WH_LOC_CODE = a.MEM_CODE
          </select>

          <select id="selectQrySchedule" parameterType="Map" resultType="egovMap">
          select no from SVC0008D
            where SCHDUL_ID = #{ScheduleID}
          </select>

          <insert id="addStkCrd_new" parameterType="Map">
          insert into log0014d
            (
            SR_CARD_ID
            ,LOC_ID
            ,STOCK_ID
            ,ENTRY_DT
            ,TYPE_ID
            ,REF_NO
            ,SALES_ORD_ID
            ,ITM_NO
            ,SRC_ID
            ,PRJCT_ID
            ,BATCH_NO
            ,QTY
            ,CURR_ID
            ,CURR_RATE
            ,COST
            ,PRC
            ,REM
            ,SERIAL_NO
            ,INSTALL_NO
            ,COST_DT
            ,APP_TYPE_ID
            ,STK_GRAD
            ,INSTALL_FAIL
            ,IS_SYNCH
            ,ENTRY_MTH_ID
            ,ORGN
            )
            values
            (
            LOG0014D_SR_CARD_ID_SEQ.nextval
            ,#{LocationID}
            ,#{StockID}
            ,sysdate
            ,#{TypeID}
            ,#{RefNo}
            ,#{SalesOrderId}
            ,#{ItemNo}
            ,#{SourceID}
            ,#{ProjectID}
            ,#{BatchNo}
            ,#{Qty}
            ,#{CurrID}
            ,#{CurrRate}
            ,#{Cost}
            ,#{Price}
            ,#{Remark}
            ,#{SerialNo}
            ,#{InstallNo}
            ,to_date(#{CostDate},'YYYY-MM-DD')
            ,#{AppTypeID}
            ,#{StkGrade}
            ,#{InstallFail}
            ,#{IsSynch}
            ,#{EntryMethodID}
            ,#{Origin}
            )
          </insert>

          <select id="selectQryConfig" parameterType="Map" resultType="egovMap">
          select SRV_CONFIG_ID
              from SAL0090D
             where SRV_STUS_ID = 1
               and SRV_SO_ID = #{SalesOrderId}
          </select>

          <update id="updateQryFilter" parameterType="Map">
          update SAL0087D
            set SRV_FILTER_PRV_CHG_DT =  to_date(#{SettleDate},'DD/MM/YYYY')
               ,SRV_FILTER_UPD_DT = sysdate
               ,SRV_FILTER_UPD_USER_ID = #{ResultCreator}
            where SRV_CONFIG_ID = #{SrvConfigID}
              and SRV_FILTER_STUS_ID = 1
              and SRV_FILTER_STK_ID = #{BSResultPartID}
          </update>

          <insert id="addBsResultDet_NoFilter" parameterType="Map">
            insert into SVC0007D
                (BS_RESULT_ITM_ID
                ,BS_RESULT_ID
                ,BS_RESULT_PART_ID
                ,BS_RESULT_PART_DESC
                ,BS_RESULT_PART_QTY
                ,BS_RESULT_REM
                ,BS_RESULT_CRT_DT
                ,BS_RESULT_CRT_USER_ID
                ,BS_RESULT_FILTER_CLM
                )
                values
                (SVC0007D_BS_RESULT_ITM_ID_SEQ.nextval
                ,#{BSResultID}
                ,#{BSResultPartID}
                ,#{BSResultPartDesc}
                ,#{BSResultPartQty}
                ,#{BSResultRemark}
                ,sysdate
                ,#{BSResultCreateBy}
                ,#{BSResultFilterClaim}
                )
          </insert>


       <select id="selectHsOrderInMonth" parameterType="Map" resultType="egovMap">
         SELECT  SALES_ORD_ID
         FROM  SVC0008D
         WHERE 1=1
         AND YEAR(+) = #{myBSYear}
         AND Month(+) = #{myBSMonth}
         AND SALES_ORD_ID IN (
              #{saleOrdIdList}
         )

        </select>





                 <select id="hSMgtResultViewResult" parameterType="Map" resultType="egovMap">
                   <![CDATA[
                             SELECT Limit1.RESULT_ID RESULT_ID  ,
                                   Limit1.SALES_ORD_ID SALES_ORD_ID  ,
                                   Limit1.SALES_ORD_NO SALES_ORD_NO  ,
                                   Limit1.NO1 NO  ,
                                   Limit1.MONTH MONTH  ,
                                   Limit1.YEAR YEAR  ,
                                   Limit1.NO NO1  ,
                                   Limit1.STUS_CODE_ID STUS_CODE_ID  ,
                                   Limit1.CODE CODE  ,
                                   (Limit1.SETL_DT) C1  ,
                                   Limit1.REN_COLCT_ID REN_COLCT_ID  ,
                                   Limit1.CODE1 CODE1  ,
                                   Limit1.RESN_DESC RESN_DESC  ,
                                   CASE
                                        WHEN ( Limit1.SRV_REM IS NOT NULL ) THEN Limit1.SRV_REM
                                   ELSE ''
                                      END C2  ,
                                   Limit1.CODY_ID CODY_ID  ,
                                   Limit1.MEM_CODE MEM_CODE  ,
                                   Limit1.NAME NAME  ,
                                   Limit1.FAIL_RESN_ID FAIL_RESN_ID  ,
                                   Limit1.CODE2 CODE2  ,
                                   Limit1.REASONDESC1 REASONDESC1  ,
                                   Limit1.WH_LOC_CODE WH_LOC_CODE  ,
                                   Limit1.WH_LOC_DESC WH_LOC_DESC  ,
                                   Limit1.RESULT_REM RESULT_REM  ,
                                   Limit1.USER_NAME USER_NAME  ,
                                   Limit1.RESULT_CRT_DT RESULT_CRT_DT  ,
                                   Limit1.RESULT_IS_CURR RESULT_IS_CURR  ,
                                   Limit1.REN_COLCT_desc
                              FROM ( SELECT Extent1.RESULT_ID RESULT_ID  ,
                                            Extent1.NO NO  ,
                                            Extent1.SALES_ORD_ID SALES_ORD_ID  ,
                                            Extent1.CODY_ID CODY_ID  ,
                                            Extent1.SETL_DT SETL_DT  ,
                                            Extent1.FAIL_RESN_ID FAIL_RESN_ID  ,
                                            Extent1.REN_COLCT_ID REN_COLCT_ID  ,
                                           (SELECT RESN_DESC
                                                From SYS0032M where 174 = resn_type_id  and resn_id = Extent1.REN_COLCT_ID ) REN_COLCT_desc ,
                                            Extent1.RESULT_REM RESULT_REM  ,
                                            Extent1.RESULT_CRT_DT RESULT_CRT_DT  ,
                                            Extent1.RESULT_IS_CURR RESULT_IS_CURR  ,
                                            Extent2.NO NO1  ,
                                            Extent2.MONTH MONTH  ,
                                            Extent2.YEAR YEAR  ,
                                            Extent3.SALES_ORD_NO SALES_ORD_NO  ,
                                            Extent4.SRV_REM SRV_REM  ,
                                            Extent5.STUS_CODE_ID STUS_CODE_ID  ,
                                            Extent5.CODE CODE  ,
                                            Extent6.CODE CODE1  ,
                                            Extent6.RESN_DESC RESN_DESC  ,
                                            Extent7.MEM_CODE MEM_CODE  ,
                                            Extent7.NAME NAME  ,
                                            Extent8.CODE CODE2  ,
                                            Extent8.RESN_DESC REASONDESC1  ,
                                            Extent9.WH_LOC_CODE WH_LOC_CODE  ,
                                            Extent9.WH_LOC_DESC WH_LOC_DESC  ,
                                            Extent10.USER_FULL_NAME USER_NAME
                                     FROM SVC0006D Extent1
                                            JOIN SVC0008D Extent2   ON Extent2.SCHDUL_ID = Extent1.SCHDUL_ID
                                            JOIN SAL0001D Extent3   ON Extent3.SALES_ORD_ID = Extent2.SALES_ORD_ID
                                            JOIN SAL0090D Extent4   ON ( Extent4.SRV_SO_ID = Extent3.SALES_ORD_ID )
                                            AND ( 1 = Extent4.SRV_STUS_ID )
                                            JOIN SYS0038M Extent5   ON Extent5.STUS_CODE_ID = Extent1.RESULT_STUS_CODE_ID
                                            LEFT JOIN SYS0032M Extent6   ON Extent6.RESN_ID = Extent1.REN_COLCT_ID
                                            LEFT JOIN ORG0001D Extent7   ON Extent7.MEM_ID = Extent1.CODY_ID
                                            LEFT JOIN SYS0032M Extent8   ON Extent8.RESN_ID = Extent1.FAIL_RESN_ID
                                            LEFT JOIN SYS0028M Extent9   ON Extent9.WH_LOC_ID = Extent1.WH_ID
                                            LEFT JOIN SYS0047M Extent10   ON Extent10.USER_ID = Extent1.RESULT_CRT_USER_ID
                                      WHERE  Extent1.RESULT_ID = #{MresultId} AND ROWNUM <= 1 ) Limit1
                        ]]>
                            </select>



                 <select id="hSMgtResultViewResultFilter" parameterType="Map" resultType="egovMap">
                   <![CDATA[
                        SELECT Distinct1.C1 C1  ,
                               Distinct1.STK_ID STK_ID  ,
                               Distinct1.STK_CODE STK_CODE  ,
                               Distinct1.STK_DESC STK_DESC  ,
                               Distinct1.BS_RESULT_PART_QTY BS_RESULT_PART_QTY  ,
                               Distinct1.BS_RESULT_FILTER_CLM BS_RESULT_FILTER_CLM
                          FROM ( SELECT DISTINCT Extent1.BS_RESULT_PART_QTY BS_RESULT_PART_QTY  ,
                                                 decode(Extent1.BS_RESULT_FILTER_CLM,'0','X','O') BS_RESULT_FILTER_CLM  ,
                                                 Extent2.STK_ID STK_ID  ,
                                                 Extent2.STK_CODE STK_CODE  ,
                                                 Extent2.STK_DESC STK_DESC  ,
                                                 1 C1
                                 FROM SVC0007D Extent1
                                        JOIN SYS0026M Extent2   ON Extent1.BS_RESULT_PART_ID = Extent2.STK_ID
                                  WHERE  ( Extent1.BS_RESULT_ID = #{MresultId} )
                                           AND ( Extent1.BS_RESULT_PART_QTY > 0 )
                                           AND ( 0 <> Extent1.BS_RESULT_PART_ID ) ) Distinct1

                        ]]>
                            </select>


       <select id="assignDeptMemUp" parameterType="Map" resultType="egovMap">
        SELECT MEM_ID, MEM_UP_ID, DEPT_CODE, BRNCH_ID
        FROM ORG0005D
        <if test="deptList != null and deptList != ''">
            WHERE DEPT_CODE IN
           <foreach item="item" collection="deptListSpl" index="index" open="(" separator="," close=")">
            #{item}
           </foreach>
        </if>
        AND MEM_LVL = '3'
       </select>


    <select id="selectCMList" parameterType="Map" resultType="egovMap">
    SELECT * FROM (
    SELECT A.DEPT_CODE AS CODE_ID, A.DEPT_CODE || '-' || B.NAME AS CODE_NAME
    FROM ORG0005D A, ORG0001D B, SYS0005M C
    WHERE A.MEM_ID   = B.MEM_ID
    AND A.BRNCH_ID   = C.BRNCH_ID
    AND A.DEPT_CODE IS NOT NULL
    AND B.MEM_TYPE   = 2
    AND A.MEM_LVL    = '3'
    AND A.BRNCH_ID   = #{groupCode}
    AND B.STUS       = '1'

    <if test = "groupCode == '151'.toString() ">
               UNION
                     SELECT A.DEPT_CODE AS CODE_ID
                    ,A.DEPT_CODE || '-' || B.NAME AS CODE_NAME
                    /*,B.MEM_CODE || '-' || B.NAME AS CODE_NAME*/
            FROM ORG0005D A
                    ,ORG0001D B
                    ,SYS0005M C
            WHERE A.MEM_ID = B.MEM_ID
                AND A.BRNCH_ID = C.BRNCH_ID
                AND A.DEPT_CODE IS NOT NULL
                AND A.BRNCH_ID = '151'
                AND B.STUS = '1'
            </if>

    ) PROJECT
    ORDER BY CODE_NAME
    </select>




     <select id="hsResultSync" parameterType="Map" resultType="java.lang.Integer">
        <![CDATA[
                 SELECT   COUNT(*) CNT
                 FROM SVC0008D  A,
                      ORG0001D B
                 WHERE  NO =#{serviceNo}
                    AND A.CODY_ID = B.MEM_ID
                    AND B.MEM_CODE =#{userId}
        ]]>
    </select>

            <update id="updateInstRemark" parameterType="Map">
     <![CDATA[
        update SAL0045D
           set INSTCT = #{instct}
              ,UPD_DT = sysdate
              ,UPD_USER_ID = #{userId}
         where SALES_ORD_ID = #{SalesOrderId}
        ]]>
    </update>


    <select id="getASEntryDocNo" parameterType="Map" resultType="egovMap">
       <![CDATA[
                SELECT FN_GET_DOCNO(#{DOCNO})  asno  FROM DUAL
        ]]>
    </select>


    <select id="getASEntryId" parameterType="Map" resultType="egovMap">
       <![CDATA[

                 SELECT  SVC0001D_AS_ID_SEQ.nextval   seq FROM DUAL

        ]]>
    </select>

    <insert id="insertSVC0001D" parameterType="Map">
       <![CDATA[
       INSERT INTO SVC0001D (
                           AS_ID, AS_NO, AS_SO_ID,
                           AS_MEM_ID, AS_MEM_GRP, AS_REQST_DT,
                           AS_REQST_TM, AS_APPNT_DT, AS_APPNT_TM,
                           AS_BRNCH_ID, AS_MALFUNC_ID, AS_MALFUNC_RESN_ID,
                           AS_REM_REQSTER, AS_REM_REQSTER_CNTC, AS_CALLLOG_ID,
                           AS_STUS_ID, AS_SMS, AS_CRT_USER_ID,
                           AS_CRT_DT, AS_UPD_USER_ID, AS_UPD_DT,
                           AS_ENTRY_IS_SYNCH, AS_ENTRY_IS_EDIT, AS_TYPE_ID,
                           AS_REQSTER_TYPE_ID, AS_IS_BS_WITHIN_30DAYS, AS_ALLOW_COMM,
                           AS_PREV_MEM_ID, AS_REM_ADD_CNTC, AS_REM_REQSTER_CNTC_SMS,
                           AS_REM_ADD_CNTC_SMS, AS_SESION_CODE, CALL_MEM,
                           REF_REQST, NO
                         )
                        VALUES (
                           #{AS_ID},
                           #{AS_NO},
                           #{AS_SO_ID},
                           #{AS_MEM_ID},
                           #{AS_MEM_GRP},
                           TO_DATE(#{AS_REQST_DT},'DD/MM/YYYY'),
                           #{AS_REQST_TM},
                           TO_DATE(#{AS_APPNT_DT},'DD/MM/YYYY'),
                           #{AS_APPNT_TM},
                           #{AS_BRNCH_ID},
                           #{AS_MALFUNC_ID},
                           #{AS_MALFUNC_RESN_ID},
                           #{AS_REM_REQSTER},
                           #{AS_REM_REQSTER_CNTC},
                           #{AS_CALLLOG_ID},
                           #{AS_STUS_ID},
                           #{AS_SMS},
                           #{USER_ID},
                           SYSDATE,
                           #{USER_ID},
                           SYSDATE,
                           #{AS_ENTRY_IS_SYNCH},
                           #{AS_ENTRY_IS_EDIT},
                           #{AS_TYPE_ID},
                           #{AS_REQSTER_TYPE_ID},
                           #{AS_IS_BS_WITHIN_30DAYS},
                           #{AS_ALLOW_COMM},
                           #{AS_PREV_MEM_ID},
                           #{AS_REM_ADD_CNTC},
                           #{AS_REM_REQSTER_CNTC_SMS},
                           #{AS_REM_ADD_CNTC_SMS},
                           #{AS_SESION_CODE},
                           #{CALL_MEMBER},
                           #{REF_REQUEST},
                           #{NO}
                           )
        ]]>
    </insert>

    <insert id="insertSVC0003D" parameterType="Map">
       <![CDATA[
                           INSERT INTO  SVC0003D (
                                               AS_PIC_ID, AS_ID, PIC_NAME,
                                               PIC_CNTC, CRT_DT, CRT_USER_ID)
                               VALUES ( SVC0003D_AS_PIC_ID_SEQ.NEXTVAL , #{AS_ID} , #{PIC_NAME},
                                               #{PIC_CNTC},SYSDATE , #{USER_ID})
        ]]>
    </insert>

    <insert id="updateStateSVC0001D" parameterType="Map">
        UPDATE SVC0001D
        SET AS_STUS_ID =#{AS_RESULT_STUS_ID},
        AS_UPD_USER_ID =#{USER_ID},
        AS_UPD_DT =SYSDATE
        WHERE AS_ID =#{AS_ENTRY_ID}
    </insert>


    <insert id="insertSVC0004D" parameterType="Map">

        INSERT INTO SVC0004D (
        AS_RESULT_ID,
        AS_RESULT_NO,
        AS_ENTRY_ID,
        AS_SO_ID,
        AS_CT_ID,
        AS_SETL_DT,
        AS_SETL_TM,
        AS_RESULT_STUS_ID,
        AS_FAIL_RESN_ID,
        AS_REN_COLCT_ID,
        AS_CMMS,
        AS_BRNCH_ID,
        AS_WH_ID,
        AS_RESULT_REM,
        AS_RESULT_CRT_DT,
        AS_RESULT_CRT_USER_ID,
        AS_MALFUNC_ID,
        AS_MALFUNC_RESN_ID,
        AS_DEFECT_TYPE_ID,
        AS_DEFECT_GRP_ID,
        AS_DEFECT_ID,
        AS_DEFECT_PART_GRP_ID,
        AS_DEFECT_PART_ID,
        AS_DEFECT_DTL_RESN_ID,
        AS_SLUTN_RESN_ID,
        AS_WORKMNSH,
        AS_FILTER_AMT,
        AS_ACSRS_AMT,
        AS_TOT_AMT,
        AS_RESULT_IS_SYNCH,
        AS_RCALL,
        AS_RESULT_STOCK_USE,
        AS_RESULT_TYPE_ID,
        AS_RESULT_IS_CURR,
        AS_RESULT_MTCH_ID,
        AS_RESULT_NO_ERR,
        AS_RESULT_UPD_DT,
        AS_RESULT_UPD_USER_ID,
        AS_ENTRY_POINT,
        AS_WORKMNSH_TAX_CODE_ID,
        AS_WORKMNSH_TXS,
        AS_RESULT_MOBILE_ID,
        APPNT_DT,
        APPNT_TM,
        IN_HUSE_REPAIR_REM,
        IN_HUSE_REPAIR_REPLACE_YN,
        IN_HUSE_REPAIR_PROMIS_DT,
        IN_HUSE_REPAIR_GRP_CODE,
        IN_HUSE_REPAIR_PRODUCT_CODE,
        IN_HUSE_REPAIR_SERIAL_NO,
        RESULT_CUST_NAME,
        RESULT_MOBILE_NO,
        RESULT_REP_EMAIL_NO,
        RESULT_ACEPT_NAME,
        SGN_DT,
        TRNSC_ID,
        NO
        )
        VALUES (
        #{AS_RESULT_ID},
        #{AS_RESULT_NO},
        #{AS_ENTRY_ID},
        #{AS_SO_ID},
        #{AS_CT_ID},
        to_DATE(#{AS_SETL_DT},'dd/mm/yyyy'),
        #{AS_SETL_TM},
        NVL(#{AS_RESULT_STUS_ID},0),
        NVL(#{AS_FAIL_RESN_ID},0),
        NVL(#{AS_REN_COLCT_ID},0),
        NVL(#{AS_CMMS},0),
        NVL(#{AS_BRNCH_ID},0),
        NVL(#{AS_WH_ID},0),
        #{AS_RESULT_REM},
        sysdate,
        #{updator},
        NVL(#{AS_MALFUNC_ID},0),
        NVL(#{AS_MALFUNC_RESN_ID},0),
        NVL(#{AS_DEFECT_TYPE_ID},0),
        NVL(#{AS_DEFECT_GRP_ID},0),
        NVL(#{AS_DEFECT_ID},0),
        NVL(#{AS_DEFECT_PART_GRP_ID},0),
        NVL(#{AS_DEFECT_PART_ID},0),
        NVL(#{AS_DEFECT_DTL_RESN_ID},0),
        NVL(#{AS_SLUTN_RESN_ID},0),
        NVL(#{AS_WORKMNSH},0),
        NVL((#{AS_FILTER_AMT}),0),
        NVL(#{AS_ACSRS_AMT},0),
        NVL((#{AS_TOT_AMT}),0),
        NVL(#{AS_RESULT_IS_SYNCH},0),
        NVL(#{AS_RCALL},0),
        NVL(#{AS_RESULT_STOCK_USE},0),
        NVL(#{AS_RESULT_TYPE_ID},0),
        #{AS_RESULT_IS_CURR},
        #{AS_RESULT_MTCH_ID},
        #{AS_RESULT_NO_ERR},
        sysdate,
        #{updator},
        NVL(#{AS_ENTRY_POINT},0),
        NVL(#{AS_WORKMNSH_TAX_CODE_ID},0),
        NVL(#{AS_WORKMNSH_TXS},0),
        #{AS_RESULT_MOBILE_ID},
        to_date(#{APPNT_DT},'dd/mm/yyyy'),
        #{APPNT_TM},
        #{IN_HUSE_REPAIR_REM},
        #{IN_HUSE_REPAIR_REPLACE_YN},
        to_date(#{IN_HUSE_REPAIR_PROMIS_DT},'dd/mm/yyyy'),
        #{IN_HUSE_REPAIR_GRP_CODE},
        #{IN_HUSE_REPAIR_PRODUCT_CODE},
        #{IN_HUSE_REPAIR_SERIAL_NO},
        #{RESULT_CUST_NAME},
        #{RESULT_MOBILE_NO},
        #{RESULT_REP_EMAIL_NO},
        #{RESULT_ACEPT_NAME},
        #{SGN_DT},
        #{TRNSC_ID},
        #{NO}
        )
    </insert>

    <select id="getResultASEntryId" parameterType="Map" resultType="egovMap">
       <![CDATA[
                SELECT SVC0004D_AS_RESULT_ID_SEQ.NEXTVAL seq FROM DUAL
        ]]>
    </select>


    <insert id="insertSVC0005D" parameterType="Map">
        INSERT INTO SVC0005D (
        ASR_ITM_ID,
        AS_RESULT_ID,
        ASR_ITM_PART_ID,
        ASR_ITM_PART_DESC,
        ASR_ITM_PART_QTY,
        ASR_ITM_PART_PRC,
        ASR_ITM_CHRG_AMT,
        ASR_ITM_REM,
        ASR_ITM_CRT_USER_ID,
        ASR_ITM_CRT_DT,
        ASR_ITM_CHRG_FOC,
        ASR_ITM_EXCHG_ID,
        ASR_ITM_CLM,
        ASR_ITM_TAX_CODE_ID,
        ASR_ITM_TXS_AMT
        <!-- SERIAL_NO, EXCHN_ID, FILTER_BARCD_SERIAL_NO -->
        )
        VALUES (
        SVC0005D_ASR_ITM_ID_SEQ.nextval,
        #{AS_RESULT_ID},
        #{ASR_ITM_PART_ID},
        #{ASR_ITM_PART_DESC},
        #{ASR_ITM_PART_QTY},
        nvl(#{ASR_ITM_PART_PRC},0),
        nvl(#{ASR_ITM_CHRG_AMT},0),
        #{ASR_ITM_REM},
        #{ASR_ITM_CRT_USER_ID},
        sysdate,
        #{ASR_ITM_CHRG_FOC},
        #{ASR_ITM_EXCHG_ID},
        #{ASR_ITM_CLM},
        #{ASR_ITM_TAX_CODE_ID},
        nvl(#{ASR_ITM_TXS_AMT},0)
        <!-- #{SERIAL_NO}, #{EXCHG_ID}, #{FILTER_BARCD_SERIAL_NO} -->
        )
    </insert>


    <select id="getBSFilterInfo" parameterType="Map" resultType="egovMap">
            <![CDATA[
                            SELECT Distinct1.C1 C1  ,
                                   Distinct1.NO NO  ,
                                   Distinct1.RESULT_IS_CURR RESULT_IS_CURR  ,
                                   Distinct1.STK_ID STK_ID  ,
                                   Distinct1.STK_CODE STK_CODE  ,
                                   Distinct1.STK_DESC STK_DESC  ,
                                   Distinct1.BS_RESULT_FILTER_CLM BS_RESULT_FILTER_CLM  ,
                                   Distinct1.RESULT_CRT_DT RESULT_CRT_DT  ,
                                   Distinct1.BS_RESULT_PART_QTY BS_RESULT_PART_QTY  ,
                                   Distinct1.USER_NAME USER_NAME,
                                   Distinct1.AMT,
                                   Distinct1.TOTAL_AMT
                              FROM ( SELECT DISTINCT Filter1.NO NO  ,
                                                     Filter1.RESULT_CRT_DT RESULT_CRT_DT  ,
                                                     Filter1.RESULT_IS_CURR RESULT_IS_CURR  ,
                                                     Filter1.BS_RESULT_PART_QTY BS_RESULT_PART_QTY  ,
                                                     decode(Filter1.BS_RESULT_FILTER_CLM,'0','X','O') BS_RESULT_FILTER_CLM,
                                                     Filter1.STK_ID STK_ID  ,
                                                     Filter1.STK_CODE STK_CODE  ,
                                                     Filter1.STK_DESC STK_DESC  ,
                                                     1 C1  ,
                                                     Extent4.USER_NAME USER_NAME ,
                                                     AMT,
                                                     Filter1.BS_RESULT_PART_QTY * AMT AS TOTAL_AMT
                                     FROM ( SELECT Extent1.NO NO  ,
                                                   Extent1.SCHDUL_ID SCHDUL_ID  ,
                                                   Extent1.RESULT_CRT_DT RESULT_CRT_DT  ,
                                                   Extent1.RESULT_CRT_USER_ID RESULT_CRT_USER_ID  ,
                                                   Extent1.RESULT_IS_CURR RESULT_IS_CURR  ,
                                                   Extent2.BS_RESULT_PART_QTY BS_RESULT_PART_QTY  ,
                                                   Extent2.BS_RESULT_FILTER_CLM BS_RESULT_FILTER_CLM  ,
                                                   Extent3.STK_ID STK_ID  ,
                                                   Extent3.STK_CODE STK_CODE  ,
                                                   Extent3.STK_DESC STK_DESC ,
                                                   NVL(Extent5.AMT,0) AMT
                                            FROM SVC0006D Extent1
                                                   JOIN SVC0007D Extent2   ON Extent1.RESULT_ID = Extent2.BS_RESULT_ID
                                                   JOIN SYS0026M Extent3   ON Extent2.BS_RESULT_PART_ID = Extent3.STK_ID
                                                   LEFT JOIN SAL0016M Extent5 ON Extent5.STK_ID = Extent3.STK_ID
                                             WHERE  ( 306 = Extent1.TYPE_ID )
                                                      AND ( 0 <> Extent2.BS_RESULT_PART_ID )
                                                      AND ( Extent2.BS_RESULT_PART_QTY > 0 ) ) Filter1
                                            LEFT JOIN SYS0047M Extent4   ON Filter1.RESULT_CRT_USER_ID = Extent4.USER_ID
                                      WHERE  Filter1.SCHDUL_ID = #{selSchdulId} ) Distinct1
                                      WHERE  Distinct1.STK_ID = 1428

                        ]]>

    </select>

    <select id="selectOrderMailingInfoByOrderID" parameterType="Map"
        resultType="egovMap">
        SELECT V1.ORD_ID
        , V1.ADDR_DTL
        , V1.STREET
        , V1.MAIL_AREA
        , V1.MAIL_POST_CODE
        , V1.MAIL_CITY
        , V1.MAIL_STATE
        , V1.MAIL_CNTY
        , V1.MAIL_CNT_NAME
        , V1.MAIL_CNT_NRIC
        , V1.MAIL_CNT_EMAIL
        , V1.MAIL_CNT_TEL_M
        , V1.MAIL_CNT_TEL_O
        , V1.MAIL_CNT_TEL_R
        , V1.MAIL_CNT_TEL_F
        , V1.MAIL_CNT_GENDER
        , V1.BILL_GRP_NO
        , V1.BILL_STATE_EMAIL
        , V1.BILL_STATE
        , V1.BILL_SMS
        , V1.BILL_POST
        , V1.MAIL_CNTC_ID
        , V1.MAIL_ADDR_ID
        , V1.MAIL_CNT_DEPT
        , V1.MAIL_CNT_POST
        FROM SAL1011V V1
        WHERE V1.ORD_ID = #{salesOrderId}
    </select>

    <select id="selectBasicInfo" parameterType="Map" resultType="egovMap">
        SELECT V1.ORD_ID
        , V1.ORD_NO
        , V1.RENTAL_STUS
        , V1.ORD_STUS_ID
        , V1.ORD_STUS_CODE
        , V1.ORD_STUS_NAME
        , V1.ORD_DT
        , V1.INSTLMT_PRIOD
        , V1.ORD_AMT
        , V1.ORD_MTH_RENTAL
        , V1.ORD_PV
        , V1.ORD_PV_MONTH
        , V1.ORD_PV_YEAR
        , V1.ORD_REF_NO
        , V1.ORD_PO_NO
        , V1.ORD_DEPT_CODE
        , V1.ORD_GRP_CODE
        , V1.ORD_ORG_CODE
        , V1.ORD_CRT_USER_ID
        , V1.ORD_CRT_DT
        , V1.APP_TYPE_ID
        , V1.APP_TYPE_CODE
        , V1.APP_TYPE_DESC
        , V1.ITM_PRC_ID
        , V1.STOCK_ID
        , V1.STOCK_CODE
        , V1.STOCK_DESC
        , V1.MASTER_STK_ID
        , V1.CUST_ID
        , V1.CUST_TYPE
        , V1.CUST_NAME
        , V1.CUST_NRIC
        , V1.CUST_DOB
        , V1.CUST_NATION
        , V1.CUST_GENDER
        , V1.CUST_RACE
        , V1.CUST_EMAIL
        , V1.CUST_VA_NO
        , TO_CHAR(V1.CUST_PASSPORT_EXPR, 'DD/MM/YYYY') CUST_PASSPORT_EXPR
        , TO_CHAR(V1.CUST_VISA_EXPR, 'DD/MM/YYYY') CUST_VISA_EXPR
        , V1.ORD_PROMO_ID
        , V1.ORD_PROMO_CODE
        , V1.ORD_PROMO_DESC
        , V1.ORD_MEM_ID
        , V1.ORD_MEM_CODE
        , V1.ORD_MEM_NAME
        , V1.ORD_MEM_NRIC
        , V1.ORD_MEM_TYPE_ID
        , V1.ORD_MEM_TYPE_CODE
        , V1.ORD_MEM_TYPE_NAME
        , V1.COOL_OFF_PRIOD
        , V1.KEYIN_BRNCH_ID
        , V1.KEYIN_BRNCH_CODE
        , V1.KEYIN_BRNCH_NAME
        , V1.ORD_REM
        , V1.RENT_CHK_ID
        , V1.ORD_HM_ID
        , V1.ORD_SM_ID
        , V1.ORD_GM_ID
        , V1.ORD_ADDR_ID
        , V1.ORD_CNTC_ID
        , V1.CUST_CARE_CNT_ID
        , V1.ORD_PROMO_RELATED_NO
        , V1.UPD_DT
        , V1.UPD_USER_ID
        , V1.JOM_PAY_REF
        , V1.STK_CTGRY_ID
        , V1.STK_CTGRY_NAME
        , V1.CUST_TYPE_ID
        , V1.CUST_BILL_ID
        , V1.OBLIGT_YEAR
        , NVL(V1.EMP_CHK, 0) AS EMP_CHK
        , NVL(V1.EX_TRADE, 0) AS EX_TRADE
        , NVL(V1.GST_CHK, 0) AS GST_CHK
        , V1.CNVR_SCHEME_ID
        , V1.PROMO_DISC_PERIOD_TP
        , V1.PROMO_DISC_PERIOD_TP_NM
        , V1.PROMO_DISC_PERIOD
        , V1.NOR_AMT
        , V1.NOR_RNT_FEE
        , V1.DISC_RNT_FEE
        , V1.SRV_PAC_ID
        , V1.ADV_BILL
        , V1.CRT_DUR
        FROM SAL1006V V1
        WHERE V1.ORD_ID = #{salesOrderId}
    </select>

    <select id="getSeqPay0031D" resultType="java.lang.Integer">
        SELECT PAY0031D_SEQ.NEXTVAL FROM DUAL
    </select>



    <select id="selectTaxInvoice" parameterType="Map" resultType="egovMap">


        SELECT search.TAX_INVOICE_CUST_NAME, search.TAX_INVOICE_CONT_PERS
        from (
        SELECT B.NAME TAX_INVOICE_CONT_PERS , D.NAME TAX_INVOICE_CUST_NAME , Rank()
        over(order by c.CUST_BILL_ID desc ) rcnt_info
        FROM
        SAL0001D A,
        SAL0027D B,
        SAL0024D C,
        SAL0029D D
        WHERE A.CUST_CNT_ID = B.CUST_CNTC_ID
        AND A.CUST_BILL_ID = C.CUST_BILL_ID
        AND A.CUST_ID = D.CUST_ID
        AND A.SALES_ORD_ID = #{AS_SO_ID}

        ) search
        where search.rcnt_info = 1
    </select>

    <select id="checkStkDuration" parameterType="Map" resultType="egovMap">
    <![CDATA[
                SELECT SRV_FILTER_STK_ID
        FROM (
            SELECT SRV_SO_ID ,fc.SRV_CONFIG_ID, SRV_FILTER_STK_ID , SRV_FILTER_PRIOD , SRV_FILTER_PRV_CHG_DT , BUFF_DAY ,
            TO_CHAR(ADD_MONTHS(SRV_FILTER_PRV_CHG_DT,SRV_FILTER_PRIOD),'YYYYMMDD') AS ECHG_PRIOD
            FROM SAL0087D fc
        LEFT JOIN SAL0090D cf ON cf.SRV_CONFIG_ID = fc.SRV_CONFIG_ID
        LEFT JOIN SVC0067M buf ON fc.SRV_FILTER_STK_ID = buf.STK_ID
        WHERE
        fc.SRV_FILTER_STUS_ID = 1
        AND cf.SRV_SO_ID = #{salesOrderId}
        AND fc.SRV_FILTER_STK_ID = #{stkId}
        ) A
            WHERE TO_CHAR(SYSDATE,'YYYYMMDD') >= ECHG_PRIOD
                AND TO_CHAR(SYSDATE,'YYYYMMDD') <= TO_CHAR((TO_DATE(ECHG_PRIOD,'YYYYMMDD') + BUFF_DAY),'YYYYMMDD')

             ]]>
     </select>


    <insert id="insert_Pay0031d" parameterType="Map">

        INSERT INTO PAY0031D (
        TAX_INVC_ID, TAX_INVC_REF_NO, TAX_INVC_REF_DT,
        TAX_INVC_SVC_NO, TAX_INVC_TYPE, TAX_INVC_CUST_NAME,
        TAX_INVC_CNTC_PERSON, TAX_INVC_ADDR1, TAX_INVC_ADDR2,
        TAX_INVC_ADDR3, TAX_INVC_ADDR4, TAX_INVC_POST_CODE,
        TAX_INVC_STATE_NAME, TAX_INVC_CNTY, TAX_INVC_TASK_ID,
        TAX_INVC_REM, TAX_INVC_CHRG, TAX_INVC_TXS,
        TAX_INVC_AMT_DUE, TAX_INVC_CRT_DT, TAX_INVC_CRT_USER_ID, AREA_ID ,ADDR_DTL, STREET)
        VALUES (
        #{taxInvcId},
        #{taxInvcRefNo},
        SYSDATE,
        #{taxInvcSvcNo},
        #{taxInvcType},
        #{taxInvcCustName},
        #{taxInvcCntcPerson},
        #{taxInvcAddr1},
        #{taxInvcAddr2},
        #{taxInvcAddr3},
        #{taxInvcAddr4},
        #{taxInvcPostCode},
        #{taxInvcStateName},
        #{taxInvcCnty},
        #{taxInvcTaskId},
        #{taxInvcRem},
        #{taxInvcChrg},
        #{taxInvcTxs},
        #{taxInvcAmtDue},
        #{taxInvcCrtDt},
        #{taxInvcCrtUserId},
        FN_GET_SVC_BILL_MADDRESS( (select sales_ord_no from sal0001d where sales_ord_id =#{AS_SO_ID})
        ,'AREA_ID'),
        FN_GET_SVC_BILL_MADDRESS( (select sales_ord_no from sal0001d where sales_ord_id =#{AS_SO_ID})
        ,'ADDR1'),
        FN_GET_SVC_BILL_MADDRESS( (select sales_ord_no from sal0001d where sales_ord_id =#{AS_SO_ID})
        ,'ADDR2')
        )
    </insert>


    <insert id="insert_Pay0032d" parameterType="Map">

        INSERT INTO PAY0032D (
        INVC_ITM_ID, TAX_INVC_ID, INVC_ITM_TYPE,
        INVC_ITM_ORD_NO, INVC_ITM_PO_NO, INVC_ITM_CODE,
        INVC_ITM_DESC1, INVC_ITM_DESC2, INVC_ITM_SERIAL_NO,
        INVC_ITM_QTY, INVC_ITM_UNIT_PRC, INVC_ITM_GST_RATE,
        INVC_ITM_GST_TXS, INVC_ITM_CHRG, INVC_ITM_AMT_DUE,
        INVC_ITM_ADD1, INVC_ITM_ADD2, INVC_ITM_ADD3,
        INVC_ITM_ADD4, INVC_ITM_POST_CODE, INVC_ITM_AREA_NAME,
        INVC_ITM_STATE_NAME, INVC_ITM_CNTY, INVC_ITM_INSTALL_DT,
        INVC_ITM_RETN_DT, INVC_ITM_BILL_REF_NO ,AREA_ID ,ADDR_DTL, STREET)
        VALUES (
        PAY0032D_SEQ.NEXTVAL,
        #{taxInvcId},
        #{invcItmType},
        (select sales_ord_no from sal0001d where sales_ord_id =#{invcItmOrdNo}),
        #{invcItmPoNo},
        #{invcItmCode},
        #{invcItmDesc1},
        #{invcItmDesc2},
        #{invcItmSerialNo},
        #{invcItmQty},
        #{invcItmUnitPrc},
        #{invcItmGstRate},
        #{invcItmGstTxs},
        #{invcItmChrg},
        #{invcItmAmtDue},
        #{invcItmAdd1},
        #{invcItmAdd2},
        #{invcItmAdd3},
        #{invcItmAdd4},
        #{invcItmPostCode},
        #{invcItmAreaName},
        #{invcItmStateName},
        #{invcItmCnty},
        #{invcItmInstallDt},
        #{invcItmRetnDt},
        #{invcItmBillRefNo},
        FN_GET_SVC_BILL_MADDRESS( (select sales_ord_no from sal0001d where sales_ord_id
        =#{invcItmOrdNo}) ,'AREA_ID'),
        FN_GET_SVC_BILL_MADDRESS( (select sales_ord_no from sal0001d where sales_ord_id
        =#{invcItmOrdNo}) ,'ADDR1'),
        FN_GET_SVC_BILL_MADDRESS( (select sales_ord_no from sal0001d where sales_ord_id
        =#{invcItmOrdNo}) ,'ADDR2')
        )

    </insert>


    <insert id="insert_Pay0016d" parameterType="Map" >

                INSERT INTO PAY0016D (
                   ACC_BILL_ID, ACC_BILL_TASK_ID, ACC_BILL_REF_DT,
                   ACC_BILL_REF_NO, ACC_BILL_ORD_ID, ACC_BILL_ORD_NO,
                   ACC_BILL_TYPE_ID, ACC_BILL_MODE_ID, ACC_BILL_SCHDUL_ID,
                   ACC_BILL_SCHDUL_PRIOD, ACC_BILL_ADJ_ID, ACC_BILL_SCHDUL_AMT,
                   ACC_BILL_ADJ_AMT, ACC_BILL_TXS_AMT, ACC_BILL_NET_AMT,
                   ACC_BILL_STUS, ACC_BILL_REM, ACC_BILL_CRT_DT,
                   ACC_BILL_CRT_USER_ID, ACC_BILL_GRP_ID, ACC_BILL_TAX_CODE_ID,
                   ACC_BILL_TAX_RATE, ACC_BILL_ACCT_CNVR, ACC_BILL_CNTRCT_ID)
                VALUES (
                           PAY0016D_SEQ.NEXTVAL,
                           #{accBillTaskId},
                           #{accBillRefDt},
                           #{accBillRefNo},
                           #{accBillOrdId},
                            (SELECT SALES_ORD_NO  FROM SAL0001D WHERE  SALES_ORD_ID =#{accBillOrdId} ) ,
                           #{accBillTypeId},
                           #{accBillModeId},
                           #{accBillSchdulId},
                           #{accBillSchdulPriod},
                           #{accBillAdjId},
                           #{accBillSchdulAmt},
                           #{accBillAdjAmt},
                           #{accBillTxsAmt},
                           #{accBillNetAmt},
                           #{accBillStus},
                           #{accBillRem},
                           #{accBillCrtDt},
                           #{accBillCrtUserId},
                           #{accBillGrpId},
                           #{accBillTaxCodeId},
                           #{accBillTaxRate},
                           #{accBillAcctCnvr},
                           #{accBillCntrctId}
                       )
       </insert>

              <insert id="insert_Pay0006d" parameterType="Map" >

            INSERT INTO PAY0006D (
                                               AS_LDGR_ID, AS_ID, AS_DOC_NO,
                                               AS_LG_DOC_TYPE_ID, AS_LG_DT, AS_LG_AMT,
                                               AS_LG_UPD_USER_ID, AS_LG_UPD_DT, AS_SO_NO,
                                               AS_RESULT_NO, AS_SO_ID, AS_ADV_PAY,
                                               R01)
                                            VALUES (
                                               PAY0006D_SEQ.NEXTVAL,
                                               #{asId},
                                               #{asDocNo},
                                               #{asLgDocTypeId},
                                               #{asLgDt},
                                               #{asLgAmt},
                                               #{asLgUpdUserId},
                                               #{asLgUpdDt},
                                               (SELECT SALES_ORD_NO  FROM SAL0001D WHERE  SALES_ORD_ID =#{asSoId} ) ,
                                               #{asResultNo},
                                               #{asSoId},
                                               #{asAdvPay},
                                               #{r01}
                                            )
       </insert>


       <insert id="insert_Pay0007d" parameterType="Map" >
                        INSERT INTO PAY0007D (
                           BILL_ID, BILL_TYPE_ID, BILL_SO_ID,
                           BILL_MEM_ID, BILL_AS_ID, BILL_PAY_TYPE_ID,
                           BILL_NO, BILL_MEM_SHIP_NO, BILL_DT,
                           BILL_AMT, BILL_REM, BILL_IS_PAID,
                           BILL_IS_COMM, UPD_USER_ID, UPD_DT,
                           SYNC_CHK, COURS_ID, STUS_ID)
                        VALUES (
                           PAY0007D_SEQ.NEXTVAL,
                           #{billTypeId},
                           #{billSoId},
                           #{billMemId},
                           #{billAsId},
                           #{billPayTypeId},
                           #{billNo},
                           #{billMemShipNo},
                           #{billDt},
                           #{billAmt},
                           #{billRem},
                           #{billIsPaid},
                           #{billIsComm},
                           #{updUserId},
                           #{updDt},
                           #{syncChk},
                           #{coursId},
                           #{stusId})
     </insert>

     <select id="selectQryUsedFilter" parameterType="Map" resultType="egovMap">

            select a.BS_RESULT_PART_ID
                ,a.BS_RESULT_PART_DESC
                ,a.BS_RESULT_PART_QTY
                ,a.BS_RESULT_REM
                ,a.BS_RESULT_FILTER_CLM
                ,c.NO
                ,d.CUST_ID
                ,TO_CHAR(b.RESULT_CRT_DT, 'DD/MM/YYYY') RESULT_CRT_DT
                ,a.SERIAL_NO
                ,c.CODY_ID
                ,b.RESULT_ID
          from SVC0007D a
          left join SVC0006D b ON b.RESULT_ID = a.BS_RESULT_ID
          left join SVC0008D c ON c.SCHDUL_ID = b.SCHDUL_ID
          left join SAL0001D d ON d.SALES_ORD_ID = b.SALES_ORD_ID
         where a.BS_RESULT_ID = #{ResultMatchID}
         order by a.BS_RESULT_ITM_ID

          </select>

           <select id="selectQryUsedFilter2" parameterType="Map" resultType="egovMap">

            select a.BS_RESULT_PART_ID
                ,a.BS_RESULT_PART_DESC
                ,a.BS_RESULT_PART_QTY
                ,a.BS_RESULT_REM
                ,a.BS_RESULT_FILTER_CLM
                ,c.NO
                ,d.CUST_ID
                ,TO_DATE(b.RESULT_CRT_DT, 'DD/MM/YYYY') RESULT_CRT_DT
                ,a.SERIAL_NO
                ,c.CODY_ID
                ,b.RESULT_ID
          from SVC0007D a
          left join SVC0006D b ON b.RESULT_ID = a.BS_RESULT_ID
          left join SVC0008D c ON c.SCHDUL_ID = b.SCHDUL_ID
          left join SAL0001D d ON d.SALES_ORD_ID = b.SALES_ORD_ID
         where a.BS_RESULT_ID = #{BSResultID}
         order by a.BS_RESULT_ITM_ID

          </select>

          <insert id="addusedFilter_Rev" parameterType="Map">
          insert into log0082m
            (SEQ
            ,SVC_ORD_ID
            ,CUST_ID
            ,SVC_DT
            ,STK_ID
            ,QTY
            ,OLD_SERIAL
            ,MEM_ID
            ,RESULT_ID
            )
            values
            (
            LOG0082M_SEQ.NEXTVAL
            ,#{HSNo}
            ,#{CustId}
            ,TO_DATE(#{CreatedDt}, 'DD/MM/YYYY')
            ,#{PartId}
            ,#{PartQty}
            ,nvl(#{SerialNo}, '')
            ,#{CodyId}
            ,#{ResultId}

            )
          </insert>

          <insert id="addusedFilter" parameterType="Map">
          insert into log0082m
            (SEQ
            ,SVC_ORD_ID
            ,CUST_ID
            ,SVC_DT
            ,STK_ID
            ,QTY
            ,OLD_SERIAL
            ,MEM_ID
            ,RESULT_ID
            )
            values
            (
            LOG0082M_SEQ.NEXTVAL
            ,#{HSNo}
            ,#{CustId}
            ,sysdate
            ,#{BSResultPartID}
            ,#{BSResultPartQty}
            ,nvl(#{SerialNo}, '')
            ,#{CodyId}
            ,#{ResultId}

            )
          </insert>

          <select id="selectTotalFilter" parameterType="Map" resultType="Integer">

            select COUNT(*)
          from SVC0007D
         where BS_RESULT_ID = #{ResultMatchID}


          </select>

           <select id="selectQryUsedFilterNew" parameterType="Map" resultType="egovMap">

            select c.NO
                ,d.CUST_ID
                ,TO_CHAR(b.RESULT_CRT_DT, 'DD/MM/YYYY') RESULT_CRT_DT
                ,c.CODY_ID
                ,b.RESULT_ID
          from SVC0006D b
          left join SVC0008D c ON c.SCHDUL_ID = b.SCHDUL_ID
          left join SAL0001D d ON d.SALES_ORD_ID = b.SALES_ORD_ID
         where b.RESULT_ID = #{ResultMatchID}


          </select>

          <select id="selectCustomer" parameterType="Map" resultType="Integer">

            select A.CUST_ID
          from SAL0001D A
         where A.SALES_ORD_ID = #{hidSalesOrdId}


          </select>

                     <select id="selectSerialNo" parameterType="Map" resultType="String">

            select A.SERIAL_NO
          from SVC0007D A
         where A.BS_RESULT_ID = #{bsResultId}


          </select>


                               <select id="selectCody" parameterType="Map" resultType="Integer">

            select A.CODY_ID
          from SVC0008D A
         where A.SCHDUL_ID = #{hidschdulId}


          </select>

          <insert id="insertUsedFilter" parameterType="Map">
          insert into log0082m
            (SEQ
            ,SVC_ORD_ID
            ,CUST_ID
            ,SVC_DT
            ,STK_ID
            ,QTY
            ,OLD_SERIAL
            ,MEM_ID
            ,RESULT_ID
            )
            values
            (
            LOG0082M_SEQ.NEXTVAL
            ,#{hsNo}
            ,#{custId}
            ,sysdate
            ,#{bsResultPartId}
            ,#{bsResultPartQty}
            ,nvl(#{serialNo}, '')
            ,#{bsCodyId}
            ,#{bsResultId}

            )
          </insert>


        <select id="selectDeptCodeList" parameterType="Map" resultType="egovMap">

            SELECT Distinct1.C1 C1,
                   Distinct1.DEPT_CODE CODE_ID,
                   Distinct1.C2 CODE_NAME
              FROM ( SELECT DISTINCT Extent1.DEPT_CODE DEPT_CODE  ,
                                     1 C1  ,
                                     Extent1.DEPT_CODE || ' - ' || Extent2.NAME C2
                     FROM ORG0005D Extent1
                            JOIN ORG0001D Extent2   ON Extent1.MEM_ID = Extent2.MEM_ID
                      WHERE  1=1
                               <if test="groupCode != null and groupCode != ''">
                               and ( Extent1.MEM_LVL = #{groupCode} )
                               </if>
                               <!-- AND ( Extent1.DEPT_CODE LIKE '%CCS%'ESCAPE '~' ) -->
                               AND ( 1 = Extent1.ORG_STUS_CODE_ID )
                               AND ( 7 = Extent2.MEM_TYPE )
                               ) Distinct1
              order by  Distinct1.DEPT_CODE

        </select>



        <select id="selectDscCodeList" parameterType="Map" resultType="egovMap">
            SELECT Project1.BRNCH_ID CODE_ID  ,
                   Project1.C1 CODE_NAME
                  FROM ( SELECT Extent1.BRNCH_ID BRNCH_ID  ,
                                Extent1.CODE || '-' || Extent1.NAME C1
                         FROM SYS0005M Extent1
                          WHERE  ( 1 = Extent1.STUS_ID )
                                   AND ( Extent1.TYPE_ID IN ( 40,43 )
                                  ) ) Project1
                  ORDER BY Project1.C1 ASC

        </select>


        <select id="selectInsStatusList" parameterType="Map" resultType="egovMap">
            SELECT Project1.STATE_ID CODE_ID  ,
                   Project1.CODE CODE  ,
                   Project1.NAME CODE_NAME  ,
                   Project1.CNTY_ID CNTY_ID  ,
                   Project1.STUS_CODE_ID STUS_CODE_ID  ,
                   Project1.CRT_DT CRT_DT  ,
                   Project1.CRT_USER_ID CRT_USER_ID  ,
                   Project1.UPD_DT UPD_DT  ,
                   Project1.UPD_USER_ID UPD_USER_ID
              FROM ( SELECT Extent1.STATE_ID STATE_ID  ,
                            Extent1.CODE CODE  ,
                            Extent1.NAME NAME  ,
                            Extent1.CNTY_ID CNTY_ID  ,
                            Extent1.STUS_CODE_ID STUS_CODE_ID  ,
                            Extent1.CRT_DT CRT_DT  ,
                            Extent1.CRT_USER_ID CRT_USER_ID  ,
                            Extent1.UPD_DT UPD_DT  ,
                            Extent1.UPD_USER_ID UPD_USER_ID
                     FROM SYS0035M Extent1
                     <if test="groupCode != null and groupCode != ''">
                      WHERE  ( Extent1.CNTY_ID = #{groupCode} )
                     </if>
                               AND ( 1 = Extent1.STUS_CODE_ID ) ) Project1
              ORDER BY Project1.NAME ASC

        </select>



       <select id="selectCodyCodeList_1" parameterType="Map" resultType="egovMap">
              SELECT A.MEM_CODE as CODE_ID , A.MEM_CODE   || '-' || a.NAME  as CODE_NAME
                FROM ORG0001D A, ORG0005D B
               WHERE A.MEM_ID = B.MEM_ID AND A.STUS = '1' AND B.DEPT_CODE = #{groupCode}
            ORDER BY A.MEM_CODE
       </select>


        <select id="selectCodyCodeList" parameterType="Map" resultType="egovMap">
                SELECT Project1.MEM_CODE CODE_ID  ,
                        Project1.MEM_CODE   || '-' || Project1.NAME  as CODE_NAME,                     Project1.NAME NAME  ,
                       Project1.NRIC NRIC  ,
                       Project1.MEM_TYPE MEM_TYPE  ,
                       Project1.CODE_NAME CODE_NAME  ,
                       Project1.C1 C1  ,
                       Project1.C2 C2  ,
                       Project1.C3 C3  ,
                       Project1.C4 C4  ,
                       Project1.C5 C5  ,
                       Project1.C6 C6  ,
                       Project1.C7 C7  ,
                       Project1.C8 C8
                  FROM ( SELECT Extent1.MEM_ID MEM_ID  ,
                                Extent1.MEM_CODE MEM_CODE  ,
                                Extent1.MEM_TYPE MEM_TYPE  ,
                                Extent1.NAME NAME  ,
                                Extent1.NRIC NRIC  ,
                                Extent2.CODE_NAME CODE_NAME  ,
                                CASE
                                     WHEN ( NOT ( ( Extent3.MEM_ID IS NULL )
                                       AND ( Extent3.MEM_CODE IS NULL )
                                       AND ( Extent3.MEM_LVL IS NULL )
                                       AND ( Extent3.DEPT_CODE IS NULL )
                                       AND ( Extent3.GRP_CODE IS NULL )
                                       AND ( Extent3.ORG_CODE IS NULL )
                                       AND ( Extent3.TOP_ORG_CODE IS NULL )
                                       AND ( Extent3.MEM_UP_ID IS NULL )
                                       AND ( Extent3.LVL3_UP_ID IS NULL )
                                       AND ( Extent3.LVL2_UP_ID IS NULL )
                                       AND ( Extent3.LVL1_UP_ID IS NULL )
                                       AND ( Extent3.LVL0_UP_ID IS NULL ) ) ) THEN Extent3.DEPT_CODE
                                ELSE ''
                                   END C1  ,
                                CASE
                                     WHEN ( NOT ( ( Extent3.MEM_ID IS NULL )
                                       AND ( Extent3.MEM_CODE IS NULL )
                                       AND ( Extent3.MEM_LVL IS NULL )
                                       AND ( Extent3.DEPT_CODE IS NULL )
                                       AND ( Extent3.GRP_CODE IS NULL )
                                       AND ( Extent3.ORG_CODE IS NULL )
                                       AND ( Extent3.TOP_ORG_CODE IS NULL )
                                       AND ( Extent3.MEM_UP_ID IS NULL )
                                       AND ( Extent3.LVL3_UP_ID IS NULL )
                                       AND ( Extent3.LVL2_UP_ID IS NULL )
                                       AND ( Extent3.LVL1_UP_ID IS NULL )
                                       AND ( Extent3.LVL0_UP_ID IS NULL ) ) ) THEN Extent3.GRP_CODE
                                ELSE ''
                                   END C2  ,
                                CASE
                                     WHEN ( NOT ( ( Extent3.MEM_ID IS NULL )
                                       AND ( Extent3.MEM_CODE IS NULL )
                                       AND ( Extent3.MEM_LVL IS NULL )
                                       AND ( Extent3.DEPT_CODE IS NULL )
                                       AND ( Extent3.GRP_CODE IS NULL )
                                       AND ( Extent3.ORG_CODE IS NULL )
                                       AND ( Extent3.TOP_ORG_CODE IS NULL )
                                       AND ( Extent3.MEM_UP_ID IS NULL )
                                       AND ( Extent3.LVL3_UP_ID IS NULL )
                                       AND ( Extent3.LVL2_UP_ID IS NULL )
                                       AND ( Extent3.LVL1_UP_ID IS NULL )
                                       AND ( Extent3.LVL0_UP_ID IS NULL ) ) ) THEN Extent3.ORG_CODE
                                ELSE ''
                                   END C3  ,
                                CASE
                                     WHEN ( NOT ( ( Extent3.MEM_ID IS NULL )
                                       AND ( Extent3.MEM_CODE IS NULL )
                                       AND ( Extent3.MEM_LVL IS NULL )
                                       AND ( Extent3.DEPT_CODE IS NULL )
                                       AND ( Extent3.GRP_CODE IS NULL )
                                       AND ( Extent3.ORG_CODE IS NULL )
                                       AND ( Extent3.TOP_ORG_CODE IS NULL )
                                       AND ( Extent3.MEM_UP_ID IS NULL )
                                       AND ( Extent3.LVL3_UP_ID IS NULL )
                                       AND ( Extent3.LVL2_UP_ID IS NULL )
                                       AND ( Extent3.LVL1_UP_ID IS NULL )
                                       AND ( Extent3.LVL0_UP_ID IS NULL ) ) ) THEN Extent3.MEM_LVL
                                ELSE 0
                                   END C4  ,
                                CASE
                                     WHEN ( NOT ( ( Extent3.MEM_ID IS NULL )
                                       AND ( Extent3.MEM_CODE IS NULL )
                                       AND ( Extent3.MEM_LVL IS NULL )
                                       AND ( Extent3.DEPT_CODE IS NULL )
                                       AND ( Extent3.GRP_CODE IS NULL )
                                       AND ( Extent3.ORG_CODE IS NULL )
                                       AND ( Extent3.TOP_ORG_CODE IS NULL )
                                       AND ( Extent3.MEM_UP_ID IS NULL )
                                       AND ( Extent3.LVL3_UP_ID IS NULL )
                                       AND ( Extent3.LVL2_UP_ID IS NULL )
                                       AND ( Extent3.LVL1_UP_ID IS NULL )
                                       AND ( Extent3.LVL0_UP_ID IS NULL ) ) ) THEN Extent3.LVL3_UP_ID
                                ELSE 0
                                   END C5  ,
                                CASE
                                     WHEN ( NOT ( ( Extent3.MEM_ID IS NULL )
                                       AND ( Extent3.MEM_CODE IS NULL )
                                       AND ( Extent3.MEM_LVL IS NULL )
                                       AND ( Extent3.DEPT_CODE IS NULL )
                                       AND ( Extent3.GRP_CODE IS NULL )
                                       AND ( Extent3.ORG_CODE IS NULL )
                                       AND ( Extent3.TOP_ORG_CODE IS NULL )
                                       AND ( Extent3.MEM_UP_ID IS NULL )
                                       AND ( Extent3.LVL3_UP_ID IS NULL )
                                       AND ( Extent3.LVL2_UP_ID IS NULL )
                                       AND ( Extent3.LVL1_UP_ID IS NULL )
                                       AND ( Extent3.LVL0_UP_ID IS NULL ) ) ) THEN Extent3.LVL2_UP_ID
                                ELSE 0
                                   END C6  ,
                                CASE
                                     WHEN ( NOT ( ( Extent3.MEM_ID IS NULL )
                                       AND ( Extent3.MEM_CODE IS NULL )
                                       AND ( Extent3.MEM_LVL IS NULL )
                                       AND ( Extent3.DEPT_CODE IS NULL )
                                       AND ( Extent3.GRP_CODE IS NULL )
                                       AND ( Extent3.ORG_CODE IS NULL )
                                       AND ( Extent3.TOP_ORG_CODE IS NULL )
                                       AND ( Extent3.MEM_UP_ID IS NULL )
                                       AND ( Extent3.LVL3_UP_ID IS NULL )
                                       AND ( Extent3.LVL2_UP_ID IS NULL )
                                       AND ( Extent3.LVL1_UP_ID IS NULL )
                                       AND ( Extent3.LVL0_UP_ID IS NULL ) ) ) THEN Extent3.LVL1_UP_ID
                                ELSE 0
                                   END C7  ,
                                CASE
                                     WHEN ( Extent4.WH_LOC_ID IS NOT NULL ) THEN Extent4.WH_LOC_ID
                                ELSE 0
                                   END C8
                         FROM ORG0001D Extent1
                                JOIN SYS0013M Extent2   ON Extent2.CODE_ID = Extent1.MEM_TYPE
                                LEFT JOIN ( SELECT vMemberOrg.MEM_ID MEM_ID  ,
                                                   vMemberOrg.MEM_CODE MEM_CODE  ,
                                                   vMemberOrg.MEM_LVL MEM_LVL  ,
                                                   vMemberOrg.DEPT_CODE DEPT_CODE  ,
                                                   vMemberOrg.GRP_CODE GRP_CODE  ,
                                                   vMemberOrg.ORG_CODE ORG_CODE  ,
                                                   vMemberOrg.TOP_ORG_CODE TOP_ORG_CODE  ,
                                                   vMemberOrg.MEM_UP_ID MEM_UP_ID  ,
                                                   vMemberOrg.LVL3_UP_ID LVL3_UP_ID  ,
                                                   vMemberOrg.LVL2_UP_ID LVL2_UP_ID  ,
                                                   vMemberOrg.LVL1_UP_ID LVL1_UP_ID  ,
                                                   vMemberOrg.LVL0_UP_ID LVL0_UP_ID
                                            FROM ORG1001V vMemberOrg ) Extent3   ON Extent3.MEM_ID = Extent1.MEM_ID
                                LEFT JOIN SYS0028M Extent4   ON Extent4.WH_LOC_CODE = Extent1.MEM_CODE
                          WHERE  ( 1 = Extent1.STUS )
                                   AND ( Extent1.MEM_TYPE IN ( 7 )
                                  ) ) Project1
                  ORDER BY Project1.MEM_CODE ASC

        </select>




        <select id="selectAreaCodeList" parameterType="Map" resultType="egovMap">

                  SELECT Extent1.AREA_ID CODE_ID  ,
                       Extent1.AREA_NAME CODE_NAME  ,
                       Extent1.AREA_STATE_ID AREA_STATE_ID  ,
                       Extent1.AREA_IDCM AREA_IDCM  ,
                       Extent1.AREA_STUS_ID AREA_STUS_ID  ,
                       Extent1.CRT_DT CRT_DT  ,
                       Extent1.CRT_DT CRT_DT  ,
                       Extent1.UPD_DT UPD_DT  ,
                       Extent1.UPD_USER_ID UPD_USER_ID
                  FROM SYS0039M Extent1
                 WHERE  1 = Extent1.AREA_STUS_ID
                  ORDER BY Extent1.AREA_NAME ASC
        </select>


        <select id="selectHSReportSingle" parameterType="Map" resultType="egovMap">
        <![CDATA[
            SELECT
                                 Distinct1.SCHDUL_ID SCHDUL_ID ,
                                 Distinct1.NO NO ,
                                 Distinct1.MONTH MONTH ,
                                 Distinct1.YEAR YEAR ,
                                 Distinct1.CODY_ID CODY_ID ,
                                 Distinct1.STUS_CODE_ID STUS_CODE_ID ,
                                 Distinct1.CODE CODE ,
                                 Distinct1.SALES_ORD_ID SALES_ORD_ID ,
                                 Distinct1.SALES_ORD_NO SALES_ORD_NO ,
                                 Distinct1.NAME NAME ,
                                 Distinct1.NRIC NRIC ,
                                 Distinct1.CODE1 CODE1 ,
                                 Distinct1.C1 C1 ,
                                 Distinct1.C2 C2 ,
                                 Distinct1.C3 C3 ,
                                 Distinct1.C4 C4 ,
                                 Distinct1.C5 C5 ,
                                 Distinct1.C6 C6 ,
                                 Distinct1.C7 C7 ,
                                 Distinct1.C8 C8
                        FROM
                            ( SELECT   /*+  leading(Extent1) use_nl( Extent7, Extent1, Extent3, Extent4, Extent6, Extent8, Extent9, Extent2,  Extent5)   */
                             DISTINCT Extent1.SCHDUL_ID SCHDUL_ID ,
                                 Extent1.NO NO ,
                                 Extent1.MONTH MONTH ,
                                 Extent1.YEAR YEAR ,
                                 Extent1.CODY_ID CODY_ID ,
                                 Extent1.STUS_CODE_ID STUS_CODE_ID ,
                                 Extent2.CODE CODE ,
                                 Extent3.SRV_ORD_ID SALES_ORD_ID ,
                                 Extent3.SRV_ORD_NO SALES_ORD_NO ,
                                 Extent4.NAME NAME ,
                                 Extent4.NRIC NRIC ,
                                 Extent5.CODE CODE1 ,
                                 1 C1 ,
                                CASE
                                WHEN ( Extent7.RESULT_ID IS NOT NULL ) THEN
                                Extent7.RESULT_ID
                                ELSE 0
                                END C2 ,
                                CASE
                                WHEN ( Extent7.RESULT_ID IS NOT NULL ) THEN
                                Extent7.NO
                                ELSE ''
                                END C3 ,
                                CASE
                                WHEN ( Extent8.MEM_ID IS NOT NULL ) THEN
                                Extent8.MEM_TYPE
                                ELSE 0
                                END C4 ,
                                CASE
                                WHEN ( Extent8.MEM_ID IS NOT NULL ) THEN
                                Extent8.MEM_CODE
                                ELSE ''
                                END C5 ,
                                CASE
                                WHEN ( Extent8.MEM_ID IS NOT NULL ) THEN
                                Extent8.STUS
                                ELSE 0
                                END C6 ,
                                CASE
                                WHEN ( Extent6.PRE_DT IS NOT NULL ) THEN
                                Extent6.PRE_DT
                                ELSE TO_DATE('01/01/1900','DD/MM/YYYY')
                                END C7 ,
                                CASE
                                WHEN ( Extent9.MEM_ID IS NOT NULL ) THEN
                                Extent9.MEM_CODE
                                ELSE ''
                                END C8
                            FROM SVC0008D Extent1
                            JOIN SYS0038M Extent2
                                ON Extent2.STUS_CODE_ID = Extent1.STUS_CODE_ID
                            JOIN SAL0225D Extent3
                                ON Extent3.SRV_ORD_ID = Extent1.SALES_ORD_ID
                            JOIN SAL0029D Extent4
                                ON Extent4.CUST_ID = Extent3.CUST_ID
                            JOIN SYS0013M Extent5
                                ON Extent5.CODE_ID = Extent3.APP_TYPE_ID
                            JOIN SAL0045D Extent6
                                    ON Extent6.SALES_ORD_ID = Extent1.SALES_ORD_ID
                                LEFT JOIN SVC0006D Extent7
                                    ON ( Extent7.SCHDUL_ID = Extent1.SCHDUL_ID )
                                        AND ( 306 = Extent7.TYPE_ID )
                                        AND ( 1 = Extent7.RESULT_IS_CURR )
                                LEFT JOIN ORG0001D Extent8
                                    ON Extent8.MEM_ID = Extent1.CODY_ID
                                LEFT JOIN ORG0001D Extent9
                                    ON Extent9.MEM_ID = Extent7.CODY_ID
                                WHERE 1=1
                                        ]]>
                                        <if test="hsMonth != null and hsMonth != ''">
                                              AND ( Extent1.YEAR = to_number(to_char(to_date(#{hsMonth},'mm/yyyy'), 'yyyy')) )
                                              AND ( Extent1.MONTH = to_number(to_char(to_date(#{hsMonth},'mm/yyyy'), 'mm')) )
                                        </if>
                                        <if test="hsNumber != null and hsNumber != ''">
                                             AND Extent1.NO = UPPER(#{hsNumber})
                                        </if>
                                        <if test="orderNumber != null and orderNumber != ''">
                                             AND Extent3.SRV_ORD_NO = #{orderNumber}
                                        </if>
                                        <if test="memberCode != null and memberCode != ''">
                                             AND (CASE WHEN (Extent8.Mem_ID IS NOT NULL) THEN Extent8.Mem_Code ELSE '' END) = UPPER(#{memberCode})
                                        </if>
                                        <![CDATA[
                                             AND ROWNUM < 100
                                                 ) Distinct1
                  ORDER BY Distinct1.SCHDUL_ID ASC
                  ]]>
        </select>
        <select id="selectHSReportGroup" parameterType="Map" resultType="egovMap">
        <![CDATA[
                SELECT Distinct2.C1 C1  ,
                           Distinct2.C2 C2  ,
                           Distinct2.C3 C3
                      FROM ( SELECT DISTINCT 1 C1  ,
                                             CASE
                                                  WHEN ( Distinct1.MEM_CODE LIKE 'CT%' ) THEN Distinct1.MEM_CODE || '_' || #{dayYear} || '_' || #{dayMonth}
                                             ELSE Distinct1.DEPT_CODE || '_' || #{dayYear} || '_' || #{dayMonth}
                                                END C2  ,
                                             CASE
                                                  WHEN ( Distinct1.MEM_CODE LIKE 'CT%' ) THEN Distinct1.MEM_CODE
                                             ELSE Distinct1.DEPT_CODE
                                                END C3
                             FROM ( SELECT DISTINCT Extent2.MEM_CODE MEM_CODE  ,
                                                    Extent2.DEPT_CODE DEPT_CODE  ,
                                                    Extent2.GRP_CODE GRP_CODE  ,
                                                    Extent2.ORG_CODE ORG_CODE  ,
                                                    Extent2.TOP_ORG_CODE TOP_ORG_CODE
                                    FROM SVC0008D Extent1
                                           JOIN ( SELECT vMemberOrg.MEM_ID MEM_ID  ,
                                                         vMemberOrg.MEM_CODE MEM_CODE  ,
                                                         vMemberOrg.MEM_LVL MEM_LVL  ,
                                                         vMemberOrg.DEPT_CODE DEPT_CODE  ,
                                                         vMemberOrg.GRP_CODE GRP_CODE  ,
                                                         vMemberOrg.ORG_CODE ORG_CODE  ,
                                                         vMemberOrg.TOP_ORG_CODE TOP_ORG_CODE  ,
                                                         vMemberOrg.MEM_UP_ID MEM_UP_ID  ,
                                                         vMemberOrg.LVL3_UP_ID LVL3_UP_ID  ,
                                                         vMemberOrg.LVL2_UP_ID LVL2_UP_ID  ,
                                                         vMemberOrg.LVL1_UP_ID LVL1_UP_ID  ,
                                                         vMemberOrg.LVL0_UP_ID LVL0_UP_ID
                                                  FROM ORG1001V vMemberOrg
                                              UNION
                                                    SELECT
                            vmemberorg2.mem_id mem_id,
                            vmemberorg2.mem_code mem_code,
                            vmemberorg2.mem_lvl mem_lvl,
                            vmemberorg2.dept_code dept_code,
                            vmemberorg2.grp_code grp_code,
                            vmemberorg2.org_code org_code,
                            vmemberorg2.top_org_code top_org_code,
                            vmemberorg2.mem_up_id mem_up_id,
                            vmemberorg2.lvl3_up_id lvl3_up_id,
                            vmemberorg2.lvl2_up_id lvl2_up_id,
                            vmemberorg2.lvl1_up_id lvl1_up_id,
                            vmemberorg2.lvl0_up_id lvl0_up_id
                        FROM
                            org1001v vmemberorg2
                        WHERE vmemberorg2.MEM_ID IN (SELECT MEM_ID FROM ORG0005D WHERE BRNCH_ID = 151)

                                                   ) Extent2   ON Extent2.MEM_ID = Extent1.CODY_ID
                                     WHERE  ( Extent1.MONTH =  to_char(sysdate, 'mm' ) )
                                              AND ( Extent1.YEAR = to_char(sysdate, 'yyyy' ) )
                                              ]]>
                                         <if test="orgCode != null and orgCode != ''">
                                             AND Extent2.ORG_CODE = #{orgCode}
                                        </if>
                                        <if test="grpCode != null and grpCode != ''">
                                             AND Extent2.GRP_CODE =#{grpCode}
                                        </if>
                                        <if test="deptCode != null and deptCode != ''">
                                             AND Extent2.DEPT_CODE = #{deptCode}
                                        </if>

                                        <![CDATA[
                                              ) Distinct1 ) Distinct2
                                           ]]>

        </select>

             <select id="selectHTCodeListByHTCode" parameterType="Map" resultType="egovMap">
              SELECT A.MEM_CODE as CODE_ID , A.MEM_CODE   || '-' || a.NAME  as CODE_NAME
                FROM ORG0001D A, ORG0005D B
               WHERE A.MEM_ID = B.MEM_ID AND A.STUS = '1'
               AND A.MEM_TYPE = 7
               <if test="groupCode != null and groupCode != ''">
               AND A.MEM_CODE = #{groupCode}
               </if>

            ORDER BY A.MEM_CODE
       </select>

                   <update id="updateHTConfigBasicMultiple" parameterType="Map">
                       UPDATE SAL0090D
                           SET SRV_CODY_ID = (SELECT MEM_ID FROM ORG0001D WHERE MEM_CODE = #{memCode} ),
                               SRV_REM = #{remark},
                               SRV_UPD_USER_ID = #{updUserId},
                               SRV_UPD_DT = SYSDATE
                         WHERE   SRV_STUS_ID = 1
                         AND SRV_SO_ID IN
                         <foreach item="item" collection="salesOrdListSp" index="index" open="(" separator="," close=")">
                          #{item}
                           </foreach>

                     </update>

                     <update id="updateAssignHTMultiple" parameterType="Map">
                       UPDATE SVC0008D
                           SET CODY_ID = (SELECT MEM_ID FROM ORG0001D WHERE MEM_CODE = #{memCode} ),
                               REM = #{remark},
                               UPD_USER_ID = #{updUserId},
                               UPD_DT = SYSDATE
                         WHERE   STUS_CODE_ID = 1
                         AND SCHDUL_ID IN
                         <foreach item="item" collection="schdulListSp" index="index" open="(" separator="," close=")">
                          #{item}
                           </foreach>

                     </update>

       <select id="selectHsOrder1Time" parameterType="Map" resultType="egovMap">
         SELECT  DISTINCT SALES_ORD_ID
         FROM  SVC0008D
         WHERE 1=1
         AND STUS_CODE_ID IN (4,10)
         AND SALES_ORD_ID IN (
             SELECT SRV_ORD_ID
             from SAL0225D SOM
             where SOM.SRV_ORD_ID = #{saleOrdIdList} AND APP_TYPE_ID IN (5701 , 3216) AND STUS_CODE_ID = 4
         )

        </select>

               <select id="selectHsOrderTotal1Year" parameterType="Map" resultType="Integer">
    SELECT  COUNT(NVL(SALES_ORD_ID,0)) AS TOTAL
         FROM  SVC0008D
         WHERE 1=1
         AND STUS_CODE_ID IN (4)
         AND SALES_ORD_ID IN (
             SELECT SRV_ORD_ID
             from SAL0225D SOM
             where SOM.SRV_ORD_ID = #{saleOrdIdList} AND APP_TYPE_ID IN (5702 , 3217) AND STUS_CODE_ID = 4
         )
        </select>


                       <select id="selectTotalCS" parameterType="Map" resultType="Integer">
    SELECT  COUNT(NVL(SALES_ORD_ID,0)) AS TOTAL
         FROM  SVC0008D
         WHERE 1=1
         AND STUS_CODE_ID IN (4)
         AND SALES_ORD_ID IN (
             SELECT SRV_ORD_ID
             from SAL0225D SOM
             where SOM.SRV_ORD_ID = #{saleOrdIdList} AND STUS_CODE_ID = 4
         )
        </select>

<select id="selectCSOrderView" parameterType="Map" resultType="egovMap">
    SELECT Extent1.ORD_ID ORD_ID ,
        Extent1.ORD_NO ORD_NO ,
        Extent1.ORD_STUS_CODE ORD_STUS_CODE ,
        Extent1.APP_TYPE_CODE APP_TYPE_CODE ,
        Extent1.STOCK_CODE STOCK_CODE ,
        Extent1.STOCK_DESC STOCK_DESC ,
        Extent1.CUST_NAME CUST_NAME ,
        Extent1.CUST_NRIC CUST_NRIC ,

        Extent2.INST_STATE INST_STATE ,
        Extent2.INST_AREA INST_AREA ,
        Extent2.INST_CNT_NAME INST_CNT_NAME ,
        Extent2.INST_CNT_TEL_M INST_CNT_TEL_M ,
        Extent2.INST_CNT_TEL_O INST_CNT_TEL_O ,
        Extent2.INST_CNT_TEL_R INST_CNT_TEL_R ,
        Extent2.LAST_INSTALL_NO LAST_INSTALL_NO ,
        Extent2.LAST_INSTALL_CT_CODE LAST_INSTALL_CT_CODE ,
        Extent2.LAST_INSTALL_CT_NAME LAST_INSTALL_CT_NAME ,
        Extent2.LAST_INSTALL_DT LAST_INSTALL_DT ,
        Extent2.LAST_INSTALL_SIRIM_NO LAST_INSTALL_SIRIM_NO ,
        Extent2.LAST_INSTALL_SERIAL_NO LAST_INSTALL_SERIAL_NO ,
        Extent2.INSTCT INSTCT ,

        Extent4.STK_ID STK_ID ,
        Extent5.CODE_NAME CODE_NAME ,
        (Extent1.ORD_DT) C1 ,
        Extent2.LAST_INSTALL_DT C2 ,
        CASE WHEN ( NOT ( ( Extent3.ORD_ID IS NULL ) AND ( Extent3.CONFIG_SETT_INS IS NULL ) AND ( Extent3.CONFIG_SETT_BS IS NULL )
                        AND ( Extent3.CONFIG_SETT_AS IS NULL ) AND ( Extent3.CONFIG_BS_GEN IS NULL ) AND ( Extent3.CONFIG_BS_MEM_ID IS NULL )
                        AND ( Extent3.CONFIG_BS_WEEK IS NULL ) AND ( Extent3.CONFIG_BS_REM IS NULL ) AND ( Extent3.SRV_MEM_ID IS NULL )
				        AND ( Extent3.SRV_MEM_NO IS NULL ) AND ( Extent3.SRV_MEM_BILL_NO IS NULL ) AND ( Extent3.SRV_MEM_PAC_ID IS NULL )
				        AND ( Extent3.SRV_MEM_PAC_CODE IS NULL ) AND ( Extent3.SRV_MEM_PAC_NAME IS NULL ) AND ( Extent3.SRV_MEM_FREQ IS NULL )
				        AND ( Extent3.SRV_MEM_DUR IS NULL ) AND ( Extent3.SRV_MEM_SALESMAN_CODE IS NULL ) AND ( Extent3.SRV_MEM_SALESMAN_NAME IS NULL ) )
				  ) THEN Extent3.CONFIG_ID ELSE 0 END C3 ,
        Extent3.SRV_MEM_PAC_NAME SRV_MEM_PAC_NAME ,
        Extent3.SRV_MEM_EXPR_DT SRV_MEM_EXPR_DT

	FROM ( SELECT * FROM SAL1006V vOrderBasicInfo ) Extent1
	JOIN ( SELECT * FROM SAL1010V vOrderInstallationInfo ) Extent2 ON Extent1.ORD_ID = Extent2.ORD_ID
	LEFT JOIN ( SELECT * FROM SAL1014V vOrderSrvMemConfigInfo ) Extent3 ON Extent1.ORD_ID = Extent3.ORD_ID
	JOIN SYS0026M Extent4 ON ( Extent1.STOCK_CODE = Extent4.STK_CODE ) OR ( ( Extent1.STOCK_CODE IS NULL ) AND ( Extent4.STK_CODE IS NULL ) )
	JOIN SYS0013M Extent5 ON Extent4.STK_CTGRY_ID = Extent5.CODE_ID
    <![CDATA[WHERE Extent1.ORD_ID = #{salesOrdId} AND ROWNUM <= 1 ]]>
</select>


<select id="checkMatOrFra" parameterType="Map" resultType="egovMap">
			SELECT  A.SALES_ORD_NO,
			            B.ITM_STK_ID,
			            C.STK_DESC ,
			            C.STK_CTGRY_ID
			FROM SAL0001D A
			JOIN SAL0002D B ON B.SALES_ORD_ID = A.SALES_ORD_ID
			JOIN SYS0026M C ON C.STK_ID = B.ITM_STK_ID
			WHERE A.SALES_ORD_ID = #{salesOrdId}


</select>

<!-- Added for solving HS Result number being wasted issue. Hui Ding, 2020-10-21 -->
<select id="getHsResultDocNo" parameterType="Map" resultType="egovMap">
      <![CDATA[
               SELECT FN_GET_DOCNO(#{DOCNO})  hsrno  FROM DUAL
       ]]>
</select>
</mapper>