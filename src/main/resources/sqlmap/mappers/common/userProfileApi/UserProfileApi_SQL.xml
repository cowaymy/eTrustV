<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.coway.trust.biz.common.userProfileApi.impl.UserProfileApiMapper">

  <select id="selectUserProfile" parameterType="Map" resultType="egovMap">
    <![CDATA[
      SELECT B.MEM_CODE AS MEM_CODE
               , B.NAME AS MEM_NAME
               , C.CODE_NAME || CASE WHEN C.CODE_DESC = 'HP' THEN '[HP Type]'
                 ELSE NULL END AS MEM_TYPE_NAME
               , D.NAME AS MEM_STATUS
               , E.CODE AS BRNCH_CODE
               , E.NAME AS BRNCH_NAME
               , CASE WHEN NVL(O1.MEM_LVL, 0) = 4 THEN O3.DEPT_CODE
                         WHEN NVL(O1.MEM_LVL, 0) = 3 THEN O2.DEPT_CODE
                         WHEN NVL(O1.MEM_LVL, 0) = 2 THEN O1.DEPT_CODE
                         ELSE NULL END AS GRP_CODE
               , CASE WHEN NVL(O1.MEM_LVL, 0) = 4 THEN O3.DEPT_CODE
                         WHEN NVL(O1.MEM_LVL, 0) = 3 THEN O2.DEPT_CODE
                         WHEN NVL(O1.MEM_LVL, 0) = 2 THEN O1.DEPT_CODE
                         ELSE NULL END AS ORG_CODE
               , CASE WHEN NVL(O1.MEM_LVL, 0) IN (3, 4) THEN O1.DEPT_CODE
                         ELSE NULL END AS DEPT_CODE
               , F.NAME AS BANK_NAME
               , B.BANK_ACC_NO AS BANK_ACC_NO
               , B.TEL_MOBILE AS MEM_HPNO
               , B.EMAIL AS MEM_EMAIL
       FROM SYS0047M A
       INNER JOIN ORG0001D B ON A.HR_CODE = B.MEM_CODE
       INNER JOIN SYS0013M C ON C.CODE_MASTER_ID = 1
                                         AND B.MEM_TYPE = C.CODE_ID
       INNER JOIN SYS0038M D ON  B.STUS = D.STUS_CODE_ID
       LEFT OUTER JOIN SYS0005M E ON B.BRNCH = E.BRNCH_ID
       LEFT OUTER JOIN SYS0004M F ON F.STUS_CODE_ID = 1
                                                AND B.BANK = F.BANK_ID
       LEFT JOIN ORG0005D O1 ON B.MEM_ID = O1.MEM_ID
       LEFT JOIN ORG0005D O2 ON O2.MEM_ID = O1.MEM_UP_ID
       LEFT JOIN ORG0005D O3 ON O3.MEM_ID = O2.MEM_UP_ID
       LEFT JOIN ORG0005D O4 ON O4.MEM_ID = O3.MEM_UP_ID
       LEFT JOIN ORG0005D O5 ON O5.MEM_ID = O4.MEM_UP_ID
       WHERE   A.USER_NAME = #{userName}
    ]]>
  </select>

  <select id="selectUserRole" parameterType="Map" resultType="egovMap">
    SELECT A.ROLE_CODE AS USER_ROLE
    FROM SYS0044M A
    INNER JOIN SYS0045M B ON A.ROLE_ID = B.ROLE_ID
    INNER JOIN SYS0047M C ON B.USER_ID = C.USER_ID
    WHERE 1=1
        AND C.USER_NAME = #{userName}
        AND A.ROLE_ID IN ( SELECT CODE
                                     FROM SYS0094M
                                     WHERE IND = 'ACI_ROLE')
  </select>
</mapper>