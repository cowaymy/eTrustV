<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.coway.trust.biz.common.impl.MainNoticeMapper">

	<select id="selectDailyCount" parameterType="Map" resultType="egovMap">
	<![CDATA[
			WITH VIEW_COUNT
						AS 
            (
            SELECT 
                 /* view [Vw_NeoSales] */
                  (SELECT COUNT(1) FROM SAL1058V) NEO_SALES
                ,/*(rental) (66)*/  
                  (SELECT COUNT(SALES_ORD_ID)  from   SAL0001D where  PV_YEAR = (SELECT EXTRACT(YEAR from SYSDATE) FROM DUAL) and PV_MONTH = (SELECT EXTRACT(MONTH from SYSDATE) FROM DUAL) and APP_TYPE_ID=66) RENTAL    
                ,/*OUTRIGHT (67)*/ 
                  (SELECT COUNT(SALES_ORD_ID)  from   SAL0001D where  PV_YEAR = (SELECT EXTRACT(YEAR from SYSDATE) FROM DUAL) and PV_MONTH = (SELECT EXTRACT(MONTH from SYSDATE) FROM DUAL) and APP_TYPE_ID=67) OUT_RIGHT
                ,/* Installment  (68) */
                  (SELECT COUNT(SALES_ORD_ID)  from   SAL0001D where  PV_YEAR = (SELECT EXTRACT(YEAR from SYSDATE) FROM DUAL) and PV_MONTH = (SELECT EXTRACT(MONTH from SYSDATE) FROM DUAL) and APP_TYPE_ID=68) INSTALLMENT
                ,/*SALES(Key_in)*/
                  (SELECT COUNT(SALES_ORD_ID) FROM SAL0001D WHERE EXTRACT (YEAR from CRT_DT) = (SELECT EXTRACT(YEAR from SYSDATE) FROM DUAL)  AND EXTRACT (MONTH from CRT_DT) = (SELECT EXTRACT(MONTH from SYSDATE) FROM DUAL)  AND 8 <> STUS_CODE_ID  AND APP_TYPE_ID IN (66,67,68) ) SALES
             FROM DUAL
             )
             SELECT NEO_SALES
                  , SALES 
                  , RENTAL
                  , OUT_RIGHT
                  , INSTALLMENT
                  , (RENTAL + OUT_RIGHT + INSTALLMENT) TOTAL
               FROM VIEW_COUNT
        
	]]>
	</select>


	<select id="selectMainNotice" parameterType="Map" resultType="egovMap">
		<![CDATA[
		SELECT *
		FROM (
				SELECT   NTCE_NO
						,NTCE_SUBJECT
						,RGST_USER_NM
						,READ_CNT
						,CRT_DT
						,EMGNCY_FLAG
						,SYSDATE
						,CASE
							WHEN SYSDATE - CRT_DT >= 1
							   THEN 'N'
							ELSE 'Y'
						 END IMG_FLAG
					FROM SYS0069M
				   WHERE STUS_FLAG = 'N'
					 AND (    SYSDATE >= NVL (NTCE_START_DT, TO_DATE ('19900101', 'YYYYMMDD') )
						  AND SYSDATE < NVL (NTCE_END_DT, TO_DATE ('29900101', 'YYYYMMDD') ) + 1
						 )
				ORDER BY NVL (EMGNCY_FLAG, 'N') DESC, NTCE_NO DESC
		) TBL
		WHERE ROWNUM <= 5
		]]>
	</select>

</mapper>