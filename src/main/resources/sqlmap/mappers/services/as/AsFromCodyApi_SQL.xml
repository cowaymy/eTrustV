<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.coway.trust.biz.services.as.impl.AsFromCodyApiServiceMapper">

  <insert id="insertAsFromCodyRequest" parameterType="Map"  >
    INSERT  /* [.com/coway/trust/biz/services/as/impl/AsFromCodyApiServiceMapper.java] */
    INTO SVC0130D( AS_CD_SEQ
                          , SALES_ORDER_NO
                          , STUS
                          , CUST_NAME
                          , PRODUCT_CODE
                          , PRODUCT_NAME
                          , APP_TYPE
                          , SALES_PROMOTION
                          , CONTRACT_DURATION
                          , OUTSTANDING
                          , SIRIM_NO
                          , SERIAL_NO
                          , MEMBERSHIP_CONTRACT_EXPIRY
                          , DSC_CODE
                          , PROD_CAT
                          , REG_ID
                          , DEFECT_CODE
                          , DEFECT_DESC
                          , CRT_USER_ID
                          , CRT_DT
                          , UPD_USER_ID
                          , UPD_DT
                          , REMARK

    ) VALUES ( SVC0130D_ID_SEQ.NEXTVAL
                  ,#{salesOrderNo}
                  ,#{stus}
                  ,#{custName}
                  ,#{productCode}
                  ,#{productName}
                  ,#{appType}
                  ,#{salesPromotion}
                  ,#{contractDuration}
                  ,#{outstanding}
                  ,#{sirimNo}
                  ,#{serialNo}
                  ,#{membershipContractExpiry}
                  ,#{dscCode}
                  ,#{prodCat}
                  ,#{regId}
                  ,#{defectCode}
                  ,#{defectDesc}
                  ,#{crtUserId}
                  ,SYSDATE
                  ,#{updUserId}
                  ,SYSDATE
                  ,#{remark}
    )
  </insert>



  <select id="selectSubmissionRecords" parameterType="Map" resultType="egovMap">
<![CDATA[
SELECT DISTINCT SALES_ORDER_NO FROM SVC0130D
WHERE EXTRACT(MONTH FROM CRT_DT) IN (SELECT EXTRACT(MONTH FROM SYSDATE) FROM dual)
AND EXTRACT(YEAR FROM CRT_DT) IN (SELECT EXTRACT(YEAR FROM SYSDATE) FROM dual)
AND SALES_ORDER_NO = #{salesOrderNo}
AND STUS = '1'
]]>
</select>


  <select id="selectSubmissionRecordsAll" parameterType="Map" resultType="egovMap">

SELECT
    A.REG_ID AS USER_ID,
    A.SALES_ORDER_NO AS SALES_ORDER_NO,
    A.PROD_CAT AS PROD_CAT,
    C.CODE AS STUS,
    TO_CHAR (A.CRT_DT, 'YYYY-MM-DD') AS CRT_DT
FROM SVC0130D A
JOIN SYS0047M B on A.REG_ID = B.USER_NAME
JOIN SYS0038M C on C.STUS_CODE_ID = A.STUS
WHERE 1 = 1

        AND    B.USER_ID = #{userId}
    <if test="fromDate != null and fromDate != '' ">
            AND TO_CHAR (A.CRT_DT, 'YYYY-MM-DD') <![CDATA[>= ]]> TO_CHAR(TO_DATE (#{fromDate},   'YYYYMMDD'),'YYYY-MM-DD')
    </if>
    <if test="toDate != null and toDate != '' ">
            AND TO_CHAR (A.CRT_DT, 'YYYY-MM-DD') <![CDATA[<= ]]> TO_CHAR(TO_DATE (#{toDate},   'YYYYMMDD'),'YYYY-MM-DD')
    </if>

ORDER BY A.CRT_DT DESC

</select>


  <select id="selectOrderInfo" parameterType="Map" resultType="egovMap">
<![CDATA[

                  SELECT DISTINCT A.SALES_ORD_NO AS SALES_ORDER_NO
                        ,G.CODE AS PROD_CAT
                        ,A.APP_TYPE_ID AS APP_TYPE
                        ,C.EMAIL AS MAIL_ADDRESS
                        ,C.NRIC AS RESULTIC_MOBILE_NO
                        ,D.TYPE_ID AS customer_Type
                        ,D.CORP_TYPE_ID AS CORP_TYPE_ID
                        ,D.cust_id AS customer_Id
                        ,D.NAME AS cust_Name
                        ,F.STK_CODE AS product_Code
                        ,F.STK_DESC AS product_Name
                        ,TO_CHAR (E.SRV_EXPR_DT, 'YYYYMMDD') AS Membership_Contract_Expiry
                        ,TO_CHAR (NVL(S.ACC_DEBT_SUB_CURR_OTSTND_AGING,0)) AS outstanding

                  from SAL0001D A
                    JOIN SAL0002D B ON B.SALES_ORD_ID = A.SALES_ORD_ID
                    JOIN SAL0027D C ON C.CUST_ID = A.CUST_ID
                    JOIN SAL0029D D ON D.CUST_ID = A.CUST_ID
                    JOIN SAL0095D E ON E.SRV_SALES_ORD_ID = A.SALES_ORD_ID
                    JOIN SYS0026M F ON B.ITM_STK_ID = F.STK_ID
                    JOIN SYS0013M G ON G.CODE_ID = F.STK_CTGRY_ID
                    LEFT JOIN PAY0053S S ON S.ACC_DEBT_ORD_ID = A.SALES_ORD_ID

                  where A.SALES_ORD_NO = #{salesOrderNo}
                  AND C.STUS_CODE_ID = 9
                  AND ROWNUM < 2

]]>
</select>

</mapper>