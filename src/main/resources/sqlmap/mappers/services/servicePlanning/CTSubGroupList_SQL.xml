<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.coway.trust.biz.services.servicePlanning.impl.CTSubGroupListMapper">

<select id="selectCTSubGroupList" parameterType="Map" resultType="egovMap">
	SELECT 
        A.CODE, B.NAME, E.MEM_CODE || ' - ' || E.NAME MEM_CODE, E.MEM_ID,D.CT_SUB_GRP, D.LAST_GRP_CODE
        FROM SYS0005M A
        INNER JOIN ORG0001D B ON B.BRNCH = A.BRNCH_ID
        INNER JOIN ORG0005D C ON C.MEM_ID = B.MEM_ID AND C.MEM_LVL = '2'
        LEFT  JOIN ORG0005D D ON D.LAST_GRP_CODE = C.LAST_GRP_CODE AND D.MEM_LVL = '4' 
        INNER JOIN ORG0001D E ON E.MEM_ID = D.MEM_ID AND E.STUS = '1'
        WHERE A.TYPE_ID = '43'
        <if test="dscCode != null and dscCode != ''">
          AND LOWER(A.CODE) = LOWER(#{dscCode})
        </if>
        <if test="memCode != null and memCode != ''">
          AND  LOWER(B.MEM_CODE) =LOWER(#{memCode})
        </if>
         <if test="CTMemId != null and CTMemId != ''">
          AND LOWER(E.MEM_CODE)  = LOWER(#{CTMemId})
        </if>
        <if test="ctSubGrp != null and ctSubGrp != ''">
          AND LOWER(D.CT_SUB_GRP)  = LOWER(#{ctSubGrp})
        </if>
        ORDER BY CODE
</select>

<update id="insertCTSubGroup" parameterType="Map">
    UPDATE ORG0005D SET 
    CT_SUB_GRP = #{ctSubGrp}
    WHERE MEM_ID = #{memId}
</update>

<update id="updateCTSubGroupByExcel" parameterType="Map">
    UPDATE ORG0005D SET 
    CT_SUB_GRP = #{ctSubGrp}
    WHERE MEM_ID = #{memId}
</update>

<select id="selectCTAreaSubGroupList" parameterType="Map" resultType="egovMap">
     SELECT A.AREA_ID,
         B.AREA,
         B.CITY,
         B.POSTCODE,
         B.STATE,
         A.REQST_NO,
         TO_CHAR(A.PRIOD_FROM,'YYYY-MM-DD') PRIOD_FROM,
         TO_CHAR(A.PRIOD_TO,'YYYY-MM-DD') PRIOD_TO,
         CASE WHEN (A.LOC_TYPE='L') THEN 'Local' 
         WHEN (A.LOC_TYPE='O') THEN 'OutStation'
         ELSE ''
         END LOC_TYPE,
         A.SVC_WEEK,
         A.CT_SUB_GRP
	   FROM ORG0019M A
		INNER JOIN  SYS0064M B ON A.AREA_ID = B.AREA_ID AND A.AVAIL_FLAG = 'Y'
        WHERE A.BRNCH_TYPE = 43
	     <if test="dscCode != null and dscCode != ''">
          AND  B.CT_BRNCH_CODE = #{dscCode}
        </if>
        <if test="areaId != null and areaId != ''">
          AND  B.AREA_ID = #{areaId}
        </if>
        <if test="area != null and area != ''">
          AND  B.AREA = #{area}
        </if>
        <if test="city != null and city != ''">
          AND  B.CITY = #{city}
        </if>
        <if test="postCode != null and postCode != ''">
          AND  B.POSTCODE = #{postCode}
        </if>
        <if test="state != null and state != ''">
          AND  B.STATE = #{state}
        </if>
        <if test="ctSubGrp != null and ctSubGrp != ''">
          AND  B.CT_SUB_GRP = #{ctSubGrp}
        </if>
	   ORDER BY CT_SUB_GRP
</select>
<update id="insertCTSubAreaGroup" parameterType="Map">
    UPDATE ORG0019M SET
		PRIOD_FROM =TO_DATE(#{priodFrom},'YYYY/MM/DD'),
		PRIOD_TO = TO_DATE(#{priodTo},'YYYY/MM/DD'),
		LOC_TYPE = #{locType},
		SVC_WEEK = #{serviceWeek},
		UPD_DT = SYSDATE
	WHERE AREA_ID = #{areaId} 
	AND BRNCH_TYPE = 43
	AND AVAIL_FLAG = 'Y'
</update>
<select id="selectCTSubGroupDscList" parameterType="Map" resultType="egovMap">
        SELECT DISTINCT CT_SUB_GRP CODE_ID, CT_SUB_GRP CODE_NAME
		  FROM SYS0064M
		 WHERE CT_BRNCH_CODE = #{branchCode}
</select>
<select id="selectCTM" parameterType="Map" resultType="egovMap">
        SELECT 
        A.CODE CODE_ID, B.NAME CODE_NAME
        FROM SYS0005M A
        INNER JOIN ORG0001D B ON B.BRNCH = A.BRNCH_ID
        INNER JOIN ORG0005D C ON C.MEM_ID = B.MEM_ID AND C.MEM_LVL = '2'
        WHERE 1=1
        <if test="dscCodeList != null and dscCodeList != '' ">
             AND A.CODE IN
           <foreach item="item" collection="dscCodeList" index="index" open="(" separator="," close=")">
           #{item}
           </foreach>
        </if>
</select>

<select id="selectCTMByDSC" parameterType="Map" resultType="egovMap">
	SELECT A.MEM_CODE  CODE_ID
	     , A.MEM_CODE || '-' || A.NAME CODE_NAME
	FROM ORG0001D A, ORG0005D B, SYS0005M C
	WHERE  A.MEM_ID = B.MEM_ID
	AND    A.BRNCH  =  C.BRNCH_ID
	AND    B.MEM_LVL = '2'
	AND    A.STUS = '1'
	<if test="groupCode != null and groupCode !='' ">
	       AND    C.CODE = #{groupCode}
	</if>

</select>

<select id="selectCTMByDSC_ID" parameterType="Map" resultType="egovMap">
    SELECT A.MEM_ID  CODE_ID
         , A.MEM_CODE || '-' || A.NAME CODE_NAME
    FROM ORG0001D A, ORG0005D B, SYS0005M C
    WHERE  A.MEM_ID = B.MEM_ID
    AND    A.BRNCH  =  C.BRNCH_ID
    AND    B.MEM_LVL = '2'
    AND    A.STUS = '1'
    <if test="groupCode != null and groupCode !='' ">
           AND    C.CODE = #{groupCode}
    </if>

</select>


<select id="selectCTSubGrb" parameterType="Map" resultType="egovMap">
    SELECT DISTINCT CT_SUB_GRP CODE_ID
    , CT_SUB_GRP  CODE_NAME
    FROM SYS0064M
    WHERE 1=1
    <if test="groupCode != null and groupCode !='' ">
           AND    CT_BRNCH_CODE = #{groupCode}
    </if>

</select>



</mapper>