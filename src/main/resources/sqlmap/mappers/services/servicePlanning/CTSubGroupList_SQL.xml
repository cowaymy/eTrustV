<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.coway.trust.biz.services.servicePlanning.impl.CTSubGroupListMapper">

<select id="selectCTSubGroupList" parameterType="Map" resultType="egovMap">
	SELECT B.CODE,B.NAME,C.MEM_CODE, C.MEM_ID,C.CT_SUB_GRP
	FROM SYS0005M A 
	        , (SELECT B.MEM_ID, B.BRNCH, A.CODE, B.NAME
	                FROM SYS0005M A 
	                         ,ORG0001D B 
	                         ,ORG0005D C
	                where 1=1
	                    and  A.BRNCH_ID = B.BRNCH 
	                    and  C.MEM_ID = B.MEM_ID
	                    AND B.MEM_TYPE=3 AND C.MEM_LVL=2  
	                    and  A.CODE =#{dscCode} AND ROWNUM=1 ) B  
	          ,(SELECT B.MEM_ID,B.MEM_CODE,C.CT_SUB_GRP--A.DSC_CODE, B.CTM_NAME, B.CT_CODE, C.SUB_GROUP 
	                FROM SYS0005M A 
	                        ,ORG0001D B 
	                        , ORG0005D C 
	                where 1=1  
	                and  A.BRNCH_ID = B.BRNCH
	                and  C.MEM_ID = B.MEM_ID
	                AND B.MEM_TYPE=3 
	                AND C.MEM_LVL=4 
	                AND B.STUS=1 
	                AND C.LAST_GRP_CODE =((SELECT C.LAST_GRP_CODE
                    FROM SYS0005M A 
                             ,ORG0001D B 
                             ,ORG0005D C
                    where 1=1
                        and  A.BRNCH_ID = B.BRNCH 
                        and  C.MEM_ID = B.MEM_ID
                        AND B.MEM_TYPE=3 AND C.MEM_LVL=2  
                        and  A.CODE =#{dscCode} AND ROWNUM=1))) C
	where  1=1
	and A.BRNCH_ID = B.BRNCH  
</select>

<update id="insertCTSubGroup" parameterType="Map">
    UPDATE ORG0005D SET 
    CT_SUB_GRP = #{ctSubGrp}
    WHERE MEM_ID = #{memId}
</update>

<select id="selectCTAreaSubGroupList" parameterType="Map" resultType="egovMap">
     SELECT A.AREA_ID,
         B.AREA,
         B.CITY,
         B.POSTCODE,
         B.STATE,
         A.REQST_NO,
         TO_CHAR(A.PRIOD_FROM,'YYYY-MM-DD') PRIOD_FROM,
         TO_CHAR(A.PRIOD_TO,'YYYY-MM-DD') PRIOD_TO,
         CASE WHEN (A.LOC_TYPE='L') THEN 'Local' 
         WHEN (A.LOC_TYPE='O') THEN 'OutStation'
         ELSE ''
         END LOC_TYPE,
         A.SVC_WEEK,
         A.CT_SUB_GRP
    FROM ORG0019M A INNER JOIN SYS0064M B ON A.AREA_ID = B.AREA_ID
   WHERE A.BRNCH_TYPE = 43
     AND A.AVAIL_FLAG = 'Y'
   AND B.CT_BRNCH_CODE=#{dscCode} 
ORDER BY CT_SUB_GRP
</select>
<update id="insertCTSubAreaGroup" parameterType="Map">
    UPDATE ORG0019M SET
		PRIOD_FROM =TO_DATE(#{priodFrom},'YYYY/MM/DD'),
		PRIOD_TO = TO_DATE(#{priodTo},'YYYY/MM/DD'),
		LOC_TYPE = #{locType},
		SVC_WEEK = #{serviceWeek}
	WHERE AREA_ID = #{areaId} 
	AND BRNCH_TYPE = 43
	AND AVAIL_FLAG = 'Y'
</update> 
</mapper>