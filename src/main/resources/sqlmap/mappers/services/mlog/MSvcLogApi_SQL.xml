<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.coway.trust.biz.services.mlog.impl.MSvcLogApiMapper">







    <select id="getHeartServiceJobList" parameterType="Map" resultType="egovMap">
    
						SELECT OR1.MEM_CODE AS settled_By,
						       S01.SALES_ORD_NO AS sales_OrderNo,
						       S01.APP_TYPE_ID AS app_Type,
						       S17.PROMO_ID AS sales_Promotion,
						       S22.CUST_ACC_BANK_ID AS bank_Code,
						       S22.CUST_ACC_NO AS cardAccount_No,
						       S27.TEL_M1 AS handphone_Tel,
						       S27.TEL_O AS home_Tel,
						       S27.TEL_R AS office_Tel,
						       S27.EMAIL AS mail_Address,
						       S27.NRIC AS resultIc_MobileNo,
						       S29.NAME AS cust_Name,
						       S29.corp_type_id AS customer_Type,
						       S29.cust_id AS customer_Id,
						       S45.BRNCH_ID AS dsc_Code,
						       S47.SIRIM_NO AS sirim_No,
						       S47.SERIAL_NO AS serial_No,
						       SV6.REN_COLCT_ID AS rc_Code,
						       SV6.FAIL_RESN_ID AS fail_ReasonCode,
						       SV8.NO AS service_No,
						       SV8.STUS_CODE_ID AS job_Status,
						       SV8.YEAR AS plan_Year,
						       SV8.MONTH AS plan_Month,
						       SYS.STK_DESC AS product_Name,
						       SYS.STK_CODE AS product_Code
						  FROM SVC0008D SV8
						       INNER JOIN SAL0001D S01
						          ON S01.SALES_ORD_ID = SV8.SALES_ORD_ID
						       INNER JOIN SAL0002D S02
						          ON S02.SALES_ORD_ID = S01.SALES_ORD_ID
						       INNER JOIN SAL0017D S17
						          ON S17.PROMO_ID = S01.PROMO_ID
						       INNER JOIN SAL0022D S22
						          ON S22.CUST_ID = S01.CUST_ID
						       INNER JOIN SAL0027D S27
						          ON S27.CUST_ID = S01.CUST_ID
						       INNER JOIN SAL0029D S29
						          ON S29.CUST_ID = S01.CUST_ID
						       INNER JOIN SAL0045D S45
						          ON S45.SALES_ORD_ID = S01.SALES_ORD_ID
						       INNER JOIN SAL0046D S46
						          ON S46.SALES_ORD_ID = S01.SALES_ORD_ID
						       INNER JOIN SAL0047D S47
						          ON S47.ENTRY_ID = S46.INSTALL_ENTRY_ID
						       INNER JOIN SVC0006D SV6
						          ON SV6.SCHDUL_ID = SV8.SCHDUL_ID
						       INNER JOIN ORG0001D OR1
						          ON OR1.MEM_ID = S46.CT_ID
						       INNER JOIN SYS0026M SYS
						          ON SYS.STK_ID = S02.ITM_STK_ID
                                 AND SV8.YEAR  = TO_CHAR(to_date(#{requestDate}  ,'YYYY/MM'),'YYYY')
                                 AND SV8.MONTH = TO_CHAR(to_date(#{requestDate} ,'YYYY/MM'),'MM')     
                                 AND OR1.MEM_CODE = #{userId}
                   
     </select> 






    <select id="getAfterServiceJobList" parameterType="Map" resultType="egovMap">
    
			SELECT B.SALES_ORD_NO AS salesOrderNo,
			       F.AS_RESULT_NO AS serviceNo,
			       A.NAME,
			       'AS' AS jobType,
			       G.AS_RESULT_STUS_ID AS jobStatus,
			       F.AS_SETL_DT AS appointmentDate,
			       F.AS_SETL_TM AS appointmentTime,
			       D.CODE,
			       C.AS_NO,
			       C.AS_REQST_DT,
			       J.CODE,
			       F.AS_RESULT_NO,
			       H.NAME,
			       B.SALES_ORD_NO,
			       I.CODE APP_TYPE,
			       A.NAME,
			       A.NRIC SVC0004D
			  FROM SAL0029D A
			       INNER JOIN SAL0001D B
			          ON B.CUST_ID = A.CUST_ID
			       INNER JOIN SVC0001D C
			          ON C.AS_SO_ID = B.SALES_ORD_ID
			       INNER JOIN SVC0004D F
			          ON F.AS_ENTRY_ID = C.AS_ID
			       INNER JOIN SVC0004D G
			          ON G.AS_RESULT_ID = F.AS_RESULT_ID
			       INNER JOIN SYS0038M C
			          ON C.STUS_CODE_ID = F.AS_RESULT_STUS_ID
			       INNER JOIN SYS0038M J
			          ON J.STUS_CODE_ID = C.AS_STUS_ID
			       INNER JOIN SYS0013M D
			          ON D.CODE_ID = C.AS_TYPE_ID
			       INNER JOIN ORG0001D H
			          ON H.MEM_ID = G.AS_CT_ID
			       INNER JOIN SYS0013M I
			          ON I.CODE_ID = B.APP_TYPE_ID
			 WHERE     1 = 1
			     AND C.AS_REQST_DT = TO_DATE (to_date(#{requestDate}, 'YYYYMMDD')
			     AND A.CODY_ID = #{userId}  

                   
     </select> 




	    <select id="getAfterServiceJobList" parameterType="Map" resultType="egovMap">
	    
	            SELECT B.SALES_ORD_NO AS salesOrderNo,
	                   F.AS_RESULT_NO AS serviceNo,
	                   A.NAME,
	                   'AS' AS jobType,
	                   G.AS_RESULT_STUS_ID AS jobStatus,
	                   F.AS_SETL_DT AS appointmentDate,
	                   F.AS_SETL_TM AS appointmentTime,
	                   D.CODE,
	                   C.AS_NO,
	                   C.AS_REQST_DT,
	                   J.CODE,
	                   F.AS_RESULT_NO,
	                   H.NAME,
	                   B.SALES_ORD_NO,
	                   I.CODE APP_TYPE,
	                   A.NAME,
	                   A.NRIC SVC0004D
	              FROM SAL0029D A
	                   INNER JOIN SAL0001D B
	                      ON B.CUST_ID = A.CUST_ID
	                   INNER JOIN SVC0001D C
	                      ON C.AS_SO_ID = B.SALES_ORD_ID
	                   INNER JOIN SVC0004D F
	                      ON F.AS_ENTRY_ID = C.AS_ID
	                   INNER JOIN SVC0004D G
	                      ON G.AS_RESULT_ID = F.AS_RESULT_ID
	                   INNER JOIN SYS0038M C
	                      ON C.STUS_CODE_ID = F.AS_RESULT_STUS_ID
	                   INNER JOIN SYS0038M J
	                      ON J.STUS_CODE_ID = C.AS_STUS_ID
	                   INNER JOIN SYS0013M D
	                      ON D.CODE_ID = C.AS_TYPE_ID
	                   INNER JOIN ORG0001D H
	                      ON H.MEM_ID = G.AS_CT_ID
	                   INNER JOIN SYS0013M I
	                      ON I.CODE_ID = B.APP_TYPE_ID
	             WHERE     1 = 1
	                 AND C.AS_REQST_DT = TO_DATE (to_date(#{requestDate}, 'YYYYMMDD')
	                 AND A.CODY_ID = #{userId}  
	     </select> 
	
	
	    <insert id="insertHeatLog" parameterType="Map">
	        INSERT INTO SVC0023T (
	           RESULT_SEQ
	           , RESULT_CRT_USER_ID
	           , SALES_ORD_ID
	           , SVC_NO
	           , TEMPER_SETTING
	           , NORESULT_REM
	           , NEXT_APPT_DATE
	           , NEXT_APPT_TIME
	           , OWNER_CODE
	           , RESULT_CUST_NAME
	           , RESULT_IC_MOBILE_NO
	           , RESULT_EMAIL_NO
	           , ACCEPTANCE_NAME
	           , REN_COLCT_ID
	           , SIGN_DATA
	           , BS_RESULT_PART_ID
	           , EXCH_REASON_ID
	           , BS_RESULT_PART_QTY
	           ,CRT_USER_ID
	           , CRT_DT
	           , TRNSC_ID
	           , TRAN_STUS_CD
	        ) VALUES (
	           SVC0023T_RESULT_SEQ.NEXTVAL
	           , #{userId}
	           , #{salesOrderNo}
	           , #{serviceNo}
	           , #{temperatureSetting}
	           , #{resultRemark}
	           , #{nextAppointmentDate}
	           , #{nextAppointmentTime}
	           , #{ownerCode}
	           , #{resultCustName}
	           , #{resultIcMobileNo}
	           , #{resultReportEmailNo}
	           , #{resultAcceptanceName}
	           , #{rcCode}
	           , #{signData}
	           , #{filterCode}
	           , #{exchangeId}
	           , #{filterChangeQty}
	           , #{userId}
	           , SYSDATE
	           , #{transactionId}
	           , 'N'
	        )
	    </insert>
	
	   <update id="updateSuccessStatus" parameterType="string">
	      UPDATE SVC0023T SET   TRAN_STUS_CD = 'Y' WHERE TRNSC_ID = #{transactionId}
	   </update>




</mapper>