<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.coway.trust.biz.services.mlog.impl.MSvcLogApiMapper">







    <select id="getHeartServiceJobList" parameterType="Map" resultType="egovMap">
    
						SELECT OR1.MEM_CODE AS settled_By,
						       S01.SALES_ORD_NO AS sales_OrderNo,
						       S01.APP_TYPE_ID AS app_Type,
						       S17.PROMO_ID AS sales_Promotion,
						       S22.CUST_ACC_BANK_ID AS bank_Code,
						       S22.CUST_ACC_NO AS cardAccount_No,
						       S27.TEL_M1 AS handphone_Tel,
						       S27.TEL_O AS home_Tel,
						       S27.TEL_R AS office_Tel,
						       S27.EMAIL AS mail_Address,
						       S27.NRIC AS resultIc_MobileNo,
						       S29.NAME AS cust_Name,
						       S29.corp_type_id AS customer_Type,
						       S29.cust_id AS customer_Id,
						       S45.BRNCH_ID AS dsc_Code,
						       S47.SIRIM_NO AS sirim_No,
						       S47.SERIAL_NO AS serial_No,
						       SV6.REN_COLCT_ID AS rc_Code,
						       SV6.FAIL_RESN_ID AS fail_ReasonCode,
						       SV8.NO AS service_No,
						       SV8.STUS_CODE_ID AS job_Status,
						       SV8.YEAR AS plan_Year,
						       SV8.MONTH AS plan_Month,
						       SYS.STK_DESC AS product_Name,
						       SYS.STK_CODE AS product_Code,
                              null as job_Type
                                ,null as appointment_Date
                                ,null as appointment_Time
                                ,null as job_Session
                                ,null as checkIn_Date
                                ,null as checkIn_Time
                                ,null as checkIn_Gps
                                ,null as service_State
                                ,null as customer_Gps
                                ,null as install_Address
                                ,null as postcode
                                ,null as customer_Va_No
                                ,null as customer_Jom_Pay_Ref_No
                                ,null as image_Url
                                ,null as instruction
                                ,null as contract_Duration
                                ,null as monthly_RentalFees
                                ,null as registrationFees
                                ,null as payment_Mode
                                ,null as payment_ModeName
                                ,null as bank_Name
                                ,null as outstanding
                                ,null as warranty
                                ,null as Membership_Contract_Expiry
                                ,null as rental_Status
                                ,null as last_Payment_Date
                                ,null as temperature_Setting
                                ,null as result_Remark
                                ,null as owner_Code
                                ,null as owner_Code_Nm
                                ,null as result_Cust_Name
                                ,null as result_Report_Email_No
                                ,null as result_Acceptance_Name
                                ,null as fail_Reason_Name
                                ,null as settled_Date
                                ,null as settled_Time
                                ,null as ren_Collection_Id
                                ,null as bsr_No
                                ,null as need_Filter
                                ,null as nextAppointment_Date
                                ,null as nextAppointment_Time
                                ,null as appType
                                ,null as salesPromotion
                                ,null as bankCode
                                ,null as dscCode
                                ,null as rcCode
                                ,null as failReasonCode
						  FROM SVC0008D SV8
						       INNER JOIN SAL0001D S01
						          ON S01.SALES_ORD_ID = SV8.SALES_ORD_ID
						       INNER JOIN SAL0002D S02
						          ON S02.SALES_ORD_ID = S01.SALES_ORD_ID
						       INNER JOIN SAL0017D S17
						          ON S17.PROMO_ID = S01.PROMO_ID
						       INNER JOIN SAL0022D S22
						          ON S22.CUST_ID = S01.CUST_ID
						       INNER JOIN SAL0027D S27
						          ON S27.CUST_ID = S01.CUST_ID
						       INNER JOIN SAL0029D S29
						          ON S29.CUST_ID = S01.CUST_ID
						       INNER JOIN SAL0045D S45
						          ON S45.SALES_ORD_ID = S01.SALES_ORD_ID
						       INNER JOIN SAL0046D S46
						          ON S46.SALES_ORD_ID = S01.SALES_ORD_ID
						       INNER JOIN SAL0047D S47
						          ON S47.ENTRY_ID = S46.INSTALL_ENTRY_ID
						       INNER JOIN SVC0006D SV6
						          ON SV6.SCHDUL_ID = SV8.SCHDUL_ID
						       INNER JOIN ORG0001D OR1
						          ON OR1.MEM_ID = S46.CT_ID
						       INNER JOIN SYS0026M SYS
						          ON SYS.STK_ID = S02.ITM_STK_ID
                                 AND SV8.YEAR  = TO_CHAR(to_date(#{requestDate}  ,'YYYY/MM'),'YYYY')
                                 AND SV8.MONTH = TO_CHAR(to_date(#{requestDate} ,'YYYY/MM'),'MM')     
                                 AND OR1.MEM_CODE = #{userId}
                   
     </select> 






    <select id="getAfterServiceJobList" parameterType="Map" resultType="egovMap">
    
			SELECT B.SALES_ORD_NO AS salesOrderNo,
			       F.AS_RESULT_NO AS serviceNo,
			       A.NAME,
			       'AS' AS jobType,
			       G.AS_RESULT_STUS_ID AS jobStatus,
			       F.AS_SETL_DT AS appointmentDate,
			       F.AS_SETL_TM AS appointmentTime,
			       D.CODE,
			       C.AS_NO,
			       C.AS_REQST_DT,
			       J.CODE,
			       F.AS_RESULT_NO,
			       H.NAME,
			       B.SALES_ORD_NO,
			       I.CODE APP_TYPE,
			       A.NAME,
			       A.NRIC SVC0004D
			  FROM SAL0029D A
			       INNER JOIN SAL0001D B
			          ON B.CUST_ID = A.CUST_ID
			       INNER JOIN SVC0001D C
			          ON C.AS_SO_ID = B.SALES_ORD_ID
			       INNER JOIN SVC0004D F
			          ON F.AS_ENTRY_ID = C.AS_ID
			       INNER JOIN SVC0004D G
			          ON G.AS_RESULT_ID = F.AS_RESULT_ID
			       INNER JOIN SYS0038M C
			          ON C.STUS_CODE_ID = F.AS_RESULT_STUS_ID
			       INNER JOIN SYS0038M J
			          ON J.STUS_CODE_ID = C.AS_STUS_ID
			       INNER JOIN SYS0013M D
			          ON D.CODE_ID = C.AS_TYPE_ID
			       INNER JOIN ORG0001D H
			          ON H.MEM_ID = G.AS_CT_ID
			       INNER JOIN SYS0013M I
			          ON I.CODE_ID = B.APP_TYPE_ID
			 WHERE     1 = 1
			     AND C.AS_REQST_DT = TO_DATE ('20170611',    'YYYYMMDD')      
<!-- 			     AND A.CODY_ID = #{userId} -->  

                   
     </select> 




 	    <select id="heartServiceParts" parameterType="Map" resultType="egovMap">
			    select *
		            from (
			            SELECT S01A.SALES_ORD_ID sales_Order_No, 
						             S01A.SALES_ORD_NO service_No,
						                S08A.NO,
						                S08A.YEAR,
						                S08A.MONTH,
						                S26A.STK_CODE AS product_Code,
						                S26B.STK_CODE AS part_Code,
						                S26B.STK_DESC as part_Name,
						                S87A.SRV_FILTER_STK_ID partId,
						                L44A.BOM_COMPNT,
						                L44A.COMPNT_QTY quanity,
						                S87A.SRV_FILTER_PRV_CHG_DT last_Chg_Date,
						                S87A.SRV_FILTER_PRIOD parts_Period ,
						                NVL2(L44A.ALTER_ITM_GRP, 'N', 'Y') AS alternative_YN,
						                S06A.RESULT_ID,
						                S07A.BS_RESULT_PART_ID,
						                S07A.BS_RESULT_PART_QTY,
						                CASE WHEN S07A.BS_RESULT_PART_QTY BETWEEN '1' AND '100' THEN 'Y' ELSE 'N'
						                END as chg_YN,
						                null as ex_Chgid ,
						                null as chg_Qty,
						                null as last_Chg_Time,
						                null as alternative_Used_YN,
						                null as alternative_Filter_Code,
						                null as alternative_Filter_Id,
						                null as alternative_Filter_Name,
						                null as filterBarcd_Chk_YN,
						                null as filterBarcd_Serial_No ,
				                       S90A.SRV_CODY_ID,
				                        (SELECT MEM_CODE
				                           FROM ORG0001D ME
				                          WHERE 1 = 1 AND ME.MEM_ID = S90A.SRV_CODY_ID) as cody_cd 
						FROM SAL0001D S01A
						INNER JOIN SAL0002D S02A ON S02A.SALES_ORD_ID = S01A.SALES_ORD_ID
						INNER JOIN SYS0026M S26A ON S26A.STK_ID = S02A.ITM_STK_ID
						INNER JOIN SAL0090D S90A ON S90A.SRV_SO_ID = S01A.SALES_ORD_ID
						INNER JOIN SAL0087D S87A ON S87A.SRV_CONFIG_ID = S90A.SRV_CONFIG_ID
						INNER JOIN SYS0026M S26B ON S26B.STK_ID = S87A.SRV_FILTER_STK_ID
						INNER JOIN LOG0043M L43A ON L43A.MATRL_NO = S26A.STK_CODE
						INNER JOIN LOG0044D L44A ON L44A.BOM = L43A.BOM AND L44A.BOM_COMPNT = S26B.STK_CODE
						INNER JOIN SVC0008D S08A ON S08A.SALES_ORD_ID = S01A.SALES_ORD_ID
						LEFT  JOIN SVC0006D S06A ON S06A.SCHDUL_ID = S08A.SCHDUL_ID
						LEFT  JOIN SVC0007D S07A ON S07A.BS_RESULT_ID = S06A.RESULT_ID
			             WHERE     1 = 1
			               and S08A.YEAR = TO_CHAR(to_date(#{requestDate}  ,'YYYY/MM'),'YYYY') 
			               and S08A.MONTH = TO_CHAR(to_date(#{requestDate} ,'YYYY/MM'),'MM')  
			               and S07A.BS_RESULT_PART_ID = '0'
		)                 
		 where  cody_cd =  #{userId}      
		 

	     </select>
	
	
	
	

        <select id="afterServiceParts" parameterType="Map" resultType="egovMap">
        
                SELECT null as sales_Order_No
                            ,null as ser_vice_No
                            ,null as product_Code
                            ,null as part_Code
                            ,null as part_Id
                            ,null as part_Name
                            ,null as quanity
                            ,null as ex_Chgid
                            ,null as chg_Qty
                            ,null as chg_YN
                            ,null as last_Chg_Date
                            ,null as last_Chg_Time
                            ,null as parts_Period
                            ,null as alternative_YN
                            ,null as alternative_Used_YN
                            ,null as alternative_Filter_Code
                            ,null as alternative_Filter_Id
                            ,null as alternative_Filter_Name
                  FROM SAL0029D A
                       INNER JOIN SAL0001D B
                          ON B.CUST_ID = A.CUST_ID
                       INNER JOIN SVC0001D C
                          ON C.AS_SO_ID = B.SALES_ORD_ID
                       INNER JOIN SVC0004D F
                          ON F.AS_ENTRY_ID = C.AS_ID
                       INNER JOIN SVC0004D G
                          ON G.AS_RESULT_ID = F.AS_RESULT_ID
                       INNER JOIN SYS0038M C
                          ON C.STUS_CODE_ID = F.AS_RESULT_STUS_ID
                       INNER JOIN SYS0038M J
                          ON J.STUS_CODE_ID = C.AS_STUS_ID
                       INNER JOIN SYS0013M D
                          ON D.CODE_ID = C.AS_TYPE_ID
                       INNER JOIN ORG0001D H
                          ON H.MEM_ID = G.AS_CT_ID
                       INNER JOIN SYS0013M I
                          ON I.CODE_ID = B.APP_TYPE_ID
                 WHERE     1 = 1
                     AND C.AS_REQST_DT = TO_DATE ('20170611',    'YYYYMMDD')      
                  <!--    AND A.CODY_ID = #{userId}   -->
         </select>
         
         	
	
	    <insert id="insertHeatLog" parameterType="Map">
	        INSERT INTO SVC0023T (
	           RESULT_SEQ
	           , RESULT_CRT_USER_ID
	           , SALES_ORD_ID
	           , SVC_NO
	           , TEMPER_SETTING
	           , NORESULT_REM
	           , NEXT_APPT_DATE
	           , NEXT_APPT_TIME
	           , OWNER_CODE
	           , RESULT_CUST_NAME
	           , RESULT_IC_MOBILE_NO
	           , RESULT_EMAIL_NO
	           , ACCEPTANCE_NAME
	           , REN_COLCT_ID
	           , SIGN_DATA
	           , BS_RESULT_PART_ID
	           , EXCH_REASON_ID
	           , BS_RESULT_PART_QTY
	           ,CRT_USER_ID
	           , CRT_DT
	           , TRNSC_ID
	           , TRAN_STUS_CD
	        ) VALUES (
	           SVC0023T_RESULT_SEQ.NEXTVAL
	           , #{userId}
	           , #{salesOrderNo}
	           , #{serviceNo}
	           , #{temperatureSetting}
	           , #{resultRemark}
	           , #{nextAppointmentDate}
	           , #{nextAppointmentTime}
	           , #{ownerCode}
	           , #{resultCustName}
	           , #{resultIcMobileNo}
	           , #{resultReportEmailNo}
	           , #{resultAcceptanceName}
	           , #{rcCode}
	           , #{signData}
	           , #{filterCode}
	           , #{exchangeId}
	           , #{filterChangeQty}
	           , #{userId}
	           , SYSDATE
	           , #{transactionId}
	           , 'N'
	        )
	    </insert>
	
	   <update id="updateSuccessStatus" parameterType="string">
	      UPDATE SVC0023T SET   TRAN_STUS_CD = 'Y' WHERE TRNSC_ID = #{transactionId}
	   </update>




</mapper>