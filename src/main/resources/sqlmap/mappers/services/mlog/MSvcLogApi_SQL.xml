<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.coway.trust.biz.services.mlog.impl.MSvcLogApiMapper">







    <select id="getHeartServiceJobList" parameterType="Map" resultType="egovMap">
    
						SELECT OR1.MEM_CODE AS settled_By,
						       S01.SALES_ORD_NO AS sales_Order_No,
						       S01.APP_TYPE_ID AS app_Type,
						       S17.PROMO_ID AS sales_Promotion,
						       S22.CUST_ACC_BANK_ID AS bank_Code,
						       S22.CUST_ACC_NO AS card_Account_No,
						       S27.TEL_M1 AS handphone_Tel,
						       S27.TEL_O AS home_Tel,
						       S27.TEL_R AS office_Tel,
						       S27.EMAIL AS mail_Address,
						       S27.NRIC AS resultIc_Mobile_No,
						       S29.NAME AS cust_Name,
						       S29.corp_type_id AS customer_Type,
						       S29.cust_id AS customer_Id,
						       S45.BRNCH_ID AS dsc_Code,
						       S47.SIRIM_NO AS sirim_No,
						       S47.SERIAL_NO AS serial_No,
						       SV6.REN_COLCT_ID AS rc_Code,
						       SV6.FAIL_RESN_ID AS fail_Reason_Code,
						       SV8.NO AS service_No,
						       SV8.STUS_CODE_ID AS job_Status,
						       SV8.YEAR AS plan_Year,
						       SV8.MONTH AS plan_Month,
						       SYS.STK_DESC AS product_Name,
						       SYS.STK_CODE AS product_Code
 						       ,
                                 '1' as job_Type
                                , '1'  as appointment_Date
                                , '1' as appointment_Time
                                , '1' as job_Session
                                , '1' as checkIn_Date
                                , '1' as checkIn_Time
                                , '1' as checkIn_Gps
                                , '1' as service_State
                                , '1' as customer_Gps
                                , '1' as install_Address
                                , '1' as postcode
                                , '1' as customer_Va_No
                                , '1' as customer_Jom_Pay_Ref_No
                                , '1' as image_Url
                                , '1' as instruction
                                , '1' as contract_Duration
                                , '1' as monthly_RentalFees
                                , '1' as registrationFees
                                , '1' as payment_Mode
                                , '1' as payment_ModeName
                                , '1' as bank_Name
                                , '1' as outstanding
                                , '1' as warranty
                                , '1' as Membership_Contract_Expiry
                                , '1' as rental_Status
                                , '1' as last_Payment_Date
                                , '1' as temperature_Setting
                                , '1' as result_Remark
                                , '1' as owner_Code
                                , '1' as owner_Code_Nm
                                , '1' as result_Cust_Name
                                , '1' as result_Report_Email_No
                                , '1' as result_Acceptance_Name
                                , '1' as fail_Reason_Name
                                , '1' as settled_Date
                                , '1' as settled_Time
                                , '1' as ren_Collection_Id
                                , '1' as bsr_No
                                , '1' as need_Filter
                                , '1' as nextAppointment_Date
                                , '1' as nextAppointment_Time
                                , '1' as appType
                                , '1' as salesPromotion
                                , '1' as bank_Code
                                , '1' as dsc_Code
                                , '1' as rc_Code
                                , '1' as failReason_Code 
						  FROM SVC0008D SV8
						       INNER JOIN SAL0001D S01
						          ON S01.SALES_ORD_ID = SV8.SALES_ORD_ID
						       INNER JOIN SAL0002D S02
						          ON S02.SALES_ORD_ID = S01.SALES_ORD_ID
						       INNER JOIN SAL0017D S17
						          ON S17.PROMO_ID = S01.PROMO_ID
						       INNER JOIN SAL0022D S22
						          ON S22.CUST_ID = S01.CUST_ID
						       INNER JOIN SAL0027D S27
						          ON S27.CUST_ID = S01.CUST_ID
						       INNER JOIN SAL0029D S29
						          ON S29.CUST_ID = S01.CUST_ID
						       INNER JOIN SAL0045D S45
						          ON S45.SALES_ORD_ID = S01.SALES_ORD_ID
						       INNER JOIN SAL0046D S46
						          ON S46.SALES_ORD_ID = S01.SALES_ORD_ID
						       INNER JOIN SAL0047D S47
						          ON S47.ENTRY_ID = S46.INSTALL_ENTRY_ID
						       INNER JOIN SVC0006D SV6
						          ON SV6.SCHDUL_ID = SV8.SCHDUL_ID
						       INNER JOIN ORG0001D OR1
						          ON OR1.MEM_ID = S46.CT_ID
						       INNER JOIN SYS0026M SYS
						          ON SYS.STK_ID = S02.ITM_STK_ID
                                 AND SV8.YEAR  = TO_CHAR(to_date(#{requestDate}  ,'YYYY/MM'),'YYYY')
                                 AND SV8.MONTH = TO_CHAR(to_date(#{requestDate} ,'YYYY/MM'),'MM')     
                                 AND OR1.MEM_CODE = #{userId}
                   
     </select> 






    <select id="getAfterServiceJobList" parameterType="Map" resultType="egovMap">
    
				SELECT SAL0001D.SALES_ORD_NO AS sales_Order_No,
				            SVC0001D.AS_NO AS service_No,
				            SAL0029D.NAME AS cust_Name,
				            SVC0001D.AS_STUS_ID AS job_Status,
				            to_char(SVC0001D.AS_APPNT_DT,'YYYYMMDD') AS appointment_Date,
				            SVC0001D.AS_APPNT_TM AS appointment_Time,
				            SVC0001D.AS_SESION_CODE AS job_Session,
				            SAL0029D.TYPE_ID AS customer_Type,
				            SAL0001D.CUST_ID AS customer_Id,
				            SAL0023D.ADDR_DTL AS install_Address,
				            SAL0027D.TEL_M1 AS handphone_Tel,
				            SAL0027D.TEL_R AS home_Tel,
				            SAL0027D.TEL_O AS office_Tel,
				            SAL0029D.EMAIL AS mail_Address,
				            SAL0029D.CUST_VA_NO AS customer_Va_No,
				            SAL0024D.CUST_BILL_PAY_REF_NO1 AS customer_Jom_Pay_Ref_No,
				            SYS0027M.IMG_URL AS image_Url,
				            SYS0026M.STK_DESC AS product_Name,
				            SYS0026M.STK_CODE AS product_Code,
				            SAL0001D.APP_TYPE_ID AS app_Type,
				            SAL0001D.PROMO_ID AS sales_Promotion,
				            SVC0001D.AS_REQSTER_TYPE_ID AS requestor,
				            SVC0001D.AS_REM_REQSTER_CNTC AS requestor_Contact,
				            SAL0095D.SRV_DUR AS contract_Duration,
				            SAL0001D.MTH_RENT_AMT AS monthly_Rental_Fees,
				            SAL0001D.TOT_AMT AS registration_Fees,
				            SAL0022D.CUST_ACC_BANK_ID AS bank_Code,
				            SAL0022D.CUST_ACC_NO AS card_Account_No,
				            SAL0047D.SIRIM_NO AS sirim_No,
				            SAL0047D.SERIAL_NO AS serial_No,
				            to_char(SAL0095D.SRV_EXPR_DT,'YYYYMMDD') AS Membership_Contract_Expiry,
				            SAL0071D.STUS_CODE_ID AS rental_Status,
				            SYS0005M.CODE AS dsc_Code,
				            to_char(SAL0047D.INSTALL_DT,'YYYYMMDD') AS installation_Date,
				            SVC0004D.AS_WORKMNSH AS labour_Charge,
				            SVC0004D.AS_DEFECT_TYPE_ID AS defect_Type_Id,
				            SVC0004D.AS_DEFECT_GRP_ID AS defect_Group_Id,
				            SVC0004D.AS_DEFECT_ID AS defect_Id,
				            SVC0004D.AS_DEFECT_PART_GRP_ID AS defect_Part_Group_Id,
				            SVC0004D.AS_DEFECT_PART_ID AS defect_Part_Id,
				            SVC0004D.AS_DEFECT_DTL_RESN_ID AS defect_Detail_Reason_Id,
				            SVC0004D.AS_SLUTN_RESN_ID AS solution_Reason_Id,
 				            SVC0004D.AS_RESULT_REM AS result_Remark,
				            SAL0029D.NAME AS result_Cust_Name,
				            SVC0004D.AS_RESULT_MOBILE_ID AS resultIc_Mobile_No,
				            SVC0004D.AS_MALFUNC_ID AS malfunction_Code,
				            SVC0004D.AS_MALFUNC_RESN_ID AS malfunction_Reason_Code,
				            SVC0004D.AS_FAIL_RESN_ID AS failReason_Code,
				            SVC0004D.AS_CT_ID AS settled_By,
				            ORG0001D.MEM_CODE AS settle_By,
				            to_char(SVC0004D.AS_SETL_DT,'YYYYMMDD') AS settled_Date,
				            SVC0004D.AS_SETL_TM AS settled_Time,
				            SVC0004D.AS_REN_COLCT_ID AS ren_Collection_Id,
				            SVC0004D.AS_RESULT_NO AS asr_No,
				            SVC0004D.AS_FILTER_AMT AS filter_Amount,
				            SVC0004D.AS_ACSRS_AMT AS accessories_Amount,
				            SVC0004D.AS_TOT_AMT AS total_Amount
				FROM    SAL0001D,
				            SAL0002D,
				            SAL0022D,
				            SAL0023D,
				            SAL0024D,
				            SAL0027D,
				            SAL0029D,
				            SAL0045D,
				            SAL0047D,
				            SAL0071D,
				            SAL0095D,
				            SVC0001D,
				            SVC0004D,
				            ORG0001D,
				            SYS0005M,
				            SYS0026M,
				            SYS0027M
				WHERE SAL0001D.CUST_ID      = SAL0022D.CUST_ID
				AND   SAL0001D.CUST_ADD_ID  = SAL0023D.CUST_ADD_ID
				AND   SAL0022D.CUST_ID      = SAL0023D.CUST_ID
				AND   SAL0001D.CUST_BILL_ID = SAL0024D.CUST_BILL_ID
				AND   SAL0001D.CUST_ID      = SAL0024D.CUST_BILL_CUST_ID
				AND   SAL0001D.CUST_ID      = SAL0027D.CUST_ID
				AND   SAL0001D.CUST_CNT_ID  = SAL0027D.CUST_CNTC_ID
				AND   SAL0001D.CUST_ID      = SAL0029D.CUST_ID
				AND   SAL0001D.SALES_ORD_ID = SAL0045D.SALES_ORD_ID
				AND   SAL0001D.SALES_ORD_ID = SVC0004D.AS_SO_ID    
				AND   SAL0001D.SALES_ORD_ID = SAL0095D.SRV_SALES_ORD_ID
				AND   SAL0001D.SALES_ORD_ID = SVC0001D.AS_SO_ID
				AND   SVC0001D.AS_ID        = SVC0004D.AS_ENTRY_ID
				AND   SAL0001D.SALES_ORD_ID = SAL0002D.SALES_ORD_ID
				AND   SAL0045D.INSTALL_ID   = SAL0047D.ENTRY_ID
				AND   SAL0002D.ITM_STK_ID   = SYS0026M.STK_ID
				AND   SAL0071D.SALES_ORD_ID = SAL0001D.SALES_ORD_ID
				AND   SYS0026M.STK_ID     = SYS0027M.STK_ID
				AND   ORG0001D.MEM_ID       = SVC0004D.AS_CT_ID
				AND   ORG0001D.BRNCH        = SYS0005M.BRNCH_ID
				AND   SVC0001D.AS_APPNT_DT BETWEEN TO_DATE(#{requestDate}, 'YYYYMMDD') AND TO_DATE(#{requestDate}, 'YYYYMMDD')
				and    ORG0001D.mem_code = #{userId}
				ORDER BY AS_APPNT_DT

                   
     </select> 





    <select id="getInstallationJobList" parameterType="Map" resultType="egovMap">
    
            SELECT B.SALES_ORD_NO AS salesOrderNo,
                   F.AS_RESULT_NO AS serviceNo,
                   A.NAME,
                   'AS' AS jobType,
                   G.AS_RESULT_STUS_ID AS jobStatus,
                   F.AS_SETL_DT AS appointmentDate,
                   F.AS_SETL_TM AS appointmentTime,
                   D.CODE,
                   C.AS_NO,
                   C.AS_REQST_DT,
                   J.CODE,
                   F.AS_RESULT_NO,
                   H.NAME,
                   B.SALES_ORD_NO,
                   I.CODE APP_TYPE,
                   A.NAME,
                   A.NRIC SVC0004D
              FROM SAL0029D A
                   INNER JOIN SAL0001D B
                      ON B.CUST_ID = A.CUST_ID
                   INNER JOIN SVC0001D C
                      ON C.AS_SO_ID = B.SALES_ORD_ID
                   INNER JOIN SVC0004D F
                      ON F.AS_ENTRY_ID = C.AS_ID
                   INNER JOIN SVC0004D G
                      ON G.AS_RESULT_ID = F.AS_RESULT_ID
                   INNER JOIN SYS0038M C
                      ON C.STUS_CODE_ID = F.AS_RESULT_STUS_ID
                   INNER JOIN SYS0038M J
                      ON J.STUS_CODE_ID = C.AS_STUS_ID
                   INNER JOIN SYS0013M D
                      ON D.CODE_ID = C.AS_TYPE_ID
                   INNER JOIN ORG0001D H
                      ON H.MEM_ID = G.AS_CT_ID
                   INNER JOIN SYS0013M I
                      ON I.CODE_ID = B.APP_TYPE_ID
             WHERE     1 = 1
                 AND C.AS_REQST_DT = TO_DATE ('20170611',    'YYYYMMDD')      
<!--                 AND A.CODY_ID = #{userId} -->  

     </select> 
     
     
     
     
     
         <select id="getProductRetrunJobList" parameterType="Map" resultType="egovMap">
    
            SELECT B.SALES_ORD_NO AS salesOrderNo,
                   F.AS_RESULT_NO AS serviceNo,
                   A.NAME,
                   'AS' AS jobType,
                   G.AS_RESULT_STUS_ID AS jobStatus,
                   F.AS_SETL_DT AS appointmentDate,
                   F.AS_SETL_TM AS appointmentTime,
                   D.CODE,
                   C.AS_NO,
                   C.AS_REQST_DT,
                   J.CODE,
                   F.AS_RESULT_NO,
                   H.NAME,
                   B.SALES_ORD_NO,
                   I.CODE APP_TYPE,
                   A.NAME,
                   A.NRIC SVC0004D
              FROM SAL0029D A
                   INNER JOIN SAL0001D B
                      ON B.CUST_ID = A.CUST_ID
                   INNER JOIN SVC0001D C
                      ON C.AS_SO_ID = B.SALES_ORD_ID
                   INNER JOIN SVC0004D F
                      ON F.AS_ENTRY_ID = C.AS_ID
                   INNER JOIN SVC0004D G
                      ON G.AS_RESULT_ID = F.AS_RESULT_ID
                   INNER JOIN SYS0038M C
                      ON C.STUS_CODE_ID = F.AS_RESULT_STUS_ID
                   INNER JOIN SYS0038M J
                      ON J.STUS_CODE_ID = C.AS_STUS_ID
                   INNER JOIN SYS0013M D
                      ON D.CODE_ID = C.AS_TYPE_ID
                   INNER JOIN ORG0001D H
                      ON H.MEM_ID = G.AS_CT_ID
                   INNER JOIN SYS0013M I
                      ON I.CODE_ID = B.APP_TYPE_ID
             WHERE     1 = 1
                 AND C.AS_REQST_DT = TO_DATE ('20170611',    'YYYYMMDD')      
<!--                 AND A.CODY_ID = #{userId} -->  

     </select> 
     
     
     
     

 	    <select id="heartServiceParts" parameterType="Map" resultType="egovMap">
 	    
			    select *
		            from (
			            SELECT S01A.SALES_ORD_ID sales_Order_No, 
						             S01A.SALES_ORD_NO service_No,
						                S08A.NO,
						                S08A.YEAR,
						                S08A.MONTH,
						                S26A.STK_CODE AS product_Code,
						                S26B.STK_CODE AS part_Code,
						                S26B.STK_DESC as part_Name,
						                S87A.SRV_FILTER_STK_ID partId,
						                L44A.BOM_COMPNT,
						                L44A.COMPNT_QTY quanity,
						                S87A.SRV_FILTER_PRV_CHG_DT last_Chg_Date,
						                S87A.SRV_FILTER_PRIOD parts_Period ,
						                NVL2(L44A.ALTER_ITM_GRP, 'N', 'Y') AS alternative_YN,
						                S06A.RESULT_ID,
						                S07A.BS_RESULT_PART_ID,
						                S07A.BS_RESULT_PART_QTY,
						                CASE WHEN S07A.BS_RESULT_PART_QTY BETWEEN '1' AND '100' THEN 'Y' ELSE 'N'
						                END as chg_YN,
						                null as ex_Chgid ,
						                null as chg_Qty,
						                null as last_Chg_Time,
						                null as alternative_Used_YN,
						                null as alternative_Filter_Code,
						                null as alternative_Filter_Id,
						                null as alternative_Filter_Name,
						                null as filterBarcd_Chk_YN,
						                null as filterBarcd_Serial_No ,
				                       S90A.SRV_CODY_ID,
				                        (SELECT MEM_CODE
				                           FROM ORG0001D ME
				                          WHERE 1 = 1 AND ME.MEM_ID = S90A.SRV_CODY_ID) as cody_cd 
						FROM SAL0001D S01A
						INNER JOIN SAL0002D S02A ON S02A.SALES_ORD_ID = S01A.SALES_ORD_ID
						INNER JOIN SYS0026M S26A ON S26A.STK_ID = S02A.ITM_STK_ID
						INNER JOIN SAL0090D S90A ON S90A.SRV_SO_ID = S01A.SALES_ORD_ID
						INNER JOIN SAL0087D S87A ON S87A.SRV_CONFIG_ID = S90A.SRV_CONFIG_ID
						INNER JOIN SYS0026M S26B ON S26B.STK_ID = S87A.SRV_FILTER_STK_ID
						INNER JOIN LOG0043M L43A ON L43A.MATRL_NO = S26A.STK_CODE
						INNER JOIN LOG0044D L44A ON L44A.BOM = L43A.BOM AND L44A.BOM_COMPNT = S26B.STK_CODE
						INNER JOIN SVC0008D S08A ON S08A.SALES_ORD_ID = S01A.SALES_ORD_ID
						LEFT  JOIN SVC0006D S06A ON S06A.SCHDUL_ID = S08A.SCHDUL_ID
						LEFT  JOIN SVC0007D S07A ON S07A.BS_RESULT_ID = S06A.RESULT_ID
			             WHERE     1 = 1
			               and S08A.YEAR = TO_CHAR(to_date(#{requestDate}  ,'YYYY/MM'),'YYYY') 
			               and S08A.MONTH = TO_CHAR(to_date(#{requestDate} ,'YYYY/MM'),'MM')  
			               and S07A.BS_RESULT_PART_ID = '0'
		)                 
		 where  cody_cd =  #{userId}      
		 

	     </select>
	
	
	
	

        <select id="afterServiceParts" parameterType="Map" resultType="egovMap">
        
					SELECT 
					SAL0001D.CUST_ID,
					SAL0001D.SALES_ORD_id AS sales_Orderid,
					SAL0001D.SALES_ORD_NO AS sales_Order_No,
					SVC0001D.AS_NO AS service_No,
					SYS0026M1.STK_CODE AS product_Code,
					SYS0026M2.STK_CODE AS part_Code,
					SYS0026M2.STK_DESC AS part_Name,
					LOG0044D.COMPNT_QTY AS quanity
					FROM SAL0001D,
								SAL0002D,
								SAL0090D,
								SAL0087D,
								SYS0026M SYS0026M1,
								SYS0026M SYS0026M2,
								LOG0043M,
								LOG0044D,
								SVC0001D
					WHERE SAL0001D.SALES_ORD_ID  = SAL0002D.SALES_ORD_ID
					AND   SAL0002D.ITM_STK_ID    = SYS0026M1.STK_ID
					AND   SAL0090D.SRV_SO_ID     = SAL0001D.SALES_ORD_ID
					AND   SAL0090D.SRV_CONFIG_ID = SAL0087D.SRV_CONFIG_ID
					AND   SYS0026M2.STK_ID       = SAL0087D.SRV_FILTER_STK_ID
					AND   LOG0043M.MATRL_NO      = SYS0026M1.STK_CODE
					AND   LOG0044D.BOM           = LOG0043M.BOM
					AND   LOG0044D.BOM_COMPNT    = SYS0026M2.STK_CODE
					AND   SAL0001D.SALES_ORD_ID  = SVC0001D.AS_SO_ID
					AND   SVC0001D.AS_MEM_ID     = (SELECT MEM_ID
					                                                        FROM ORG0001D
					                                                            WHERE ORG0001D.MEM_CODE = #{userId})
					AND   SVC0001D.AS_APPNT_DT BETWEEN TO_DATE(#{requestDate}, 'YYYYMMDD') AND TO_DATE(#{requestDate}, 'YYYYMMDD')
					ORDER BY AS_NO
         </select>
         
         
         	
	
	    <insert id="insertHeatLog" parameterType="Map">
	        INSERT INTO SVC0023T (
	           RESULT_SEQ
	           , RESULT_CRT_USER_ID
	           , SALES_ORD_ID
	           , SVC_NO
	           , TEMPER_SETTING
	           , NORESULT_REM
	           , NEXT_APPT_DATE
	           , NEXT_APPT_TIME
	           , OWNER_CODE
	           , RESULT_CUST_NAME
	           , RESULT_IC_MOBILE_NO
	           , RESULT_EMAIL_NO
	           , ACCEPTANCE_NAME
	           , REN_COLCT_ID
	           , SIGN_DATA
	           , BS_RESULT_PART_ID
	           , EXCH_REASON_ID
	           , BS_RESULT_PART_QTY
	           ,CRT_USER_ID
	           , CRT_DT
	           , TRNSC_ID
	           , TRAN_STUS_CD
	        ) VALUES (
	           SVC0023T_RESULT_SEQ.NEXTVAL
	           , #{userId}
	           , #{salesOrderNo}
	           , #{serviceNo}
	           , #{temperatureSetting}
	           , #{resultRemark}
	           , #{nextAppointmentDate}
	           , #{nextAppointmentTime}
	           , #{ownerCode}
	           , #{resultCustName}
	           , #{resultIcMobileNo}
	           , #{resultReportEmailNo}
	           , #{resultAcceptanceName}
	           , #{rcCode}
	           , #{signData}
	           , #{filterCode}
	           , #{exchangeId}
	           , #{filterChangeQty}
	           , #{userId}
	           , SYSDATE
	           , #{transactionId}
	           , 'N'
	        )
	    </insert>
	
	
	
	
        <insert id="insertAsResultLog" parameterType="Map">
            INSERT INTO SVC0024T (
				RESULT_SEQ
				,RESULT_CRT_USER_ID
				,SALES_ORD_ID
				,SVC_NO
				,LABOUR_CHRG
				,AS_DEFECT_ID
				,AS_DEFECT_PART_ID
				,AS_DEFECT_DTL_RESN_ID
				,AS_SLUTN_RESN_ID
				,AS_DEFECT_TYPE_ID
				,IN_HUSE_REPAIR_REM
				,IN_HUSE_REPAIR_REP_YN
				,IN_HUSE_REPAIR_PROMS_DATE
				,IN_HUSE_REPAIR_PROD_GRP_CODE
				,IN_HUSE_REPAIR_PROD_CODE
				,IN_HUSE_REPAIR_SERIAL_NO
				,RESULT_REM
				,OWNER_CODE
				,RESULT_CUST_NAME
				,RESULT_IC_MOBILE_NO
				,RESULT_EMAIL_NO
				,ACCEPTANCE_NAME
				,SIGN_DATA
				,TRNSC_ID
				,AS_RESULT_PART_ID
				,CHRG_FOC
				,EXCH_REASON_ID
				,SALES_PRC
				,AS_RESULT_PART_QTY
				,PART_TYPE
<!-- 				,filterBarcdSerialNo -->
				,CRT_USER_ID
				,CRT_DT
				,TRAN_STUS_CD
            ) VALUES (
               SVC0024T_RESULT_SEQ.NEXTVAL
				,#{userId}
				,#{salesOrderNo}
				,#{serviceNo}
				,#{labourCharge}
				,#{defectId}
				,#{defectPartId}
				,#{defectDetailReasonId}
				,#{solutionReasonId}
				,#{defectTypeId}
				,#{inHouseRepairRemark}
				,#{inHouseRepairReplacementYN}
				,#{inHouseRepairPromisedDate}
				,#{inHouseRepairProductGroupCode}
				,#{inHouseRepairProductCode}
				,#{inHouseRepairSerialNo}
				,#{resultRemark}
				,#{ownerCode}
				,#{resultCustName}
				,#{resultIcMobileNo}
				,#{resultReportEmailNo}
				,#{resultAcceptanceName}
				,#{signData}
				,#{transactionId}
				,#{filterCode}
				,#{chargesFoc}
				,#{exchangeId}
				,#{salesPrice}
				,#{filterChangeQty}
				,#{partsType}
<!-- 				,#{filterBarcdSerialNo} --> 
               ,#{userId}
               , SYSDATE
               , 'N'
            )
        </insert>
        
        
        
        	
	   <update id="updateSuccessStatus" parameterType="string">
	      UPDATE SVC0023T SET   TRAN_STUS_CD = 'Y' WHERE TRNSC_ID = #{transactionId}
	   </update>


       <update id="updateSuccessASStatus" parameterType="string">
          UPDATE SVC0024T SET   TRAN_STUS_CD = 'Y' WHERE TRNSC_ID = #{transactionId}
       </update>
       
       

       <update id="updateSuccessInstallStatus" parameterType="string">
          UPDATE SVC0025T SET   TRAN_STUS_CD = 'Y' WHERE TRNSC_ID = #{transactionId}
       </update>
       
              
       

        <select id="getNextSvc006dSeq"  resultType="int">
             select GBSLCVD.SVC0006D_RESULT_ID_SEQ.NEXTVAL
                from dual
        </select>
        
        
        
         <insert id="insertHsResultD" parameterType="Map">
         
              insert into SVC0007D (
                         BS_RESULT_ITM_ID
                        ,BS_RESULT_ID
                        ,BS_RESULT_PART_ID
                        ,BS_RESULT_PART_QTY
                        ,BS_RESULT_CRT_DT
                        ,BS_RESULT_CRT_USER_ID
                        )
                 values (
                      GBSLCVD.SVC0007D_BS_RESULT_ITM_ID_SEQ.nextval
                    , #{bsResultId}
                    , #{filterCode}
                    , #{filterChangeQty}
                    , sysdate
                    , #{userId}
            )
            </insert>         
        
        
             <select id="selectHSScheduleMCnt"  parameterType="Map" resultType="int">
                        SELECT count(*) cnt
                          FROM SVC0008D Extent1
                        WHERE  Extent1.SCHDUL_ID = #{schdulId} 
              </select>


             <select id="selectHSResultMList"  parameterType="Map" resultType="egovMap">
                        SELECT Extent1.RESULT_ID RESULT_ID  ,
                               Extent1.NO NO  ,
                               Extent1.TYPE_ID TYPE_ID  ,
                               Extent1.SCHDUL_ID SCHDUL_ID  ,
                               Extent1.SALES_ORD_ID SALES_ORD_ID  ,
                               Extent1.CODY_ID CODY_ID  ,
                               Extent1.SETL_DT SETL_DT  ,
                               Extent1.RESULT_STUS_CODE_ID RESULT_STUS_CODE_ID  ,
                               Extent1.FAIL_RESN_ID FAIL_RESN_ID  ,
                               Extent1.REN_COLCT_ID REN_COLCT_ID  ,
                               Extent1.WH_ID WH_ID  ,
                               Extent1.RESULT_REM RESULT_REM  ,
                               Extent1.RESULT_CRT_DT RESULT_CRT_DT  ,
                               Extent1.RESULT_CRT_USER_ID RESULT_CRT_USER_ID  ,
                               Extent1.RESULT_UPD_DT RESULT_UPD_DT  ,
                               Extent1.RESULT_UPD_USER_ID RESULT_UPD_USER_ID  ,
                               Extent1.RESULT_IS_SYNC RESULT_IS_SYNC  ,
                               Extent1.RESULT_IS_EDIT RESULT_IS_EDIT  ,
                               Extent1.RESULT_STOCK_USE RESULT_STOCK_USE  ,
                               Extent1.RESULT_IS_CURR RESULT_IS_CURR  ,
                               Extent1.RESULT_MTCH_ID RESULT_MTCH_ID  ,
                               Extent1.RESULT_IS_ADJ RESULT_IS_ADJ  ,
                               Extent1.RESULT_ENTRY_POINT RESULT_ENTRY_POINT  ,
                               Extent1.RESULT_MOBILE_ID RESULT_MOBILE_ID  
                          FROM SVC0006D Extent1
                <![CDATA[        WHERE  Extent1.SCHDUL_ID = #{schdulId}  AND ROWNUM <= 1    ]]> 

                    </select>
                    
                    


                  <update id="updateHsSVC0008D" parameterType="Map">
                        UPDATE SVC0008D
                           SET STUS_CODE_ID = #{resultStusCodeId}
                                ,ACTN_MEM_ID = #{memId}
                                ,CODY_ID = #{memId}
                         WHERE   SCHDUL_ID = #{schdulId}
                    </update>                    



                    <select id="selectSrvConfiguration" parameterType="Map" resultType="egovMap">
                                SELECT Extent1.RESULT_ID RESULT_ID  ,
                                       Extent1.NO NO  ,
                                       Extent1.TYPE_ID TYPE_ID  ,
                                       Extent1.SCHDUL_ID SCHDUL_ID  ,
                                       Extent1.SALES_ORD_ID SALES_ORD_ID  ,
                                       Extent1.CODY_ID CODY_ID  ,
                                       Extent1.SETL_DT SETL_DT  ,
                                       Extent1.RESULT_STUS_CODE_ID RESULT_STUS_CODE_ID  ,
                                       Extent1.FAIL_RESN_ID FAIL_RESN_ID  ,
                                       Extent1.REN_COLCT_ID REN_COLCT_ID  ,
                                       Extent1.WH_ID WH_ID  ,
                                       Extent1.RESULT_REM RESULT_REM  ,
                                       Extent1.RESULT_CRT_DT RESULT_CRT_DT  ,
                                       Extent1.RESULT_CRT_USER_ID RESULT_CRT_USER_ID  ,
                                       Extent1.RESULT_UPD_DT RESULT_UPD_DT  ,
                                       Extent1.RESULT_UPD_USER_ID RESULT_UPD_USER_ID  ,
                                       Extent1.RESULT_IS_SYNC RESULT_IS_SYNC  ,
                                       Extent1.RESULT_IS_EDIT RESULT_IS_EDIT  ,
                                       Extent1.RESULT_STOCK_USE RESULT_STOCK_USE  ,
                                       Extent1.RESULT_IS_CURR RESULT_IS_CURR  ,
                                       Extent1.RESULT_MTCH_ID RESULT_MTCH_ID  ,
                                       Extent1.RESULT_IS_ADJ RESULT_IS_ADJ  ,
                                       Extent1.RESULT_ENTRY_POINT RESULT_ENTRY_POINT  ,
                                       Extent1.RESULT_MOBILE_ID RESULT_MOBILE_ID  
                                  FROM SVC0006D Extent1
                            <![CDATA[    WHERE  Extent1.SALES_ORD_ID = #{salesOrdId} AND ROWNUM <= 1 ]]> 
                            </select>
                            
                            
             <insert id="insertHsResultSVC0006D" parameterType="Map" >
               INSERT INTO GBSLCVD.SVC0006D (
                       RESULT_ID, NO, TYPE_ID, SCHDUL_ID, SALES_ORD_ID , CODY_ID
                      ,SETL_DT,RESULT_STUS_CODE_ID,FAIL_RESN_ID  , REN_COLCT_ID,WH_ID
                      ,RESULT_REM,RESULT_CRT_DT,RESULT_CRT_USER_ID,RESULT_UPD_DT,RESULT_UPD_USER_ID
                      ,RESULT_IS_SYNC,RESULT_IS_EDIT,RESULT_STOCK_USE,RESULT_IS_CURR,RESULT_MTCH_ID
                      ,RESULT_IS_ADJ
                       ) 
                VALUES ( #{bsResultId}, #{docNo} , #{typeId},#{schdulId} ,#{salesOrdId} ,#{memId}
                             ,SYSDATE,#{resultStusCodeId},#{failResnId} ,#{renColctId},#{whId}
                            ,#{resultRemark} ,SYSDATE,#{memId},SYSDATE ,#{memId}
                            ,#{resultIsSync},#{resultIsEdit},#{resultStockUse},#{resultIsCurr},#{resultMtchId}
                            ,#{resultIsAdj}
                 )
             </insert>
             
                                         
             <select id="selectHsAssiinlList" parameterType="Map" resultType="egovMap">
						 
                            SELECT  distinct Project2.No No  ,
                                        Project2.HS_DATE HS_DATE  ,
                                        Project2.STUS_CODE_ID STUS_CODE_ID  ,
                                        Project2.Code Code  ,
                                        Project2.SALES_ORD_NO SALES_ORD_NO  ,
                                        Project2.ASSIGN_CODY C5  ,
                                        Project2.ACTION_CODY as ACTN_MEM_ID,
                                        Project2.MEM_ID ,
                                        Project2.Name Name  ,
                                        Project2.cust_id,
                                        Project2.cody_status_nm,
                                        Project2.BRNCH_ID as BRNCH_ID,
                                        Project2.SCHDUL_ID SCHDUL_ID   ,
                                        Project2.SALES_ORD_ID,
                                        Project2.branch_cd,
                                        Project2.CODY_MANGR_USER_ID,
                                        Project2.MEM_CODE,
                                        Project2.sal_mem_id                                        
                         from(       SELECT HS.NO AS NO,
                                                   HS.STUS_CODE_ID as STUS_CODE_ID,
                                                   HS.MONTH || '/' || HS.YEAR as HS_DATE ,
                                                   HS.MONTH,
                                                   HS.YEAR,
                                                   ST.CODE,
                                                   HR.NO AS Result,
                                                   SO.SALES_ORD_NO,
                                                   AP.CODE AS AppType,
                                                   CU.NAME,
                                                   CD.MEM_CODE AS ASSIGN_CODY,
                                                   CD.MEM_ID,
                                                   AC.MEM_CODE AS ACTION_CODY,
                                                   MG.STATE,
                                                   MG.AREA,
                                                   cu.CUST_ID as cust_id,
                                                (select code
                                                   from SYS0038M
                                                   where 1=1
                                                   and stus_code_id = cu.STUS_CODE_ID ) as cody_status_nm,
                                                   SO.BRNCH_ID as BRNCH_ID,
                                                   HS.SCHDUL_ID SCHDUL_ID  ,
                                                    SO.SALES_ORD_ID,
                                                   BR.CODE as branch_cd,
                                                   MG.CODY_MANGR_USER_ID  ,
                                                   ( select  MEM_CODE
                                                    from ORG0001D
                                                    where mem_id =  SO.MEM_ID) as MEM_CODE,
                                                    SO.MEM_ID as sal_mem_id
                                              FROM SVC0008D HS                                                       
                                                   INNER JOIN SAL0001D SO
                                                      ON SO.SALES_ORD_ID = HS.SALES_ORD_ID
                                                   INNER JOIN SAL0023D AD
                                                      ON AD.CUST_ADD_ID = SO.CUST_ADD_ID
                                                   INNER JOIN SYS0064M MG
                                                      ON MG.AREA_ID = AD.AREA_ID
                                                   left JOIN SVC0006D HR
                                                      ON HR.SCHDUL_ID = HS.SCHDUL_ID
                                                   INNER JOIN SYS0038M ST
                                                      ON ST.STUS_CODE_ID = HS.STUS_CODE_ID
                                                   INNER JOIN SYS0013M AP
                                                      ON AP.CODE_ID = SO.APP_TYPE_ID
                                                   INNER JOIN SAL0029D CU
                                                      ON CU.CUST_ID = SO.CUST_ID
                                                   INNER JOIN ORG0001D CD
                                                      ON CD.MEM_ID = HS.CODY_ID
                                                   left JOIN ORG0001D AC
                                                      ON AC.MEM_ID = HS.ACTN_MEM_ID
                                                   LEFT JOIN SYS0005M BR
                                                      ON BR.CODE = MG.CODY_BRNCH_CODE                                                          
                                             WHERE 1=1
                                                    AND SO.SALES_ORD_NO = #{salesOrderNo}
                                                     and HS.no = #{serviceNo}
                        )Project2
          </select>                            


        <select id="getUseridToMemid" parameterType="Map" resultType="String">
				select MEM_ID
				from ORG0001D
				where mem_code = #{userId}
          </select>
          
          
          
          
          
          
                   
</mapper>