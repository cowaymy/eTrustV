<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.coway.trust.biz.api.impl.ChatbotInboundApiMapper">

    <select id="checkAccess" parameterType="Map" resultType="egovMap">
        SELECT *
        FROM API0001M
        WHERE API_USER_STUS_ID = 1
            AND API_USER_NAME = #{userName}
            AND API_KEY = #{key}
    </select>

    <select id="verifyCustIdentity" parameterType="Map" resultType="egovMap">
        SELECT
		    B.CUST_ID,
		    B.NAME AS CUST_NAME,
		    B.NRIC AS CUST_NRIC,
		    B.NATION AS CUST_NATION,
		    C.CODE AS CUST_TYPE
		FROM SAL0027D A
		JOIN SAL0029D B ON B.CUST_ID = A.CUST_ID
		LEFT JOIN SYS0013M C ON C.CODE_ID = B.TYPE_ID
		WHERE A.STUS_CODE_ID = 9
		AND B.STUS_CODE_ID = 1
		AND (A.TEL_M1 = #{custPhoneNo} OR A.TEL_M1 = #{custPhoneNoWoutCode})
		ORDER BY C.CODE_ID
    </select>

    <select id="isCustExist" parameterType="Map">
        SELECT
        COUNT(1)
        FROM SAL0029D
        WHERE
        CUST_ID = #{custId}
        AND NRIC = #{custNric}
    </select>

    <select id="getOrderList" parameterType="Map" resultType="egovMap">
        SELECT S01.SALES_ORD_ID, S01.SALES_ORD_NO, S01.CUST_ADD_ID, S26.STK_CODE, S26.STK_DESC, S64.AREA
		  FROM SAL0001D S01
		  JOIN SAL0002D S02 ON S01.SALES_ORD_ID = S02.SALES_ORD_ID
		  JOIN SAL0029D S29 ON S29.CUST_ID = S01.CUST_ID
		  LEFT JOIN SYS0026M S26 ON S02.ITM_STK_ID  = S26.STK_ID
		  LEFT JOIN SAL0023D S23 ON S23.CUST_ADD_ID = S01.CUST_ADD_ID
		  LEFT JOIN SYS0064M S64 ON S64.AREA_ID  =S23.AREA_ID
		  WHERE S29.CUST_ID = 1857021
		  AND S29.NRIC = '880905435884'
		  AND S01.STUS_CODE_ID <![CDATA[ <> ]]> 10
    </select>
</mapper>
