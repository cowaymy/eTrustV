<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.coway.trust.biz.logistics.seriallocation.impl.SerialLocationMapper">

    <select id="searchSerialLocationList" parameterType="Map"  resultType="EgovMap">
    SELECT
                lg63d.SERIAL_NO,
                sy28m.WH_LOC_CODE,
                sy28m.WH_LOC_DESC,
                (SELECT CODE_NAME FROM SYS0013M WHERE CODE = sy28m.WH_LOC_GB AND CODE_MASTER_ID = 339) WH_LOC_TYPE,
                lg63d.MATNR,
                sy26m.STK_DESC,
                (SELECT CODE_NAME FROM SYS0013M WHERE CODE_ID = sy26m.STK_TYPE_ID) STK_TYPE,
                (SELECT CODE_NAME FROM SYS0013M WHERE CODE_ID = sy26m.STK_CTGRY_ID) STK_CTGRY,
                TO_CHAR(TO_DATE(lg63d.GLTRI, 'YYYY/MM/DD'), 'DD/MM/YYYY') AS GLTRI,
                TO_CHAR(TO_DATE(lg63d.LWEDT, 'YYYY/MM/DD'), 'DD/MM/YYYY') AS LWEDT,
                lg63d.SWAOK,
                TO_CHAR(lg63d.CRT_DT, 'DD/MM/YYYY') AS  CRT_DT
        FROM LOG0063D lg63d , SYS0028M sy28m, SYS0026M sy26m
        WHERE lg63d.LOC_ID = sy28M.WH_LOC_ID (+)
              AND sy26m.STk_CODE = lg63d.MATNR
           <if test="srchmaterial !=null and srchmaterial !=''">
              AND lg63d.MATNR  LIKE #{srchmaterial} || '%'
        </if>
        <if test="srchserial !=null and srchserial !=''">
            AND lg63d.SERIAL_NO LIKE '%' || #{srchserial} || '%'
        </if>
         <if test="srchcatagorytype != null">
                    AND sy26m.STK_CTGRY_ID IN
                    <foreach item="item" collection="cateList" index="index" open="(" separator="," close=")">
                    #{item}
                    </foreach>
         </if>
         <if test="materialtype != null">
                    AND sy26m.STK_TYPE_ID IN
                    <foreach item="item" collection="typeList" index="index" open="(" separator="," close=")">
                    #{item}
                    </foreach>
         </if>
          <if test="hiddenLoc != null and hiddenLoc !=''">
                    AND lg63d.LOC_ID = #{hiddenLoc}
         </if>
        <if test="srchcrtdtfrom !=null and srchcrtdtfrom !='' and srchcrtdtto !=null and srchcrtdtto !=''">
            AND TO_CHAR(lg63d.CRT_DT, 'YYYYMMDD')
                 BETWEEN TO_CHAR(TO_DATE(#{srchcrtdtfrom},'DD/MM/YYYY'),'YYYYMMDD')
                 AND TO_CHAR(TO_DATE(#{srchcrtdtto},'DD/MM/YYYY'),'YYYYMMDD')
        </if>
        ORDER BY lg63d.SERIAL_NO
    </select>
</mapper>