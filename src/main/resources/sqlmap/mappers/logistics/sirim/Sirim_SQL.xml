<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.coway.trust.biz.logistics.sirim.impl.SirimMapper">
    
    
<select id="selectWarehouseList" parameterType="Map" resultType="EgovMap">  
    SELECT Extent1.WH_LOC_ID CODE_ID  ,
	           Extent1.WH_LOC_CODE CODE  ,
	           Extent1.WH_LOC_DESC CODE_NAME  
      FROM SYS0028M Extent1
      WHERE  ( 1 = Extent1.WH_LOC_STUS_ID ) 
      AND ( 'B' <![CDATA[<> ]]> Extent1.WH_LOC_STK_GRAD ) 
      AND ( 277 = Extent1.WH_LOC_TYPE_ID )
</select>


<select id="selectSirimList" parameterType="Map" resultType="EgovMap">  
SELECT Project1.SIRIM_TYPE_ID SIRIM_TYPE_ID  ,
       Project1.SIRIM_NO SIRIM_NO  ,
       Project1.SIRIM_TYPE_CODE SIRIM_TYPE_CODE  ,
       Project1.SIRIM_TYPE_NAME SIRIM_TYPE_NAME  ,
       Project1.SIRIM_LOC SIRIM_LOC  ,
       Project1.SIRIM_QTY SIRIM_QTY  
  FROM ( SELECT Extent1.SIRIM_LOC SIRIM_LOC  ,
                Extent1.SIRIM_TYPE_ID SIRIM_TYPE_ID  ,
                Extent1.SIRIM_TYPE_CODE SIRIM_TYPE_CODE  ,
                Extent1.SIRIM_TYPE_NAME SIRIM_TYPE_NAME  ,
                Extent1.SIRIM_QTY SIRIM_QTY  ,
                LTRIM(RTRIM(Extent1.SIRIM_NO)) SIRIM_NO  
         FROM ( SELECT LOG1002V.SIRIM_NO SIRIM_NO  ,
                       LOG1002V.SIRIM_LOC SIRIM_LOC  ,
                       LOG1002V.SIRIM_TYPE_ID SIRIM_TYPE_ID  ,
                       LOG1002V.SIRIM_TYPE_CODE SIRIM_TYPE_CODE  ,
                       LOG1002V.SIRIM_TYPE_NAME SIRIM_TYPE_NAME  ,
                       LOG1002V.SIRIM_QTY SIRIM_QTY  
                FROM LOG1002V ) Extent1
                WHERE 1 = 1
               <if test="searchSirimNo != null and searchSirimNo !=''">
                    AND  (LTRIM(RTRIM(Extent1.SIRIM_NO)))= #{searchSirimNo}                         
		       </if> 
		       <if test="searchCategory != null and searchCategory !=''">
		             AND Extent1.SIRIM_TYPE_ID = #{searchCategory}             
		       </if>
		       <if test="searchWarehouse != null and searchWarehouse !=''">
		             AND Extent1.SIRIM_LOC = #{searchWarehouse}
		       </if>
		       ) Project1
  ORDER BY Project1.SIRIM_NO ASC
</select>   


<!-- <select id="selectSirimNo" parameterType="Map" resultType="EgovMap">  
    select count(*) 
    from LOG0033D 
    where SRM_NO_FROM = #{StartSirimNo}
    AND SRM_NO_TO =#{EndSirimNo}
</select>   -->  

<!-- <select id="selectSirimNo" parameterType="Map" resultType="Integer">  
   select count(*) 
   from LOG0040D 
   where SIRIM_NO in
    <foreach item="item" collection="StartSirimNo" index="index" open="(" separator="," close=")">
            #{item}
    </foreach>
   
   
</select>  -->


 <insert id="insertSirimM" parameterType="Map">
    INSERT INTO LOG0033D(
        SRM_BATCH_ID,
        SRM_BATCH_NO, 
        SRM_NO_FROM, 
        SRM_NO_TO, 
        SRM_WH_LOC, 
        SRM_STUS_ID, 
        SRM_CRT_USER_ID, 
        SRM_CRT_DT, 
        SRM_QTY, 
        SRM_REM, 
        SRM_UPD_USER_ID, 
        SRM_UPD_DT )
     VALUES 
        ( 
        #{srmBatchId},
        #{getdocNo},
        #{SrmNoFrom},
        #{SrmNoTo},
        #{addWarehouse},
        1, 
        #{crtuser_id},
        SYSDATE,
        #{addQuantity},
        '',
        #{upuser_id},
        SYSDATE
        )
</insert> 


<insert id="insertSirimD" parameterType="Map">
    INSERT INTO LOG0034D(
        SRM_DET_ID, 
	    SRM_BATCH_ID, 
	    SRM_DCF_ID, 
	    SRM_NO, 
	    SRM_STUS_ID, 
	    SRM_CRT_USER_ID, 
	    SRM_CRT_DT, 
	    SRM_UPD_USER_ID, 
	    SRM_UPD_DT )
  VALUES 
  (
   #{srdBatchId}, 
   #{srmBatchId},
   0,
   #{saveSirimNo},
   1,
   #{crtuser_id},
   SYSDATE,
   #{upuser_id},
   SYSDATE
  )    
</insert>


<insert id="insertSirimCrd_Pos" parameterType="Map">
    INSERT INTO LOG0040D( 
    SIRIM_ID,
    SIRIM_NO, 
    SIRIM_TYPE_ID, 
    SIRIM_LOC, 
    SIRIM_QTY, 
    SIRIM_DOC_NO, 
    SIRIM_REM, 
    SIRIM_CRT_DT, 
    SIRIM_CRT_USER_ID, 
    SIRIM_SYNC_CHK, 
    SIRIM_ENTRY_POINT, 
    SIRIM_AFT_WEB_SYS )
  VALUES 
  ( 
  #{CrdSirimId},
  #{saveSirimNo},
  #{addTypeSirim},
  #{addSirimLoc},                   
  #{addSirimQty},
  #{getdocNo},
  '',
  (SELECT TO_CHAR(SYSDATE,'YYYY-MM-DD') FROM DUAL),
  #{crtuser_id},
  1,
  1,
  1 
  )
</insert>


<select id="SirimMCreateSeq" resultType="Integer">
     SELECT NVL(MAX(SRM_BATCH_ID),0) + 1 from LOG0033D
</select>
<select id="SirimDCreateSeq" resultType="Integer">
     SELECT NVL(MAX(SRM_DET_ID),0) + 1 from LOG0034D
</select> 
<select id="CrdPosCreateSeq" resultType="Integer">
     SELECT NVL(MAX(SIRIM_ID),0) + 1 from LOG0040D
</select>
<select id="docNoCreateSeq" resultType="String">
      select FN_GET_DOCNO('75') from dual
</select>   
   
   
        
</mapper>