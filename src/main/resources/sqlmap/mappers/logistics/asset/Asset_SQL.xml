<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.coway.trust.biz.logistics.asset.impl.AssetMngMapper">
    
        <resultMap id="assetClobMap" type="EgovMap">
        <result property="assetrem" column="assetrem" jdbcType="CLOB" javaType="java.lang.String"/>
        <result property="department" column="department" jdbcType="CLOB" javaType="java.lang.String"/>
        <result property="department" column="CODE_DESC" jdbcType="CLOB" javaType="java.lang.String"/>
        </resultMap>
     
    <select id="selectAssetList" parameterType="Map" resultMap="assetClobMap">
		   SELECT 
	           P1.ASSET_ID assetId  ,
	           P1.BRAND_ID brandId  ,
	           P1.NAME2 name  ,
	           P1.CTGRY_ID ctgryId  ,
	           P1.CODE_NAME codeName  ,
	           P1. COLOR_ID   colorId   ,
	           P1.CODENAME2 codeName1  ,
	           P1.CRT_DT crtDt  ,
	           P1.CRT_USER_ID crtUserId  ,
	           P1.USER_NAME userName  ,
	           P1.CURR_BRNCH_ID currBrnchId  ,
	           P1.C1 branch  ,
	           P1.CURR_DEPT_ID currDeptId  ,
	           P1.C2 department  ,
	           P1.CURR_USER_ID currUserId  ,
	           P1.C3 userName2  ,
	           P1.IMEI_NO imeiNo  ,
	           P1.MAC_ADDR macAddr  ,
	           P1.NAME name1  ,
	           P1.PURCHS_AMT purchsAmt  ,
	           P1.PURCHS_DT purchsDt  ,
	           P1.REF_NO refNo  ,
	           P1.ASSET_REM assetRem  ,
	           P1.SERIAL_NO serialNo  ,
	           P1.STUS_ID stusId  ,
	           P1.NAME1 name2  ,
	           P1.TYPE_ID typeId  ,
	           P1.CODENAME1 codeName2  ,
	           P1.UPD_DT updDt  ,
	           P1.UPD_USER_ID updUserId  ,
	           P1.USERNAME1 userName1  ,
	           P1.WRANTY_NO wrantyNo  ,
	           P1.DEALER_ID dealerId  ,
	           P1.DEALER_NAME dealerName  ,
	           P1.INVC_NO invcNo  
	      FROM ( SELECT E1.ASSET_ID ASSET_ID  ,
	                    E1.STUS_ID STUS_ID  ,
	                    E1.CTGRY_ID CTGRY_ID  ,
	                    E1.TYPE_ID TYPE_ID  ,
	                    E1.COLOR_ID COLOR_ID  ,
	                    E1.BRAND_ID BRAND_ID  ,
	                    E1.CURR_BRNCH_ID CURR_BRNCH_ID  ,
	                    E1.CURR_DEPT_ID CURR_DEPT_ID  ,
	                    E1.CURR_USER_ID CURR_USER_ID  ,
	                    E1.PURCHS_DT PURCHS_DT  ,
	                    E1.PURCHS_AMT PURCHS_AMT  ,
	                    E1.IMEI_NO IMEI_NO  ,
	                    E1.WRANTY_NO WRANTY_NO  ,
	                    E1.SERIAL_NO SERIAL_NO  ,
	                    E1.REF_NO REF_NO  ,
	                    E1.ASSET_REM ASSET_REM  ,
	                    E1.CRT_USER_ID CRT_USER_ID  ,
	                    E1.CRT_DT CRT_DT  ,
	                    E1.UPD_USER_ID UPD_USER_ID  ,
	                    E1.UPD_DT UPD_DT  ,
	                    E1.NAME NAME  ,
	                    E1.MAC_ADDR MAC_ADDR  ,
	                    E1.INVC_NO INVC_NO  ,
	                    E1.DEALER_ID DEALER_ID  ,
	                    E2.NAME NAME1  ,
	                    E3.NAME NAME2  ,
	                    E4.CODE_NAME CODE_NAME  ,
	                    E5.CODE_NAME CODENAME1  ,
	                    E6.CODE_NAME CODENAME2  ,
	                    E7.USER_NAME USER_NAME  ,
	                    E8.USER_NAME USERNAME1  ,
	                    E12.DEALER_NAME DEALER_NAME  ,
	                    CASE 
	                         WHEN ( E9.BRNCH_ID IS NOT NULL ) THEN E9.CODE
	                    ELSE null
	                       END C1  ,
	                    CASE 
	                         WHEN ( E10.DEPT_ID IS NOT NULL ) THEN E10.DEPT_NAME
	                    ELSE null
	                       END C2  ,
	                    CASE 
	                         WHEN ( E11.USER_ID IS NOT NULL ) THEN E11.USER_NAME
	                    ELSE null
	                       END C3  
	             FROM LOG0050M E1
	                    JOIN SYS0038M E2   ON E2.STUS_CODE_ID = E1.STUS_ID
	                    JOIN LOG0049M E3   ON E3.BRAND_ID = E1.BRAND_ID
	                    JOIN SYS0013M E4   ON E4.CODE_ID = E1.CTGRY_ID
	                    JOIN SYS0013M E5   ON E5.CODE_ID = E1.TYPE_ID
	                    JOIN SYS0013M E6   ON E6.CODE_ID = E1.COLOR_ID
	                    JOIN SYS0047M E7   ON E7.USER_ID = E1.CRT_USER_ID
	                    JOIN SYS0047M E8   ON E8.USER_ID = E1.UPD_USER_ID
	                    LEFT JOIN SYS0005M E9   ON E9.BRNCH_ID = E1.CURR_BRNCH_ID
	                    LEFT JOIN SYS0040M E10   ON ( E10.DEPT_ID = E1.CURR_DEPT_ID )
	                    AND ( E1.CURR_DEPT_ID > 0 )
	                    LEFT JOIN SYS0047M E11   ON ( E11.USER_ID = E1.CURR_USER_ID )
	                    AND ( E1.CURR_USER_ID > 0 )
	                    LEFT JOIN SAL0030D E12   ON E12.DEALER_ID = E1.DEALER_ID
	               WHERE  1 = E1.STUS_ID ) P1
	      ORDER BY P1.ASSET_ID ASC    
    </select>
    
    
    <select id="selectDealerList" parameterType="Map" resultType="EgovMap">
		  SELECT 
		       DEALER_ID CODE_ID  ,
		       DEALER_NAME CODE_NAME  ,
		       DEALER_NRIC DEALER_NRIC  ,
		       DEALER_EMAIL DEALER_EMAIL  ,
		       DEALER_STUS_ID DEALER_STUS_ID  ,
		       DEALER_BRNCH_ID DEALER_BRNCH_ID  ,
		       CRT_DT CRT_DT  ,
		       CRT_USER_ID CRT_USER_ID  ,
		       UPD_DT UPD_DT  ,
		       UPD_USER_ID UPD_USER_ID  ,
		       USER_ID USER_ID  ,
		       CUST_ID CUST_ID  ,
		       SBO_CODE SBO_CODE  
		  FROM SAL0030D 
		 WHERE  1 = DEALER_STUS_ID
		  ORDER BY DEALER_NAME ASC
    </select>
    
    <select id="selectBrandList" parameterType="Map" resultType="EgovMap">
	     SELECT 
               BRAND_ID CODE_ID  ,
               Name CODE_NAME  ,
               DISAB DISAB  ,
               CRT_USER_ID CRT_USER_ID  ,
               CRT_DT CRT_DT  ,
               UPD_USER_ID UPD_USER_ID  ,
               UPD_DT UPD_DT  
          FROM LOG0049M Extent1
          WHERE  0 = DISAB
          ORDER BY Name ASC
    </select>
   
    <select id="selectColorList" parameterType="Map" resultMap="assetClobMap">
         SELECT 
			 CODE_ID CODE_ID, 
			 CODE_MASTER_ID  CODE_MASTER_ID, 
			 CODE  CODE, 
			 CODE_NAME  CODE_NAME, 
			 CODE_DESC  CODE_DESC, 
			 DISAB DISAB, 
			 CRT_DT  CRT_DT, 
			 CRT_USER_ID  CRT_USER_ID, 
			 UPD_DT UPD_DT, 
			 UPD_USER_ID UPD_USER_ID, 
			 OLD_CODE_ID OLD_CODE_ID
		 FROM SYS0013M 
		 WHERE DISAB = 0
		 AND CODE_MASTER_ID = 112
         <!-- AND CODE_MASTER_ID = #{groupCode} -->
    </select>
    
    
    
    
    
    
    <insert id="insertAssetMng" parameterType="Map">
         INSERT INTO LOG0050M(
            ASSET_ID
          , STUS_ID
          , CTGRY_ID 
          , TYPE_ID  
          , COLOR_ID
          , BRAND_ID
          , CURR_BRNCH_ID
          , CURR_DEPT_ID
          , CURR_USER_ID
          , PURCHS_DT
          , PURCHS_AMT
          , IMEI_NO
          , WRANTY_NO
          , SERIAL_NO
          , REF_NO
          , ASSET_REM
          , CRT_USER_ID
          , CRT_DT
          , UPD_USER_ID
          , UPD_DT
          , NAME
          , MAC_ADDR
          , INVC_NO
          , DEALER_ID
         )  
        VALUES (
         #{inassetid}
        ,#{masterstatus}
        ,#{mastercategory} 
        ,#{mastertype}
        ,#{mastercolor}
        ,#{masterbrand}
        ,#{masterbreanch}
        ,#{curr_dept_id}
        ,#{curr_user_id}    
        <!-- ,#{masterpurchasedate} -->
        ,TO_CHAR(TO_DATE(#{masterpurchasedate}, 'DD-MM-YYYY'), 'YYYY-MM-DD') 
        ,#{masterpurchaseamount}      
        ,#{masterimeino}
        ,#{masterwarrantyno}  
        ,#{masterserialno}  
        ,#{masterrefno}
        ,#{masterremark}
        ,#{crt_user_id}      
        ,SYSDATE
        ,#{upd_user_id}
        ,SYSDATE 
        ,#{mastermodelname}
        ,#{mastermacaddress}
        ,#{masterinvoiceno}
        ,#{masterdealer}
        )
    </insert>
    <select id="AssetCreateSeq" parameterType="Map" resultType="Integer">
        SELECT NVL(MAX(ASSET_ID),0) + 1 from LOG0050M
    </select>
    
    
</mapper>